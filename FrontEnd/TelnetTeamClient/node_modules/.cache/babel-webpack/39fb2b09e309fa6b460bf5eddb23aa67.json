{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Component, ViewChild } from '@angular/core';\nimport { MatPaginator } from '@angular/material/paginator';\nimport { MatTableDataSource } from '@angular/material/table';\nimport { MatDialogConfig } from '@angular/material/dialog';\nimport { AddEmpComponent } from '../add-emp/add-emp.component';\nimport { ModifyComponent } from '../modify/modify.component';\nimport { ConfirmDialogComponent } from 'app/confirm-dialog/confirm-dialog.component';\nlet TablePaginatorComponent = class TablePaginatorComponent {\n  constructor(dataService, authService, _dialog, _snackBar) {\n    this.dataService = dataService;\n    this.authService = authService;\n    this._dialog = _dialog;\n    this._snackBar = _snackBar;\n    this.displayedColumns = ['date_Debut', 'date_Fin', 'statut', 'days', 'type', 'actions'];\n    this.dataSource = new MatTableDataSource([]);\n    this.typeCongesData = [];\n  }\n\n  ngOnInit() {\n    this.loadUserData();\n  }\n\n  loadUserData() {\n    const token = this.authService.getToken();\n\n    if (token) {\n      const parsedToken = this.parseToken(token);\n      const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\n\n      if (userId) {\n        this.dataService.getConges(userId).subscribe(congesData => {\n          this.dataService.getTypeConges().subscribe(typeCongesData => {\n            this.typeCongesData = typeCongesData;\n            const processedData = congesData.map(item => {\n              const typeConge = typeCongesData.find(tc => tc.type_Conge_Id === item.type_Conge_Id);\n              return Object.assign(Object.assign({\n                conge_Id: item.conge_Id\n              }, item), {\n                days: this.calculateDays(new Date(item.date_Debut), new Date(item.date_Fin)),\n                type: typeConge ? typeConge.type : 'Unknown'\n              });\n            });\n            this.dataSource = new MatTableDataSource(processedData);\n            this.dataSource.paginator = this.paginator;\n          }, error => {\n            console.error('Error fetching type conge data:', error);\n          });\n        }, error => {\n          console.error('Error fetching conges data:', error);\n        });\n      } else {\n        console.error('userId is undefined.');\n      }\n    } else {\n      console.error('Token is not available.');\n    }\n  }\n\n  parseToken(token) {\n    try {\n      const payload = atob(token.split('.')[1]);\n      return JSON.parse(payload);\n    } catch (error) {\n      console.error('Error parsing token:', error);\n      return null;\n    }\n  }\n\n  calculateDays(startDate, endDate) {\n    const oneDay = 24 * 60 * 60 * 1000;\n    return Math.round((endDate.getTime() - startDate.getTime()) / oneDay);\n  }\n\n  openaddemp(event) {\n    event.preventDefault();\n    const dialogConfig = new MatDialogConfig();\n    dialogConfig.autoFocus = true;\n\n    const dialogRef = this._dialog.open(AddEmpComponent, dialogConfig);\n\n    dialogRef.afterClosed().subscribe(newEmployee => {\n      if (newEmployee) {\n        const typeConge = this.typeCongesData.find(tc => tc.type_Conge_Id === newEmployee.type_Conge_Id);\n        const newData = {\n          conge_Id: newEmployee.conge_Id,\n          date_Debut: new Date(newEmployee.date_Debut),\n          date_Fin: new Date(newEmployee.date_Fin),\n          statut: newEmployee.statut,\n          days: this.calculateDays(new Date(newEmployee.date_Debut), new Date(newEmployee.date_Fin)),\n          type: typeConge ? typeConge.type : 'Unknown'\n        };\n        this.dataSource.data.push(newData);\n        this.refreshDataSource();\n        this.showSuccessMessage('Request added successfully!');\n      }\n    });\n  }\n\n  openadddelete(event) {\n    event.preventDefault();\n    const dialogConfig = new MatDialogConfig();\n    dialogConfig.autoFocus = true;\n\n    const dialogRef = this._dialog.open(ConfirmDialogComponent, dialogConfig);\n  }\n\n  refreshDataSource() {\n    this.dataSource = new MatTableDataSource(this.dataSource.data);\n    this.dataSource.paginator = this.paginator;\n  }\n\n  onEditClick(element) {\n    if (element.statut === 'Pending') {\n      this.openmodify(element);\n    } else {\n      this.showErrorMessage('The leave request cannot be modified.');\n    }\n  }\n\n  onDeleteClick(element) {\n    if (element.statut === 'Pending') {\n      this.openConfirmDialog('Are you sure you want to delete this request?').afterClosed().subscribe(result => {\n        if (result) {\n          this.delete(element);\n        }\n      });\n    } else {\n      this.showErrorMessage('The leave request cannot be deleted.');\n    }\n  }\n\n  openConfirmDialog(message) {\n    return this._dialog.open(ConfirmDialogComponent, {\n      width: '300px',\n      data: {\n        message\n      }\n    });\n  }\n\n  openmodify(element) {\n    const dialogConfig = new MatDialogConfig();\n    dialogConfig.autoFocus = true;\n    dialogConfig.data = element;\n\n    const dialogRef = this._dialog.open(ModifyComponent, dialogConfig);\n\n    dialogRef.afterClosed().subscribe(result => {\n      if (result) {\n        // Send the HTTP request to update the leave request dates\n        this.dataService.updateCongeDates(result.conge_Id, {\n          date_Debut: result.dateDebut,\n          date_Fin: result.dateFin\n        }).subscribe(() => {\n          // Update the specific leave request in dataSource\n          const index = this.dataSource.data.findIndex(item => item.conge_Id === result.conge_Id);\n\n          if (index !== -1) {\n            const updatedData = Object.assign(Object.assign({}, this.dataSource.data[index]), {\n              date_Debut: new Date(result.dateDebut),\n              date_Fin: new Date(result.dateFin),\n              days: this.calculateDays(new Date(result.dateDebut), new Date(result.dateFin))\n            });\n            this.dataSource.data[index] = updatedData;\n            this.refreshDataSource(); // Show success message\n\n            this.showSuccessMessage('Request updated!');\n          }\n        }, error => {\n          console.error('Error updating leave request dates:', error);\n        });\n      }\n    });\n  }\n\n  delete(element) {\n    this.dataService.deleteConge(element.conge_Id).subscribe(() => {\n      this.dataSource.data = this.dataSource.data.filter(item => item.conge_Id !== element.conge_Id);\n      this.refreshDataSource();\n      this.showSuccessMessage('Request deleted successfully!');\n    }, error => {\n      console.error('Error deleting leave request:', error);\n    });\n  }\n\n  showErrorMessage(message) {\n    this._snackBar.open(message, 'Close', {\n      duration: 3000\n    });\n  }\n\n  showSuccessMessage(message) {\n    this._snackBar.open(message, 'Close', {\n      duration: 3000\n    });\n  }\n\n};\n\n__decorate([ViewChild(MatPaginator)], TablePaginatorComponent.prototype, \"paginator\", void 0);\n\nTablePaginatorComponent = __decorate([Component({\n  selector: 'app-table-paginator',\n  templateUrl: './table-paginator.component.html',\n  styleUrls: ['./table-paginator.component.scss']\n})], TablePaginatorComponent);\nexport { TablePaginatorComponent };","map":{"version":3,"sources":["C:/Users/pprod/Desktop/satge PFE/satge PFE/TelnetTeamClient/src/app/table-paginator/table-paginator.component.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","Component","ViewChild","MatPaginator","MatTableDataSource","MatDialogConfig","AddEmpComponent","ModifyComponent","ConfirmDialogComponent","TablePaginatorComponent","constructor","dataService","authService","_dialog","_snackBar","displayedColumns","dataSource","typeCongesData","ngOnInit","loadUserData","token","getToken","parsedToken","parseToken","userId","nameid","getConges","subscribe","congesData","getTypeConges","processedData","map","item","typeConge","find","tc","type_Conge_Id","assign","conge_Id","days","calculateDays","Date","date_Debut","date_Fin","type","paginator","error","console","payload","atob","split","JSON","parse","startDate","endDate","oneDay","Math","round","getTime","openaddemp","event","preventDefault","dialogConfig","autoFocus","dialogRef","open","afterClosed","newEmployee","newData","statut","data","push","refreshDataSource","showSuccessMessage","openadddelete","onEditClick","element","openmodify","showErrorMessage","onDeleteClick","openConfirmDialog","result","delete","message","width","updateCongeDates","dateDebut","dateFin","index","findIndex","updatedData","deleteConge","filter","duration","prototype","selector","templateUrl","styleUrls"],"mappings":"AAAA,IAAIA,UAAU,GAAI,QAAQ,KAAKA,UAAd,IAA6B,UAAUC,UAAV,EAAsBC,MAAtB,EAA8BC,GAA9B,EAAmCC,IAAnC,EAAyC;AACnF,MAAIC,CAAC,GAAGC,SAAS,CAACC,MAAlB;AAAA,MAA0BC,CAAC,GAAGH,CAAC,GAAG,CAAJ,GAAQH,MAAR,GAAiBE,IAAI,KAAK,IAAT,GAAgBA,IAAI,GAAGK,MAAM,CAACC,wBAAP,CAAgCR,MAAhC,EAAwCC,GAAxC,CAAvB,GAAsEC,IAArH;AAAA,MAA2HO,CAA3H;AACA,MAAI,OAAOC,OAAP,KAAmB,QAAnB,IAA+B,OAAOA,OAAO,CAACC,QAAf,KAA4B,UAA/D,EAA2EL,CAAC,GAAGI,OAAO,CAACC,QAAR,CAAiBZ,UAAjB,EAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,CAAJ,CAA3E,KACK,KAAK,IAAIU,CAAC,GAAGb,UAAU,CAACM,MAAX,GAAoB,CAAjC,EAAoCO,CAAC,IAAI,CAAzC,EAA4CA,CAAC,EAA7C,EAAiD,IAAIH,CAAC,GAAGV,UAAU,CAACa,CAAD,CAAlB,EAAuBN,CAAC,GAAG,CAACH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACH,CAAD,CAAT,GAAeH,CAAC,GAAG,CAAJ,GAAQM,CAAC,CAACT,MAAD,EAASC,GAAT,EAAcK,CAAd,CAAT,GAA4BG,CAAC,CAACT,MAAD,EAASC,GAAT,CAA7C,KAA+DK,CAAnE;AAC7E,SAAOH,CAAC,GAAG,CAAJ,IAASG,CAAT,IAAcC,MAAM,CAACM,cAAP,CAAsBb,MAAtB,EAA8BC,GAA9B,EAAmCK,CAAnC,CAAd,EAAqDA,CAA5D;AACH,CALD;;AAMA,SAASQ,SAAT,EAAoBC,SAApB,QAAqC,eAArC;AACA,SAASC,YAAT,QAA6B,6BAA7B;AACA,SAASC,kBAAT,QAAmC,yBAAnC;AACA,SAASC,eAAT,QAAgC,0BAAhC;AACA,SAASC,eAAT,QAAgC,8BAAhC;AACA,SAASC,eAAT,QAAgC,4BAAhC;AACA,SAASC,sBAAT,QAAuC,6CAAvC;AACA,IAAIC,uBAAuB,GAAG,MAAMA,uBAAN,CAA8B;AACxDC,EAAAA,WAAW,CAACC,WAAD,EAAcC,WAAd,EAA2BC,OAA3B,EAAoCC,SAApC,EAA+C;AACtD,SAAKH,WAAL,GAAmBA,WAAnB;AACA,SAAKC,WAAL,GAAmBA,WAAnB;AACA,SAAKC,OAAL,GAAeA,OAAf;AACA,SAAKC,SAAL,GAAiBA,SAAjB;AACA,SAAKC,gBAAL,GAAwB,CAAC,YAAD,EAAe,UAAf,EAA2B,QAA3B,EAAqC,MAArC,EAA6C,MAA7C,EAAqD,SAArD,CAAxB;AACA,SAAKC,UAAL,GAAkB,IAAIZ,kBAAJ,CAAuB,EAAvB,CAAlB;AACA,SAAKa,cAAL,GAAsB,EAAtB;AACH;;AACDC,EAAAA,QAAQ,GAAG;AACP,SAAKC,YAAL;AACH;;AACDA,EAAAA,YAAY,GAAG;AACX,UAAMC,KAAK,GAAG,KAAKR,WAAL,CAAiBS,QAAjB,EAAd;;AACA,QAAID,KAAJ,EAAW;AACP,YAAME,WAAW,GAAG,KAAKC,UAAL,CAAgBH,KAAhB,CAApB;AACA,YAAMI,MAAM,GAAGF,WAAW,KAAK,IAAhB,IAAwBA,WAAW,KAAK,KAAK,CAA7C,GAAiD,KAAK,CAAtD,GAA0DA,WAAW,CAACG,MAArF;;AACA,UAAID,MAAJ,EAAY;AACR,aAAKb,WAAL,CAAiBe,SAAjB,CAA2BF,MAA3B,EAAmCG,SAAnC,CAA8CC,UAAD,IAAgB;AACzD,eAAKjB,WAAL,CAAiBkB,aAAjB,GAAiCF,SAAjC,CAA4CV,cAAD,IAAoB;AAC3D,iBAAKA,cAAL,GAAsBA,cAAtB;AACA,kBAAMa,aAAa,GAAGF,UAAU,CAACG,GAAX,CAAeC,IAAI,IAAI;AACzC,oBAAMC,SAAS,GAAGhB,cAAc,CAACiB,IAAf,CAAoBC,EAAE,IAAIA,EAAE,CAACC,aAAH,KAAqBJ,IAAI,CAACI,aAApD,CAAlB;AACA,qBAAO1C,MAAM,CAAC2C,MAAP,CAAc3C,MAAM,CAAC2C,MAAP,CAAc;AAAEC,gBAAAA,QAAQ,EAAEN,IAAI,CAACM;AAAjB,eAAd,EAA2CN,IAA3C,CAAd,EAAgE;AAAEO,gBAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmB,IAAIC,IAAJ,CAAST,IAAI,CAACU,UAAd,CAAnB,EAA8C,IAAID,IAAJ,CAAST,IAAI,CAACW,QAAd,CAA9C,CAAR;AAAgFC,gBAAAA,IAAI,EAAEX,SAAS,GAAGA,SAAS,CAACW,IAAb,GAAoB;AAAnH,eAAhE,CAAP;AACH,aAHqB,CAAtB;AAIA,iBAAK5B,UAAL,GAAkB,IAAIZ,kBAAJ,CAAuB0B,aAAvB,CAAlB;AACA,iBAAKd,UAAL,CAAgB6B,SAAhB,GAA4B,KAAKA,SAAjC;AACH,WARD,EAQIC,KAAD,IAAW;AACVC,YAAAA,OAAO,CAACD,KAAR,CAAc,iCAAd,EAAiDA,KAAjD;AACH,WAVD;AAWH,SAZD,EAYIA,KAAD,IAAW;AACVC,UAAAA,OAAO,CAACD,KAAR,CAAc,6BAAd,EAA6CA,KAA7C;AACH,SAdD;AAeH,OAhBD,MAiBK;AACDC,QAAAA,OAAO,CAACD,KAAR,CAAc,sBAAd;AACH;AACJ,KAvBD,MAwBK;AACDC,MAAAA,OAAO,CAACD,KAAR,CAAc,yBAAd;AACH;AACJ;;AACDvB,EAAAA,UAAU,CAACH,KAAD,EAAQ;AACd,QAAI;AACA,YAAM4B,OAAO,GAAGC,IAAI,CAAC7B,KAAK,CAAC8B,KAAN,CAAY,GAAZ,EAAiB,CAAjB,CAAD,CAApB;AACA,aAAOC,IAAI,CAACC,KAAL,CAAWJ,OAAX,CAAP;AACH,KAHD,CAIA,OAAOF,KAAP,EAAc;AACVC,MAAAA,OAAO,CAACD,KAAR,CAAc,sBAAd,EAAsCA,KAAtC;AACA,aAAO,IAAP;AACH;AACJ;;AACDN,EAAAA,aAAa,CAACa,SAAD,EAAYC,OAAZ,EAAqB;AAC9B,UAAMC,MAAM,GAAG,KAAK,EAAL,GAAU,EAAV,GAAe,IAA9B;AACA,WAAOC,IAAI,CAACC,KAAL,CAAW,CAACH,OAAO,CAACI,OAAR,KAAoBL,SAAS,CAACK,OAAV,EAArB,IAA4CH,MAAvD,CAAP;AACH;;AACDI,EAAAA,UAAU,CAACC,KAAD,EAAQ;AACdA,IAAAA,KAAK,CAACC,cAAN;AACA,UAAMC,YAAY,GAAG,IAAIzD,eAAJ,EAArB;AACAyD,IAAAA,YAAY,CAACC,SAAb,GAAyB,IAAzB;;AACA,UAAMC,SAAS,GAAG,KAAKnD,OAAL,CAAaoD,IAAb,CAAkB3D,eAAlB,EAAmCwD,YAAnC,CAAlB;;AACAE,IAAAA,SAAS,CAACE,WAAV,GAAwBvC,SAAxB,CAAmCwC,WAAD,IAAiB;AAC/C,UAAIA,WAAJ,EAAiB;AACb,cAAMlC,SAAS,GAAG,KAAKhB,cAAL,CAAoBiB,IAApB,CAAyBC,EAAE,IAAIA,EAAE,CAACC,aAAH,KAAqB+B,WAAW,CAAC/B,aAAhE,CAAlB;AACA,cAAMgC,OAAO,GAAG;AACZ9B,UAAAA,QAAQ,EAAE6B,WAAW,CAAC7B,QADV;AAEZI,UAAAA,UAAU,EAAE,IAAID,IAAJ,CAAS0B,WAAW,CAACzB,UAArB,CAFA;AAGZC,UAAAA,QAAQ,EAAE,IAAIF,IAAJ,CAAS0B,WAAW,CAACxB,QAArB,CAHE;AAIZ0B,UAAAA,MAAM,EAAEF,WAAW,CAACE,MAJR;AAKZ9B,UAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmB,IAAIC,IAAJ,CAAS0B,WAAW,CAACzB,UAArB,CAAnB,EAAqD,IAAID,IAAJ,CAAS0B,WAAW,CAACxB,QAArB,CAArD,CALM;AAMZC,UAAAA,IAAI,EAAEX,SAAS,GAAGA,SAAS,CAACW,IAAb,GAAoB;AANvB,SAAhB;AAQA,aAAK5B,UAAL,CAAgBsD,IAAhB,CAAqBC,IAArB,CAA0BH,OAA1B;AACA,aAAKI,iBAAL;AACA,aAAKC,kBAAL,CAAwB,6BAAxB;AACH;AACJ,KAfD;AAgBH;;AACDC,EAAAA,aAAa,CAACd,KAAD,EAAQ;AACjBA,IAAAA,KAAK,CAACC,cAAN;AACA,UAAMC,YAAY,GAAG,IAAIzD,eAAJ,EAArB;AACAyD,IAAAA,YAAY,CAACC,SAAb,GAAyB,IAAzB;;AACA,UAAMC,SAAS,GAAG,KAAKnD,OAAL,CAAaoD,IAAb,CAAkBzD,sBAAlB,EAA0CsD,YAA1C,CAAlB;AACH;;AACDU,EAAAA,iBAAiB,GAAG;AAChB,SAAKxD,UAAL,GAAkB,IAAIZ,kBAAJ,CAAuB,KAAKY,UAAL,CAAgBsD,IAAvC,CAAlB;AACA,SAAKtD,UAAL,CAAgB6B,SAAhB,GAA4B,KAAKA,SAAjC;AACH;;AACD8B,EAAAA,WAAW,CAACC,OAAD,EAAU;AACjB,QAAIA,OAAO,CAACP,MAAR,KAAmB,SAAvB,EAAkC;AAC9B,WAAKQ,UAAL,CAAgBD,OAAhB;AACH,KAFD,MAGK;AACD,WAAKE,gBAAL,CAAsB,uCAAtB;AACH;AACJ;;AACDC,EAAAA,aAAa,CAACH,OAAD,EAAU;AACnB,QAAIA,OAAO,CAACP,MAAR,KAAmB,SAAvB,EAAkC;AAC9B,WAAKW,iBAAL,CAAuB,+CAAvB,EAAwEd,WAAxE,GAAsFvC,SAAtF,CAAgGsD,MAAM,IAAI;AACtG,YAAIA,MAAJ,EAAY;AACR,eAAKC,MAAL,CAAYN,OAAZ;AACH;AACJ,OAJD;AAKH,KAND,MAOK;AACD,WAAKE,gBAAL,CAAsB,sCAAtB;AACH;AACJ;;AACDE,EAAAA,iBAAiB,CAACG,OAAD,EAAU;AACvB,WAAO,KAAKtE,OAAL,CAAaoD,IAAb,CAAkBzD,sBAAlB,EAA0C;AAC7C4E,MAAAA,KAAK,EAAE,OADsC;AAE7Cd,MAAAA,IAAI,EAAE;AAAEa,QAAAA;AAAF;AAFuC,KAA1C,CAAP;AAIH;;AACDN,EAAAA,UAAU,CAACD,OAAD,EAAU;AAChB,UAAMd,YAAY,GAAG,IAAIzD,eAAJ,EAArB;AACAyD,IAAAA,YAAY,CAACC,SAAb,GAAyB,IAAzB;AACAD,IAAAA,YAAY,CAACQ,IAAb,GAAoBM,OAApB;;AACA,UAAMZ,SAAS,GAAG,KAAKnD,OAAL,CAAaoD,IAAb,CAAkB1D,eAAlB,EAAmCuD,YAAnC,CAAlB;;AACAE,IAAAA,SAAS,CAACE,WAAV,GAAwBvC,SAAxB,CAAkCsD,MAAM,IAAI;AACxC,UAAIA,MAAJ,EAAY;AACR;AACA,aAAKtE,WAAL,CAAiB0E,gBAAjB,CAAkCJ,MAAM,CAAC3C,QAAzC,EAAmD;AAC/CI,UAAAA,UAAU,EAAEuC,MAAM,CAACK,SAD4B;AAE/C3C,UAAAA,QAAQ,EAAEsC,MAAM,CAACM;AAF8B,SAAnD,EAGG5D,SAHH,CAGa,MAAM;AACf;AACA,gBAAM6D,KAAK,GAAG,KAAKxE,UAAL,CAAgBsD,IAAhB,CAAqBmB,SAArB,CAA+BzD,IAAI,IAAIA,IAAI,CAACM,QAAL,KAAkB2C,MAAM,CAAC3C,QAAhE,CAAd;;AACA,cAAIkD,KAAK,KAAK,CAAC,CAAf,EAAkB;AACd,kBAAME,WAAW,GAAGhG,MAAM,CAAC2C,MAAP,CAAc3C,MAAM,CAAC2C,MAAP,CAAc,EAAd,EAAkB,KAAKrB,UAAL,CAAgBsD,IAAhB,CAAqBkB,KAArB,CAAlB,CAAd,EAA8D;AAAE9C,cAAAA,UAAU,EAAE,IAAID,IAAJ,CAASwC,MAAM,CAACK,SAAhB,CAAd;AAA0C3C,cAAAA,QAAQ,EAAE,IAAIF,IAAJ,CAASwC,MAAM,CAACM,OAAhB,CAApD;AAA8EhD,cAAAA,IAAI,EAAE,KAAKC,aAAL,CAAmB,IAAIC,IAAJ,CAASwC,MAAM,CAACK,SAAhB,CAAnB,EAA+C,IAAI7C,IAAJ,CAASwC,MAAM,CAACM,OAAhB,CAA/C;AAApF,aAA9D,CAApB;AACA,iBAAKvE,UAAL,CAAgBsD,IAAhB,CAAqBkB,KAArB,IAA8BE,WAA9B;AACA,iBAAKlB,iBAAL,GAHc,CAId;;AACA,iBAAKC,kBAAL,CAAwB,kBAAxB;AACH;AACJ,SAbD,EAaI3B,KAAD,IAAW;AACVC,UAAAA,OAAO,CAACD,KAAR,CAAc,qCAAd,EAAqDA,KAArD;AACH,SAfD;AAgBH;AACJ,KApBD;AAqBH;;AACDoC,EAAAA,MAAM,CAACN,OAAD,EAAU;AACZ,SAAKjE,WAAL,CAAiBgF,WAAjB,CAA6Bf,OAAO,CAACtC,QAArC,EAA+CX,SAA/C,CAAyD,MAAM;AAC3D,WAAKX,UAAL,CAAgBsD,IAAhB,GAAuB,KAAKtD,UAAL,CAAgBsD,IAAhB,CAAqBsB,MAArB,CAA4B5D,IAAI,IAAIA,IAAI,CAACM,QAAL,KAAkBsC,OAAO,CAACtC,QAA9D,CAAvB;AACA,WAAKkC,iBAAL;AACA,WAAKC,kBAAL,CAAwB,+BAAxB;AACH,KAJD,EAII3B,KAAD,IAAW;AACVC,MAAAA,OAAO,CAACD,KAAR,CAAc,+BAAd,EAA+CA,KAA/C;AACH,KAND;AAOH;;AACDgC,EAAAA,gBAAgB,CAACK,OAAD,EAAU;AACtB,SAAKrE,SAAL,CAAemD,IAAf,CAAoBkB,OAApB,EAA6B,OAA7B,EAAsC;AAClCU,MAAAA,QAAQ,EAAE;AADwB,KAAtC;AAGH;;AACDpB,EAAAA,kBAAkB,CAACU,OAAD,EAAU;AACxB,SAAKrE,SAAL,CAAemD,IAAf,CAAoBkB,OAApB,EAA6B,OAA7B,EAAsC;AAClCU,MAAAA,QAAQ,EAAE;AADwB,KAAtC;AAGH;;AAhKuD,CAA5D;;AAkKA5G,UAAU,CAAC,CACPiB,SAAS,CAACC,YAAD,CADF,CAAD,EAEPM,uBAAuB,CAACqF,SAFjB,EAE4B,WAF5B,EAEyC,KAAK,CAF9C,CAAV;;AAGArF,uBAAuB,GAAGxB,UAAU,CAAC,CACjCgB,SAAS,CAAC;AACN8F,EAAAA,QAAQ,EAAE,qBADJ;AAENC,EAAAA,WAAW,EAAE,kCAFP;AAGNC,EAAAA,SAAS,EAAE,CAAC,kCAAD;AAHL,CAAD,CADwB,CAAD,EAMjCxF,uBANiC,CAApC;AAOA,SAASA,uBAAT","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Component, ViewChild } from '@angular/core';\r\nimport { MatPaginator } from '@angular/material/paginator';\r\nimport { MatTableDataSource } from '@angular/material/table';\r\nimport { MatDialogConfig } from '@angular/material/dialog';\r\nimport { AddEmpComponent } from '../add-emp/add-emp.component';\r\nimport { ModifyComponent } from '../modify/modify.component';\r\nimport { ConfirmDialogComponent } from 'app/confirm-dialog/confirm-dialog.component';\r\nlet TablePaginatorComponent = class TablePaginatorComponent {\r\n    constructor(dataService, authService, _dialog, _snackBar) {\r\n        this.dataService = dataService;\r\n        this.authService = authService;\r\n        this._dialog = _dialog;\r\n        this._snackBar = _snackBar;\r\n        this.displayedColumns = ['date_Debut', 'date_Fin', 'statut', 'days', 'type', 'actions'];\r\n        this.dataSource = new MatTableDataSource([]);\r\n        this.typeCongesData = [];\r\n    }\r\n    ngOnInit() {\r\n        this.loadUserData();\r\n    }\r\n    loadUserData() {\r\n        const token = this.authService.getToken();\r\n        if (token) {\r\n            const parsedToken = this.parseToken(token);\r\n            const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\r\n            if (userId) {\r\n                this.dataService.getConges(userId).subscribe((congesData) => {\r\n                    this.dataService.getTypeConges().subscribe((typeCongesData) => {\r\n                        this.typeCongesData = typeCongesData;\r\n                        const processedData = congesData.map(item => {\r\n                            const typeConge = typeCongesData.find(tc => tc.type_Conge_Id === item.type_Conge_Id);\r\n                            return Object.assign(Object.assign({ conge_Id: item.conge_Id }, item), { days: this.calculateDays(new Date(item.date_Debut), new Date(item.date_Fin)), type: typeConge ? typeConge.type : 'Unknown' });\r\n                        });\r\n                        this.dataSource = new MatTableDataSource(processedData);\r\n                        this.dataSource.paginator = this.paginator;\r\n                    }, (error) => {\r\n                        console.error('Error fetching type conge data:', error);\r\n                    });\r\n                }, (error) => {\r\n                    console.error('Error fetching conges data:', error);\r\n                });\r\n            }\r\n            else {\r\n                console.error('userId is undefined.');\r\n            }\r\n        }\r\n        else {\r\n            console.error('Token is not available.');\r\n        }\r\n    }\r\n    parseToken(token) {\r\n        try {\r\n            const payload = atob(token.split('.')[1]);\r\n            return JSON.parse(payload);\r\n        }\r\n        catch (error) {\r\n            console.error('Error parsing token:', error);\r\n            return null;\r\n        }\r\n    }\r\n    calculateDays(startDate, endDate) {\r\n        const oneDay = 24 * 60 * 60 * 1000;\r\n        return Math.round((endDate.getTime() - startDate.getTime()) / oneDay);\r\n    }\r\n    openaddemp(event) {\r\n        event.preventDefault();\r\n        const dialogConfig = new MatDialogConfig();\r\n        dialogConfig.autoFocus = true;\r\n        const dialogRef = this._dialog.open(AddEmpComponent, dialogConfig);\r\n        dialogRef.afterClosed().subscribe((newEmployee) => {\r\n            if (newEmployee) {\r\n                const typeConge = this.typeCongesData.find(tc => tc.type_Conge_Id === newEmployee.type_Conge_Id);\r\n                const newData = {\r\n                    conge_Id: newEmployee.conge_Id,\r\n                    date_Debut: new Date(newEmployee.date_Debut),\r\n                    date_Fin: new Date(newEmployee.date_Fin),\r\n                    statut: newEmployee.statut,\r\n                    days: this.calculateDays(new Date(newEmployee.date_Debut), new Date(newEmployee.date_Fin)),\r\n                    type: typeConge ? typeConge.type : 'Unknown'\r\n                };\r\n                this.dataSource.data.push(newData);\r\n                this.refreshDataSource();\r\n                this.showSuccessMessage('Request added successfully!');\r\n            }\r\n        });\r\n    }\r\n    openadddelete(event) {\r\n        event.preventDefault();\r\n        const dialogConfig = new MatDialogConfig();\r\n        dialogConfig.autoFocus = true;\r\n        const dialogRef = this._dialog.open(ConfirmDialogComponent, dialogConfig);\r\n    }\r\n    refreshDataSource() {\r\n        this.dataSource = new MatTableDataSource(this.dataSource.data);\r\n        this.dataSource.paginator = this.paginator;\r\n    }\r\n    onEditClick(element) {\r\n        if (element.statut === 'Pending') {\r\n            this.openmodify(element);\r\n        }\r\n        else {\r\n            this.showErrorMessage('The leave request cannot be modified.');\r\n        }\r\n    }\r\n    onDeleteClick(element) {\r\n        if (element.statut === 'Pending') {\r\n            this.openConfirmDialog('Are you sure you want to delete this request?').afterClosed().subscribe(result => {\r\n                if (result) {\r\n                    this.delete(element);\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.showErrorMessage('The leave request cannot be deleted.');\r\n        }\r\n    }\r\n    openConfirmDialog(message) {\r\n        return this._dialog.open(ConfirmDialogComponent, {\r\n            width: '300px',\r\n            data: { message }\r\n        });\r\n    }\r\n    openmodify(element) {\r\n        const dialogConfig = new MatDialogConfig();\r\n        dialogConfig.autoFocus = true;\r\n        dialogConfig.data = element;\r\n        const dialogRef = this._dialog.open(ModifyComponent, dialogConfig);\r\n        dialogRef.afterClosed().subscribe(result => {\r\n            if (result) {\r\n                // Send the HTTP request to update the leave request dates\r\n                this.dataService.updateCongeDates(result.conge_Id, {\r\n                    date_Debut: result.dateDebut,\r\n                    date_Fin: result.dateFin\r\n                }).subscribe(() => {\r\n                    // Update the specific leave request in dataSource\r\n                    const index = this.dataSource.data.findIndex(item => item.conge_Id === result.conge_Id);\r\n                    if (index !== -1) {\r\n                        const updatedData = Object.assign(Object.assign({}, this.dataSource.data[index]), { date_Debut: new Date(result.dateDebut), date_Fin: new Date(result.dateFin), days: this.calculateDays(new Date(result.dateDebut), new Date(result.dateFin)) });\r\n                        this.dataSource.data[index] = updatedData;\r\n                        this.refreshDataSource();\r\n                        // Show success message\r\n                        this.showSuccessMessage('Request updated!');\r\n                    }\r\n                }, (error) => {\r\n                    console.error('Error updating leave request dates:', error);\r\n                });\r\n            }\r\n        });\r\n    }\r\n    delete(element) {\r\n        this.dataService.deleteConge(element.conge_Id).subscribe(() => {\r\n            this.dataSource.data = this.dataSource.data.filter(item => item.conge_Id !== element.conge_Id);\r\n            this.refreshDataSource();\r\n            this.showSuccessMessage('Request deleted successfully!');\r\n        }, (error) => {\r\n            console.error('Error deleting leave request:', error);\r\n        });\r\n    }\r\n    showErrorMessage(message) {\r\n        this._snackBar.open(message, 'Close', {\r\n            duration: 3000,\r\n        });\r\n    }\r\n    showSuccessMessage(message) {\r\n        this._snackBar.open(message, 'Close', {\r\n            duration: 3000,\r\n        });\r\n    }\r\n};\r\n__decorate([\r\n    ViewChild(MatPaginator)\r\n], TablePaginatorComponent.prototype, \"paginator\", void 0);\r\nTablePaginatorComponent = __decorate([\r\n    Component({\r\n        selector: 'app-table-paginator',\r\n        templateUrl: './table-paginator.component.html',\r\n        styleUrls: ['./table-paginator.component.scss']\r\n    })\r\n], TablePaginatorComponent);\r\nexport { TablePaginatorComponent };\r\n"]},"metadata":{},"sourceType":"module"}
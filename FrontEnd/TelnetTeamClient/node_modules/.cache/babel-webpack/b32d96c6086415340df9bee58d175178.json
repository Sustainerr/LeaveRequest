{"ast":null,"code":"import { EventEmitter } from '@angular/core';\nimport { Validators } from '@angular/forms';\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog'; // Import MatDialogRef\n\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/common/http\";\nimport * as i3 from \"../auth.service\";\nimport * as i4 from \"@angular/material/snack-bar\";\nimport * as i5 from \"@angular/material/dialog\";\nimport * as i6 from \"@angular/common\";\n\nfunction AddEmpComponent_option_17_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const type_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", type_r1.type_Conge_Id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(type_r1.type);\n  }\n}\n\nexport let AddEmpComponent = /*#__PURE__*/(() => {\n  class AddEmpComponent {\n    constructor(fb, http, authService, _snackBar, // Inject MatSnackBar\n    dialogRef, // Inject MatDialogRef\n    data) {\n      this.fb = fb;\n      this.http = http;\n      this.authService = authService;\n      this._snackBar = _snackBar;\n      this.dialogRef = dialogRef;\n      this.data = data;\n      this.typeCongeUrl = 'https://localhost:7216/api/TypeConges/byRole';\n      this.congesUrl = 'https://localhost:7216/api/conges';\n      this.userRole = '';\n      this.leaveTypes = [];\n      this.employeeAdded = new EventEmitter();\n      console.log('AddEmpComponent instantiated');\n      this.leaveForm = this.fb.group({\n        dateDebut: ['', Validators.required],\n        dateFin: ['', Validators.required],\n        type: ['', Validators.required]\n      });\n    }\n\n    ngOnInit() {\n      console.log('ngOnInit called');\n      const token = this.authService.getToken();\n      console.log('Token:', token);\n\n      if (token) {\n        const parsedToken = this.parseToken(token);\n        console.log('Parsed Token:', parsedToken);\n        const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\n        console.log('User ID:', userId);\n\n        if (userId) {\n          this.authService.getUserById(userId).subscribe(data => {\n            console.log('User data:', data);\n            this.userRole = data.role;\n            console.log('User Role:', this.userRole);\n            this.getLeaveTypesForRoles(this.userRole);\n          }, error => {\n            console.error('Error fetching user data:', error);\n          });\n        } else {\n          console.error('userId is undefined.');\n        }\n      } else {\n        console.error('Token is not available.');\n      }\n    }\n\n    parseToken(token) {\n      try {\n        const payload = atob(token.split('.')[1]);\n        return JSON.parse(payload);\n      } catch (error) {\n        console.error('Error parsing token:', error);\n        return null;\n      }\n    }\n\n    getLeaveTypesForRoles(role) {\n      this.getLeaveTypesByRole('Utilisateur').pipe(switchMap(utilisateurTypes => {\n        this.leaveTypes = utilisateurTypes;\n\n        if (role === 'Chef') {\n          return this.getLeaveTypesByRole('Chef');\n        } else if (role === 'Admin') {\n          return this.getLeaveTypesByRole('Chef').pipe(switchMap(chefTypes => {\n            this.leaveTypes = this.leaveTypes.concat(chefTypes);\n            return this.getLeaveTypesByRole('Admin');\n          }));\n        } else {\n          return of([]); // No additional types to fetch\n        }\n      }), catchError(error => {\n        console.error('Error fetching leave types:', error);\n        return of([]); // Return an empty array on error\n      })).subscribe(additionalTypes => {\n        if (role === 'Chef' || role === 'Admin') {\n          this.leaveTypes = this.leaveTypes.concat(additionalTypes);\n        }\n\n        console.log('Combined leave types:', this.leaveTypes);\n      });\n    }\n\n    getLeaveTypesByRole(role) {\n      const url = `${this.typeCongeUrl}/${role}`;\n      console.log(`Fetching leave types for role: ${role} from URL: ${url}`);\n      return this.http.get(url).pipe(catchError(error => {\n        console.error(`Error fetching leave types for role ${role}:`, error);\n        return of([]);\n      }));\n    }\n\n    onSubmit() {\n      if (this.leaveForm.valid) {\n        const token = this.authService.getToken();\n\n        if (token) {\n          const parsedToken = this.parseToken(token);\n          const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\n          const leaveRequest = {\n            date_Debut: this.leaveForm.value.dateDebut,\n            date_Fin: this.leaveForm.value.dateFin,\n            statut: 'Pending',\n            type_Conge_Id: this.leaveForm.value.type,\n            matricule: userId\n          };\n          console.log('Submitting leave request:', leaveRequest);\n          this.http.post(this.congesUrl, leaveRequest).subscribe(response => {\n            console.log('Leave request submitted successfully:', response);\n            this.employeeAdded.emit(response); // Display success message and close the dialog\n\n            this._snackBar.open('Request added successfully', 'Close', {\n              duration: 3000\n            });\n\n            this.dialogRef.close(); // Close the dialog\n          }, error => {\n            console.error('Error submitting leave request:', error);\n          });\n        } else {\n          console.error('Token is not available.');\n        }\n      } else {\n        console.error('Form is invalid.');\n      }\n    }\n\n  }\n\n  AddEmpComponent.ɵfac = function AddEmpComponent_Factory(t) {\n    return new (t || AddEmpComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HttpClient), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.MatSnackBar), i0.ɵɵdirectiveInject(i5.MatDialogRef), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA));\n  };\n\n  AddEmpComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddEmpComponent,\n    selectors: [[\"app-add-emp\"]],\n    outputs: {\n      employeeAdded: \"employeeAdded\"\n    },\n    decls: 20,\n    vars: 3,\n    consts: [[1, \"form-container\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"date-inputs\"], [1, \"form-group\"], [\"for\", \"dateDebut\"], [\"type\", \"date\", \"id\", \"dateDebut\", \"formControlName\", \"dateDebut\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"dateFin\"], [\"type\", \"date\", \"id\", \"dateFin\", \"formControlName\", \"dateFin\", \"required\", \"\", 1, \"form-control\"], [1, \"form-group\", \"type-input\"], [\"for\", \"type\"], [\"id\", \"type\", \"formControlName\", \"type\", \"required\", \"\", 1, \"form-control\"], [\"value\", \"\", \"disabled\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [3, \"value\"]],\n    template: function AddEmpComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function AddEmpComponent_Template_form_ngSubmit_1_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"label\", 4);\n        i0.ɵɵtext(5, \"Date Debut:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(6, \"input\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 3);\n        i0.ɵɵelementStart(8, \"label\", 6);\n        i0.ɵɵtext(9, \"Date Fin:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(10, \"input\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\", 8);\n        i0.ɵɵelementStart(12, \"label\", 9);\n        i0.ɵɵtext(13, \"Type:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(14, \"select\", 10);\n        i0.ɵɵelementStart(15, \"option\", 11);\n        i0.ɵɵtext(16, \"Select Type\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵtemplate(17, AddEmpComponent_option_17_Template, 2, 2, \"option\", 12);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"button\", 13);\n        i0.ɵɵtext(19, \"Add Employee\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.leaveForm);\n        i0.ɵɵadvance(16);\n        i0.ɵɵproperty(\"ngForOf\", ctx.leaveTypes);\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"disabled\", ctx.leaveForm.invalid);\n      }\n    },\n    directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.RequiredValidator, i1.SelectControlValueAccessor, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i6.NgForOf],\n    styles: [\".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:35px}.date-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;max-width:500px;margin-bottom:20px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;margin-right:10px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:last-child{margin-right:0}.type-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin:0 auto}\"]\n  });\n  return AddEmpComponent;\n})();","map":{"version":3,"sources":["C:/Users/pprod/Desktop/satge PFE/satge PFE/TelnetTeamClient/src/app/add-emp/add-emp.component.ts"],"names":["EventEmitter","Validators","MAT_DIALOG_DATA","i0","i1","i2","i3","i4","i5","i6","AddEmpComponent_option_17_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","type_r1","$implicit","ɵɵproperty","type_Conge_Id","ɵɵadvance","ɵɵtextInterpolate","type","AddEmpComponent","constructor","fb","http","authService","_snackBar","dialogRef","data","typeCongeUrl","congesUrl","userRole","leaveTypes","employeeAdded","console","log","leaveForm","group","dateDebut","required","dateFin","ngOnInit","token","getToken","parsedToken","parseToken","userId","nameid","getUserById","subscribe","role","getLeaveTypesForRoles","error","payload","atob","split","JSON","parse","getLeaveTypesByRole","pipe","switchMap","utilisateurTypes","chefTypes","concat","of","catchError","additionalTypes","url","get","onSubmit","valid","leaveRequest","date_Debut","value","date_Fin","statut","matricule","post","response","emit","open","duration","close","ɵfac","AddEmpComponent_Factory","t","ɵɵdirectiveInject","FormBuilder","HttpClient","AuthService","MatSnackBar","MatDialogRef","ɵcmp","ɵɵdefineComponent","selectors","outputs","decls","vars","consts","template","AddEmpComponent_Template","ɵɵlistener","AddEmpComponent_Template_form_ngSubmit_1_listener","ɵɵelement","ɵɵtemplate","invalid","directives","ɵNgNoValidate","NgControlStatusGroup","FormGroupDirective","DefaultValueAccessor","NgControlStatus","FormControlName","RequiredValidator","SelectControlValueAccessor","NgSelectOption","ɵNgSelectMultipleOption","NgForOf","styles"],"mappings":"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","sourcesContent":["import { EventEmitter } from '@angular/core';\r\nimport { Validators } from '@angular/forms';\r\nimport { MAT_DIALOG_DATA } from '@angular/material/dialog'; // Import MatDialogRef\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/forms\";\r\nimport * as i2 from \"@angular/common/http\";\r\nimport * as i3 from \"../auth.service\";\r\nimport * as i4 from \"@angular/material/snack-bar\";\r\nimport * as i5 from \"@angular/material/dialog\";\r\nimport * as i6 from \"@angular/common\";\r\nfunction AddEmpComponent_option_17_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"option\", 14);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const type_r1 = ctx.$implicit;\r\n    i0.ɵɵproperty(\"value\", type_r1.type_Conge_Id);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate(type_r1.type);\r\n} }\r\nexport class AddEmpComponent {\r\n    constructor(fb, http, authService, _snackBar, // Inject MatSnackBar\r\n    dialogRef, // Inject MatDialogRef\r\n    data) {\r\n        this.fb = fb;\r\n        this.http = http;\r\n        this.authService = authService;\r\n        this._snackBar = _snackBar;\r\n        this.dialogRef = dialogRef;\r\n        this.data = data;\r\n        this.typeCongeUrl = 'https://localhost:7216/api/TypeConges/byRole';\r\n        this.congesUrl = 'https://localhost:7216/api/conges';\r\n        this.userRole = '';\r\n        this.leaveTypes = [];\r\n        this.employeeAdded = new EventEmitter();\r\n        console.log('AddEmpComponent instantiated');\r\n        this.leaveForm = this.fb.group({\r\n            dateDebut: ['', Validators.required],\r\n            dateFin: ['', Validators.required],\r\n            type: ['', Validators.required]\r\n        });\r\n    }\r\n    ngOnInit() {\r\n        console.log('ngOnInit called');\r\n        const token = this.authService.getToken();\r\n        console.log('Token:', token);\r\n        if (token) {\r\n            const parsedToken = this.parseToken(token);\r\n            console.log('Parsed Token:', parsedToken);\r\n            const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\r\n            console.log('User ID:', userId);\r\n            if (userId) {\r\n                this.authService.getUserById(userId).subscribe((data) => {\r\n                    console.log('User data:', data);\r\n                    this.userRole = data.role;\r\n                    console.log('User Role:', this.userRole);\r\n                    this.getLeaveTypesForRoles(this.userRole);\r\n                }, (error) => {\r\n                    console.error('Error fetching user data:', error);\r\n                });\r\n            }\r\n            else {\r\n                console.error('userId is undefined.');\r\n            }\r\n        }\r\n        else {\r\n            console.error('Token is not available.');\r\n        }\r\n    }\r\n    parseToken(token) {\r\n        try {\r\n            const payload = atob(token.split('.')[1]);\r\n            return JSON.parse(payload);\r\n        }\r\n        catch (error) {\r\n            console.error('Error parsing token:', error);\r\n            return null;\r\n        }\r\n    }\r\n    getLeaveTypesForRoles(role) {\r\n        this.getLeaveTypesByRole('Utilisateur').pipe(switchMap((utilisateurTypes) => {\r\n            this.leaveTypes = utilisateurTypes;\r\n            if (role === 'Chef') {\r\n                return this.getLeaveTypesByRole('Chef');\r\n            }\r\n            else if (role === 'Admin') {\r\n                return this.getLeaveTypesByRole('Chef').pipe(switchMap((chefTypes) => {\r\n                    this.leaveTypes = this.leaveTypes.concat(chefTypes);\r\n                    return this.getLeaveTypesByRole('Admin');\r\n                }));\r\n            }\r\n            else {\r\n                return of([]); // No additional types to fetch\r\n            }\r\n        }), catchError((error) => {\r\n            console.error('Error fetching leave types:', error);\r\n            return of([]); // Return an empty array on error\r\n        })).subscribe((additionalTypes) => {\r\n            if (role === 'Chef' || role === 'Admin') {\r\n                this.leaveTypes = this.leaveTypes.concat(additionalTypes);\r\n            }\r\n            console.log('Combined leave types:', this.leaveTypes);\r\n        });\r\n    }\r\n    getLeaveTypesByRole(role) {\r\n        const url = `${this.typeCongeUrl}/${role}`;\r\n        console.log(`Fetching leave types for role: ${role} from URL: ${url}`);\r\n        return this.http.get(url).pipe(catchError((error) => {\r\n            console.error(`Error fetching leave types for role ${role}:`, error);\r\n            return of([]);\r\n        }));\r\n    }\r\n    onSubmit() {\r\n        if (this.leaveForm.valid) {\r\n            const token = this.authService.getToken();\r\n            if (token) {\r\n                const parsedToken = this.parseToken(token);\r\n                const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\r\n                const leaveRequest = {\r\n                    date_Debut: this.leaveForm.value.dateDebut,\r\n                    date_Fin: this.leaveForm.value.dateFin,\r\n                    statut: 'Pending',\r\n                    type_Conge_Id: this.leaveForm.value.type,\r\n                    matricule: userId\r\n                };\r\n                console.log('Submitting leave request:', leaveRequest);\r\n                this.http.post(this.congesUrl, leaveRequest).subscribe((response) => {\r\n                    console.log('Leave request submitted successfully:', response);\r\n                    this.employeeAdded.emit(response);\r\n                    // Display success message and close the dialog\r\n                    this._snackBar.open('Request added successfully', 'Close', {\r\n                        duration: 3000,\r\n                    });\r\n                    this.dialogRef.close(); // Close the dialog\r\n                }, (error) => {\r\n                    console.error('Error submitting leave request:', error);\r\n                });\r\n            }\r\n            else {\r\n                console.error('Token is not available.');\r\n            }\r\n        }\r\n        else {\r\n            console.error('Form is invalid.');\r\n        }\r\n    }\r\n}\r\nAddEmpComponent.ɵfac = function AddEmpComponent_Factory(t) { return new (t || AddEmpComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HttpClient), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.MatSnackBar), i0.ɵɵdirectiveInject(i5.MatDialogRef), i0.ɵɵdirectiveInject(MAT_DIALOG_DATA)); };\r\nAddEmpComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: AddEmpComponent, selectors: [[\"app-add-emp\"]], outputs: { employeeAdded: \"employeeAdded\" }, decls: 20, vars: 3, consts: [[1, \"form-container\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"date-inputs\"], [1, \"form-group\"], [\"for\", \"dateDebut\"], [\"type\", \"date\", \"id\", \"dateDebut\", \"formControlName\", \"dateDebut\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"dateFin\"], [\"type\", \"date\", \"id\", \"dateFin\", \"formControlName\", \"dateFin\", \"required\", \"\", 1, \"form-control\"], [1, \"form-group\", \"type-input\"], [\"for\", \"type\"], [\"id\", \"type\", \"formControlName\", \"type\", \"required\", \"\", 1, \"form-control\"], [\"value\", \"\", \"disabled\", \"\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\", 3, \"disabled\"], [3, \"value\"]], template: function AddEmpComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵelementStart(0, \"div\", 0);\r\n        i0.ɵɵelementStart(1, \"form\", 1);\r\n        i0.ɵɵlistener(\"ngSubmit\", function AddEmpComponent_Template_form_ngSubmit_1_listener() { return ctx.onSubmit(); });\r\n        i0.ɵɵelementStart(2, \"div\", 2);\r\n        i0.ɵɵelementStart(3, \"div\", 3);\r\n        i0.ɵɵelementStart(4, \"label\", 4);\r\n        i0.ɵɵtext(5, \"Date Debut:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelement(6, \"input\", 5);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(7, \"div\", 3);\r\n        i0.ɵɵelementStart(8, \"label\", 6);\r\n        i0.ɵɵtext(9, \"Date Fin:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelement(10, \"input\", 7);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(11, \"div\", 8);\r\n        i0.ɵɵelementStart(12, \"label\", 9);\r\n        i0.ɵɵtext(13, \"Type:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(14, \"select\", 10);\r\n        i0.ɵɵelementStart(15, \"option\", 11);\r\n        i0.ɵɵtext(16, \"Select Type\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵtemplate(17, AddEmpComponent_option_17_Template, 2, 2, \"option\", 12);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(18, \"button\", 13);\r\n        i0.ɵɵtext(19, \"Add Employee\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n    } if (rf & 2) {\r\n        i0.ɵɵadvance(1);\r\n        i0.ɵɵproperty(\"formGroup\", ctx.leaveForm);\r\n        i0.ɵɵadvance(16);\r\n        i0.ɵɵproperty(\"ngForOf\", ctx.leaveTypes);\r\n        i0.ɵɵadvance(1);\r\n        i0.ɵɵproperty(\"disabled\", ctx.leaveForm.invalid);\r\n    } }, directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.RequiredValidator, i1.SelectControlValueAccessor, i1.NgSelectOption, i1.ɵNgSelectMultipleOption, i6.NgForOf], styles: [\".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:35px}.date-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;max-width:500px;margin-bottom:20px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;margin-right:10px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:last-child{margin-right:0}.type-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin:0 auto}\"] });\r\n"]},"metadata":{},"sourceType":"module"}
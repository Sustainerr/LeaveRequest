{"ast":null,"code":"var __decorate = this && this.__decorate || function (decorators, target, key, desc) {\n  var c = arguments.length,\n      r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc,\n      d;\n  if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n  return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\n\nimport { Component, ViewEncapsulation } from '@angular/core';\nimport { Subject } from 'rxjs/index';\nimport { takeUntil } from 'rxjs/operators';\nimport { ReferenceSearch } from 'app/models/project-management/project';\nimport { PaginatorPipe } from 'app/pipes/shared';\nlet ReferencesComponent = class ReferencesComponent {\n  constructor(notificationService, dateTimeService, sortService, referenceService, router, searchFilterService) {\n    this.notificationService = notificationService;\n    this.dateTimeService = dateTimeService;\n    this.sortService = sortService;\n    this.referenceService = referenceService;\n    this.router = router;\n    this.searchFilterService = searchFilterService;\n    this.paginatorPipe = new PaginatorPipe(this.searchFilterService);\n    this.statusesIdentifiers = [];\n    this.selectedStatusesIdentifiers = [];\n    this.typesIdentifiers = [];\n    this.selectedTypesIdentifiers = [];\n    this.activitiesIdentifiers = [];\n    this.selectedActivitiesIdentifiers = [];\n    this.referenceCode = '';\n    this.title = '';\n    this.dropdownSettings = {};\n    this.dropdownStatusSettings = {};\n    this.references = [];\n    this.listView = false;\n    this.destroyed = new Subject();\n  }\n\n  ngOnInit() {\n    this.getStatuses();\n    this.getTypes();\n    this.searchFilterService.pageIndex = 0;\n    this.searchFilterService.pageSize = 24;\n    this.dropdownSettings = {\n      singleSelection: false,\n      idField: 'id',\n      textField: 'description',\n      selectAllText: 'Select All',\n      unSelectAllText: 'UnSelect All',\n      itemsShowLimit: 1,\n      enableCheckAll: true,\n      allowSearchFilter: true,\n      maxHeight: 150,\n      placeholder: 'criteria',\n      searchPlaceholderText: 'Search...'\n    };\n    this.dropdownStatusSettings = {\n      singleSelection: false,\n      idField: 'id',\n      textField: 'description',\n      selectAllText: 'Select All',\n      unSelectAllText: 'UnSelect All',\n      itemsShowLimit: 1,\n      enableCheckAll: true,\n      allowSearchFilter: false,\n      maxHeight: 150,\n      placeholder: 'criteria',\n      searchPlaceholderText: 'Search...'\n    };\n    this.subscription = this.referenceService.sortReferences.subscribe(event => {\n      this.onSortData(event);\n    });\n    this.periodTo = this.dateTimeService.today();\n    this.periodFrom = this.dateTimeService.getFirstDayFromPreviousMonth();\n    const referenceSearch = JSON.parse(sessionStorage.getItem('referenceSearch'));\n\n    if (referenceSearch !== null) {\n      this.title = referenceSearch.title;\n      this.referenceCode = referenceSearch.referenceCode;\n      this.selectedStatusesIdentifiers = referenceSearch.selectedStatusesIdentifiers;\n      this.selectedStatusesIds = this.selectedStatusesIdentifiers.map(state => state.id).join(',');\n      this.selectedTypesIdentifiers = referenceSearch.selectedTypesIdentifiers;\n      this.selectedTypesIds = this.selectedTypesIdentifiers.map(customer => customer.id).join(',');\n      this.selectedActivitiesIdentifiers = referenceSearch.selectedActivitiesIdentifiers;\n      this.selectedActivitiesIds = this.selectedActivitiesIdentifiers.map(activity => activity.id).join(',');\n\n      if (referenceSearch.periodFrom != null) {\n        this.periodFrom = referenceSearch.periodFrom;\n      }\n\n      if (referenceSearch.periodTo != null) {\n        this.periodTo = referenceSearch.periodTo;\n      }\n    }\n\n    this.refreshSubscription = this.referenceService.savedReference.pipe(takeUntil(this.destroyed)).subscribe(data => {\n      if (data && data.getPrevious === true) {\n        this.searchButton();\n        this.searchFilterService.pageSize = data.pageSize;\n        this.searchFilterService.pageIndex = data.pageIndex;\n        this.destroyed.next();\n        this.referenceService.savedReference.next();\n      }\n    });\n  }\n\n  ngOnDestroy() {\n    this.subscription.unsubscribe();\n    this.refreshSubscription.unsubscribe();\n    this.searchFilterService.showingDataLastFilter = [];\n  }\n\n  onResetAllFilters() {\n    this.onResetTitle();\n    this.onResetReference();\n    this.onResetStatus();\n    this.onResetType();\n    this.onResetStartDateRange();\n    this.onResetEndDateRange();\n    this.onResetActivity();\n  }\n\n  getStatuses() {\n    this.referenceService.getDocumentStates().subscribe(data => {\n      if (data != null) {\n        this.statusesIdentifiers = data;\n\n        if (this.selectedStatusesIds !== null && this.selectedStatusesIds !== undefined) {\n          this.selectedStatusesIds = this.statusesIdentifiers.map(status => status.id).join(',');\n        }\n      }\n    });\n  }\n\n  getTypes() {\n    this.referenceService.getTypesDocuments().subscribe(data => {\n      if (data != null) {\n        this.typesIdentifiers = data;\n\n        if (!(this.selectedTypesIds === null || this.selectedTypesIds === undefined)) {\n          this.selectedTypesIds = this.typesIdentifiers.map(status => status.id).join(',');\n        }\n      }\n    });\n  }\n\n  onResetTitle() {\n    this.title = undefined;\n  }\n\n  onResetActivity() {\n    const selectedActivities = [];\n    selectedActivities.push(this.activitiesIdentifiers.find(activity => activity.id === JSON.parse(localStorage.getItem('currentUser')).activityId));\n    this.selectedActivitiesIdentifiers = selectedActivities;\n    sessionStorage.removeItem('referenceSearch');\n  }\n\n  onResetReference() {\n    this.referenceCode = undefined;\n  }\n\n  onResetStatus() {\n    this.selectedStatusesIdentifiers = [];\n  }\n\n  onResetType() {\n    this.selectedTypesIdentifiers = [];\n  }\n\n  onResetStartDateRange() {\n    this.periodFrom = this.dateTimeService.getFirstDayFromPreviousMonth();\n  }\n\n  onResetEndDateRange() {\n    this.periodTo = this.dateTimeService.today();\n  }\n\n  searchButton() {\n    if (this.periodFrom !== null && this.periodTo !== null) {\n      this.searchFilterService.pageIndex = 0;\n      this.selectedStatusesIds = this.selectedStatusesIdentifiers.map(state => state.id).join(',');\n      this.selectedTypesIds = this.selectedTypesIdentifiers.map(type => type.id).join(',');\n      this.selectedActivitiesIds = this.selectedActivitiesIdentifiers.map(activity => activity.id).join(',');\n      const referenceSearch = new ReferenceSearch();\n      referenceSearch.title = this.title;\n      referenceSearch.referenceCode = this.referenceCode;\n      referenceSearch.selectedStatusesIdentifiers = this.selectedStatusesIdentifiers;\n      referenceSearch.selectedTypesIdentifiers = this.selectedTypesIdentifiers;\n      referenceSearch.selectedActivitiesIdentifiers = this.selectedActivitiesIdentifiers;\n      referenceSearch.periodFrom = this.periodFrom;\n      referenceSearch.periodTo = this.periodTo;\n      sessionStorage.setItem('referenceSearch', JSON.stringify(referenceSearch));\n      this.isLoading = true;\n      this.referenceService.getReferencesProjects(this.title, this.referenceCode, this.selectedStatusesIds, this.selectedTypesIds, this.selectedActivitiesIds, this.periodFrom, this.periodTo).subscribe(data => {\n        this.isLoading = false;\n        this.references = data;\n        this.lengthReferences = this.references.length;\n\n        if (data.length !== 0) {\n          this.listView = true;\n        } else {\n          this.listView = false;\n        }\n      });\n    } else {\n      this.notificationService.danger('Please fill dates fields');\n    }\n  }\n\n  onClickingEnter(event) {\n    if (event.key === 'Enter') {\n      this.searchButton();\n    }\n  }\n\n  dateOnly(event) {\n    return this.dateTimeService.dateOnly(event);\n  }\n\n  onSortData(sort) {\n    if (sort.active && sort.direction !== '') {\n      if (this.references !== undefined) {\n        this.references.sort((a, b) => {\n          const isAsc = sort.direction === 'asc';\n\n          switch (sort.active) {\n            case 'referenceCode':\n              return this.sortService.compare(a.referenceCode, b.referenceCode, isAsc, false);\n\n            case 'title':\n              return this.sortService.compare(a.title, b.title, isAsc, false);\n\n            case 'edition':\n              return this.sortService.compare(a.edition, b.edition, isAsc, true);\n\n            case 'creationDate':\n              return this.sortService.compare(a.creationDate, b.creationDate, isAsc, false);\n\n            case 'state':\n              return this.sortService.compare(a.state, b.state, isAsc, false);\n\n            case 'type':\n              return this.sortService.compare(a.type, b.type, isAsc, false);\n\n            default:\n              return 0;\n          }\n        });\n      }\n    }\n\n    this.paginatorPipe.transform(this.references, this.searchFilterService.pageIndex, this.searchFilterService.pageSize);\n  }\n\n  AddReference() {\n    this.router.navigate(['/project-management/project/add-reference']);\n\n    if (this.lengthReferences !== undefined && this.lengthReferences !== 0) {\n      this.referenceService.savedReference.next({\n        'getPrevious': false,\n        'pageIndex': this.searchFilterService.pageIndex,\n        'pageSize': this.searchFilterService.pageSize\n      });\n    }\n  }\n\n};\nReferencesComponent = __decorate([Component({\n  selector: 'app-references',\n  templateUrl: './references.component.html',\n  styleUrls: ['./references.component.scss'],\n  encapsulation: ViewEncapsulation.None\n})], ReferencesComponent);\nexport { ReferencesComponent };","map":{"version":3,"sources":["C:/Users/pprod/Desktop/satge PFE/satge PFE/TelnetTeamClient/src/app/components/project-management/project/references/references.component.ts"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","Component","ViewEncapsulation","Subject","takeUntil","ReferenceSearch","PaginatorPipe","ReferencesComponent","constructor","notificationService","dateTimeService","sortService","referenceService","router","searchFilterService","paginatorPipe","statusesIdentifiers","selectedStatusesIdentifiers","typesIdentifiers","selectedTypesIdentifiers","activitiesIdentifiers","selectedActivitiesIdentifiers","referenceCode","title","dropdownSettings","dropdownStatusSettings","references","listView","destroyed","ngOnInit","getStatuses","getTypes","pageIndex","pageSize","singleSelection","idField","textField","selectAllText","unSelectAllText","itemsShowLimit","enableCheckAll","allowSearchFilter","maxHeight","placeholder","searchPlaceholderText","subscription","sortReferences","subscribe","event","onSortData","periodTo","today","periodFrom","getFirstDayFromPreviousMonth","referenceSearch","JSON","parse","sessionStorage","getItem","selectedStatusesIds","map","state","id","join","selectedTypesIds","customer","selectedActivitiesIds","activity","refreshSubscription","savedReference","pipe","data","getPrevious","searchButton","next","ngOnDestroy","unsubscribe","showingDataLastFilter","onResetAllFilters","onResetTitle","onResetReference","onResetStatus","onResetType","onResetStartDateRange","onResetEndDateRange","onResetActivity","getDocumentStates","undefined","status","getTypesDocuments","selectedActivities","push","find","localStorage","activityId","removeItem","type","setItem","stringify","isLoading","getReferencesProjects","lengthReferences","danger","onClickingEnter","dateOnly","sort","active","direction","a","b","isAsc","compare","edition","creationDate","transform","AddReference","navigate","selector","templateUrl","styleUrls","encapsulation","None"],"mappings":"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","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nimport { Component, ViewEncapsulation } from '@angular/core';\r\nimport { Subject } from 'rxjs/index';\r\nimport { takeUntil } from 'rxjs/operators';\r\nimport { ReferenceSearch } from 'app/models/project-management/project';\r\nimport { PaginatorPipe } from 'app/pipes/shared';\r\nlet ReferencesComponent = class ReferencesComponent {\r\n    constructor(notificationService, dateTimeService, sortService, referenceService, router, searchFilterService) {\r\n        this.notificationService = notificationService;\r\n        this.dateTimeService = dateTimeService;\r\n        this.sortService = sortService;\r\n        this.referenceService = referenceService;\r\n        this.router = router;\r\n        this.searchFilterService = searchFilterService;\r\n        this.paginatorPipe = new PaginatorPipe(this.searchFilterService);\r\n        this.statusesIdentifiers = [];\r\n        this.selectedStatusesIdentifiers = [];\r\n        this.typesIdentifiers = [];\r\n        this.selectedTypesIdentifiers = [];\r\n        this.activitiesIdentifiers = [];\r\n        this.selectedActivitiesIdentifiers = [];\r\n        this.referenceCode = '';\r\n        this.title = '';\r\n        this.dropdownSettings = {};\r\n        this.dropdownStatusSettings = {};\r\n        this.references = [];\r\n        this.listView = false;\r\n        this.destroyed = new Subject();\r\n    }\r\n    ngOnInit() {\r\n        this.getStatuses();\r\n        this.getTypes();\r\n        this.searchFilterService.pageIndex = 0;\r\n        this.searchFilterService.pageSize = 24;\r\n        this.dropdownSettings = {\r\n            singleSelection: false,\r\n            idField: 'id',\r\n            textField: 'description',\r\n            selectAllText: 'Select All',\r\n            unSelectAllText: 'UnSelect All',\r\n            itemsShowLimit: 1,\r\n            enableCheckAll: true,\r\n            allowSearchFilter: true,\r\n            maxHeight: 150,\r\n            placeholder: 'criteria',\r\n            searchPlaceholderText: 'Search...'\r\n        };\r\n        this.dropdownStatusSettings = {\r\n            singleSelection: false,\r\n            idField: 'id',\r\n            textField: 'description',\r\n            selectAllText: 'Select All',\r\n            unSelectAllText: 'UnSelect All',\r\n            itemsShowLimit: 1,\r\n            enableCheckAll: true,\r\n            allowSearchFilter: false,\r\n            maxHeight: 150,\r\n            placeholder: 'criteria',\r\n            searchPlaceholderText: 'Search...'\r\n        };\r\n        this.subscription = this.referenceService.sortReferences.subscribe((event) => {\r\n            this.onSortData(event);\r\n        });\r\n        this.periodTo = this.dateTimeService.today();\r\n        this.periodFrom = this.dateTimeService.getFirstDayFromPreviousMonth();\r\n        const referenceSearch = JSON.parse(sessionStorage.getItem('referenceSearch'));\r\n        if (referenceSearch !== null) {\r\n            this.title = referenceSearch.title;\r\n            this.referenceCode = referenceSearch.referenceCode;\r\n            this.selectedStatusesIdentifiers = referenceSearch.selectedStatusesIdentifiers;\r\n            this.selectedStatusesIds = this.selectedStatusesIdentifiers.map(state => state.id).join(',');\r\n            this.selectedTypesIdentifiers = referenceSearch.selectedTypesIdentifiers;\r\n            this.selectedTypesIds = this.selectedTypesIdentifiers.map(customer => customer.id).join(',');\r\n            this.selectedActivitiesIdentifiers = referenceSearch.selectedActivitiesIdentifiers;\r\n            this.selectedActivitiesIds = this.selectedActivitiesIdentifiers.map(activity => activity.id).join(',');\r\n            if (referenceSearch.periodFrom != null) {\r\n                this.periodFrom = referenceSearch.periodFrom;\r\n            }\r\n            if (referenceSearch.periodTo != null) {\r\n                this.periodTo = referenceSearch.periodTo;\r\n            }\r\n        }\r\n        this.refreshSubscription = this.referenceService.savedReference.pipe(takeUntil(this.destroyed)).subscribe(data => {\r\n            if (data && data.getPrevious === true) {\r\n                this.searchButton();\r\n                this.searchFilterService.pageSize = data.pageSize;\r\n                this.searchFilterService.pageIndex = data.pageIndex;\r\n                this.destroyed.next();\r\n                this.referenceService.savedReference.next();\r\n            }\r\n        });\r\n    }\r\n    ngOnDestroy() {\r\n        this.subscription.unsubscribe();\r\n        this.refreshSubscription.unsubscribe();\r\n        this.searchFilterService.showingDataLastFilter = [];\r\n    }\r\n    onResetAllFilters() {\r\n        this.onResetTitle();\r\n        this.onResetReference();\r\n        this.onResetStatus();\r\n        this.onResetType();\r\n        this.onResetStartDateRange();\r\n        this.onResetEndDateRange();\r\n        this.onResetActivity();\r\n    }\r\n    getStatuses() {\r\n        this.referenceService.getDocumentStates()\r\n            .subscribe(data => {\r\n            if (data != null) {\r\n                this.statusesIdentifiers = data;\r\n                if ((this.selectedStatusesIds !== null && this.selectedStatusesIds !== undefined)) {\r\n                    this.selectedStatusesIds = this.statusesIdentifiers.map(status => status.id).join(',');\r\n                }\r\n            }\r\n        });\r\n    }\r\n    getTypes() {\r\n        this.referenceService.getTypesDocuments()\r\n            .subscribe(data => {\r\n            if (data != null) {\r\n                this.typesIdentifiers = data;\r\n                if (!(this.selectedTypesIds === null || this.selectedTypesIds === undefined)) {\r\n                    this.selectedTypesIds = this.typesIdentifiers.map(status => status.id).join(',');\r\n                }\r\n            }\r\n        });\r\n    }\r\n    onResetTitle() {\r\n        this.title = undefined;\r\n    }\r\n    onResetActivity() {\r\n        const selectedActivities = [];\r\n        selectedActivities.push(this.activitiesIdentifiers.find(activity => activity.id === JSON.parse(localStorage.getItem('currentUser')).activityId));\r\n        this.selectedActivitiesIdentifiers = selectedActivities;\r\n        sessionStorage.removeItem('referenceSearch');\r\n    }\r\n    onResetReference() {\r\n        this.referenceCode = undefined;\r\n    }\r\n    onResetStatus() {\r\n        this.selectedStatusesIdentifiers = [];\r\n    }\r\n    onResetType() {\r\n        this.selectedTypesIdentifiers = [];\r\n    }\r\n    onResetStartDateRange() {\r\n        this.periodFrom = this.dateTimeService.getFirstDayFromPreviousMonth();\r\n    }\r\n    onResetEndDateRange() {\r\n        this.periodTo = this.dateTimeService.today();\r\n    }\r\n    searchButton() {\r\n        if (this.periodFrom !== null && this.periodTo !== null) {\r\n            this.searchFilterService.pageIndex = 0;\r\n            this.selectedStatusesIds = this.selectedStatusesIdentifiers.map(state => state.id).join(',');\r\n            this.selectedTypesIds = this.selectedTypesIdentifiers.map(type => type.id).join(',');\r\n            this.selectedActivitiesIds = this.selectedActivitiesIdentifiers.map(activity => activity.id).join(',');\r\n            const referenceSearch = new ReferenceSearch();\r\n            referenceSearch.title = this.title;\r\n            referenceSearch.referenceCode = this.referenceCode;\r\n            referenceSearch.selectedStatusesIdentifiers = this.selectedStatusesIdentifiers;\r\n            referenceSearch.selectedTypesIdentifiers = this.selectedTypesIdentifiers;\r\n            referenceSearch.selectedActivitiesIdentifiers = this.selectedActivitiesIdentifiers;\r\n            referenceSearch.periodFrom = this.periodFrom;\r\n            referenceSearch.periodTo = this.periodTo;\r\n            sessionStorage.setItem('referenceSearch', JSON.stringify(referenceSearch));\r\n            this.isLoading = true;\r\n            this.referenceService.getReferencesProjects(this.title, this.referenceCode, this.selectedStatusesIds, this.selectedTypesIds, this.selectedActivitiesIds, this.periodFrom, this.periodTo).subscribe(data => {\r\n                this.isLoading = false;\r\n                this.references = data;\r\n                this.lengthReferences = this.references.length;\r\n                if (data.length !== 0) {\r\n                    this.listView = true;\r\n                }\r\n                else {\r\n                    this.listView = false;\r\n                }\r\n            });\r\n        }\r\n        else {\r\n            this.notificationService.danger('Please fill dates fields');\r\n        }\r\n    }\r\n    onClickingEnter(event) {\r\n        if (event.key === 'Enter') {\r\n            this.searchButton();\r\n        }\r\n    }\r\n    dateOnly(event) {\r\n        return this.dateTimeService.dateOnly(event);\r\n    }\r\n    onSortData(sort) {\r\n        if (sort.active && sort.direction !== '') {\r\n            if (this.references !== undefined) {\r\n                this.references.sort((a, b) => {\r\n                    const isAsc = sort.direction === 'asc';\r\n                    switch (sort.active) {\r\n                        case 'referenceCode':\r\n                            return this.sortService.compare(a.referenceCode, b.referenceCode, isAsc, false);\r\n                        case 'title':\r\n                            return this.sortService.compare(a.title, b.title, isAsc, false);\r\n                        case 'edition':\r\n                            return this.sortService.compare(a.edition, b.edition, isAsc, true);\r\n                        case 'creationDate':\r\n                            return this.sortService.compare(a.creationDate, b.creationDate, isAsc, false);\r\n                        case 'state':\r\n                            return this.sortService.compare(a.state, b.state, isAsc, false);\r\n                        case 'type':\r\n                            return this.sortService.compare(a.type, b.type, isAsc, false);\r\n                        default:\r\n                            return 0;\r\n                    }\r\n                });\r\n            }\r\n        }\r\n        this.paginatorPipe.transform(this.references, this.searchFilterService.pageIndex, this.searchFilterService.pageSize);\r\n    }\r\n    AddReference() {\r\n        this.router.navigate(['/project-management/project/add-reference']);\r\n        if (this.lengthReferences !== undefined && this.lengthReferences !== 0) {\r\n            this.referenceService.savedReference.next({\r\n                'getPrevious': false, 'pageIndex': this.searchFilterService.pageIndex,\r\n                'pageSize': this.searchFilterService.pageSize\r\n            });\r\n        }\r\n    }\r\n};\r\nReferencesComponent = __decorate([\r\n    Component({\r\n        selector: 'app-references',\r\n        templateUrl: './references.component.html',\r\n        styleUrls: ['./references.component.scss'],\r\n        encapsulation: ViewEncapsulation.None\r\n    })\r\n], ReferencesComponent);\r\nexport { ReferencesComponent };\r\n"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"@angular/material/dialog\";\nimport * as i3 from \"@angular/common/http\";\nimport * as i4 from \"../auth.service\";\nimport * as i5 from \"../services/data.service\";\nimport * as i6 from \"@angular/material/snack-bar\";\nimport * as i7 from \"@angular/common\";\n\nfunction AddEmpSomeoneComponent_option_19_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 15);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const type_r1 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", type_r1.id);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate(type_r1.name);\n  }\n}\n\nexport let AddEmpSomeoneComponent = /*#__PURE__*/(() => {\n  class AddEmpSomeoneComponent {\n    constructor(fb, dialogRef, http, authService, dataService, snackBar) {\n      this.fb = fb;\n      this.dialogRef = dialogRef;\n      this.http = http;\n      this.authService = authService;\n      this.dataService = dataService;\n      this.snackBar = snackBar;\n      this.leaveTypes = [];\n      this.userRole = null;\n      this.userGroupId = null;\n    }\n\n    ngOnInit() {\n      this.leaveForm = this.fb.group({\n        dateDebut: ['', Validators.required],\n        dateFin: ['', Validators.required],\n        matricule: ['', Validators.required],\n        type: ['', Validators.required]\n      });\n      this.dataService.getTypeConges().subscribe(data => {\n        this.leaveTypes = data;\n      });\n      const token = this.authService.getToken();\n\n      if (token) {\n        const parsedToken = this.parseToken(token);\n        this.userRole = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.role;\n        this.userGroupId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.groupId;\n      }\n    }\n\n    parseToken(token) {\n      try {\n        const payload = token.split('.')[1];\n        return JSON.parse(atob(payload));\n      } catch (e) {\n        return null;\n      }\n    }\n\n    onSubmit() {\n      if (this.leaveForm.valid) {\n        const token = this.authService.getToken();\n\n        if (token) {\n          const parsedToken = this.parseToken(token);\n          const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\n          const leaveRequest = {\n            date_Debut: this.leaveForm.value.dateDebut,\n            date_Fin: this.leaveForm.value.dateFin,\n            statut: 'Approved',\n            type_Conge_Id: this.leaveForm.value.type,\n            matricule: this.leaveForm.value.matricule\n          };\n          this.dataService.getUserByMatricule(leaveRequest.matricule).subscribe(user => {\n            if (user.congesDispo > 0) {\n              if (this.userRole === 'Admin') {\n                this.submitLeaveRequest(leaveRequest, user.congesDispo);\n              } else if (this.userRole === 'Chef' && this.userGroupId !== undefined) {\n                if (user.groupe_Id === this.userGroupId) {\n                  this.submitLeaveRequest(leaveRequest, user.congesDispo);\n                } else {\n                  this.snackBar.open('Error: The selected user is not in the same group.', 'Close', {\n                    duration: 3000\n                  });\n                }\n              }\n            } else {\n              this.snackBar.open(`The user with the matricule ${leaveRequest.matricule} has 0 leave requests available.`, 'Close', {\n                duration: 3000\n              });\n            }\n          });\n        } else {\n          console.error('Token is not available.');\n        }\n      } else {\n        console.error('Form is invalid.');\n      }\n    }\n\n    submitLeaveRequest(leaveRequest, congesDispo) {\n      this.http.post(`${this.dataService.getApiUrl()}/Conges`, leaveRequest).subscribe(response => {\n        this.snackBar.open(`A request has been added for the user with matricule: ${leaveRequest.matricule}`, 'Close', {\n          duration: 3000\n        });\n        this.dataService.updateCongesDispo(leaveRequest.matricule, congesDispo - 1).subscribe();\n        this.dialogRef.close();\n      }, error => {\n        console.error('Error submitting leave request:', error);\n      });\n    }\n\n  }\n\n  AddEmpSomeoneComponent.ɵfac = function AddEmpSomeoneComponent_Factory(t) {\n    return new (t || AddEmpSomeoneComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatDialogRef), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.DataService), i0.ɵɵdirectiveInject(i6.MatSnackBar));\n  };\n\n  AddEmpSomeoneComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n    type: AddEmpSomeoneComponent,\n    selectors: [[\"app-add-emp-someone\"]],\n    decls: 22,\n    vars: 2,\n    consts: [[1, \"form-container\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"date-inputs\"], [1, \"form-group\"], [\"for\", \"dateDebut\"], [\"type\", \"date\", \"id\", \"dateDebut\", \"formControlName\", \"dateDebut\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"dateFin\"], [\"type\", \"date\", \"id\", \"dateFin\", \"formControlName\", \"dateFin\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"matricule\"], [\"type\", \"text\", \"id\", \"matricule\", \"formControlName\", \"matricule\", \"required\", \"\", 1, \"form-control\"], [1, \"form-group\", \"type-input\"], [\"for\", \"type\"], [\"id\", \"type\", \"formControlName\", \"type\", \"required\", \"\", 1, \"form-control\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [3, \"value\"]],\n    template: function AddEmpSomeoneComponent_Template(rf, ctx) {\n      if (rf & 1) {\n        i0.ɵɵelementStart(0, \"div\", 0);\n        i0.ɵɵelementStart(1, \"form\", 1);\n        i0.ɵɵlistener(\"ngSubmit\", function AddEmpSomeoneComponent_Template_form_ngSubmit_1_listener() {\n          return ctx.onSubmit();\n        });\n        i0.ɵɵelementStart(2, \"div\", 2);\n        i0.ɵɵelementStart(3, \"div\", 3);\n        i0.ɵɵelementStart(4, \"label\", 4);\n        i0.ɵɵtext(5, \"Date Debut:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(6, \"input\", 5);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(7, \"div\", 3);\n        i0.ɵɵelementStart(8, \"label\", 6);\n        i0.ɵɵtext(9, \"Date Fin:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(10, \"input\", 7);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(11, \"div\", 3);\n        i0.ɵɵelementStart(12, \"label\", 8);\n        i0.ɵɵtext(13, \"Matricule:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelement(14, \"input\", 9);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(15, \"div\", 10);\n        i0.ɵɵelementStart(16, \"label\", 11);\n        i0.ɵɵtext(17, \"Type:\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(18, \"select\", 12);\n        i0.ɵɵtemplate(19, AddEmpSomeoneComponent_option_19_Template, 2, 2, \"option\", 13);\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementStart(20, \"button\", 14);\n        i0.ɵɵtext(21, \"Submit\");\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n        i0.ɵɵelementEnd();\n      }\n\n      if (rf & 2) {\n        i0.ɵɵadvance(1);\n        i0.ɵɵproperty(\"formGroup\", ctx.leaveForm);\n        i0.ɵɵadvance(18);\n        i0.ɵɵproperty(\"ngForOf\", ctx.leaveTypes);\n      }\n    },\n    directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.RequiredValidator, i1.SelectControlValueAccessor, i7.NgForOf, i1.NgSelectOption, i1.ɵNgSelectMultipleOption],\n    styles: [\".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:35px}.date-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;max-width:500px;margin-bottom:20px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;margin-right:10px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:last-child{margin-right:0}.type-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin:0 auto}\"]\n  });\n  return AddEmpSomeoneComponent;\n})();","map":{"version":3,"sources":["C:/Users/pprod/Desktop/satge PFE/satge PFE/TelnetTeamClient/src/app/add-emp-someone/add-emp-someone.component.ts"],"names":["Validators","i0","i1","i2","i3","i4","i5","i6","i7","AddEmpSomeoneComponent_option_19_Template","rf","ctx","ɵɵelementStart","ɵɵtext","ɵɵelementEnd","type_r1","$implicit","ɵɵproperty","id","ɵɵadvance","ɵɵtextInterpolate","name","AddEmpSomeoneComponent","constructor","fb","dialogRef","http","authService","dataService","snackBar","leaveTypes","userRole","userGroupId","ngOnInit","leaveForm","group","dateDebut","required","dateFin","matricule","type","getTypeConges","subscribe","data","token","getToken","parsedToken","parseToken","role","groupId","payload","split","JSON","parse","atob","e","onSubmit","valid","userId","nameid","leaveRequest","date_Debut","value","date_Fin","statut","type_Conge_Id","getUserByMatricule","user","congesDispo","submitLeaveRequest","undefined","groupe_Id","open","duration","console","error","post","getApiUrl","response","updateCongesDispo","close","ɵfac","AddEmpSomeoneComponent_Factory","t","ɵɵdirectiveInject","FormBuilder","MatDialogRef","HttpClient","AuthService","DataService","MatSnackBar","ɵcmp","ɵɵdefineComponent","selectors","decls","vars","consts","template","AddEmpSomeoneComponent_Template","ɵɵlistener","AddEmpSomeoneComponent_Template_form_ngSubmit_1_listener","ɵɵelement","ɵɵtemplate","directives","ɵNgNoValidate","NgControlStatusGroup","FormGroupDirective","DefaultValueAccessor","NgControlStatus","FormControlName","RequiredValidator","SelectControlValueAccessor","NgForOf","NgSelectOption","ɵNgSelectMultipleOption","styles"],"mappings":"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","sourcesContent":["import { Validators } from '@angular/forms';\r\nimport * as i0 from \"@angular/core\";\r\nimport * as i1 from \"@angular/forms\";\r\nimport * as i2 from \"@angular/material/dialog\";\r\nimport * as i3 from \"@angular/common/http\";\r\nimport * as i4 from \"../auth.service\";\r\nimport * as i5 from \"../services/data.service\";\r\nimport * as i6 from \"@angular/material/snack-bar\";\r\nimport * as i7 from \"@angular/common\";\r\nfunction AddEmpSomeoneComponent_option_19_Template(rf, ctx) { if (rf & 1) {\r\n    i0.ɵɵelementStart(0, \"option\", 15);\r\n    i0.ɵɵtext(1);\r\n    i0.ɵɵelementEnd();\r\n} if (rf & 2) {\r\n    const type_r1 = ctx.$implicit;\r\n    i0.ɵɵproperty(\"value\", type_r1.id);\r\n    i0.ɵɵadvance(1);\r\n    i0.ɵɵtextInterpolate(type_r1.name);\r\n} }\r\nexport class AddEmpSomeoneComponent {\r\n    constructor(fb, dialogRef, http, authService, dataService, snackBar) {\r\n        this.fb = fb;\r\n        this.dialogRef = dialogRef;\r\n        this.http = http;\r\n        this.authService = authService;\r\n        this.dataService = dataService;\r\n        this.snackBar = snackBar;\r\n        this.leaveTypes = [];\r\n        this.userRole = null;\r\n        this.userGroupId = null;\r\n    }\r\n    ngOnInit() {\r\n        this.leaveForm = this.fb.group({\r\n            dateDebut: ['', Validators.required],\r\n            dateFin: ['', Validators.required],\r\n            matricule: ['', Validators.required],\r\n            type: ['', Validators.required]\r\n        });\r\n        this.dataService.getTypeConges().subscribe((data) => {\r\n            this.leaveTypes = data;\r\n        });\r\n        const token = this.authService.getToken();\r\n        if (token) {\r\n            const parsedToken = this.parseToken(token);\r\n            this.userRole = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.role;\r\n            this.userGroupId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.groupId;\r\n        }\r\n    }\r\n    parseToken(token) {\r\n        try {\r\n            const payload = token.split('.')[1];\r\n            return JSON.parse(atob(payload));\r\n        }\r\n        catch (e) {\r\n            return null;\r\n        }\r\n    }\r\n    onSubmit() {\r\n        if (this.leaveForm.valid) {\r\n            const token = this.authService.getToken();\r\n            if (token) {\r\n                const parsedToken = this.parseToken(token);\r\n                const userId = parsedToken === null || parsedToken === void 0 ? void 0 : parsedToken.nameid;\r\n                const leaveRequest = {\r\n                    date_Debut: this.leaveForm.value.dateDebut,\r\n                    date_Fin: this.leaveForm.value.dateFin,\r\n                    statut: 'Approved',\r\n                    type_Conge_Id: this.leaveForm.value.type,\r\n                    matricule: this.leaveForm.value.matricule\r\n                };\r\n                this.dataService.getUserByMatricule(leaveRequest.matricule).subscribe(user => {\r\n                    if (user.congesDispo > 0) {\r\n                        if (this.userRole === 'Admin') {\r\n                            this.submitLeaveRequest(leaveRequest, user.congesDispo);\r\n                        }\r\n                        else if (this.userRole === 'Chef' && this.userGroupId !== undefined) {\r\n                            if (user.groupe_Id === this.userGroupId) {\r\n                                this.submitLeaveRequest(leaveRequest, user.congesDispo);\r\n                            }\r\n                            else {\r\n                                this.snackBar.open('Error: The selected user is not in the same group.', 'Close', {\r\n                                    duration: 3000,\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        this.snackBar.open(`The user with the matricule ${leaveRequest.matricule} has 0 leave requests available.`, 'Close', {\r\n                            duration: 3000,\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                console.error('Token is not available.');\r\n            }\r\n        }\r\n        else {\r\n            console.error('Form is invalid.');\r\n        }\r\n    }\r\n    submitLeaveRequest(leaveRequest, congesDispo) {\r\n        this.http.post(`${this.dataService.getApiUrl()}/Conges`, leaveRequest).subscribe((response) => {\r\n            this.snackBar.open(`A request has been added for the user with matricule: ${leaveRequest.matricule}`, 'Close', {\r\n                duration: 3000,\r\n            });\r\n            this.dataService.updateCongesDispo(leaveRequest.matricule, congesDispo - 1).subscribe();\r\n            this.dialogRef.close();\r\n        }, (error) => {\r\n            console.error('Error submitting leave request:', error);\r\n        });\r\n    }\r\n}\r\nAddEmpSomeoneComponent.ɵfac = function AddEmpSomeoneComponent_Factory(t) { return new (t || AddEmpSomeoneComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.MatDialogRef), i0.ɵɵdirectiveInject(i3.HttpClient), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.DataService), i0.ɵɵdirectiveInject(i6.MatSnackBar)); };\r\nAddEmpSomeoneComponent.ɵcmp = /*@__PURE__*/ i0.ɵɵdefineComponent({ type: AddEmpSomeoneComponent, selectors: [[\"app-add-emp-someone\"]], decls: 22, vars: 2, consts: [[1, \"form-container\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"date-inputs\"], [1, \"form-group\"], [\"for\", \"dateDebut\"], [\"type\", \"date\", \"id\", \"dateDebut\", \"formControlName\", \"dateDebut\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"dateFin\"], [\"type\", \"date\", \"id\", \"dateFin\", \"formControlName\", \"dateFin\", \"required\", \"\", 1, \"form-control\"], [\"for\", \"matricule\"], [\"type\", \"text\", \"id\", \"matricule\", \"formControlName\", \"matricule\", \"required\", \"\", 1, \"form-control\"], [1, \"form-group\", \"type-input\"], [\"for\", \"type\"], [\"id\", \"type\", \"formControlName\", \"type\", \"required\", \"\", 1, \"form-control\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [3, \"value\"]], template: function AddEmpSomeoneComponent_Template(rf, ctx) { if (rf & 1) {\r\n        i0.ɵɵelementStart(0, \"div\", 0);\r\n        i0.ɵɵelementStart(1, \"form\", 1);\r\n        i0.ɵɵlistener(\"ngSubmit\", function AddEmpSomeoneComponent_Template_form_ngSubmit_1_listener() { return ctx.onSubmit(); });\r\n        i0.ɵɵelementStart(2, \"div\", 2);\r\n        i0.ɵɵelementStart(3, \"div\", 3);\r\n        i0.ɵɵelementStart(4, \"label\", 4);\r\n        i0.ɵɵtext(5, \"Date Debut:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelement(6, \"input\", 5);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(7, \"div\", 3);\r\n        i0.ɵɵelementStart(8, \"label\", 6);\r\n        i0.ɵɵtext(9, \"Date Fin:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelement(10, \"input\", 7);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(11, \"div\", 3);\r\n        i0.ɵɵelementStart(12, \"label\", 8);\r\n        i0.ɵɵtext(13, \"Matricule:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelement(14, \"input\", 9);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(15, \"div\", 10);\r\n        i0.ɵɵelementStart(16, \"label\", 11);\r\n        i0.ɵɵtext(17, \"Type:\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(18, \"select\", 12);\r\n        i0.ɵɵtemplate(19, AddEmpSomeoneComponent_option_19_Template, 2, 2, \"option\", 13);\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementStart(20, \"button\", 14);\r\n        i0.ɵɵtext(21, \"Submit\");\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n        i0.ɵɵelementEnd();\r\n    } if (rf & 2) {\r\n        i0.ɵɵadvance(1);\r\n        i0.ɵɵproperty(\"formGroup\", ctx.leaveForm);\r\n        i0.ɵɵadvance(18);\r\n        i0.ɵɵproperty(\"ngForOf\", ctx.leaveTypes);\r\n    } }, directives: [i1.ɵNgNoValidate, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.DefaultValueAccessor, i1.NgControlStatus, i1.FormControlName, i1.RequiredValidator, i1.SelectControlValueAccessor, i7.NgForOf, i1.NgSelectOption, i1.ɵNgSelectMultipleOption], styles: [\".form-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;padding:35px}.date-inputs[_ngcontent-%COMP%]{display:flex;justify-content:space-between;width:100%;max-width:500px;margin-bottom:20px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]{flex:1;margin-right:10px}.date-inputs[_ngcontent-%COMP%]   .form-group[_ngcontent-%COMP%]:last-child{margin-right:0}.type-input[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;width:100%;max-width:500px;margin-bottom:20px}button[_ngcontent-%COMP%]{display:block;margin:0 auto}\"] });\r\n"]},"metadata":{},"sourceType":"module"}
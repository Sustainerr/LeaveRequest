"use strict";(self.webpackChunktelnetteam_app=self.webpackChunktelnetteam_app||[]).push([[239],{83239:function(e,t,i){i.r(t),i.d(t,{CUSTOM_DT_FORMATS:function(){return ft},InvoicingModule:function(){return gt}});var n=i(38583),a=i(32403),r=i(3679),s=i(72458),c=i(22238),o=i(36063),l=i(82480),d=i(67827),m=i(91841),h=i(36332),p=i(38458),v=i(37716);let u=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=v.\u0275\u0275defineInjector({providers:[],imports:[[n.CommonModule,a.m,r.FormsModule,r.ReactiveFormsModule,a.q,c.Is,d.ZQ.forRoot(),m.HttpClientModule,l.w,h.o,p.l]]}),e})();var f=i(88452),g=i(63753),S=i(62028),y=i(70833),x=i(90046),C=i(55750),b=i(10337),I=i(44995),E=i(96523),D=i(19992),w=i(98295),R=i(49983),A=i(43220),k=i(69517),M=i(39924),T=i(4885),j=i(42352),F=i(88136),P=i(34239);function N(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div"),v.\u0275\u0275elementStart(1,"h1"),v.\u0275\u0275text(2,"No Result Found"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function B(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",32),v.\u0275\u0275elementStart(1,"div",33),v.\u0275\u0275elementStart(2,"div",34),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",35),v.\u0275\u0275element(5,"mat-spinner"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function O(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",36),v.\u0275\u0275elementStart(1,"app-estimates",37),v.\u0275\u0275listener("estimateState",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext(2).toggleEditDetails(t)}),v.\u0275\u0275pipe(2,"paginator"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext(2);v.\u0275\u0275classProp("blurred",e.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("contractDetails",!0)("estimates",v.\u0275\u0275pipeBind3(2,6,e.estimates,e.searchFilterService.pageIndex,e.searchFilterService.pageSize))("estimateEditable",e.estimateEditable)("project",e.projects)}}function V(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",4),v.\u0275\u0275elementStart(1,"div",5),v.\u0275\u0275elementStart(2,"div",6),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",7),v.\u0275\u0275elementStart(5,"mat-list"),v.\u0275\u0275elementStart(6,"mat-list-item"),v.\u0275\u0275elementStart(7,"h3",8),v.\u0275\u0275text(8,"Period"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(9,"mat-form-field",9),v.\u0275\u0275elementStart(10,"input",10),v.\u0275\u0275listener("keypress",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().dateOnly(t)})("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().estimateStartDate=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(11,"mat-datepicker-toggle",11),v.\u0275\u0275element(12,"mat-datepicker",null,12),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(14,"mat-form-field",9),v.\u0275\u0275elementStart(15,"input",13),v.\u0275\u0275listener("keypress",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().dateOnly(t)})("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().estimateEndDate=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(16,"mat-datepicker-toggle",11),v.\u0275\u0275element(17,"mat-datepicker",null,14),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(19,"mat-list-item"),v.\u0275\u0275elementStart(20,"h3",8),v.\u0275\u0275text(21,"Reference"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(22,"mat-form-field",15),v.\u0275\u0275elementStart(23,"input",16),v.\u0275\u0275listener("keydown",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().onClickingEnter(t)})("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().estimateReference=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(24,"div",7),v.\u0275\u0275elementStart(25,"mat-list"),v.\u0275\u0275elementStart(26,"mat-list-item"),v.\u0275\u0275elementStart(27,"h3",8),v.\u0275\u0275text(28,"Activity"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(29,"div",17),v.\u0275\u0275elementStart(30,"ng-multiselect-dropdown",18),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().selectedActivitiesIdentifiers=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(31,"mat-list-item"),v.\u0275\u0275elementStart(32,"h3",8),v.\u0275\u0275text(33,"Customer"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(34,"div",17),v.\u0275\u0275elementStart(35,"ng-multiselect-dropdown",19),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().selectedCustomersIdentifiers=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(36,"div",20),v.\u0275\u0275elementStart(37,"mat-list"),v.\u0275\u0275elementStart(38,"mat-list-item"),v.\u0275\u0275elementStart(39,"h3",8),v.\u0275\u0275text(40,"Status"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(41,"div",17),v.\u0275\u0275elementStart(42,"ng-multiselect-dropdown",19),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().selectedStatusesIdentifiers=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(43,"div",21),v.\u0275\u0275elementStart(44,"div",22),v.\u0275\u0275elementStart(45,"button",23),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().filterEstimateButton()}),v.\u0275\u0275text(46,"Search"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(47,"div",22),v.\u0275\u0275elementStart(48,"button",24),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().onResetAllFilters()}),v.\u0275\u0275text(49,"Reset"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(50,"nav",25),v.\u0275\u0275elementStart(51,"div",26),v.\u0275\u0275element(52,"app-paginator",27),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(53,N,3,0,"div",28),v.\u0275\u0275elementStart(54,"div",29),v.\u0275\u0275template(55,B,6,0,"div",30),v.\u0275\u0275template(56,O,3,10,"div",31),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275reference(13),t=v.\u0275\u0275reference(18),i=v.\u0275\u0275nextContext();v.\u0275\u0275advance(10),v.\u0275\u0275property("matDatepicker",e)("max",i.estimateEndDate)("ngModel",i.estimateStartDate),v.\u0275\u0275advance(1),v.\u0275\u0275property("for",e),v.\u0275\u0275advance(4),v.\u0275\u0275property("matDatepicker",t)("min",i.estimateStartDate)("ngModel",i.estimateEndDate),v.\u0275\u0275advance(1),v.\u0275\u0275property("for",t),v.\u0275\u0275advance(7),v.\u0275\u0275property("ngModel",i.estimateReference),v.\u0275\u0275advance(7),v.\u0275\u0275property("placeholder","Select...")("settings",i.dropdownSettings)("data",i.activitiesIdentifiers)("ngModel",i.selectedActivitiesIdentifiers)("disabled",i.isProjectManager),v.\u0275\u0275advance(5),v.\u0275\u0275property("placeholder","Select...")("settings",i.dropdownSettings)("data",i.customersIdentifiers)("ngModel",i.selectedCustomersIdentifiers),v.\u0275\u0275advance(7),v.\u0275\u0275property("placeholder","Select...")("settings",i.dropdownSettingsStatus)("data",i.statuses)("ngModel",i.selectedStatusesIdentifiers),v.\u0275\u0275advance(10),v.\u0275\u0275property("pageSize",i.searchFilterService.pageSize)("pageIndex",i.searchFilterService.pageIndex)("length",i.lengthEstimates),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",i.emptyResult&&i.listView),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",i.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",i.listView&&!i.emptyResult)}}function z(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",38),v.\u0275\u0275elementStart(1,"app-edit-estimate",39),v.\u0275\u0275listener("isSavedEstimate",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().savedEstimate(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("isEditEstimate",!0)("selectedEstimate",e.selectedEstimate)}}let _=(()=>{class e{constructor(e,t,i,n,a,r){this.sortService=e,this.projectService=t,this.notificationService=i,this.searchFilterService=n,this.dateTimeService=a,this.invoicingService=r,this.estimateReference="",this.emptyResult=!1,this.listView=!1,this.selectedCustomersIdentifiers=[],this.customersIdentifiers=[],this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.isEditableEstimate=!1,this.orderEditable=!1,this.dropdownSettings={},this.dropdownSettingsStatus={},this.selectedStatusesIdentifiers=[],this.subscription=new y.w0,this.statuses=[{id:"Emis",description:"Emis"},{id:"Lanc\xe9",description:"Lanc\xe9"},{id:"Factur\xe9",description:"Factur\xe9"},{id:"Clos",description:"Clos"},{id:"Suspendu",description:"Suspendu"},{id:"Arr\xeat\xe9",description:"Arr\xeat\xe9"}],this.paginatorPipe=new C.Ry(this.searchFilterService),this.isProjectManager=!1}ngOnInit(){this.subscription.add(this.invoicingService.sortEstimates.subscribe(e=>{this.onSortData(e)})),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.dropdownSettingsStatus={singleSelection:!1,idField:"id",textField:"description",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!1,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.getCustomers(),this.getActivities(),this.subscription.add(this.invoicingService.reloadEstimates.subscribe(e=>{this.getEstimates(this.estimateReference,this.selectedCustomersIds,this.selectedActivitiesIds,this.selectedState,this.estimateStartDate,this.estimateEndDate)})),this.lengthEstimates=0,this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})})),this.estimateStartDate=this.dateTimeService.getFirstDayFromPreviousMonth(),this.estimateEndDate=this.dateTimeService.today();const e=JSON.parse(sessionStorage.getItem("estimateSearch"));null!==e&&(this.estimateReference=e.estimateReference,this.selectedCustomersIdentifiers=e.selectedCustomersIdentifiers,this.selectedCustomersIds=this.selectedCustomersIdentifiers.map(e=>e.id).join(","),this.selectedActivitiesIdentifiers=e.selectedActivitiesIdentifiers,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(","),this.selectedStatusesIdentifiers=e.selectedStatusesIdentifiers,this.selectedState=this.selectedStatusesIdentifiers.map(e=>e.id).join(","),null!=e.estimateStartDate&&(this.estimateStartDate=e.estimateStartDate),null!=e.estimateEndDate&&(this.estimateEndDate=e.estimateEndDate)),this.user=JSON.parse(localStorage.getItem("currentUser"))}ngOnDestroy(){this.subscription.unsubscribe()}onResetCustomers(){this.selectedCustomersIdentifiers=[]}onResetActivity(){this.user.groupId!==S.Fl.ProjectManager&&(this.selectedActivitiesIdentifiers=[])}onResetStates(){this.selectedStatusesIdentifiers=[]}onResetAllFilters(){sessionStorage.removeItem("estimateSearch"),this.estimateReference="",this.onResetCustomers(),this.onResetActivity(),this.onResetStates(),this.estimateStartDate=this.dateTimeService.getFirstDayFromPreviousMonth(),this.estimateEndDate=this.dateTimeService.today()}onChangeCustomer(e){this.selectedCustomersIds=e}onChangeActivity(e){this.selectedActivitiesIds=e}onChangeServices(e){this.selectedServicesIds=e}getCustomers(){this.projectService.getClients().subscribe(e=>{null!=e&&(this.customersIdentifiers=e,null==this.selectedCustomersIds||(this.selectedCustomersIds=this.customersIdentifiers.map(e=>e.id).join(","),this.onChangeCustomer(this.selectedCustomersIds)))})}getActivities(){this.projectService.getActivities().subscribe(e=>{null!=e&&(this.activitiesIdentifiers=e,this.user.groupId===S.Fl.ProjectManager?(this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(e=>e.id===this.user.activityId),this.isProjectManager=!0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(",")):this.selectedActivitiesIds=this.activitiesIdentifiers.map(e=>e.id).join(","),this.onChangeActivity(this.selectedActivitiesIds))})}filterEstimateButton(){if(null!==this.estimateEndDate&&null!==this.estimateStartDate){this.searchFilterService.pageIndex=0,void 0!==this.selectedStatusesIdentifiers&&(this.selectedState=this.selectedStatusesIdentifiers.map(e=>e.id).join(",")),this.selectedCustomersIds=this.selectedCustomersIdentifiers.map(e=>e.id).join(","),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(",");const e=new x.ag;e.estimateReference=this.estimateReference,e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.selectedCustomersIdentifiers=this.selectedCustomersIdentifiers,e.selectedStatusesIdentifiers=this.selectedStatusesIdentifiers,e.estimateStartDate=this.estimateStartDate,e.estimateEndDate=this.estimateEndDate,sessionStorage.setItem("estimateSearch",JSON.stringify(e)),this.getEstimates(this.estimateReference,this.selectedCustomersIds,this.selectedActivitiesIds,this.selectedState,this.estimateStartDate,this.estimateEndDate)}else this.notificationService.danger("Please fill dates fields")}getEstimates(e,t,i,n,a,r){this.isLoading=!0,this.invoicingService.getEstimates(e,t,i,n,a,r).subscribe(e=>{this.isLoading=!1,null!=e&&(this.emptyResult=!1,this.estimates=e,this.listView=!0,this.lengthEstimates=this.estimates.length,this.emptyResult=0===e.length)})}toggleEditDetails(e){this.listView=!1,this.selectedEstimate=Object.assign(new x.B0,e),this.isEditableEstimate=!0}savedEstimate(e){this.listView=e,this.isEditableEstimate=!e,this.emptyResult=!1,this.getEstimates(this.estimateReference,this.selectedCustomersIds,this.selectedActivitiesIds,this.selectedState,this.estimateStartDate,this.estimateEndDate)}onClickingEnter(e){"Enter"===e.key&&this.filterEstimateButton()}dateOnly(e){return this.dateTimeService.dateOnly(e)}onSortData(e){e.active&&""!==e.direction&&this.estimates.sort((t,i)=>{const n="asc"===e.direction;switch(e.active){case"estimateReference":return this.sortService.compare(t.estimateReference,i.estimateReference,n,!1);case"estimateEdit":return this.sortService.compare(t.estimateEdit,i.estimateEdit,n,!1);case"estimateDate":return this.sortService.compare(t.estimateDate,i.estimateDate,n,!1);case"clientName":return this.sortService.compare(t.clientName,i.clientName,n,!1);case"estimateState":return this.sortService.compare(t.estimateState,i.estimateState,n,!1);case"contractReference":return this.sortService.compare(t.contractReference,i.contractReference,n,!1);case"orderDate":return this.sortService.compare(t.orderDate,i.orderDate,n,!1);case"batchRefference":return this.sortService.compare(t.batchRefference,i.batchRefference,n,!1);default:return 0}}),this.paginatorPipe.transform(this.estimates,this.searchFilterService.pageIndex,this.searchFilterService.pageSize)}}return e.\u0275fac=function(t){return new(t||e)(v.\u0275\u0275directiveInject(b.Kx),v.\u0275\u0275directiveInject(I.Y4),v.\u0275\u0275directiveInject(b.gq),v.\u0275\u0275directiveInject(b.nJ),v.\u0275\u0275directiveInject(b.Cv),v.\u0275\u0275directiveInject(E.X))},e.\u0275cmp=v.\u0275\u0275defineComponent({type:e,selectors:[["app-all-estimates"]],decls:4,vars:2,consts:[[1,"page-body"],[1,"row"],["class","col-xl-12 col-lg-12 filter-bar",4,"ngIf"],["class","example-container mat-elevation-z8",4,"ngIf"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"date-field","col-sm-5"],["matInput","","placeholder","From","required","",3,"matDatepicker","max","ngModel","keypress","ngModelChange"],["matSuffix","",3,"for"],["picker11",""],["matInput","","placeholder","To","required","",3,"matDatepicker","min","ngModel","keypress","ngModelChange"],["picker22",""],[1,"search-input","col-sm-10"],["placeholder","Search here...","matInput","","name","searchInput",3,"ngModel","keydown","ngModelChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","100%",3,"placeholder","settings","data","ngModel","disabled","ngModelChange"],[1,"multi-search",2,"width","100%",3,"placeholder","settings","data","ngModel","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"btn","btn-md","btn-default","ripple","light","m-t-10",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10"],[1,"nav-item","nav-grid","col-sm-12"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],["class","overlay",4,"ngIf"],["class","example-container mat-elevation-z8  loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"example-container","mat-elevation-z8","loaded-content"],[3,"contractDetails","estimates","estimateEditable","project","estimateState"],[1,"example-container","mat-elevation-z8"],[3,"isEditEstimate","selectedEstimate","isSavedEstimate"]],template:function(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",0),v.\u0275\u0275elementStart(1,"div",1),v.\u0275\u0275template(2,V,57,28,"div",2),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(3,z,2,2,"div",3),v.\u0275\u0275elementEnd()),2&e&&(v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",!t.isEditableEstimate),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",t.isEditableEstimate&&!t.emptyResult))},directives:[n.NgIf,D.i$,D.Tg,w.KE,R.Nt,A.hl,r.DefaultValueAccessor,r.RequiredValidator,r.NgControlStatus,r.NgModel,A.nW,w.R9,A.Mq,d.OP,k.M2,M.J,T.$g,j.N,F.c],pipes:[P.R],styles:[".filter-button{text-align:center;width:100%;margin:2%}.search-input{font-size:14px}.date-field{font-size:14px}.pointer{cursor:pointer}.reset-all-btn{cursor:pointer;font-size:20px}.reset-all-btn:hover{color:red}.arrow-icon{font-size:10px}.close-icon{float:right;font-size:22px}.multi-search{width:100%}.ngb-accordion .card .card-header{padding-left:5px}.ngb-accordion .card .card-header .a{font-size:15px}.mat-list .mat-divider{margin-top:15px}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.mat-list-header{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.material-icons{font-size:25px}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),e})();var $=i(16738),L=i(60040),H=i(11494),J=i(32789),Y=i(38590),q=i(72172),G=i(7539),Q=i(62758);function W(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Batch Ref."),v.\u0275\u0275elementEnd())}function U(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",25),v.\u0275\u0275listener("click",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().goToBatchesDetail(t)}),v.\u0275\u0275elementStart(1,"span",26),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.batchReference),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.batchReference," ")}}function X(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Order Ref."),v.\u0275\u0275elementEnd())}function K(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",25),v.\u0275\u0275listener("click",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().goToOrdersDetail(t)}),v.\u0275\u0275elementStart(1,"span",26),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.contractReference),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.contractReference," ")}}function Z(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Estimate Ref."),v.\u0275\u0275elementEnd())}function ee(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",25),v.\u0275\u0275listener("click",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().goToEstimatesDetail(t)}),v.\u0275\u0275elementStart(1,"span",26),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.estimateReference),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.estimateReference," ")}}function te(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Project"),v.\u0275\u0275elementEnd())}function ie(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",27),v.\u0275\u0275elementStart(1,"span",26),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.projectName),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1("",e.projectName," ")}}function ne(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Delivery Date"),v.\u0275\u0275elementEnd())}function ae(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275text(1),v.\u0275\u0275pipe(2,"shortDate"),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate1(" ",v.\u0275\u0275pipeBind1(2,1,e.batchDeliveryDate)," ")}}function re(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Addressed To"),v.\u0275\u0275elementEnd())}function se(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",27),v.\u0275\u0275elementStart(1,"span",26),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.batchAdressedTo),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.batchAdressedTo," ")}}function ce(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Amount"),v.\u0275\u0275elementEnd())}function oe(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275text(1),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate2(" ",e.batchAmount," ",e.currency," ")}}function le(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Invoice Date"),v.\u0275\u0275elementEnd())}function de(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",28),v.\u0275\u0275elementStart(1,"mat-form-field",29),v.\u0275\u0275elementStart(2,"input",30),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.invoiceDeliveryDate=t})("keypress",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().dateOnly(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(3,"mat-datepicker-toggle",31),v.\u0275\u0275element(4,"mat-datepicker",32,33),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=v.\u0275\u0275reference(5),n=v.\u0275\u0275nextContext();v.\u0275\u0275advance(2),v.\u0275\u0275property("matDatepicker",i)("ngModel",n.datePipe(e.invoiceDeliveryDate))("disabled",n.invoicedBatch(e)||e.BatchChecked),v.\u0275\u0275advance(1),v.\u0275\u0275property("for",i),v.\u0275\u0275advance(1),v.\u0275\u0275property("startView","month")}}function me(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",34),v.\u0275\u0275text(1,"Net to pay"),v.\u0275\u0275elementEnd())}const he=function(e){return{"disabled-color":e}};function pe(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",28),v.\u0275\u0275elementStart(1,"mat-form-field",35),v.\u0275\u0275elementStart(2,"input",36),v.\u0275\u0275listener("keypress",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().numberOnly(t)})("blur",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().checkNumber(t)})("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.invoiceNetToBePayed=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275text(3,"\xa0\xa0\xa0 "),v.\u0275\u0275elementStart(4,"span",37),v.\u0275\u0275text(5),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=v.\u0275\u0275nextContext();v.\u0275\u0275advance(2),v.\u0275\u0275property("ngModel",e.invoiceNetToBePayed)("disabled",i.invoicedBatch(e)||e.BatchChecked),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngClass",v.\u0275\u0275pureFunction1(4,he,!0===e.BatchChecked)),v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate1(" ",e.currency,"")}}function ve(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Saari Ref."),v.\u0275\u0275elementEnd())}function ue(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",28),v.\u0275\u0275elementStart(1,"mat-form-field",38),v.\u0275\u0275elementStart(2,"input",39),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.invoiceSaariReference=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=v.\u0275\u0275nextContext();v.\u0275\u0275advance(2),v.\u0275\u0275property("ngModel",e.invoiceSaariReference)("disabled",i.invoicedBatch(e))}}function fe(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",24),v.\u0275\u0275text(1,"Invoiced"),v.\u0275\u0275elementEnd())}function ge(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275elementStart(1,"mat-checkbox",40),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.BatchChecked=t})("change",function(t){const i=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().batchesInvoiced(i,t)})("click",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext().DisabledWhenChecked(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("ngModel",e.BatchChecked)("disabled",i.invoicedBatch(e))}}function Se(e,t){1&e&&v.\u0275\u0275element(0,"mat-header-row",41)}function ye(e,t){1&e&&v.\u0275\u0275element(0,"mat-row")}function xe(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",42),v.\u0275\u0275elementStart(1,"strong",43),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate(e.activityName)}}function Ce(e,t){1&e&&v.\u0275\u0275element(0,"mat-row")}const be=function(){return["groupHeader"]};let Ie=(()=>{class e{constructor(e){this.displayedColumns=["batchReference","orderReference","estimateReference","projectName","batchDelevryDate","batchAdressedTo","batchAmount","invoiceDeliveryDate","invoiceNetToBePayed","invoiceSaariReference","invoiced"],this.dataSource=new J.by,this.checked=!0,this.invoicingBatches=[],this.groupByColumns=[],this.invoicingService=e.get(E.X),this.searchFilterService=e.get(b.nJ),this.groupsService=e.get(b.Jc),this.mailService=e.get(b.YT),this.notificationService=e.get(b.gq),this.dateTimeService=e.get(b.Cv),this.router=e.get(f.F0),this.activeRoute=e.get(f.gz)}ngOnInit(){this.groupByColumns=["activityName"],this.selectedBatchId=0,this.dataSource=new J.by(this.groupsService.addGroups(this.batches,this.groupByColumns)),this.subscription=this.searchFilterService.resultChanged.subscribe(()=>{this.dataSource=new J.by(this.groupsService.addGroups(this.searchFilterService.showingDataLastFilter,this.groupByColumns))}),this.invoicingService.insertInvoicingBatch.subscribe(e=>{this.insertInvoicesLaunch()})}ngOnDestroy(){this.subscription.unsubscribe()}invoicedBatch(e){return!(0===e.invoiceId||null==e.invoiceId)}onSortData(e){this.invoicingService.sortInvoices.next(e)}dateOnly(e){return this.dateTimeService.dateOnly(e)}datePipe(e){return"0001-01-01T00:00:00"===e?"":e}insertInvoicesLaunch(){this.invoicingBatches.length>0?this.invoicingService.saveInvoicesLaunch(this.invoicingBatches).subscribe(()=>{this.notificationService.success("Invoice is saved successfully"),this.invoicingService.getinvoicingBatches.next(),this.invoicingBatches.forEach(e=>{this.mailService.invoiceAdded(e)}),this.invoicingBatches=[]},e=>{this.notificationService.danger("Add invoice failed")}):this.notificationService.warning("None of the batches are checked Please verify")}batchesInvoiced(e,t){if(!0===t.checked){const t=new x.mw;t.invoiceReference="N/A",t.currencyId=e.currencyId,t.invoiceAdressedTo=e.batchAdressedTo,t.invoiceAmount=e.batchAmount,t.invoiceDeliveryDate=e.invoiceDeliveryDate,t.invoiceSaariReference=e.invoiceSaariReference,t.invoiceNetToBePayed=e.invoiceNetToBePayed,t.batchId=e.batchId,t.batchReference=e.batchReference,t.projectName=e.projectName,this.invoicingBatches.push(t)}else{const t=this.invoicingBatches.findIndex(t=>t.batchId=e.batchId);this.invoicingBatches.splice(t,1)}}DisabledWhenChecked(e){""===e.invoiceNetToBePayed&&(e.invoiceNetToBePayed=null),null===e.invoiceDeliveryDate||null===e.invoiceNetToBePayed?e.BatchChecked=!0:(!0===e.locked||void 0===e.locked)&&(e.locked=!0),!0===e.BatchChecked&&(e.locked=!1)}isGroup(e,t){return t.level}numberOnly(e){const t=e.which?e.which:e.keyCode;return!(t>31&&(t<44||t>57)||45===t||47===t)}goToBatchesDetail(e){this.router.navigate(["/project-management/project/edit/"+e.pifId.toString()+"/"+e.projectId.toString(),{title:"batches",batchId:e.batchId}],{relativeTo:this.activeRoute})}goToOrdersDetail(e){this.router.navigate(["/project-management/project/edit/"+e.pifId.toString()+"/"+e.projectId.toString(),{title:"orders",contractId:e.contractId}],{relativeTo:this.activeRoute})}goToEstimatesDetail(e){this.router.navigate(["/project-management/project/edit/"+e.pifId.toString()+"/"+e.projectId.toString(),{title:"estimates",estimateId:e.estimateId}],{relativeTo:this.activeRoute})}checkNumber(e){e.invoiceNetToBePayed&&(e.invoiceNetToBePayed=e.invoiceNetToBePayed.toString().replace(",",".")),isNaN(e.invoiceNetToBePayed)&&(e.invoiceNetToBePayed=null)}}return e.\u0275fac=function(t){return new(t||e)(v.\u0275\u0275directiveInject(v.Injector))},e.\u0275cmp=v.\u0275\u0275defineComponent({type:e,selectors:[["app-invoices-launch"]],viewQuery:function(e,t){if(1&e&&v.\u0275\u0275viewQuery(H.YE,7),2&e){let e;v.\u0275\u0275queryRefresh(e=v.\u0275\u0275loadQuery())&&(t.sort=e.first)}},inputs:{batches:"batches"},decls:40,vars:7,consts:[["matSort","","matSortDirection","asc","matSortDisableClear","",3,"dataSource","matSortChange"],["table",""],["matColumnDef","batchReference"],["mat-sort-header","",4,"matHeaderCellDef"],["class","reference",3,"matTooltip","click",4,"matCellDef"],["matColumnDef","orderReference"],["matColumnDef","estimateReference"],["matColumnDef","projectName"],[3,"matTooltip",4,"matCellDef"],["matColumnDef","batchDelevryDate"],[4,"matCellDef"],["matColumnDef","batchAdressedTo"],["matColumnDef","batchAmount"],["matColumnDef","invoiceDeliveryDate"],["floatLabel","never",4,"matCellDef"],["matColumnDef","invoiceNetToBePayed"],["mat-sort-header","","class","header-align",4,"matHeaderCellDef"],["matColumnDef","invoiceSaariReference"],["matColumnDef","invoiced"],["class"," table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["matColumnDef","groupHeader"],["colspan","999",4,"matCellDef"],[4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-sort-header",""],[1,"reference",3,"matTooltip","click"],[1,"span-ellipsis"],[3,"matTooltip"],["floatLabel","never"],[2,"width","90%","text-align","center"],["matInput","","name","invoiceDeliveryDate",3,"matDatepicker","ngModel","disabled","ngModelChange","keypress"],["matSuffix","",3,"for"],[3,"startView"],["PickerStartDay",""],["mat-sort-header","",1,"header-align"],[2,"width","90%","text-align","right"],["appNumberValidator","","matInput","",2,"width","100px","border","white",3,"ngModel","disabled","keypress","blur","ngModelChange"],[3,"ngClass"],[2,"width","90%"],["matInput","",2,"border","white",3,"ngModel","disabled","ngModelChange"],[2,"height","20px",3,"ngModel","disabled","ngModelChange","change","click"],[1,"table-primary","table-*"],["colspan","999"],[1,"strong"]],template:function(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-table",0,1),v.\u0275\u0275listener("matSortChange",function(e){return t.onSortData(e)}),v.\u0275\u0275elementContainerStart(2,2),v.\u0275\u0275template(3,W,2,0,"mat-header-cell",3),v.\u0275\u0275template(4,U,3,2,"mat-cell",4),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(5,5),v.\u0275\u0275template(6,X,2,0,"mat-header-cell",3),v.\u0275\u0275template(7,K,3,2,"mat-cell",4),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(8,6),v.\u0275\u0275template(9,Z,2,0,"mat-header-cell",3),v.\u0275\u0275template(10,ee,3,2,"mat-cell",4),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(11,7),v.\u0275\u0275template(12,te,2,0,"mat-header-cell",3),v.\u0275\u0275template(13,ie,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(14,9),v.\u0275\u0275template(15,ne,2,0,"mat-header-cell",3),v.\u0275\u0275template(16,ae,3,3,"mat-cell",10),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(17,11),v.\u0275\u0275template(18,re,2,0,"mat-header-cell",3),v.\u0275\u0275template(19,se,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(20,12),v.\u0275\u0275template(21,ce,2,0,"mat-header-cell",3),v.\u0275\u0275template(22,oe,2,2,"mat-cell",10),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(23,13),v.\u0275\u0275template(24,le,2,0,"mat-header-cell",3),v.\u0275\u0275template(25,de,6,5,"mat-cell",14),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(26,15),v.\u0275\u0275template(27,me,2,0,"mat-header-cell",16),v.\u0275\u0275template(28,pe,6,6,"mat-cell",14),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(29,17),v.\u0275\u0275template(30,ve,2,0,"mat-header-cell",3),v.\u0275\u0275template(31,ue,3,2,"mat-cell",14),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(32,18),v.\u0275\u0275template(33,fe,2,0,"mat-header-cell",3),v.\u0275\u0275template(34,ge,2,2,"mat-cell",10),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275template(35,Se,1,0,"mat-header-row",19),v.\u0275\u0275template(36,ye,1,0,"mat-row",20),v.\u0275\u0275elementContainerStart(37,21),v.\u0275\u0275template(38,xe,3,1,"mat-cell",22),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275template(39,Ce,1,0,"mat-row",23),v.\u0275\u0275elementEnd()),2&e&&(v.\u0275\u0275property("dataSource",t.dataSource),v.\u0275\u0275advance(35),v.\u0275\u0275property("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),v.\u0275\u0275advance(1),v.\u0275\u0275property("matRowDefColumns",t.displayedColumns),v.\u0275\u0275advance(3),v.\u0275\u0275property("matRowDefColumns",v.\u0275\u0275pureFunction0(6,be))("matRowDefWhen",t.isGroup))},directives:[J.BZ,H.YE,J.w1,J.fO,J.Dz,J.as,J.nj,J.ge,H.nU,J.ev,Y.gM,w.KE,R.Nt,A.hl,r.DefaultValueAccessor,r.NgControlStatus,r.NgModel,A.nW,w.R9,A.Mq,q.z,n.NgClass,G.oG,J.XQ,J.Gk],pipes:[Q.M],styles:[".mat-table[_ngcontent-%COMP%]{overflow:auto;border-radius:4px;max-height:calc(100vh - 342px)}table[_ngcontent-%COMP%]{width:100%}.span-ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.material-icons[_ngcontent-%COMP%]{font-size:15px}.mat-column-batchReference[_ngcontent-%COMP%]{flex:0 0 12%!important;width:12%!important}.mat-column-orderReference[_ngcontent-%COMP%]{flex:0 0 10%!important;width:10%!important}.mat-column-estimateReference[_ngcontent-%COMP%]{flex:0 0 10%!important;width:10%!important}.mat-column-batchDelevryDate[_ngcontent-%COMP%]{flex:0 0 8%!important;width:8%!important;justify-content:center}.mat-column-batchAdressedTo[_ngcontent-%COMP%]{flex:0 0 8%!important;width:8%!important}.mat-column-batchAmount[_ngcontent-%COMP%]{flex:0 0 6%!important;width:6%;text-align:right;justify-content:flex-end}.mat-column-projectName[_ngcontent-%COMP%]{flex:0 0 11%!important;width:12%!important}.mat-column-invoiceDeliveryDate[_ngcontent-%COMP%]{flex:0 0 7%!important;width:8%!important;justify-content:center;-webkit-margin-start:1%;margin-inline-start:1%}.mat-column-invoiceNetToBePayed[_ngcontent-%COMP%]{flex:0 0 10%!important;width:10%!important;-webkit-margin-start:1%;margin-inline-start:1%}.mat-column-invoiceSaariReference[_ngcontent-%COMP%]{flex:0 0 8%!important;width:9%!important;-webkit-margin-start:1%;margin-inline-start:1%}.mat-column-invoiced[_ngcontent-%COMP%]{flex:0 0 7%!important;width:4%!important;justify-content:center}.header-align[_ngcontent-%COMP%]{display:flex;justify-content:center}.pdf-ico[_ngcontent-%COMP%]{font-size:35px;margin-bottom:25px}  .mat-sort-header-arrow{color:#fff}.strong[_ngcontent-%COMP%]{background:-webkit-linear-gradient(#5a5a5a,black);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold}.mat-column-groupHeader[_ngcontent-%COMP%]{color:#030303;background-color:#eceaea;font-weight:bolder;font-size:medium;font-family:Arial,Helvetica,sans-serif}.input-date[_ngcontent-%COMP%]{width:55%}.reference[_ngcontent-%COMP%]{color:#00f;cursor:pointer}.disabled-color[_ngcontent-%COMP%]{color:#aaa}"]}),e})();function Ee(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"nav",22),v.\u0275\u0275elementStart(1,"div",23),v.\u0275\u0275elementStart(2,"button",24),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext(2).exportToExcel()}),v.\u0275\u0275element(3,"em",25),v.\u0275\u0275text(4," Export "),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(5,"button",26),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext(2).insertInvoicingBatch()}),v.\u0275\u0275element(6,"em",27),v.\u0275\u0275text(7," Submit "),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(8,"div",28),v.\u0275\u0275element(9,"app-paginator",29),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext(2);v.\u0275\u0275advance(5),v.\u0275\u0275property("disabled",e.mutliClickDisable),v.\u0275\u0275advance(4),v.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.lengthBatches)}}function De(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div"),v.\u0275\u0275elementStart(1,"h1"),v.\u0275\u0275text(2,"No Result Found"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function we(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",30),v.\u0275\u0275elementStart(1,"div",31),v.\u0275\u0275elementStart(2,"div",32),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",33),v.\u0275\u0275element(5,"mat-spinner"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function Re(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"div",34),v.\u0275\u0275element(1,"app-invoices-launch",35),v.\u0275\u0275pipe(2,"paginator"),v.\u0275\u0275elementEnd()),2&e){const e=v.\u0275\u0275nextContext(2);v.\u0275\u0275classProp("blurred",e.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("batches",v.\u0275\u0275pipeBind3(2,3,e.batches,e.searchFilterService.pageIndex,e.searchFilterService.pageSize))}}function Ae(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",3),v.\u0275\u0275elementStart(1,"div",4),v.\u0275\u0275elementStart(2,"div",5),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",6),v.\u0275\u0275elementStart(5,"mat-list"),v.\u0275\u0275elementStart(6,"mat-list-item"),v.\u0275\u0275elementStart(7,"h3",7),v.\u0275\u0275text(8,"Period"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(9,"div",8),v.\u0275\u0275elementStart(10,"app-select-month",9),v.\u0275\u0275listener("daysChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().daysChangePeriodFrom(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(11,"div",8),v.\u0275\u0275elementStart(12,"app-select-month",10),v.\u0275\u0275listener("daysChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().daysChangePeriodTo(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(13,"div",6),v.\u0275\u0275elementStart(14,"mat-list"),v.\u0275\u0275elementStart(15,"mat-list-item"),v.\u0275\u0275elementStart(16,"h3",7),v.\u0275\u0275text(17,"Activity"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(18,"div",11),v.\u0275\u0275elementStart(19,"ng-multiselect-dropdown",12),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().selectedActivitiesIdentifiers=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(20,"div",13),v.\u0275\u0275elementStart(21,"div",14),v.\u0275\u0275elementStart(22,"div",15),v.\u0275\u0275elementStart(23,"button",16),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().filterBatchButton()}),v.\u0275\u0275text(24,"Search"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(25,Ee,10,4,"nav",17),v.\u0275\u0275template(26,De,3,0,"div",18),v.\u0275\u0275elementStart(27,"div",19),v.\u0275\u0275template(28,we,6,0,"div",20),v.\u0275\u0275template(29,Re,3,7,"div",21),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext();v.\u0275\u0275advance(10),v.\u0275\u0275property("selectedDate",e.deliveryStartDate)("maxDate",e.maxDate),v.\u0275\u0275advance(2),v.\u0275\u0275property("selectedDate",e.deliveryEndDate)("minDate",e.minDate),v.\u0275\u0275advance(7),v.\u0275\u0275property("placeholder","Select...")("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("settings",e.dropdownSettings)("disabled",e.isProjectManager),v.\u0275\u0275advance(6),v.\u0275\u0275property("ngIf",!e.isEditBatch&&!e.addBatch),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",e.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",e.listView&&!e.isEditBatch&&!e.emptyResult)}}let ke=(()=>{class e{constructor(e,t,i,n,a,r){this.invoicingService=e,this.sortService=t,this.excelService=i,this.searchFilterService=n,this.projectService=a,this.dateTimeService=r,this.deliveryStartDate=void 0,this.deliveryEndDate=void 0,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.subscription=new y.w0,this.paginatorPipe=new C.Ry(this.searchFilterService),this.groupByColumns=[],this.mutliClickDisable=!1,this.isProjectManager=!1}ngOnInit(){this.groupByColumns=["activityName"];const e=this.dateTimeService.today();this.deliveryStartDate=$([e.getFullYear(),e.getMonth()]).toDate(),this.deliveryEndDate=$(e).endOf("month").toDate(),this.minDate=this.deliveryStartDate,this.maxDate=this.deliveryEndDate,this.subscription.add(this.invoicingService.sortInvoices.subscribe(e=>{this.onSortData(e)})),this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.user=JSON.parse(localStorage.getItem("currentUser")),this.listView=!1,this.isEditBatch=!1,this.addBatch=!1,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}));const t=JSON.parse(sessionStorage.getItem("launchinvoicingSearch"));null!==t&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(","),null!=t.deliveryStartDate&&(this.deliveryStartDate=t.deliveryStartDate,this.minDate=new Date(this.deliveryStartDate)),null!=t.deliveryEndDate&&(this.deliveryEndDate=t.deliveryEndDate,this.maxDate=new Date(this.deliveryEndDate))),this.invoicingService.getinvoicingBatches.subscribe(()=>{const e=JSON.parse(sessionStorage.getItem("launchinvoicingSearch")),t=e.deliveryStartDate,i=e.deliveryEndDate,n=e.selectedActivitiesIdentifiers.map(e=>e.id).join(",");this.getLaunchInvoices(n,t,i)})}ngOnDestroy(){this.subscription.unsubscribe()}toggleEditDetails(e){this.isEditBatch=!0,this.selectedBatch=e,this.addBatch=!1,this.listView=!1}getActivities(){this.projectService.getActivities().subscribe(e=>{null!=e&&(this.activitiesIdentifiers=e,this.user.groupId===S.Fl.ProjectManager?(this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(e=>e.id===this.user.activityId),this.isProjectManager=!0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(",")):this.selectedActivitiesIds=this.activitiesIdentifiers.map(e=>e.id).join(","),this.onChangeActivity(this.selectedActivitiesIds))})}onChangeActivity(e){this.selectedActivitiesIds=e}onResetActivity(){this.selectedActivitiesIdentifiers=[]}savedBatch(e){this.listView=e,this.isEditBatch=!e,this.addBatch=!e,this.emptyResult=!1,this.invoicingService.getLaunchInvoices(this.selectedActivitiesIds,this.deliveryStartDate,this.deliveryEndDate).subscribe(e=>{null!=e&&(this.batches=e,this.lengthBatches=this.batches.length)})}exportToExcel(){if(void 0!==this.batches&&0!==this.batches.length){const e=[{header:"Activity",key:"activityName"},{header:"Batch Reference",key:"batchReference"},{header:"Order Reference",key:"contractReference"},{header:"Estimate Reference",key:"estimateReference"},{header:"Project",key:"projectName"},{header:"Customer",key:"customer"},{header:"Delivery Date",key:"batchDeliveryDate"},{header:"Adressed To",key:"batchAdressedTo"},{header:"Amount",key:"batchAmount"},{header:"Invoice Date",key:"invoiceDeliveryDate"},{header:"Net To Pay",key:"invoiceNetToBePayed"},{header:"Currency",key:"currency"},{header:"Saari Ref",key:"invoiceSaariReference"}],t=[],i=[],n=[];this.batches.forEach(e=>{const i=[];i.push(e.activityName),i.push(e.batchReference),i.push(e.contractReference),i.push(e.estimateReference),i.push(e.projectName),i.push(e.customer),i.push(this.dateFormat(e.batchDeliveryDate)),i.push(e.batchAdressedTo),i.push(e.batchAmount),i.push(this.dateFormat(e.invoiceDeliveryDate)),i.push(e.invoiceNetToBePayed),i.push(e.currency),i.push(e.invoiceSaariReference),t.push(i)}),this.excelService.generateExcel(e,t,i,n,"Invoices_Launch")}}dateFormat(e){return null==e||"0001-01-01T00:00:00"===e?"":this.dateTimeService.getShortFormat(e)}filterBatchButton(){this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(","),this.updateSessionStorage(),this.getLaunchInvoices(this.selectedActivitiesIds,this.deliveryStartDate,this.deliveryEndDate)}updateSessionStorage(){const e=new x.$l;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.deliveryStartDate=this.deliveryStartDate,e.deliveryEndDate=this.deliveryEndDate,sessionStorage.setItem("launchinvoicingSearch",JSON.stringify(e))}getLaunchInvoices(e,t,i){this.searchFilterService.pageIndex=0,this.isLoading=!0,this.invoicingService.getLaunchInvoices(e,t,i).subscribe(e=>{this.isLoading=!1,null!=e&&(this.batches=e,this.batches.forEach(e=>{e.invoiceNetToBePayed&&(e.invoiceNetToBePayed=+e.invoiceNetToBePayed.toString().replace(",",".")),e.BatchChecked=this.invoicedBatch(e),this.emptyResult=!1}),this.lengthBatches=this.batches.length,this.listView=!0)})}invoicedBatch(e){return!(0===e.invoiceId||null==e.invoiceId)}insertInvoicingBatch(){this.mutliClickDisable=!0,setTimeout(()=>{this.mutliClickDisable=!1},1e3),this.invoicingService.insertInvoicingBatch.next()}onSortData(e){e.active&&""!==e.direction&&void 0!==this.batches&&(this.batches.sort((t,i)=>{const n="asc"===e.direction;switch(e.active){case"batchReference":return this.sortService.compare(t.batchReference,i.batchReference,n,!1);case"orderReference":return this.sortService.compare(t.contractReference,i.contractReference,n,!1);case"estimateReference":return this.sortService.compare(t.estimateReference,i.estimateReference,n,!1);case"projectName":return this.sortService.compare(t.projectName,i.projectName,n,!1);case"batchDelevryDate":return this.sortService.compare(t.batchDeliveryDate,i.batchDeliveryDate,n,!1);case"batchAdressedTo":return this.sortService.compare(t.batchAdressedTo,i.batchAdressedTo,n,!1);case"batchAmount":return this.sortService.compare(t.batchAmount,i.batchAmount,n,!0);case"invoiceDeliveryDate":return this.sortService.compare(t.invoiceDeliveryDate,i.invoiceDeliveryDate,n,!1);case"invoiceNetToBePayed":return this.sortService.compare(t.invoiceNetToBePayed,i.invoiceNetToBePayed,n,!0);case"invoiceSaariReference":return this.sortService.compare(t.invoiceSaariReference,i.invoiceSaariReference,n,!1);case"invoiced":return this.sortService.compare(t.BatchChecked,i.BatchChecked,n,!1);default:return 0}}),this.batches.sort((e,t)=>this.sortService.compare(e.activityId,t.activityId,!0,!0))),this.paginatorPipe.transform(this.batches,this.searchFilterService.pageIndex,this.searchFilterService.pageSize)}daysChangePeriodFrom(e){const t=new Date(e);this.deliveryStartDate=$([t.getFullYear(),t.getMonth()]).toDate(),this.minDate=this.deliveryStartDate}daysChangePeriodTo(e){const t=new Date(e);this.deliveryEndDate=$(t).endOf("month").toDate(),this.maxDate=this.deliveryEndDate}}return e.\u0275fac=function(t){return new(t||e)(v.\u0275\u0275directiveInject(E.X),v.\u0275\u0275directiveInject(b.Kx),v.\u0275\u0275directiveInject(b.xB),v.\u0275\u0275directiveInject(b.nJ),v.\u0275\u0275directiveInject(I.Y4),v.\u0275\u0275directiveInject(b.Cv))},e.\u0275cmp=v.\u0275\u0275defineComponent({type:e,selectors:[["app-all-invoices-launch"]],inputs:{project:"project"},decls:3,vars:1,consts:[[1,"page-body"],[1,"row"],["class","col-xl-12 col-lg-12 filter-bar",4,"ngIf"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],["class","navbar navbar-light bg-faded m-b-10 p-10",4,"ngIf"],[4,"ngIf"],[1,"wrapper"],["class","overlay",4,"ngIf"],["class","example-container mat-elevation-z8 loaded-content",3,"blurred",4,"ngIf"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],["type","submit",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"disabled","click"],[1,"fa","fa-arrow-circle-right",2,"font-size","medium"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"example-container","mat-elevation-z8","loaded-content"],[3,"batches"]],template:function(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",0),v.\u0275\u0275elementStart(1,"div",1),v.\u0275\u0275template(2,Ae,30,13,"div",2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e&&(v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",!t.isEditBatch&&!t.addBatch))},directives:[n.NgIf,D.i$,D.Tg,L.j,d.OP,r.NgControlStatus,r.NgModel,k.M2,M.J,T.$g,Ie],pipes:[P.R],styles:[".filter-button{text-align:center;width:100%;margin:2%}.search-input{font-size:14px}.pointer{cursor:pointer}.reset-all-btn{cursor:pointer;font-size:20px}.reset-all-btn:hover{color:red}.arrow-icon{font-size:10px}.close-icon{float:right;font-size:22px}.multi-search{width:100%}.date-field{font-size:14px}.ngb-accordion .card .card-header{padding-left:5px}.ngb-accordion .card .card-header .a{font-size:15px}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.mat-list-header{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.material-icons{font-size:25px}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),e})();var Me=i(17224);function Te(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Project"),v.\u0275\u0275elementEnd())}function je(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",24),v.\u0275\u0275listener("click",function(t){const i=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext(2).goToInvoicesDetail(i,t)}),v.\u0275\u0275elementStart(1,"span",25),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.projectName),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.projectName," ")}}function Fe(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Batch Ref."),v.\u0275\u0275elementEnd())}function Pe(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",26),v.\u0275\u0275elementStart(1,"span",25),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.batchReference),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.batchReference,"")}}function Ne(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Order Ref."),v.\u0275\u0275elementEnd())}function Be(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",26),v.\u0275\u0275elementStart(1,"span",25),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.contractReference),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate1(" ",e.contractReference," ")}}function Oe(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Addressed To"),v.\u0275\u0275elementEnd())}function Ve(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",26),v.\u0275\u0275elementStart(1,"span",25),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.invoiceAdressedTo),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate(e.invoiceAdressedTo)}}function ze(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Customer"),v.\u0275\u0275elementEnd())}function _e(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",26),v.\u0275\u0275elementStart(1,"span",25),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275propertyInterpolate("matTooltip",e.customer),v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate(e.customer)}}function $e(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Net to pay"),v.\u0275\u0275elementEnd())}function Le(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275text(1),v.\u0275\u0275pipe(2,"numberForm"),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate2(" ",v.\u0275\u0275pipeBind1(2,2,e.invoiceNetToBePayed)," ",e.currency," ")}}function He(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Delivery"),v.\u0275\u0275elementEnd())}function Je(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275text(1),v.\u0275\u0275pipe(2,"shortDate"),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate1(" ",v.\u0275\u0275pipeBind1(2,1,e.invoiceDeliveryDate)," ")}}function Ye(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Saari Ref."),v.\u0275\u0275elementEnd())}function qe(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell",27),v.\u0275\u0275elementStart(1,"mat-form-field",28),v.\u0275\u0275elementStart(2,"input",29),v.\u0275\u0275listener("blur",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext(2).updatedSaariRef(t)})("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.invoiceSaariReference=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit;v.\u0275\u0275advance(2),v.\u0275\u0275property("ngModel",e.invoiceSaariReference)}}function Ge(e,t){1&e&&(v.\u0275\u0275elementStart(0,"mat-header-cell",23),v.\u0275\u0275text(1,"Cashed On"),v.\u0275\u0275elementEnd())}function Qe(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"mat-cell"),v.\u0275\u0275elementStart(1,"mat-form-field",30),v.\u0275\u0275elementStart(2,"input",31),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e).$implicit.invoiceCashedOn=t})("dateChange",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext(2).updatedCashedOn(t)})("blur",function(){const t=v.\u0275\u0275restoreView(e).$implicit;return v.\u0275\u0275nextContext(2).updatedCashedOn(t)})("keypress",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext(2).dateOnly(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(3,"mat-datepicker-toggle",32),v.\u0275\u0275element(4,"mat-datepicker",33,34),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=t.$implicit,i=v.\u0275\u0275reference(5),n=v.\u0275\u0275nextContext(2);v.\u0275\u0275advance(2),v.\u0275\u0275property("matDatepicker",i)("ngModel",n.datePipe(e.invoiceCashedOn)),v.\u0275\u0275advance(1),v.\u0275\u0275property("for",i),v.\u0275\u0275advance(1),v.\u0275\u0275property("startView","month")}}function We(e,t){1&e&&v.\u0275\u0275element(0,"mat-header-row",35)}function Ue(e,t){1&e&&v.\u0275\u0275element(0,"mat-row")}function Xe(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"div",39),v.\u0275\u0275text(1),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(1),v.\u0275\u0275textInterpolate2(" \xa0",e.activityTotal,"\xa0",e.currency,"\xa0\xa0 ")}}function Ke(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"mat-cell",36),v.\u0275\u0275elementStart(1,"strong",37),v.\u0275\u0275text(2),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(3,"strong",37),v.\u0275\u0275text(4,"\xa0\xa0\xa0\xa0-- Net To Pay Total:"),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(5,Xe,2,2,"div",38),v.\u0275\u0275elementEnd()),2&e){const e=t.$implicit;v.\u0275\u0275advance(2),v.\u0275\u0275textInterpolate(e.activityName),v.\u0275\u0275advance(3),v.\u0275\u0275property("ngForOf",e.activitiesTotal)}}function Ze(e,t){1&e&&v.\u0275\u0275element(0,"mat-row")}const et=function(){return["groupHeader"]};function tt(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",1),v.\u0275\u0275elementStart(1,"mat-table",2,3),v.\u0275\u0275listener("matSortChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().onSortData(t)}),v.\u0275\u0275elementContainerStart(3,4),v.\u0275\u0275template(4,Te,2,0,"mat-header-cell",5),v.\u0275\u0275template(5,je,3,2,"mat-cell",6),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(6,7),v.\u0275\u0275template(7,Fe,2,0,"mat-header-cell",5),v.\u0275\u0275template(8,Pe,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(9,9),v.\u0275\u0275template(10,Ne,2,0,"mat-header-cell",5),v.\u0275\u0275template(11,Be,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(12,10),v.\u0275\u0275template(13,Oe,2,0,"mat-header-cell",5),v.\u0275\u0275template(14,Ve,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(15,11),v.\u0275\u0275template(16,ze,2,0,"mat-header-cell",5),v.\u0275\u0275template(17,_e,3,2,"mat-cell",8),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(18,12),v.\u0275\u0275template(19,$e,2,0,"mat-header-cell",5),v.\u0275\u0275template(20,Le,3,4,"mat-cell",13),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(21,14),v.\u0275\u0275template(22,He,2,0,"mat-header-cell",5),v.\u0275\u0275template(23,Je,3,3,"mat-cell",13),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(24,15),v.\u0275\u0275template(25,Ye,2,0,"mat-header-cell",5),v.\u0275\u0275template(26,qe,3,1,"mat-cell",16),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275elementContainerStart(27,17),v.\u0275\u0275template(28,Ge,2,0,"mat-header-cell",5),v.\u0275\u0275template(29,Qe,6,4,"mat-cell",13),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275template(30,We,1,0,"mat-header-row",18),v.\u0275\u0275template(31,Ue,1,0,"mat-row",19),v.\u0275\u0275elementContainerStart(32,20),v.\u0275\u0275template(33,Ke,6,2,"mat-cell",21),v.\u0275\u0275elementContainerEnd(),v.\u0275\u0275template(34,Ze,1,0,"mat-row",22),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("dataSource",e.dataSource),v.\u0275\u0275advance(29),v.\u0275\u0275property("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),v.\u0275\u0275advance(1),v.\u0275\u0275property("matRowDefColumns",e.displayedColumns),v.\u0275\u0275advance(3),v.\u0275\u0275property("matRowDefColumns",v.\u0275\u0275pureFunction0(6,et))("matRowDefWhen",e.isGroup)}}let it=(()=>{class e{constructor(e,t,i,n,a,r,s){this.invoicingService=e,this.dialog=t,this.searchFilterService=i,this.dateTimeService=n,this.router=a,this.activeRoute=r,this.invoicesValidateGroupService=s,this.displayedColumns=["projectName","customer","contractReference","batchReference","invoiceAdressedTo","invoiceDeliveryDate","invoiceNetToBePayed","invoiceSaariReference","invoiceCashedOn"],this.dataSource=new J.by,this.groupByColumns=[],this.expandedSubInvoice=[]}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.isEditInvoice=!1,this.listView=!0,this.selectedInvoiceId=0,this.subscription=this.searchFilterService.resultChanged.subscribe(()=>{this.setInvoiceDeposit(),this.dataSource=new J.by(this.invoicesValidateGroupService.addGroupWithTotal(this.searchFilterService.showingDataLastFilter,this.groupByColumns,this.invoicesFiltred))})}ngOnChanges(){this.groupByColumns=["activityName"],(null!==this.invoices||void 0!==this.invoices)&&(this.dataSource=new J.by(this.invoicesValidateGroupService.addGroupWithTotal(this.searchFilterService.showingDataLastFilter,this.groupByColumns,this.invoicesFiltred)))}ngOnDestroy(){this.subscription.unsubscribe()}setInvoiceDeposit(){this.searchFilterService.showingDataLastFilter.forEach(e=>{(1===e.invoiceDeposit||3===e.invoiceDeposit)&&(e.invoiceChecked=!0)})}isGroup(e,t){return t.level}getValidationState(e){return 1===e?"validated":"pending"}updatedSaariRef(e){this.invoicingService.saveInvoiceSaariRef(e.invoiceId,e.invoiceSaariReference).subscribe(()=>{""===e.invoiceSaariReference&&this.invoicingService.reloadInvoices.next()})}updatedCashedOn(e){this.invoicingService.saveInvoiceCashedOn(e.invoiceId,e.invoiceCashedOn)}dateOnly(e){return this.dateTimeService.dateOnly(e)}datePipe(e){return"0001-01-01T00:00:00"===e?"":e}onSortData(e){this.invoicingService.sortAllInvoices.next(e)}goToInvoicesDetail(e,t){this.router.navigate(["/project-management/project/edit/"+e.pifId.toString()+"/"+e.projectId.toString(),{title:"invoices",invoiceId:e.invoiceId}],{relativeTo:this.activeRoute})}}return e.\u0275fac=function(t){return new(t||e)(v.\u0275\u0275directiveInject(E.X),v.\u0275\u0275directiveInject(c.uw),v.\u0275\u0275directiveInject(b.nJ),v.\u0275\u0275directiveInject(b.Cv),v.\u0275\u0275directiveInject(f.F0),v.\u0275\u0275directiveInject(f.gz),v.\u0275\u0275directiveInject(E.a))},e.\u0275cmp=v.\u0275\u0275defineComponent({type:e,selectors:[["app-invoices-validate"]],viewQuery:function(e,t){if(1&e&&v.\u0275\u0275viewQuery(H.YE,7),2&e){let e;v.\u0275\u0275queryRefresh(e=v.\u0275\u0275loadQuery())&&(t.sort=e.first)}},inputs:{InvoiceEditable:"InvoiceEditable",invoices:"invoices",invoicesFiltred:"invoicesFiltred"},features:[v.\u0275\u0275NgOnChangesFeature],decls:1,vars:1,consts:[["class","example-container mat-elevation-z8",4,"ngIf"],[1,"example-container","mat-elevation-z8"],["matSortDirection","asc","matSortDisableClear","","matSort","",3,"dataSource","matSortChange"],["table",""],["matColumnDef","projectName",1,"table-hover","table-striped","table-styling"],["mat-sort-header","",4,"matHeaderCellDef"],["class","link",3,"matTooltip","click",4,"matCellDef"],["matColumnDef","batchReference"],[3,"matTooltip",4,"matCellDef"],["matColumnDef","contractReference"],["matColumnDef","invoiceAdressedTo"],["matColumnDef","customer"],["matColumnDef","invoiceNetToBePayed"],[4,"matCellDef"],["matColumnDef","invoiceDeliveryDate"],["matColumnDef","invoiceSaariReference"],["floatLabel","never","style","text-align: left;",4,"matCellDef"],["matColumnDef","invoiceCashedOn"],["class"," table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["matColumnDef","groupHeader"],["colspan","999",4,"matCellDef"],[4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-sort-header",""],[1,"link",3,"matTooltip","click"],[1,"span-ellipsis"],[3,"matTooltip"],["floatLabel","never",2,"text-align","left"],[2,"width","70%"],["matInput","",2,"border","white",3,"ngModel","blur","ngModelChange"],[2,"width","90%"],["matInput","","name","invoiceCashedOn",3,"matDatepicker","ngModel","ngModelChange","dateChange","blur","keypress"],["matSuffix","",3,"for"],[3,"startView"],["PickerStartDay",""],[1,"table-primary","table-*"],["colspan","999"],[1,"strong"],["class","strong-amount",4,"ngFor","ngForOf"],[1,"strong-amount"]],template:function(e,t){1&e&&v.\u0275\u0275template(0,tt,35,7,"div",0),2&e&&v.\u0275\u0275property("ngIf",t.listView)},directives:[n.NgIf,J.BZ,H.YE,J.w1,J.fO,J.Dz,J.as,J.nj,J.ge,H.nU,J.ev,Y.gM,w.KE,R.Nt,r.DefaultValueAccessor,r.NgControlStatus,r.NgModel,A.hl,A.nW,w.R9,A.Mq,J.XQ,J.Gk,n.NgForOf],pipes:[Me.$,Q.M],styles:[".mat-table[_ngcontent-%COMP%]{overflow:auto;border-radius:4px;max-height:calc(100vh - 342px)}table[_ngcontent-%COMP%]{width:100%}.span-ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}.material-icons[_ngcontent-%COMP%]{font-size:15px}.mat-column-groupHeader[_ngcontent-%COMP%]{color:#030303;background-color:#eceaea;font-weight:bolder;font-size:medium;font-family:Arial,Helvetica,sans-serif}.mat-column-projectName[_ngcontent-%COMP%]{flex:0 0 17%!important;width:17%!important}.mat-column-batchReference[_ngcontent-%COMP%]{flex:0 0 14%!important;width:14%!important}.mat-column-contractReference[_ngcontent-%COMP%]{flex:0 0 11%!important;width:11%!important}.mat-column-invoiceAdressedTo[_ngcontent-%COMP%]{flex:0 0 11%!important;width:11%!important}.mat-column-invoiceNetToBePayed[_ngcontent-%COMP%]{flex:0 0 9%!important;width:9%!important;text-align:right;justify-content:flex-end}.mat-column-invoiceDeliveryDate[_ngcontent-%COMP%]{flex:0 0 6%!important;width:6%!important;justify-content:center}.mat-column-invoiceSaariReference[_ngcontent-%COMP%]{flex:0 0 11%!important;width:11%!important;justify-content:center}.mat-column-invoiceCashedOn[_ngcontent-%COMP%]{flex:0 0 11%!important;width:11%!important;justify-content:center}.mat-column-customer[_ngcontent-%COMP%]{flex:0 0 10%!important;width:10%!important}  .mat-sort-header-arrow{color:#fff}.strong[_ngcontent-%COMP%]{background:-webkit-linear-gradient(#5a5a5a,black);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold}.strong-amount[_ngcontent-%COMP%]{background:-webkit-linear-gradient(#546cf3,#05274d);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.link[_ngcontent-%COMP%]{color:#00f;cursor:pointer}"]}),e})();var nt=i(27205);function at(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"nav",23),v.\u0275\u0275elementStart(1,"div",24),v.\u0275\u0275elementStart(2,"button",25),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext(2).exportToExcel()}),v.\u0275\u0275element(3,"em",26),v.\u0275\u0275text(4," Export "),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(5,"div",27),v.\u0275\u0275element(6,"app-paginator",28),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext(2);v.\u0275\u0275advance(6),v.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.countInvoices)}}function rt(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div"),v.\u0275\u0275elementStart(1,"h1"),v.\u0275\u0275text(2,"No Result Found"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function st(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",29),v.\u0275\u0275elementStart(1,"div",30),v.\u0275\u0275elementStart(2,"div",31),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",32),v.\u0275\u0275element(5,"mat-spinner"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd())}function ct(e,t){if(1&e&&(v.\u0275\u0275elementStart(0,"div",33),v.\u0275\u0275element(1,"app-invoices-validate",34),v.\u0275\u0275pipe(2,"paginator"),v.\u0275\u0275elementEnd()),2&e){const e=v.\u0275\u0275nextContext(2);v.\u0275\u0275classProp("blurred",e.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("invoices",v.\u0275\u0275pipeBind3(2,5,e.invoices,e.searchFilterService.pageIndex,e.searchFilterService.pageSize))("invoicesFiltred",e.invoices)("InvoiceEditable",e.InvoiceEditable)}}function ot(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",4),v.\u0275\u0275elementStart(1,"div",5),v.\u0275\u0275elementStart(2,"div",6),v.\u0275\u0275elementStart(3,"div",1),v.\u0275\u0275elementStart(4,"div",7),v.\u0275\u0275elementStart(5,"mat-list"),v.\u0275\u0275elementStart(6,"mat-list-item"),v.\u0275\u0275elementStart(7,"h3",8),v.\u0275\u0275text(8,"Period"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(9,"div",9),v.\u0275\u0275elementStart(10,"app-select-month",10),v.\u0275\u0275listener("daysChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().daysChangePeriodFrom(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(11,"div",9),v.\u0275\u0275elementStart(12,"app-select-month",11),v.\u0275\u0275listener("daysChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().daysChangePeriodTo(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(13,"div",7),v.\u0275\u0275elementStart(14,"mat-list"),v.\u0275\u0275elementStart(15,"mat-list-item"),v.\u0275\u0275elementStart(16,"h3",8),v.\u0275\u0275text(17,"Activity"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementStart(18,"div",12),v.\u0275\u0275elementStart(19,"ng-multiselect-dropdown",13),v.\u0275\u0275listener("ngModelChange",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().selectedActivitiesIdentifiers=t}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275element(20,"div",14),v.\u0275\u0275elementStart(21,"div",15),v.\u0275\u0275elementStart(22,"div",16),v.\u0275\u0275elementStart(23,"button",17),v.\u0275\u0275listener("click",function(){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().filterInvoiceButton()}),v.\u0275\u0275text(24,"Search"),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(25,at,7,3,"nav",18),v.\u0275\u0275template(26,rt,3,0,"div",19),v.\u0275\u0275elementStart(27,"div",20),v.\u0275\u0275template(28,st,6,0,"div",21),v.\u0275\u0275template(29,ct,3,9,"div",22),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext();v.\u0275\u0275advance(10),v.\u0275\u0275property("selectedDate",e.deliveryStartDate)("maxDate",e.maxDate),v.\u0275\u0275advance(2),v.\u0275\u0275property("selectedDate",e.deliveryEndDate)("minDate",e.minDate),v.\u0275\u0275advance(7),v.\u0275\u0275property("placeholder","Select...")("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("settings",e.dropdownSettings),v.\u0275\u0275advance(6),v.\u0275\u0275property("ngIf",!e.addInvoice&&!e.isEditInvoice),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",e.isLoading),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",e.listView&&!e.isEditInvoice&&!e.emptyResult)}}function lt(e,t){if(1&e){const e=v.\u0275\u0275getCurrentView();v.\u0275\u0275elementStart(0,"div",35),v.\u0275\u0275elementStart(1,"app-edit-invoice",36),v.\u0275\u0275listener("isSavedInvoice",function(t){return v.\u0275\u0275restoreView(e),v.\u0275\u0275nextContext().savedInvoice(t)}),v.\u0275\u0275elementEnd(),v.\u0275\u0275elementEnd()}if(2&e){const e=v.\u0275\u0275nextContext();v.\u0275\u0275advance(1),v.\u0275\u0275property("project",e.project)("isNewInvoice",!e.listView)("isEditInvoice",e.isEditInvoice)("selectedInvoice",e.selectedInvoice)}}const dt=[{path:"",data:{title:"Invoice",function:S.FI.Invoicing,status:!1},canActivate:[g.a1],children:[{path:"invoices-launch",component:ke,data:{title:"Invoices Launch",icon:"icon-home",caption:"",function:S.FI.Batches,status:!0},canActivate:[g.a1]},{path:"invoices",component:(()=>{class e{constructor(e,t,i,n,a,r){this.sortService=e,this.searchFilterService=t,this.excelService=i,this.invoicingService=n,this.dateTimeService=a,this.projectService=r,this.emptyResult=!1,this.listView=!1,this.isEditInvoice=!1,this.addInvoice=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.paginatorPipe=new C.Ry(this.searchFilterService),this.subscription=new y.w0}ngOnInit(){const e=this.dateTimeService.today();this.deliveryStartDate=$([e.getFullYear(),e.getMonth()]).toDate(),this.deliveryEndDate=$(e).endOf("month").toDate(),this.minDate=this.deliveryStartDate,this.maxDate=this.deliveryEndDate,this.subscription.add(this.invoicingService.sortAllInvoices.subscribe(e=>{this.onSortData(e)})),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.user=JSON.parse(localStorage.getItem("currentUser")),this.isEditInvoice=!1,this.subscription.add(this.invoicingService.reloadInvoices.subscribe(e=>{const t=JSON.parse(sessionStorage.getItem("invoicesSearch")),i=t.selectedActivitiesIdentifiers.map(e=>e.id).join(",");this.getInvoices(i,t.deliveryStartDate,t.deliveryEndDate)})),this.countInvoices=0,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}));const t=JSON.parse(sessionStorage.getItem("invoicesSearch"));null!==t&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(","),null!=t.deliveryStartDate&&(this.deliveryStartDate=t.deliveryStartDate,this.minDate=new Date(this.deliveryStartDate)),null!=t.deliveryEndDate&&(this.deliveryEndDate=t.deliveryEndDate,this.maxDate=new Date(this.deliveryEndDate)))}ngOnDestroy(){this.subscription.unsubscribe()}onResetActivity(){this.selectedActivitiesIdentifiers=[]}getActivities(){this.projectService.getActivities().subscribe(e=>{null!=e&&(this.activitiesIdentifiers=e,this.selectedActivitiesIds=this.activitiesIdentifiers.map(e=>e.id).join(","),this.onChangeActivity(this.selectedActivitiesIds))})}onChangeActivity(e){this.selectedActivitiesIds=e}toggleEditDetails(e){this.isEditInvoice=!0,this.selectedInvoice=e,this.listView=!1}savedInvoice(e){this.listView=!0,this.isEditInvoice=!1,this.addInvoice=!1,this.getInvoices(this.selectedActivitiesIds,this.deliveryStartDate,this.deliveryEndDate)}invoiceCanceled(e){this.listView=e,this.isEditInvoice=!e,this.getInvoices(this.selectedActivitiesIds,this.deliveryStartDate,this.deliveryEndDate)}filterInvoiceButton(){this.searchFilterService.pageIndex=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(e=>e.id).join(",");const e=new x.z0;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.deliveryStartDate=this.deliveryStartDate,e.deliveryEndDate=this.deliveryEndDate,sessionStorage.setItem("invoicesSearch",JSON.stringify(e)),this.getInvoices(this.selectedActivitiesIds,this.deliveryStartDate,this.deliveryEndDate)}getInvoices(e,t,i){this.isLoading=!0,this.invoicingService.getInvoices(e,t,i).subscribe(e=>{this.isLoading=!1,null!=e&&(this.invoices=e,this.countInvoices=this.invoices.length,this.emptyResult=!1,this.listView=!0,this.emptyResult=0===e.length)})}exportToExcel(){if(void 0!==this.invoices&&0!==this.invoices.length){const e=[{header:"Activity",key:"activityName"},{header:"Project",key:"projectName"},{header:"Customer",key:"customer"},{header:"Batch Reference",key:"batchReference"},{header:"Order Reference",key:"contractReference"},{header:"Adressed To",key:"invoiceAdressedTo"},{header:"Net To Pay",key:"invoiceNetToBePayed"},{header:"Currency",key:"currency"},{header:"Invoice Date",key:"invoiceDeliveryDate"},{header:"Saari Ref",key:"invoiceSaariReference"},{header:"Cashed On",key:"invoiceCashedOn"}],t=[],i=[],n=[];this.invoices.forEach(e=>{const i=[];i.push(e.activityName),i.push(e.projectName),i.push(e.customer),i.push(e.batchReference),i.push(e.contractReference),i.push(e.invoiceAdressedTo),i.push(e.invoiceNetToBePayed),i.push(e.currency),i.push(this.dateFormat(e.invoiceDeliveryDate)),i.push(e.invoiceSaariReference),i.push(this.dateFormat(e.invoiceCashedOn)),t.push(i)}),this.excelService.generateExcel(e,t,i,n,"Invoices_Validate")}}onClickingEnter(e){"Enter"===e.key&&this.filterInvoiceButton()}dateFormat(e){return null==e||"0001-01-01T00:00:00"===e?"":this.dateTimeService.getShortFormat(e)}dateOnly(e){return this.dateTimeService.dateOnly(e)}onSortData(e){e.active&&""!==e.direction&&void 0!==this.invoices&&(this.invoices.sort((t,i)=>{const n="asc"===e.direction;switch(e.active){case"projectName":return this.sortService.compare(t.projectName,i.projectName,n,!1);case"batchReference":return this.sortService.compare(t.batchReference,i.batchReference,n,!1);case"invoiceReference":return this.sortService.compare(t.invoiceReference,i.invoiceReference,n,!1);case"contractReference":return this.sortService.compare(t.contractReference,i.contractReference,n,!1);case"invoiceAdressedTo":return this.sortService.compare(t.invoiceAdressedTo,i.invoiceAdressedTo,n,!1);case"invoiceAmount":return this.sortService.compare(t.invoiceAmount,i.invoiceAmount,n,!0);case"invoiceNetToBePayed":return this.sortService.compare(t.invoiceNetToBePayed,i.invoiceNetToBePayed,n,!0);case"invoiceDeliveryDate":return this.sortService.compare(t.invoiceDeliveryDate,i.invoiceDeliveryDate,n,!1);case"invoiceSaariReference":return this.sortService.compare(t.invoiceSaariReference,i.invoiceSaariReference,n,!1);case"invoiceCashedOn":return this.sortService.compare(t.invoiceCashedOn,i.invoiceCashedOn,n,!1);case"customer":return this.sortService.compare(t.customer,i.customer,n,!1);default:return 0}}),this.invoices.sort((e,t)=>this.sortService.compare(e.activityId,t.activityId,!0,!0))),this.paginatorPipe.transform(this.invoices,this.searchFilterService.pageIndex,this.searchFilterService.pageSize)}daysChangePeriodFrom(e){const t=new Date(e);this.deliveryStartDate=$([t.getFullYear(),t.getMonth()]).toDate(),this.minDate=this.deliveryStartDate}daysChangePeriodTo(e){const t=new Date(e);this.deliveryEndDate=$(t).endOf("month").toDate(),this.maxDate=this.deliveryEndDate}}return e.\u0275fac=function(t){return new(t||e)(v.\u0275\u0275directiveInject(b.Kx),v.\u0275\u0275directiveInject(b.nJ),v.\u0275\u0275directiveInject(b.xB),v.\u0275\u0275directiveInject(E.X),v.\u0275\u0275directiveInject(b.Cv),v.\u0275\u0275directiveInject(I.Y4))},e.\u0275cmp=v.\u0275\u0275defineComponent({type:e,selectors:[["app-all-invoices-validate"]],decls:4,vars:2,consts:[[1,"page-body"],[1,"row"],["class","col-xl-12 col-lg-12 filter-bar",4,"ngIf"],["class","example-container mat-elevation-z8",4,"ngIf"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],["class","navbar navbar-light bg-faded m-b-10 p-10",4,"ngIf"],[4,"ngIf"],[1,"wrapper"],["class","overlay",4,"ngIf"],["class","example-container mat-elevation-z8 loaded-content",3,"blurred",4,"ngIf"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"example-container","mat-elevation-z8","loaded-content"],[3,"invoices","invoicesFiltred","InvoiceEditable"],[1,"example-container","mat-elevation-z8"],[3,"project","isNewInvoice","isEditInvoice","selectedInvoice","isSavedInvoice"]],template:function(e,t){1&e&&(v.\u0275\u0275elementStart(0,"div",0),v.\u0275\u0275elementStart(1,"div",1),v.\u0275\u0275template(2,ot,30,12,"div",2),v.\u0275\u0275elementEnd(),v.\u0275\u0275template(3,lt,2,4,"div",3),v.\u0275\u0275elementEnd()),2&e&&(v.\u0275\u0275advance(2),v.\u0275\u0275property("ngIf",!t.isEditInvoice),v.\u0275\u0275advance(1),v.\u0275\u0275property("ngIf",!t.listView&&t.isEditInvoice&&!t.emptyResult))},directives:[n.NgIf,D.i$,D.Tg,L.j,d.OP,r.NgControlStatus,r.NgModel,k.M2,M.J,T.$g,it,nt.b],pipes:[P.R],styles:[".filter-button{text-align:center;width:100%;margin:2%}.search-input{font-size:14px}.date-field{font-size:14px}.pointer{cursor:pointer}.reset-all-btn{cursor:pointer;font-size:20px}.reset-all-btn:hover{color:red}.arrow-icon{font-size:10px}.close-icon{float:right;font-size:22px}.multi-search{width:100%}.ngb-accordion .card .card-header{padding-left:5px}.ngb-accordion .card .card-header .a{font-size:15px}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.mat-list-header{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.material-icons{font-size:25px}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),e})(),data:{title:"Invoices Validate",icon:"icon-home",caption:"",function:S.FI.Invoices,status:!0},canActivate:[g.a1]},{path:"quotations",component:_,data:{title:"Quotations",icon:"icon-home",caption:"",function:S.FI.Estimations,status:!0},canActivate:[g.a1]}]}];let mt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=v.\u0275\u0275defineInjector({imports:[[f.Bz.forChild(dt)],f.Bz]}),e})();var ht=i(81040);let pt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=v.\u0275\u0275defineInjector({providers:[b.nJ],imports:[[n.CommonModule,a.m,r.FormsModule,r.ReactiveFormsModule,a.q,c.Is,d.ZQ.forRoot(),m.HttpClientModule,ht.U,h.o]]}),e})();var vt=i(88720);let ut=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=v.\u0275\u0275defineInjector({providers:[b.nJ],imports:[[n.CommonModule,a.m,r.FormsModule,r.ReactiveFormsModule,a.q,c.Is,d.ZQ.forRoot(),m.HttpClientModule,vt.b]]}),e})();const ft={parse:{dateInput:"L"},display:{dateInput:"L",monthYearLabel:"MMM YYYY",dateA11yLabel:"LL",monthYearA11yLabel:"MMMM YYYY"}};let gt=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=v.\u0275\u0275defineNgModule({type:e}),e.\u0275inj=v.\u0275\u0275defineInjector({providers:[I.Y4,E.X,E.a,b.n4,b.Kx,{provide:s.Ad,useValue:"fr-FR"},{provide:s._A,useClass:o.t7,deps:[s.Ad]},{provide:s.sG,useValue:ft}],imports:[[n.CommonModule,mt,a.m,r.FormsModule,r.ReactiveFormsModule,a.q,c.Is,l.w,ut,u,pt]]}),e})()}}]);
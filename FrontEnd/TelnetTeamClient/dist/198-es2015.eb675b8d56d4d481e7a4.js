"use strict";(self.webpackChunktelnetteam_app=self.webpackChunktelnetteam_app||[]).push([[198],{13198:function(t,e,i){i.r(e),i.d(e,{IndicatorModule:function(){return ki}});var n=i(38583),o=i(32403),r=i(67827),a=i(88452),s=i(62028),l=i(63753),d=i(97004),c=i(37716),h=i(4618),m=i(44995),p=i(10337),u=i(19992),f=i(64576),g=i(7539),y=i(3679),v=i(82613),b=i(98295),S=i(49983),x=i(72172),C=i(69517),I=i(39924),P=i(4929);function E(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-grid-tile",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"number"),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate2(" ",t.userIdentifier," (",c.\u0275\u0275pipeBind2(2,2,i.getTotal(t.monthLoads[1].load),"1.2-2"),") ")}}function M(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-grid-tile",6),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"number"),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate2(" ",t.userIdentifier," (",c.\u0275\u0275pipeBind2(2,2,i.getTotal(t.monthLoads[1].load),"1.2-2"),") ")}}let A=(()=>{class t{constructor(t){this.searchFilterService=t}ngOnInit(){}getTotal(t){return void 0===t.total?0:t.total}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(p.nJ))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-resources-inter-contract"]],inputs:{resourcesLoadBudgeted:"resourcesLoadBudgeted",resourcesLoadPlanned:"resourcesLoadPlanned",budgetedNumber:"budgetedNumber",plannedNumber:"plannedNumber"},decls:13,vars:5,consts:[["cols","12","rowHeight","40px"],["colspan","12",1,"header",2,"margin-bottom","5px"],["cols","12","rowHeight","40px",2,"margin-top","5px",3,"hidden"],["colspan","1",1,"header",3,"rowspan"],["class","body",4,"ngFor","ngForOf"],["cols","12","rowHeight","40px",2,"margin-top","5px"],[1,"body"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-grid-list",0),c.\u0275\u0275elementStart(1,"mat-grid-tile",1),c.\u0275\u0275text(2,"Inter contract resources "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"mat-grid-list",2),c.\u0275\u0275elementStart(4,"mat-grid-tile",3),c.\u0275\u0275text(5,"Invoiced "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerStart(6),c.\u0275\u0275template(7,E,3,5,"mat-grid-tile",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(8,"mat-grid-list",5),c.\u0275\u0275elementStart(9,"mat-grid-tile",3),c.\u0275\u0275text(10,"Planned "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementContainerStart(11),c.\u0275\u0275template(12,M,3,5,"mat-grid-tile",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(3),c.\u0275\u0275property("hidden",0===e.resourcesLoadBudgeted.length),c.\u0275\u0275advance(1),c.\u0275\u0275property("rowspan",e.budgetedNumber),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",e.resourcesLoadBudgeted),c.\u0275\u0275advance(2),c.\u0275\u0275property("rowspan",e.plannedNumber),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",e.resourcesLoadPlanned))},directives:[P.Il,P.DX,n.NgForOf],pipes:[n.DecimalPipe],styles:[".mat-grid-tile[_ngcontent-%COMP%]{border:1px rgba(255,255,255,.2)}.header[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:550;text-align:center;background-color:#3f629d}.body[_ngcontent-%COMP%]{font-size:12px!important;background-color:#fff;text-align:left}"]}),t})();var j=i(4885),w=i(32789),D=i(38590);function R(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"li"),c.\u0275\u0275text(1),c.\u0275\u0275pipe(2,"number"),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate2(" \xa0\xa0\xa0\xa0",t.taskName,": ",c.\u0275\u0275pipeBind2(2,2,t.total,"1.2-2")," ")}}function k(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"ul"),c.\u0275\u0275template(1,R,3,5,"li",2),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(2).$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",t.tasks)}}function L(t,e){if(1&t){const t=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275elementStart(1,"div"),c.\u0275\u0275text(2," \xa0 "),c.\u0275\u0275elementStart(3,"span",3),c.\u0275\u0275listener("click",function(){c.\u0275\u0275restoreView(t);const e=c.\u0275\u0275nextContext().$implicit;return c.\u0275\u0275nextContext(4).expandProject(e)}),c.\u0275\u0275text(4),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(5,"span",1),c.\u0275\u0275listener("click",function(){c.\u0275\u0275restoreView(t);const e=c.\u0275\u0275nextContext().$implicit;return c.\u0275\u0275nextContext(4).expandProject(e)}),c.\u0275\u0275text(6),c.\u0275\u0275pipe(7,"number"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(8,k,2,1,"ul",0),c.\u0275\u0275elementEnd()}if(2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext(4);c.\u0275\u0275advance(3),c.\u0275\u0275property("ngClass",e.isProjectExpandable(t)),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName,": "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngClass",e.isProjectExpandable(t)),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind2(7,5,t.total,"1.2-2"),""),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",t.expanded)}}function N(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"li"),c.\u0275\u0275template(1,L,9,8,"div",0),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",0!==t.projectId)}}function F(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"ul"),c.\u0275\u0275template(1,N,2,1,"li",2),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(3);c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",t.load.projects)}}function O(t,e){if(1&t){const t=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"li"),c.\u0275\u0275elementStart(1,"span",1),c.\u0275\u0275listener("click",function(){c.\u0275\u0275restoreView(t);const e=c.\u0275\u0275nextContext(2);return e.expandLoad(e.load)}),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"number"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,F,2,1,"ul",0),c.\u0275\u0275elementEnd()}if(2&t){const t=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(1),c.\u0275\u0275property("ngClass",t.isLoadExpandable(t.load)),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",c.\u0275\u0275pipeBind2(3,3,t.load.total,"1.2-2")," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngIf",t.load.expanded)}}function T(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"li"),c.\u0275\u0275elementStart(1,"span",4),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(3,"span",5),c.\u0275\u0275text(4),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",t.projectName,":"),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(t.total)}}function _(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"li"),c.\u0275\u0275elementStart(1,"ul"),c.\u0275\u0275template(2,T,5,2,"li",2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",t.load.projects)}}function W(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"ul"),c.\u0275\u0275template(1,O,5,6,"li",0),c.\u0275\u0275template(2,_,3,1,"li",0),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",!t.palnnedEstimatedWorkload),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",t.palnnedEstimatedWorkload)}}let z=(()=>{class t{constructor(){this.visibleLoad=!1,this.palnnedEstimatedWorkload=!1}ngOnInit(){this.visibleLoad=void 0!==this.load.total,this.visibleLoad&&(this.palnnedEstimatedWorkload=this.load.type===d.L2.Planned&&0===this.load.total&&1===this.load.projects.length&&0===this.load.projects[0].projectId)}isLoadExpandable(t){return 0!==t.projects.length?"underline pointer":"underline"}expandLoad(t){t.expanded=!t.expanded}isProjectExpandable(t){return 0!==t.tasks.length?"underline pointer":"underline"}expandProject(t){t.expanded=!t.expanded}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-month-load"]],inputs:{load:"load"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngClass","click"],[4,"ngFor","ngForOf"],[1,"bold",3,"ngClass","click"],[1,"bold","italic"],[1,"italic"]],template:function(t,e){1&t&&c.\u0275\u0275template(0,W,3,2,"ul",0),2&t&&c.\u0275\u0275property("ngIf",e.visibleLoad)},directives:[n.NgIf,n.NgClass,n.NgForOf],pipes:[n.DecimalPipe],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.bold[_ngcontent-%COMP%]{font-weight:bold}.underline[_ngcontent-%COMP%]{-webkit-text-decoration-line:underline;text-decoration-line:underline}.italic[_ngcontent-%COMP%]{font-style:italic}"]}),t})();function H(t,e){1&t&&(c.\u0275\u0275elementStart(0,"th",11),c.\u0275\u0275text(1,"Resource"),c.\u0275\u0275elementEnd())}function V(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",12),c.\u0275\u0275elementStart(1,"span",13),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=e.dataIndex,n=c.\u0275\u0275nextContext();c.\u0275\u0275styleProp("display",n.getRowSpan(i)?"":"none"),c.\u0275\u0275propertyInterpolate("matTooltip",t.userIdentifier),c.\u0275\u0275attribute("rowspan",n.getRowSpan(i)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(t.userIdentifier)}}function G(t,e){1&t&&c.\u0275\u0275element(0,"th",11)}function B(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",14),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate(i.getResourceLoadType(t.type))}}const J=function(t){return{width:t}};function $(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",18),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngStyle",c.\u0275\u0275pureFunction1(2,J,e.getMonthColumnHeaderWidth())),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate(e.getColumnHeader(t))}}function Y(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",19),c.\u0275\u0275elementStart(1,"div",20),c.\u0275\u0275element(2,"app-month-load",21),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext().index,n=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",n.loadColorClass(t,i)),c.\u0275\u0275advance(2),c.\u0275\u0275property("load",t.monthLoads[i].load)}}function U(t,e){1&t&&(c.\u0275\u0275elementContainerStart(0,15),c.\u0275\u0275template(1,$,2,4,"th",16),c.\u0275\u0275template(2,Y,3,2,"td",17),c.\u0275\u0275elementContainerEnd()),2&t&&c.\u0275\u0275propertyInterpolate("matColumnDef",e.$implicit)}function Q(t,e){1&t&&c.\u0275\u0275element(0,"tr",22)}function q(t,e){1&t&&c.\u0275\u0275element(0,"tr",23)}let K=(()=>{class t{constructor(t){this.searchFilterService=t,this.displayedColumns=["Resource","Type"],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.dataSource=new w.by}ngOnInit(){this.buildColmnsHeader(),this.dataSource=new w.by(this.resourcesLoad),this.subscription=this.searchFilterService.resultChanged.subscribe(()=>{this.dataSource=new w.by(this.searchFilterService.showingDataLastFilter)})}ngOnDestroy(){this.subscription.unsubscribe()}buildColmnsHeader(){const t=this.resourcesLoad[0].monthLoads.length;for(let e=0;e<t;e++)this.displayedColumns.push("M"+(e+1)),this.monthColumnsHeaders.push(this.monthNames[this.resourcesLoad[0].monthLoads[e].month]+this.resourcesLoad[0].monthLoads[e].year)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getMonthColumnHeaderWidth(){return Math.round(84/this.resourcesLoad[0].monthLoads.length)+"%"}getRowSpan(t){return Number.isInteger(t/this.loadTypes)?this.loadTypes:""}getResourceLoadType(t){switch(t){case d.L2.Budgeted:return"I";case d.L2.Planned:return"P";case d.L2.Real:return"R"}}loadColorClass(t,e){const i=new Date(t.monthLoads[e].year,t.monthLoads[e].month,1),n=new Date(t.monthLoads[e].year,t.monthLoads[e].month+1,0);if(new Date(t.monthLoads[e].year,12,0)>t.entryDate&&(void 0!==t.exitDate&&(i>t.exitDate||n<t.entryDate)||void 0===t.exitDate&&n<t.entryDate))return"resigned-new-resource";{const i=t.monthLoads[e].load.total;return i>15?"big-load":i>=5?"average-load":i>0?"tiny-load":this.plannedLoadColorClass(t,e)}}plannedLoadColorClass(t,e){const i=t.monthLoads[e].load;if(i.type!==d.L2.Planned||0!==i.total||1!==i.projects.length||0!==i.projects[0].projectId)return 0===t.monthLoads[e].load.total&&t.type===d.L2.Planned&&(t.monthLoads[e].load.total=null),"empty-load";switch(i.projects[0].probability){case 0:return"weak-probability";case 1:return"average-probability";case 2:return"strong-probability";default:return"empty-load"}}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(p.nJ))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-resources-load"]],inputs:{resourcesLoad:"resourcesLoad",loadTypes:"loadTypes",year:"year"},decls:12,vars:5,consts:[["mat-table","","multiTemplateDataRows","",1,"table-width","mat-elevation-z8",3,"dataSource"],["table",""],[2,"padding","0px"],["matColumnDef","Resource"],["mat-header-cell","","scope","col",4,"matHeaderCellDef"],["mat-cell","",3,"matTooltip","display",4,"matCellDef"],["matColumnDef","Type"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","","class","table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","scope","col"],["mat-cell","",3,"matTooltip"],[1,"span-ellipsis"],["mat-cell",""],[3,"matColumnDef"],["mat-header-cell","","scope","col",3,"ngStyle",4,"matHeaderCellDef"],["mat-cell","",3,"ngClass",4,"matCellDef"],["mat-header-cell","","scope","col",3,"ngStyle"],["mat-cell","",3,"ngClass"],[1,"loaded-content"],[3,"load"],["mat-header-row","",1,"table-primary","table-*"],["mat-row",""]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0,1),c.\u0275\u0275element(2,"caption",2),c.\u0275\u0275elementContainerStart(3,3),c.\u0275\u0275template(4,H,2,0,"th",4),c.\u0275\u0275template(5,V,3,5,"td",5),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(6,6),c.\u0275\u0275template(7,G,1,0,"th",4),c.\u0275\u0275template(8,B,2,1,"td",7),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275template(9,U,3,1,"ng-container",8),c.\u0275\u0275template(10,Q,1,0,"tr",9),c.\u0275\u0275template(11,q,1,0,"tr",10),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275property("dataSource",e.dataSource),c.\u0275\u0275advance(9),c.\u0275\u0275property("ngForOf",e.displayedColumns.slice(2,e.displayedColumns.length)),c.\u0275\u0275advance(1),c.\u0275\u0275property("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),c.\u0275\u0275advance(1),c.\u0275\u0275property("matRowDefColumns",e.displayedColumns))},directives:[w.BZ,w.w1,w.fO,w.Dz,n.NgForOf,w.as,w.nj,w.ge,w.ev,D.gM,n.NgStyle,n.NgClass,z,w.XQ,w.Gk],styles:["td.mat-cell[_ngcontent-%COMP%]{height:30px!important;min-width:30px!important;padding-left:10px}td.mat-cell[_ngcontent-%COMP%]:last-of-type, td.mat-footer-cell[_ngcontent-%COMP%]:last-of-type, th.mat-header-cell[_ngcontent-%COMP%]:last-of-type{padding-right:0;border-right:none}.material-icons[_ngcontent-%COMP%]{font-size:15px}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600;text-align:center}.span-ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mat-column-Resource[_ngcontent-%COMP%]{flex:0 0 14%!important;width:14%!important}.mat-column-Type[_ngcontent-%COMP%]{flex:0 0 2%!important;width:2%!important}.big-load[_ngcontent-%COMP%]{background-color:#063a9bf1!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.average-load[_ngcontent-%COMP%]{background-color:#00beff!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.tiny-load[_ngcontent-%COMP%]{background-color:orange!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.weak-probability[_ngcontent-%COMP%]{background-color:red!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.average-probability[_ngcontent-%COMP%]{background-color:#ffdead!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.strong-probability[_ngcontent-%COMP%]{background-color:#98fb98!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.empty-load[_ngcontent-%COMP%]{background-color:tomato!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.resigned-new-resource[_ngcontent-%COMP%]{background-color:gray!important;border-right:1px dashed rgba(255,255,255,.2);border-bottom:1px solid rgba(255,255,255,.2);color:#fff!important}"]}),t})();var Z=i(34239);function X(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",61),c.\u0275\u0275elementStart(1,"div",62),c.\u0275\u0275elementStart(2,"div",63),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275elementStart(4,"div",64),c.\u0275\u0275element(5,"mat-spinner"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function tt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",58),c.\u0275\u0275element(1,"app-resources-load",65),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275property("hidden",!t.hideInterContractGrid),c.\u0275\u0275advance(1),c.\u0275\u0275property("resourcesLoad",c.\u0275\u0275pipeBind3(2,6,t.resourcesLoad,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("loadTypes",t.selectedLoadTypesIdentifiers.length)("year",t.year)}}let et=(()=>{class t{constructor(t,e,i,n,o,r,a){this.indicatorService=t,this.projectService=e,this.coreDataService=i,this.dateTimeService=n,this.excelService=o,this.searchFilterService=r,this.notificationService=a,this.budgeted=!0,this.planned=!0,this.real=!0,this.includeInterns=!1,this.interContract=!1,this.monthsCountInterContract="3",this.displayinterContract="InterContract",this.hideInterContractGrid=!0,this.showBtn=!0,this.resourcesType="Budgeted",this.loadValue=10,this.detailLevel="0",this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.listView=!1,this.resourcesLoad=[],this.resoucesInterContractBudgeted=[],this.resoucesInterContractPlanned=[],this.lengthResourcesLoad=0,this.isLoading=!1,this.customersIdentifiers=[],this.selectedCustomersIdentifiers=[],this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.resourcesIdentifiers=[],this.selectedResourcesIdentifiers=[],this.departmentsIdentifiers=[],this.selectedDepartmentsIdentifiers=[],this.projectsIdentifiers=[],this.selectedProjectsIdentifiers=[],this.loadTypesIdentifiers=[],this.selectedLoadTypesIdentifiers=[],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "]}ngOnInit(){this.year=(new Date).getFullYear(),this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.bindFilterData()}bindFilterData(){this.getClients(),this.getActivities(),this.getResources(),this.getDepartments(),this.getProjects()}getClients(){this.projectService.getClients().subscribe(t=>{null!=t&&(this.customersIdentifiers=t)})}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t,this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId))})}getResources(){this.coreDataService.getActiveUsers().subscribe(t=>{null!=t&&(this.resourcesIdentifiers=t)})}getDepartments(){this.coreDataService.getDepartments().subscribe(t=>{null!=t&&(this.departmentsIdentifiers=t)})}getProjects(){this.projectService.getAllProjects().subscribe(t=>{null!=t&&(this.projectsIdentifiers=t)})}IsInterContract(){this.interContract?(this.startMonth=(new Date).getMonth(),this.monthsCount=+this.monthsCountInterContract+1,this.startDate=new Date(this.startMonth+1+"/01/"+(new Date).getFullYear()),this.endDate=new Date(new Date(this.startDate).setMonth(this.startDate.getMonth()+1+ +this.monthsCountInterContract,0)),this.year=(new Date).getFullYear()):this.year===(new Date).getFullYear()?(this.startMonth=0,this.monthsCount=12,this.startDate=new Date("01/01/"+this.year),this.endDate=new Date("12/31/"+this.year)):(this.startMonth=0,this.monthsCount=12,this.startDate=new Date("01/01/"+this.year),this.endDate=new Date("12/31/"+this.year),this.hideInterContractGrid=!0)}getInterContractList(){this.interContract?this.buildSelectedInterContractResources():this.year===(new Date).getFullYear()&&this.buildNotSelectedInterContractResources(),this.budgetedRowsNumber=this.getRowNumber(this.resoucesInterContractBudgeted),this.plannedRowsNumber=this.getRowNumber(this.resoucesInterContractPlanned)}buildSelectedInterContractResources(){this.resourcesLoad.forEach(t=>{(void 0===t.monthLoads[1].load.total||t.monthLoads[1].load.total<this.loadValue)&&void 0===t.exitDate&&(t.type===d.L2.Budgeted?this.resoucesInterContractBudgeted.push(t):t.type===d.L2.Planned&&this.resoucesInterContractPlanned.push(t))})}buildNotSelectedInterContractResources(){this.resourcesLoad.forEach(t=>{let e=(new Date).getMonth();e=e<11?e+1:e,void 0!==t.monthLoads[e].load&&(void 0===t.monthLoads[e].load.total||t.monthLoads[e].load.total<this.loadValue)&&void 0===t.exitDate&&(t.type===d.L2.Budgeted?this.resoucesInterContractBudgeted.push(t):t.type===d.L2.Planned&&this.resoucesInterContractPlanned.push(t))})}getRowNumber(t){return t.length<11?1:t.length%11>0?Math.floor(t.length/11)+1:Math.floor(t.length/11)}search(){if(this.searchFilterService.pageIndex=0,this.resourcesLoad=[],this.resoucesInterContractBudgeted=[],this.resoucesInterContractPlanned=[],this.lengthResourcesLoad=0,this.listView=!1,this.showBtn=!0,this.concatLoadType(),this.IsInterContract(),0!==this.selectedLoadTypesIdentifiers.length)if(this.loadValue>25)this.notificationService.danger("Load value of interContract must be less than 25");else if(0==+this.monthsCountInterContract||+this.monthsCountInterContract>12)this.notificationService.danger("The number of interContract months must be between 1 and 12");else{this.isLoading=!0;const t=new d.Gl;t.selectedDepartmentsIdentifiers=this.selectedDepartmentsIdentifiers,t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.selectedResourcesIdentifiers=this.selectedResourcesIdentifiers,t.selectedCustomersIdentifiers=this.selectedCustomersIdentifiers,t.selectedProjectsIdentifiers=this.selectedProjectsIdentifiers,t.selectedLoadTypesIdentifiers=this.selectedLoadTypesIdentifiers,t.detailLevel=this.detailLevel,t.includeInterns=this.includeInterns,t.startDate=this.startDate,t.endDate=this.endDate,this.indicatorService.getLoadPlanBudgeted(t).subscribe(e=>{this.indicatorService.getLoadPlanPlanned(t).subscribe(i=>{this.indicatorService.getLoadPlanReal(t).subscribe(t=>{this.prepareResourcesLoads(e),this.prepareResourcesLoads(i),this.prepareResourcesLoads(t);const n=(new Date).getFullYear();(this.interContract||this.year===n)&&this.getInterContractList(),this.searchFilterService.rowSpan=this.selectedLoadTypesIdentifiers.length,this.lengthResourcesLoad=this.resourcesLoad.length/this.selectedLoadTypesIdentifiers.length,this.listView=0!==this.lengthResourcesLoad,this.showBtn=!(0!==this.lengthResourcesLoad&&(this.interContract||this.year===n)),this.isLoading=!1})})})}}onResetAllFilters(){this.year=(new Date).getFullYear(),this.selectedResourcesIdentifiers=[],this.selectedDepartmentsIdentifiers=[],this.selectedProjectsIdentifiers=[],this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId),this.selectedCustomersIdentifiers=[],this.budgeted=!0,this.planned=!0,this.real=!0,this.detailLevel="0",this.includeInterns=!1,this.monthsCountInterContract="3",this.loadValue=10,this.interContractTypes="1",this.interContract=!1}yearChanged(t){this.year=new Date(t).getFullYear()}bugdetedChecked(t){"1"===t.value?(this.budgeted=!0,this.planned=!1,this.real=!1,this.resourcesType="Budgeted"):"2"===t.value&&(this.budgeted=!1,this.planned=!0,this.real=!1,this.resourcesType="Planed")}interContractChecked(t){t.checked?(this.interContractTypes="1",this.budgeted=!0,this.planned=!1,this.real=!1):this.hideInterContractGrid=!0}changeBtnName(){"InterContract"===this.displayinterContract?(this.displayinterContract="Workload plan",this.hideInterContractGrid=!1):(this.displayinterContract="InterContract",this.hideInterContractGrid=!0)}exportToExcel(){if(void 0!==this.resourcesLoad&&0!==this.resourcesLoad.length){const t=[{header:"Matricule",key:"A",width:10},{header:"Ressource",key:"B",width:30},{header:"Type",key:"C",width:10},{header:this.monthNames[this.startMonth]+this.year,key:"D",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth]+this.year,key:"E",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+1]+this.year,key:"F",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+1]+this.year,key:"G",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+2]+this.year,key:"H",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+2]+this.year,key:"I",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+3]+this.year,key:"J",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+3]+this.year,key:"K",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+4]+this.year,key:"L",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+4]+this.year,key:"M",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+5]+this.year,key:"N",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+5]+this.year,key:"O",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+6]+this.year,key:"P",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+6]+this.year,key:"Q",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+7]+this.year,key:"R",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+7]+this.year,key:"S",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+8]+this.year,key:"T",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+8]+this.year,key:"U",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+9]+this.year,key:"V",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+9]+this.year,key:"W",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+10]+this.year,key:"X",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+10]+this.year,key:"Y",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+11]+this.year,key:"Z",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+11]+this.year,key:"AA",width:25,style:{alignment:{wrapText:!0}}}],e=["D1:E1","F1:G1","H1:I1","J1:K1","L1:M1","N1:O1","P1:Q1","R1:S1","T1:U1","V1:W1","X1:Y1","Z1:AA1"];let i=[];i.push(this.getHeaderStyle("A")),i.push(this.getHeaderStyle("B")),i.push(this.getHeaderStyle("C")),i.push(this.getHeaderStyle("D")),i.push(this.getHeaderStyle("F")),i.push(this.getHeaderStyle("H")),i.push(this.getHeaderStyle("J")),i.push(this.getHeaderStyle("L")),i.push(this.getHeaderStyle("N")),i.push(this.getHeaderStyle("P")),i.push(this.getHeaderStyle("R")),i.push(this.getHeaderStyle("T")),i.push(this.getHeaderStyle("V")),i.push(this.getHeaderStyle("X")),i.push(this.getHeaderStyle("Z"));const n=[];let o=1;this.resourcesLoad.forEach(t=>{const e=[];o++,e.push(t.userIdentifier.split(" ")[0]),e.push(t.userIdentifier.replace(t.userIdentifier.split(" ")[0]+" ","")),e.push(this.getResourceLoadType(t.type)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[0].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[0].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,0),"D","E",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[1].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[1].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,1),"F","G",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[2].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[2].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,2),"H","I",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[3].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[3].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,3),"J","K",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[4].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[4].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,4),"L","M",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[5].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[5].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,5),"N","O",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[6].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[6].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,6),"P","Q",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[7].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[7].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,7),"R","S",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[8].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[8].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,8),"T","U",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[9].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[9].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,9),"V","W",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[10].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[10].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,10),"X","Y",o)),e.push(this.getRessourceLoadMonthLoad(t.monthLoads[11].load)),e.push(this.getRessourceLoadMonthLoadDetails(t.monthLoads[11].load)),i=i.concat(this.getRessourceLoadMonthLoadCellsStyle(this.getRessourceLoadMonthLoadCellColor(t,11),"Z","AA",o)),n.push(e)}),this.excelService.generateExcel(t,n,e,i,"WorkloadPlan")}}getHeaderStyle(t){return{cell:t+"1",font:{color:{argb:"FFFFFF"},bold:!0},alignment:{vertical:"middle",horizontal:"center"},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"3F629D"}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}}getResourceLoadType(t){switch(t){case d.L2.Budgeted:return"I";case d.L2.Planned:return"P";case d.L2.Real:return"R"}}getRessourceLoadMonthLoad(t){const e=String.fromCharCode(13)+String.fromCharCode(10);let i="";return null!=t.total&&(i=t.type===d.L2.Planned&&0===t.total&&1===t.projects.length&&0===t.projects[0].projectId?t.projects[0].total.toString():t.total.toString()+e),i}getRessourceLoadMonthLoadDetails(t){const e=String.fromCharCode(13)+String.fromCharCode(10);let i="";return null!=t.total&&(t.type===d.L2.Planned&&0===t.total&&1===t.projects.length&&0===t.projects[0].projectId?i=t.projects[0].projectName+":"+t.projects[0].total:t.projects.forEach(t=>{0!==t.projectId&&(i=i+t.projectName+":"+t.total+e)})),i}getRessourceLoadMonthLoadCellsStyle(t,e,i,n){const o=[];return o.push({cell:e+n,fill:{type:"pattern",pattern:"solid",fgColor:{argb:t}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),o.push({cell:i+n,fill:{type:"pattern",pattern:"solid",fgColor:{argb:t}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),o}getRessourceLoadMonthLoadCellColor(t,e){if(this.resignedOrNewResource(t,e))return"808080";{const i=t.monthLoads[e].load.total;if(i>15)return"063A9B";if(i>=5)return"00BEFF";if(i>0)return"FFA500";{const i=t.monthLoads[e].load;return i.type===d.L2.Planned&&0===i.total&&1===i.projects.length&&0===i.projects[0].projectId?this.plannedWorkloadCellColor(i.projects[0].probability):"FF6347"}}}resignedOrNewResource(t,e){const i=new Date(t.monthLoads[e].year,t.monthLoads[e].month,1),n=new Date(t.monthLoads[e].year,t.monthLoads[e].month+1,0);return new Date(t.monthLoads[e].year,12,0)>t.entryDate&&(void 0!==t.exitDate&&(i>t.exitDate||n<t.entryDate)||void 0===t.exitDate&&n<t.entryDate)}plannedWorkloadCellColor(t){switch(t){case 0:return"FF0000";case 1:return"FFDEAD";case 2:return"98FB98";default:return"FF6347"}}prepareResourcesLoads(t){t.forEach(t=>{if(!this.interContract||this.interContract&&this.dateTimeService.isNullDate(t.exitDate)){const e=this.resourcesLoad.findIndex(e=>e.userId===t.userId&&e.type===t.loadType);-1!==e?this.resourcesLoad[e]=this.prepareResourceLoad(this.resourcesLoad[e],t):this.selectedLoadTypesIdentifiers.forEach(e=>{let i=this.createNewResourceLoad(this.startMonth,this.year,this.monthsCount);i.userId=t.userId,i.userIdentifier=t.userIdentifier,i.entryDate=new Date(t.entryDate),this.dateTimeService.isNullDate(t.exitDate)||(i.exitDate=new Date(t.exitDate)),i.type=e,i.type===t.loadType&&(i=this.prepareResourceLoad(i,t)),this.resourcesLoad.push(i)})}})}createNewResourceLoad(t,e,i){const n=new d.$4(i);for(let o=0;o<i;o++)t+o<12?(n.monthLoads[o].month=t+o,n.monthLoads[o].year=e):(n.monthLoads[o].month=t+o-12,n.monthLoads[o].year=e+1);return n}prepareResourceLoad(t,e){if(null!==e.month){const i=t.monthLoads.findIndex(t=>t.month===e.month-1&&t.year===e.year);t.monthLoads[i]=this.prepareMonthLoad(t.monthLoads[i],e)}return t}prepareMonthLoad(t,e){return t.load=this.prepareLoad(t.load,e),t}prepareLoad(t,e){if(null===e.projectId)t.type=e.loadType,t.total=e.monthLoad;else{let i=-1;if(i=t.projects.findIndex(t=>t.projectId===e.projectId&&t.projectName===e.projectAbreviation),0===e.projectId&&void 0===t.total&&(t.type=e.loadType,t.total=0),-1!==i)t.projects[i]=this.prepareProjectLoad(t.projects[i],e);else{const i=new d.e9;i.projectId=e.projectId,i.projectName=e.projectAbreviation,t.projects.push(this.prepareProjectLoad(i,e))}}return t}prepareProjectLoad(t,e){if(null===e.taskId)t.total=e.monthLoad,0===t.projectId&&(t.probability=e.probability);else{const i=t.tasks.findIndex(t=>t.taskId===e.taskId);if(-1!==i)t.tasks[i]=this.prepareTaskLoad(t.tasks[i],e);else{const i=new d.of;i.taskId=e.taskId,i.taskName=e.taskName,t.tasks.push(this.prepareTaskLoad(i,e))}}return t}prepareTaskLoad(t,e){return t.total=e.monthLoad,t}concatLoadType(){this.selectedLoadTypesIdentifiers=[],this.budgeted&&this.selectedLoadTypesIdentifiers.push(d.L2.Budgeted),this.planned&&this.selectedLoadTypesIdentifiers.push(d.L2.Planned),this.real&&this.selectedLoadTypesIdentifiers.push(d.L2.Real)}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(h.Qk),c.\u0275\u0275directiveInject(m.Y4),c.\u0275\u0275directiveInject(p.YY),c.\u0275\u0275directiveInject(p.Cv),c.\u0275\u0275directiveInject(p.xB),c.\u0275\u0275directiveInject(p.nJ),c.\u0275\u0275directiveInject(p.gq))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-load-plan"]],decls:144,vars:50,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-2","col-lg-12"],[1,"mat-subheader","col-sm-3"],[1,"col-sm-9"],[3,"enabled","yearChange"],[1,"check-box-list"],[3,"ngModel","disabled","ngModelChange"],[3,"ngModel","ngModelChange"],["value","0"],["value","1"],["value","2"],[1,"col-xl-6","col-lg-12"],[1,"col-sm-6"],[1,"mat-subheader","col-sm-2"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"settings","data","ngModel","placeholder","ngModelChange"],[1,"col-sm-12"],[1,"mat-subheader","col-sm-1"],[1,"col-sm-11"],[1,"multi-search",2,"width","100%",3,"settings","data","ngModel","placeholder","ngModelChange"],[1,"text","m-b-10",3,"ngModel","ngModelChange","change"],[1,"text","m-b-5"],[1,"input-info-load","m-b-5"],["type","text","min","1","max","12","appNumberValidator","","matInput","","name","searchInput","maxlength","2",3,"disabled","ngModel","ngModelChange"],["appNumberValidator","","type","text","min","1","max","20","matInput","","name","searchInput",3,"disabled","ngModel","ngModelChange"],["aria-label","Select an option",1,"text","margin-left","m-b-5",3,"disabled","ngModel","ngModelChange"],["value","1",3,"change"],["value","2",3,"change"],[1,"col-xl-3","col-lg-12"],[1,"text","m-b-10",3,"ngModel","ngModelChange"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"disabled","click"],[1,"btn","btn-md","btn-default","ripple","light","m-t-10",3,"disabled","click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"col-sm-3"],["type","button",1,"export","btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"hidden","click"],[3,"pageSize","pageIndex","length"],[1,"col-sm-12","legend","m-b-10"],[1,"table-width"],[2,"padding","0px"],["scope","col"],[1,"box","load-less-5"],[1,"box","load-between-5-15"],[1,"box","load-over-15"],[1,"box","weak-probability"],[1,"box","average-probability"],[1,"box","strong-probability"],[1,"box","resigned-new"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],[1,"loaded-content",3,"hidden"],[3,"resourcesLoadBudgeted","resourcesLoadPlanned","budgetedNumber","plannedNumber"],["class","loaded-content",3,"blurred","hidden",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[3,"resourcesLoad","loadTypes","year"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Year"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-input-year",8),c.\u0275\u0275listener("yearChange",function(t){return e.yearChanged(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"mat-list-item"),c.\u0275\u0275elementStart(14,"div",9),c.\u0275\u0275elementStart(15,"mat-checkbox",10),c.\u0275\u0275listener("ngModelChange",function(t){return e.budgeted=t}),c.\u0275\u0275text(16,"Invoiced"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(17,"mat-checkbox",10),c.\u0275\u0275listener("ngModelChange",function(t){return e.planned=t}),c.\u0275\u0275text(18,"Planned"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(19,"mat-checkbox",10),c.\u0275\u0275listener("ngModelChange",function(t){return e.real=t}),c.\u0275\u0275text(20,"Real"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(21,"mat-list-item"),c.\u0275\u0275elementStart(22,"mat-radio-group",11),c.\u0275\u0275listener("ngModelChange",function(t){return e.detailLevel=t}),c.\u0275\u0275elementStart(23,"mat-radio-button",12),c.\u0275\u0275text(24,"Loads"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(25,"mat-radio-button",13),c.\u0275\u0275text(26,"Projects"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(27,"mat-radio-button",14),c.\u0275\u0275text(28,"Details"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(29,"div",15),c.\u0275\u0275elementStart(30,"mat-list"),c.\u0275\u0275elementStart(31,"mat-list-item"),c.\u0275\u0275elementStart(32,"div",16),c.\u0275\u0275elementStart(33,"div",1),c.\u0275\u0275elementStart(34,"h3",17),c.\u0275\u0275text(35,"Resource"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(36,"div",18),c.\u0275\u0275elementStart(37,"ng-multiselect-dropdown",19),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedResourcesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(38,"div",16),c.\u0275\u0275elementStart(39,"div",1),c.\u0275\u0275elementStart(40,"h3",17),c.\u0275\u0275text(41,"Depart."),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(42,"div",18),c.\u0275\u0275elementStart(43,"ng-multiselect-dropdown",19),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedDepartmentsIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(44,"mat-list-item"),c.\u0275\u0275elementStart(45,"div",20),c.\u0275\u0275elementStart(46,"div",1),c.\u0275\u0275elementStart(47,"h3",21),c.\u0275\u0275text(48,"Project"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(49,"div",22),c.\u0275\u0275elementStart(50,"ng-multiselect-dropdown",23),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedProjectsIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(51,"mat-list-item"),c.\u0275\u0275elementStart(52,"mat-checkbox",24),c.\u0275\u0275listener("ngModelChange",function(t){return e.interContract=t})("change",function(t){return e.interContractChecked(t)}),c.\u0275\u0275text(53," Inter-Contract"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(54,"div",25),c.\u0275\u0275text(55,"For the"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(56,"mat-form-field",26),c.\u0275\u0275elementStart(57,"input",27),c.\u0275\u0275listener("ngModelChange",function(t){return e.monthsCountInterContract=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(58,"div",25),c.\u0275\u0275text(59,"next month(s) with a load less than"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(60,"mat-form-field",26),c.\u0275\u0275elementStart(61,"input",28),c.\u0275\u0275listener("ngModelChange",function(t){return e.loadValue=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(62,"div",25),c.\u0275\u0275text(63,"MD"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(64,"mat-radio-group",29),c.\u0275\u0275listener("ngModelChange",function(t){return e.interContractTypes=t}),c.\u0275\u0275elementStart(65,"mat-radio-button",30),c.\u0275\u0275listener("change",function(t){return e.bugdetedChecked(t)}),c.\u0275\u0275text(66,"Invoiced "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(67,"mat-radio-button",31),c.\u0275\u0275listener("change",function(t){return e.bugdetedChecked(t)}),c.\u0275\u0275text(68,"Planned "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(69,"div",32),c.\u0275\u0275elementStart(70,"mat-list"),c.\u0275\u0275elementStart(71,"mat-list-item"),c.\u0275\u0275elementStart(72,"div",20),c.\u0275\u0275elementStart(73,"div",1),c.\u0275\u0275elementStart(74,"h3",17),c.\u0275\u0275text(75,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(76,"div",18),c.\u0275\u0275elementStart(77,"ng-multiselect-dropdown",19),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(78,"mat-list-item"),c.\u0275\u0275elementStart(79,"div",20),c.\u0275\u0275elementStart(80,"div",1),c.\u0275\u0275elementStart(81,"h3",17),c.\u0275\u0275text(82,"Customer"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(83,"div",18),c.\u0275\u0275elementStart(84,"ng-multiselect-dropdown",19),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedCustomersIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(85,"mat-list-item"),c.\u0275\u0275elementStart(86,"mat-checkbox",33),c.\u0275\u0275listener("ngModelChange",function(t){return e.includeInterns=t}),c.\u0275\u0275text(87,"Include Interns"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(88,"div",34),c.\u0275\u0275elementStart(89,"div",35),c.\u0275\u0275elementStart(90,"button",36),c.\u0275\u0275listener("click",function(){return e.search()}),c.\u0275\u0275text(91,"Search"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(92,"div",35),c.\u0275\u0275elementStart(93,"button",37),c.\u0275\u0275listener("click",function(){return e.onResetAllFilters()}),c.\u0275\u0275text(94,"Reset"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(95,"nav",38),c.\u0275\u0275elementStart(96,"div",39),c.\u0275\u0275elementStart(97,"button",40),c.\u0275\u0275listener("click",function(){return e.exportToExcel()}),c.\u0275\u0275element(98,"em",41),c.\u0275\u0275text(99," Export "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(100,"button",42),c.\u0275\u0275listener("click",function(){return e.changeBtnName()}),c.\u0275\u0275text(101),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(102,"div",7),c.\u0275\u0275element(103,"app-paginator",43),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(104,"div",44),c.\u0275\u0275elementStart(105,"table",45),c.\u0275\u0275element(106,"caption",46),c.\u0275\u0275elementStart(107,"tbody"),c.\u0275\u0275elementStart(108,"tr"),c.\u0275\u0275element(109,"th",47),c.\u0275\u0275elementStart(110,"td"),c.\u0275\u0275element(111,"div",48),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(112,"td"),c.\u0275\u0275text(113," Load < 5 MD "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(114,"td"),c.\u0275\u0275element(115,"div",49),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(116,"td"),c.\u0275\u0275text(117," Load between 5 and 15 MD "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(118,"td"),c.\u0275\u0275element(119,"div",50),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(120,"td"),c.\u0275\u0275text(121," Load > 15 MD "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(122,"td"),c.\u0275\u0275element(123,"div",51),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(124,"td"),c.\u0275\u0275text(125," Weak Probability "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(126,"td"),c.\u0275\u0275element(127,"div",52),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(128,"td"),c.\u0275\u0275text(129," Average Probability "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(130,"td"),c.\u0275\u0275element(131,"div",53),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(132,"td"),c.\u0275\u0275text(133," Strong Probability "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(134,"td"),c.\u0275\u0275element(135,"div",54),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(136,"td"),c.\u0275\u0275text(137," Resigned or New Recruit "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(138,"div",55),c.\u0275\u0275elementStart(139,"div",56),c.\u0275\u0275template(140,X,6,0,"div",57),c.\u0275\u0275elementStart(141,"div",58),c.\u0275\u0275element(142,"app-resources-inter-contract",59),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(143,tt,3,10,"div",60),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("enabled",!e.interContract),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngModel",e.budgeted)("disabled",e.interContract),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngModel",e.planned)("disabled",e.interContract),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngModel",e.real)("disabled",e.interContract),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngModel",e.detailLevel),c.\u0275\u0275advance(15),c.\u0275\u0275property("settings",e.dropdownSettings)("data",e.resourcesIdentifiers)("ngModel",e.selectedResourcesIdentifiers)("placeholder","Select..."),c.\u0275\u0275advance(6),c.\u0275\u0275property("settings",e.dropdownSettings)("data",e.departmentsIdentifiers)("ngModel",e.selectedDepartmentsIdentifiers)("placeholder","Select..."),c.\u0275\u0275advance(7),c.\u0275\u0275property("settings",e.dropdownSettings)("data",e.projectsIdentifiers)("ngModel",e.selectedProjectsIdentifiers)("placeholder","Select..."),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngModel",e.interContract),c.\u0275\u0275advance(5),c.\u0275\u0275property("disabled",!e.interContract)("ngModel",e.monthsCountInterContract),c.\u0275\u0275advance(4),c.\u0275\u0275property("disabled",!e.interContract)("ngModel",e.loadValue),c.\u0275\u0275advance(3),c.\u0275\u0275property("disabled",!e.interContract)("ngModel",e.interContractTypes),c.\u0275\u0275advance(13),c.\u0275\u0275property("settings",e.dropdownSettings)("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("placeholder","Select..."),c.\u0275\u0275advance(7),c.\u0275\u0275property("settings",e.dropdownSettings)("data",e.customersIdentifiers)("ngModel",e.selectedCustomersIdentifiers)("placeholder","Select..."),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngModel",e.includeInterns),c.\u0275\u0275advance(4),c.\u0275\u0275property("disabled",e.isLoading),c.\u0275\u0275advance(3),c.\u0275\u0275property("disabled",e.isLoading),c.\u0275\u0275advance(7),c.\u0275\u0275property("hidden",e.showBtn),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",e.displayinterContract," "),c.\u0275\u0275advance(2),c.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.lengthResourcesLoad),c.\u0275\u0275advance(37),c.\u0275\u0275property("ngIf",e.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("hidden",e.hideInterContractGrid),c.\u0275\u0275advance(1),c.\u0275\u0275property("resourcesLoadBudgeted",e.resoucesInterContractBudgeted)("resourcesLoadPlanned",e.resoucesInterContractPlanned)("budgetedNumber",e.budgetedRowsNumber)("plannedNumber",e.plannedRowsNumber),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView))},directives:[u.i$,u.Tg,f.G,g.oG,y.NgControlStatus,y.NgModel,v.VQ,v.U0,r.OP,b.KE,S.Nt,y.DefaultValueAccessor,x.z,y.MaxLengthValidator,C.M2,I.J,n.NgIf,A,j.$g,K],pipes:[Z.R],styles:[".multiselect-dropdown .dropdown-list .item1 .filter-textbox{font-size:12px}.multiselect-dropdown .dropdown-btn{font-size:14px}.multiselect-dropdown .selected-item{font-size:10px;background:#448aff}.multiselect-dropdown .multiselect-item-checkbox{font-size:12px}.mat-list .mat-divider{margin-top:15px}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.text{margin-top:15px;height:40px;padding:0 5px;font-size:13px;font-weight:normal!important;color:#0000008a}.input-info-load{width:4%;font-size:15px;text-align:center!important}.mat-radio-button{padding-right:4px}.mat-radio-group{font-size:12px!important;color:#0000008a!important}.mat-radio-label-content{font-size:13px!important;font-weight:bold!important}.check-box-list{font-size:14px!important;margin-bottom:6px;color:#0000008a!important;padding-left:0!important}.mat-checkbox-layout{margin-bottom:0;padding:2px}.mat-checkbox-layout .mat-checkbox-label{font-size:13px!important;font-weight:bold!important;color:#0000008a}.mat-list-base .mat-list-item .mat-list-item-content{padding-left:0!important;padding-right:0!important}.margin-left{margin-left:20px}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 465px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}.legend{font-size:12px;font-weight:normal;color:#0000008a}.box{width:40px;height:20px;border:1px solid white}.load-less-5{background-color:orange}.load-between-5-15{background-color:#00beff}.load-over-15{background-color:#00f}.weak-probability{background-color:red}.average-probability{background-color:#ffdead}.strong-probability{background-color:#98fb98}.resigned-new{background-color:gray}\n"],encapsulation:2}),t})();var it=i(22238),nt=i(70833),ot=i(55750),rt=i(60428);let at=(()=>{class t{constructor(t){this.dialogRef=t}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.so))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-activity-legend"]],decls:36,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"form",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"span"),c.\u0275\u0275text(4," Profitability Activity Legend "),c.\u0275\u0275elementStart(5,"em",3),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(6,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"div",4),c.\u0275\u0275elementStart(8,"div"),c.\u0275\u0275elementStart(9,"span",5),c.\u0275\u0275text(10,"Spent (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(11,"La charge d\xe9pens\xe9e (HJ) = la charge d\xe9pens\xe9e des projets de l'activit\xe9."),c.\u0275\u0275element(12,"br"),c.\u0275\u0275elementStart(13,"span",5),c.\u0275\u0275text(14,"Invoiced (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = la charge factur\xe9e des projets de l'activit\xe9."),c.\u0275\u0275element(16,"br"),c.\u0275\u0275elementStart(17,"span",5),c.\u0275\u0275text(18,"Spent Amount (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(19,"Montant d\xe9pens\xe9 (\u20ac) = la somme du co\xfbt (co\xfbt interne de la ressource * 20 jours) de chaque ressource appartenant \xe0 l'activit\xe9."),c.\u0275\u0275element(20,"br"),c.\u0275\u0275elementStart(21,"span",5),c.\u0275\u0275text(22,"Achieved Cost (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(23,"Montant factur\xe9 (\u20ac) = la somme du prix (prix de la ressource * nbr de jours factur\xe9) pour les membres de chaque projet."),c.\u0275\u0275element(24,"br"),c.\u0275\u0275elementStart(25,"span",5),c.\u0275\u0275text(26,"Invoiced Cost (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(27,"Montant factur\xe9 (\u20ac) = le co\xfbt r\xe9el de la facturation (Il est r\xe9cup\xe9r\xe9 de la facture)."),c.\u0275\u0275element(28,"br"),c.\u0275\u0275elementStart(29,"span",5),c.\u0275\u0275text(30,"Productivity (%): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(31,"Rentabilit\xe9 (%) = (Invoiced Cost (\u20ac) / Spent Amount (\u20ac)) * 100. "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(32,"div",6),c.\u0275\u0275elementStart(33,"div",7),c.\u0275\u0275elementStart(34,"button",8),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(35,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())},directives:[y.\u0275NgNoValidate,y.NgControlStatusGroup,y.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:190px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t})();var st=i(16738),lt=i(60040),dt=i(11494),ct=i(62758);function ht(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Resource"),c.\u0275\u0275elementEnd())}function mt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",t.userIdentifier," ")}}function pt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Company Entry"),c.\u0275\u0275elementEnd())}function ut(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"shortDate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",c.\u0275\u0275pipeBind1(3,2,t.entryDate)," ")}}function ft(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Company Exit"),c.\u0275\u0275elementEnd())}function gt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"shortDate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",c.\u0275\u0275pipeBind1(3,2,t.exitDate)," ")}}function yt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Activity Start"),c.\u0275\u0275elementEnd())}function vt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"shortDate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",c.\u0275\u0275pipeBind1(3,2,t.startDate)," ")}}function bt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Activity End"),c.\u0275\u0275elementEnd())}function St(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275pipe(3,"shortDate"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",c.\u0275\u0275pipeBind1(3,2,t.endDate)," ")}}function xt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-header-cell",15),c.\u0275\u0275text(1,"Spent Amount \u20ac"),c.\u0275\u0275elementEnd())}function Ct(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",16),c.\u0275\u0275elementStart(1,"span"),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(t)),c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1("",t.spentMonthAmount," ")}}function It(t,e){1&t&&c.\u0275\u0275element(0,"mat-header-row",17)}function Pt(t,e){1&t&&c.\u0275\u0275element(0,"mat-row")}function Et(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"mat-cell",18),c.\u0275\u0275elementStart(1,"strong",19),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate(t.activityName)}}function Mt(t,e){1&t&&c.\u0275\u0275element(0,"mat-row")}const At=function(){return["groupHeader"]};let jt=(()=>{class t{constructor(t,e,i,n,o){this.profitabilityActivityService=t,this.sortService=e,this.groupsService=i,this.dialog=n,this.data=o,this.displayedColumns=["userIdentifier","entryDate","exitDate","startDate","endDate","spentMonthAmount"],this.groupByColumns=["activityName"],this.dataSource=new w.by}ngOnInit(){this.dataSource=new w.by(this.groupsService.addGroups(this.data,this.groupByColumns)),this.subscription=this.profitabilityActivityService.sortSpentAmount.subscribe(()=>{this.dataSource=new w.by(this.groupsService.addGroups(this.data,this.groupByColumns))})}ngOnDestroy(){this.subscription.unsubscribe()}isGroup(t,e){return e.level}isUserQuitWithEmptyExitDate(t){if(1===t.userQuit&&"0001-01-01T00:00:00"===t.exitDate)return"red"}onSortData(t){t.active&&""!==t.direction&&void 0!==this.data&&(this.data.sort((e,i)=>{const n="asc"===t.direction;switch(t.active){case"userIdentifier":return this.sortService.compare(e.userIdentifier,i.userIdentifier,n,!1);case"entryDate":return this.sortService.compare(e.entryDate,i.entryDate,n,!1);case"exitDate":return this.sortService.compare(e.exitDate,i.exitDate,n,!1);case"startDate":return this.sortService.compare(e.startDate,i.startDate,n,!1);case"endDate":return this.sortService.compare(e.endDate,i.endDate,n,!1);case"spentMonthAmount":return this.sortService.compare(e.spentMonthAmount,i.spentMonthAmount,n,!0);default:return 0}}),this.profitabilityActivityService.sortSpentAmount.next())}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(h.VK),c.\u0275\u0275directiveInject(p.Kx),c.\u0275\u0275directiveInject(p.Jc),c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(it.WI))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-spent-amount"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},decls:25,vars:7,consts:[["matSort","","matSortDirection","asc","matSortDisableClear","",3,"dataSource","matSortChange"],["table",""],["matColumnDef","userIdentifier"],["mat-sort-header","",4,"matHeaderCellDef"],[3,"ngClass",4,"matCellDef"],["matColumnDef","entryDate"],["matColumnDef","exitDate"],["matColumnDef","startDate"],["matColumnDef","endDate"],["matColumnDef","spentMonthAmount"],["class"," table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["matColumnDef","groupHeader"],["colspan","999",4,"matCellDef"],[4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-sort-header",""],[3,"ngClass"],[1,"table-primary","table-*"],["colspan","999"],[1,"strong"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"mat-table",0,1),c.\u0275\u0275listener("matSortChange",function(t){return e.onSortData(t)}),c.\u0275\u0275elementContainerStart(2,2),c.\u0275\u0275template(3,ht,2,0,"mat-header-cell",3),c.\u0275\u0275template(4,mt,3,2,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(5,5),c.\u0275\u0275template(6,pt,2,0,"mat-header-cell",3),c.\u0275\u0275template(7,ut,4,4,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(8,6),c.\u0275\u0275template(9,ft,2,0,"mat-header-cell",3),c.\u0275\u0275template(10,gt,4,4,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(11,7),c.\u0275\u0275template(12,yt,2,0,"mat-header-cell",3),c.\u0275\u0275template(13,vt,4,4,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(14,8),c.\u0275\u0275template(15,bt,2,0,"mat-header-cell",3),c.\u0275\u0275template(16,St,4,4,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275elementContainerStart(17,9),c.\u0275\u0275template(18,xt,2,0,"mat-header-cell",3),c.\u0275\u0275template(19,Ct,3,2,"mat-cell",4),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275template(20,It,1,0,"mat-header-row",10),c.\u0275\u0275template(21,Pt,1,0,"mat-row",11),c.\u0275\u0275elementContainerStart(22,12),c.\u0275\u0275template(23,Et,3,1,"mat-cell",13),c.\u0275\u0275elementContainerEnd(),c.\u0275\u0275template(24,Mt,1,0,"mat-row",14),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275property("dataSource",e.dataSource),c.\u0275\u0275advance(20),c.\u0275\u0275property("matHeaderRowDef",e.displayedColumns)("matHeaderRowDefSticky",!0),c.\u0275\u0275advance(1),c.\u0275\u0275property("matRowDefColumns",e.displayedColumns),c.\u0275\u0275advance(3),c.\u0275\u0275property("matRowDefColumns",c.\u0275\u0275pureFunction0(6,At))("matRowDefWhen",e.isGroup))},directives:[w.BZ,dt.YE,w.w1,w.fO,w.Dz,w.as,w.nj,w.ge,dt.nU,w.ev,n.NgClass,w.XQ,w.Gk],pipes:[ct.M],styles:[".mat-table[_ngcontent-%COMP%]{overflow:auto;border-radius:4px;max-height:calc(100vh - 392px)}table[_ngcontent-%COMP%]{width:100%}.strong[_ngcontent-%COMP%]{background:-webkit-linear-gradient(#5a5a5a,black);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}"]}),t})();function wt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",9),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(t)," ")}}function Dt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[t]," ")}}function Rt(t,e){if(1&t){const t=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"span",20),c.\u0275\u0275listener("click",function(){c.\u0275\u0275restoreView(t);const e=c.\u0275\u0275nextContext().index,i=c.\u0275\u0275nextContext(2).$implicit;return c.\u0275\u0275nextContext().activitySpentDetailDisplay(e,i)}),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()}if(2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValue(t,e)," ")}}function kt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"span"),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValue(t,e)," ")}}function Lt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",18),c.\u0275\u0275template(1,Rt,2,1,"span",19),c.\u0275\u0275template(2,kt,2,1,"span",13),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=e.index,n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",o.isActivityMonthSpentAmount(t,i,n)),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",!o.isActivityMonthSpentAmount(t,i,n))}}function Nt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",14),c.\u0275\u0275elementStart(1,"td",15),c.\u0275\u0275elementStart(2,"span",16),c.\u0275\u0275text(3),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,Lt,3,2,"td",17),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",t.activityName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function Ft(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function Ot(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"label",28),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(3).$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.companyName,"")}}function Tt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"label",29),c.\u0275\u0275text(1," Empty"),c.\u0275\u0275elementEnd())}function _t(t,e){if(1&t&&(c.\u0275\u0275template(0,Ot,2,1,"label",26),c.\u0275\u0275template(1,Tt,2,0,"label",27),c.\u0275\u0275text(2)),2&t){const t=c.\u0275\u0275nextContext(2).$implicit;c.\u0275\u0275property("ngIf",t.companyName),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",!t.companyName),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," ")}}function Wt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function zt(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValue(t,e),"")}}function Ht(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",30),c.\u0275\u0275template(1,Wt,2,0,"div",23),c.\u0275\u0275template(2,zt,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275propertyInterpolate1("matTooltip"," ",o.getTotalSubColumnValue(t,n),""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(t,n))("ngIfElse",i)}}function Vt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",21),c.\u0275\u0275elementStart(1,"td",22),c.\u0275\u0275template(2,Ft,2,0,"div",23),c.\u0275\u0275template(3,_t,3,3,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(5,Ht,4,3,"td",25),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275reference(4),e=c.\u0275\u0275nextContext().$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",e.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==i.getTotalSubColumnValue(i.i,e))("ngIfElse",t),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function Gt(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function Bt(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate(i.getSubColumnValue(t,e))}}function Jt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",18),c.\u0275\u0275template(1,Gt,2,0,"div",23),c.\u0275\u0275template(2,Bt,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getSubColumnValue(t,n))("ngIfElse",i)}}function $t(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",31),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,Jt,4,2,"td",17),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1(" ",t.userIdentifier," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function Yt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tbody"),c.\u0275\u0275template(1,Nt,5,2,"tr",11),c.\u0275\u0275template(2,Vt,6,4,"tr",12),c.\u0275\u0275template(3,$t,4,2,"tr",13),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",1==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",2==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level)}}let Ut=(()=>{class t{constructor(t,e,i,n,o){this.dialog=t,this.profitabilityActivityService=e,this.profitabilityActivityGroupService=i,this.dateTimeService=n,this.numberFormatter=o,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent MD","Invoiced MD","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityActivitiesGrouped=[],this.activitySpentAmountDisplaying=!1}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}ngOnChanges(){(null!==this.profitabilityActivities||void 0!==this.profitabilityActivities)&&(this.profitabilityActivitiesGrouped=this.profitabilityActivityGroupService.getProfitabilityActivitiesGrouped(this.profitabilityActivities,this.profitabilityActivitiesFiltred,this.profitabilityActivitiesProjects,this.profitabilityActivitiesTotal,this.monthsCount))}buildColmnsHeader(){if((null!==this.profitabilityActivities||void 0!==this.profitabilityActivities)&&this.profitabilityActivities.length>0){const t=this.profitabilityActivities[0].monthsProfitabilityActivity.length;for(let e=0;e<t;e++){this.displayedColumns.push("M"+e);const t=this.profitabilityActivities[0].monthsProfitabilityActivity[this.getMonthIndex(e)].month-1,i=this.profitabilityActivities[0].monthsProfitabilityActivity[this.getMonthIndex(e)].year;isNaN(t)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[t]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}}getMonthIndex(t){return Math.floor(t)}getMonthDetailsIndex(t){return Math.floor(t/this.displayedSubColumnsNamesCount)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityActivity[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityActivity[n].spentMonthLoad,1);case 1:return this.format(e.monthsProfitabilityActivity[n].invoicedMonthLoad);case 2:return this.format(e.monthsProfitabilityActivity[n].spentMonthAmount);case 3:return this.format(e.monthsProfitabilityActivity[n].achivedMonthCost);case 4:case 5:case 6:case 7:return-1}}getTotalSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityActivity[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityActivity[n].spentMonthLoad,1);case 1:return this.numberFormatter.round(e.monthsProfitabilityActivity[n].invoicedMonthLoad,1);case 2:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].spentMonthAmount,1));case 3:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].achivedMonthCost,1));case 4:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].invoicedMonthCost,1));case 5:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].spentMonthMission,1));case 6:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].invoicedMonthMission,1));case 7:return e.monthsProfitabilityActivity[n].saariRef}}activitySpentDetailDisplay(t,e){if(!this.activitySpentAmountDisplaying){this.activitySpentAmountDisplaying=!0;const i=e.activityId.toString(),n=Math.floor(t/this.displayedSubColumnsNamesCount),o=e.monthsProfitabilityActivity[n].month,r=e.monthsProfitabilityActivity[n].year;if(void 0!==o&&void 0!==r){const t=new Date(o+"/01/"+r),e=st(t).endOf("month").toDate();this.profitabilityActivityService.getProfitabilityActivitySpentDetail(i,t,e).subscribe(t=>{const e={disableClose:!1,hasBackdrop:!0,width:"1000px",data:t};this.activitySpentAmountDisplaying=!1,this.displayEditdialogRef=this.dialog.open(jt,e)})}}}isActivityMonthSpentAmount(t,e,i){const n=Math.floor(e/this.displayedSubColumnsNamesCount);return t===this.displayedSubColumnsNames[2]&&n<i.monthsProfitabilityActivity.length-1}dateOnly(t){return this.dateTimeService.dateOnly(t)}datePipe(t){return"0001-01-01T00:00:00"===t?"":t}format(t){return 0===t?"":t}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(h.VK),c.\u0275\u0275directiveInject(h.zc),c.\u0275\u0275directiveInject(p.Cv),c.\u0275\u0275directiveInject(rt.e))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-activity"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},inputs:{profitabilityActivities:"profitabilityActivities",profitabilityActivitiesFiltred:"profitabilityActivitiesFiltred",profitabilityActivitiesProjects:"profitabilityActivitiesProjects",profitabilityActivitiesTotal:"profitabilityActivitiesTotal",monthsCount:"monthsCount"},features:[c.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],["class","activitySpentAmount",3,"click",4,"ngIf"],[1,"activitySpentAmount",3,"click"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],["style","text-align: center;",3,"matTooltip",4,"ngFor","ngForOf"],["style","background-color:#24901d;","class","label",4,"ngIf"],["style","background-color:rgb(235, 64, 64);","class","label",4,"ngIf"],[1,"label",2,"background-color","#24901d"],[1,"label",2,"background-color","rgb(235, 64, 64)"],[2,"text-align","center",3,"matTooltip"],[1,"td-third",2,"width","15%"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0),c.\u0275\u0275element(1,"caption",1),c.\u0275\u0275elementStart(2,"thead",2),c.\u0275\u0275elementStart(3,"tr",3),c.\u0275\u0275elementStart(4,"th",4),c.\u0275\u0275text(5,"Activity / Company-Project / Resource"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(6,wt,2,2,"th",5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"tr",6),c.\u0275\u0275template(8,Dt,2,1,"th",7),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(9,Yt,4,3,"tbody",8),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(6),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",e.displayedSubColumns),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.profitabilityActivitiesGrouped))},directives:[n.NgForOf,n.NgIf,D.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}.activitySpentAmount[_ngcontent-%COMP%]{cursor:pointer;-webkit-text-decoration-line:underline;text-decoration-line:underline}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t})();function Qt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",9),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(t)," ")}}function qt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[t]," ")}}function Kt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",15),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext().$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",n.getTotalSubColumnValue(t,i)," ")}}function Zt(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tbody"),c.\u0275\u0275elementStart(1,"tr",11),c.\u0275\u0275elementStart(2,"td",12),c.\u0275\u0275elementStart(3,"span",13),c.\u0275\u0275text(4),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(5,Kt,2,1,"td",14),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(4),c.\u0275\u0275textInterpolate1(" ",t.activityName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}let Xt=(()=>{class t{constructor(t,e){this.dialog=t,this.numberFormatter=e,this.displayedColumns=["activityName"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Count","Spent Amount \u20ac","Invoiced Cost \u20ac","Productivity %"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[]}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}buildColmnsHeader(){if((null!==this.profitabilityActivitiesGroup||void 0!==this.profitabilityActivitiesGroup)&&this.profitabilityActivitiesGroup.length>0){const t=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity.length;for(let e=0;e<t;e++){this.displayedColumns.push("M"+e);const t=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity[this.getMonthIndex(e)].month-1,i=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity[this.getMonthIndex(e)].year;isNaN(t)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[t]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}}getMonthIndex(t){return Math.floor(t)}getMonthDetailsIndex(t){return Math.floor(t/this.displayedSubColumnsNamesCount)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getTotalSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityActivity[n])switch(i){case 0:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].resourcesCount,2));case 1:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].spentMonthAmount,1));case 2:return this.format(this.numberFormatter.round(e.monthsProfitabilityActivity[n].invoicedMonthCost,1));case 3:return this.numberFormatter.round(e.monthsProfitabilityActivity[n].productivity,1)}}format(t){return 0===t?"":t}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(rt.e))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-productivity"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},inputs:{profitabilityActivitiesGroup:"profitabilityActivitiesGroup",monthsCount:"monthsCount"},decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0),c.\u0275\u0275element(1,"caption",1),c.\u0275\u0275elementStart(2,"thead",2),c.\u0275\u0275elementStart(3,"tr",3),c.\u0275\u0275elementStart(4,"th",4),c.\u0275\u0275text(5,"Activity Productivity Summary"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(6,Qt,2,2,"th",5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"tr",6),c.\u0275\u0275template(8,qt,2,1,"th",7),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(9,Zt,6,2,"tbody",8),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(6),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",e.displayedSubColumns),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.profitabilityActivitiesGroup))},directives:[n.NgForOf],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t})();function te(t,e){if(1&t&&c.\u0275\u0275element(0,"app-paginator",29),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.profitabilityActivitiesLength)}}function ee(t,e){if(1&t&&c.\u0275\u0275element(0,"app-paginator",29),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.profitabilityActivitiesGroupLength)}}function ie(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275elementStart(1,"h1"),c.\u0275\u0275text(2,"No Result Found"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function ne(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",30),c.\u0275\u0275elementStart(1,"div",31),c.\u0275\u0275elementStart(2,"div",32),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275elementStart(4,"div",33),c.\u0275\u0275element(5,"mat-spinner"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function oe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",34),c.\u0275\u0275element(1,"app-activity",35),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("profitabilityActivities",c.\u0275\u0275pipeBind3(2,7,t.profitabilityActivities,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("profitabilityActivitiesFiltred",t.profitabilityActivities)("profitabilityActivitiesProjects",t.profitabilityActivitiesProjects)("profitabilityActivitiesTotal",t.profitabilityActivitiesTotal)("monthsCount",t.monthsCount)}}function re(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",34),c.\u0275\u0275element(1,"app-productivity",36),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("profitabilityActivitiesGroup",c.\u0275\u0275pipeBind3(2,4,t.profitabilityActivitiesGroup,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("monthsCount",t.monthsCount)}}let ae=(()=>{class t{constructor(t){this.emptyResult=!1,this.profitabilityActivitiesGrouped=[],this.profitabilityActivitiesGroup=[],this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new p.nJ,this.paginatorPipe=new ot.Ry(this.searchFilterService),this.subscription=new nt.w0,this.hideBtnProductivity=!0,this.hideProductivity=!0,this.displayedProductivityLabel="Summary",this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent","Invoiced","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref","Productivity %"],this.dialog=t.get(it.uw),this.searchFilterService=t.get(p.nJ),this.excelService=t.get(p.xB),this.profitabilityActivityService=t.get(h.VK),this.profitabilityActivityGroupService=t.get(h.zc),this.projectService=t.get(m.Y4),this.dateTimeService=t.get(p.Cv),this.numberFormatter=t.get(rt.e),this.notificationService=t.get(p.gq)}ngOnInit(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===s.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=12,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.profitabilityActivityService.reloadProfitabilityActivity.subscribe(()=>{const t=JSON.parse(sessionStorage.getItem("profitabilityActivitySearch")),e=t.selectedActivitiesIdentifiers.map(t=>t.id).join(",");this.getProfitabilityActivity(e,t.profitabilityActivityStartDate,t.profitabilityActivityEndDate)})),this.profitabilityActivitiesLength=0,this.profitabilityActivitiesGroupLength=0,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}))}ngOnDestroy(){this.subscription.unsubscribe()}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t,this.setSearchFilter())})}setSearchFilter(){const t=JSON.parse(sessionStorage.getItem("profitabilityActivitySearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),null!=t.profitabilityActivityStartDate&&(this.profitabilityActivityStartDate=new Date(t.profitabilityActivityStartDate),this.minDate=this.profitabilityActivityStartDate),null!=t.profitabilityActivityEndDate&&(this.profitabilityActivityEndDate=new Date(t.profitabilityActivityEndDate),this.maxDate=this.profitabilityActivityEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId);const t=this.dateTimeService.today();this.profitabilityActivityStartDate=st([t.getFullYear(),t.getMonth()]).toDate(),this.profitabilityActivityEndDate=st(t).endOf("month").toDate(),this.minDate=this.profitabilityActivityStartDate,this.maxDate=this.profitabilityActivityEndDate}}searchProfitabilityActivity(){this.searchFilterService.pageIndex=0,this.profitabilityActivities=[],this.profitabilityActivitiesGroup=[],this.profitabilityActivitiesLength=0,this.profitabilityActivitiesGroupLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.emptyResult=!0,this.listView=!1;const t=new d.Zh;t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.profitabilityActivityStartDate=this.profitabilityActivityStartDate,t.profitabilityActivityEndDate=this.profitabilityActivityEndDate,sessionStorage.setItem("profitabilityActivitySearch",JSON.stringify(t)),this.computeStartMonthandYear(),this.getProfitabilityActivity(this.selectedActivitiesIds,this.profitabilityActivityStartDate,this.profitabilityActivityEndDate)}getProfitabilityActivity(t,e,i){this.isLoading=!0,this.profitabilityActivityService.getProfitabilityActivity(t,e,i).subscribe(n=>{null!=n&&this.profitabilityActivityService.getProfitabilityActivityProject(t,e,i).subscribe(o=>{this.profitabilityActivityService.getProfitabilityActivitySpentTotal(t,e,i).subscribe(t=>{if(this.isLoading=!1,this.profitabilityActivitiesProjects=o,this.profitabilityActivitiesTotal=t,this.prepareProfitabilityActivities(n),this.AddProjectsWithoutResourcesLoad(),this.profitabilityActivitiesLength=this.profitabilityActivities.length,this.emptyResult=!1,this.listView=!0,0===this.profitabilityActivities.length)this.emptyResult=!0,this.hideBtnProductivity=!0;else if(void 0!==this.profitabilityActivities){const t=this.profitabilityActivityGroupService.getProfitabilityActivitiesGrouped(this.profitabilityActivities,this.profitabilityActivities,this.profitabilityActivitiesProjects,this.profitabilityActivitiesTotal,this.monthsCount);this.profitabilityActivitiesGrouped=JSON.parse(JSON.stringify(t)),this.profitabilityActivitiesGroup=this.profitabilityActivitiesGrouped.filter(t=>1===t.level),this.profitabilityActivitiesGroupLength=this.profitabilityActivitiesGroup.length,this.emptyResult=!1,this.hideBtnProductivity=!1}},()=>{this.isLoading=!1,this.notificationService.danger("Profitability activity not loaded.")})},()=>{this.isLoading=!1,this.notificationService.danger("Profitability activity not loaded.")})},()=>{this.isLoading=!1,this.notificationService.danger("Profitability activity not loaded.")})}prepareProfitabilityActivities(t){t.forEach(t=>{const e=this.profitabilityActivities.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId&&e.userId===t.userId);if(-1!==e)this.profitabilityActivities[e]=this.prepareProfitabilityActivity(this.profitabilityActivities[e],t);else{const e=this.createProfitabilityActivity(this.startMonth,this.startYear,this.monthsCount);this.profitabilityActivities.push(this.prepareProfitabilityActivity(e,t))}})}computeStartMonthandYear(){this.startMonth=this.profitabilityActivityStartDate.getMonth(),this.startYear=this.profitabilityActivityStartDate.getFullYear(),this.computeMonthsCount()}computeMonthsCount(){this.monthsCount=12*(this.profitabilityActivityEndDate.getFullYear()-this.profitabilityActivityStartDate.getFullYear()),this.monthsCount-=this.profitabilityActivityStartDate.getMonth(),this.monthsCount+=this.profitabilityActivityEndDate.getMonth()+1}prepareProfitabilityActivity(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=e.projectName,t.companyName=e.companyName,t.userId=e.userId,t.userIdentifier=e.userIdentifier;const i=t.monthsProfitabilityActivity.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsProfitabilityActivity[i].spentMonthLoad=e.spentMonthLoad,t.monthsProfitabilityActivity[i].invoicedMonthLoad=e.invoicedMonthLoad,t.monthsProfitabilityActivity[i].globalMonthSpent=e.globalMonthSpent,t.monthsProfitabilityActivity[i].achivedMonthCost=e.achivedMonthCost,t.monthsProfitabilityActivity[i].invoicedMonthCost=e.invoicedMonthCost,t.monthsProfitabilityActivity[i].spentMonthAmount=this.numberFormatter.round(e.spentMonthAmount,0),t.monthsProfitabilityActivity[i].spentMonthMission=e.spentMonthMission,t.monthsProfitabilityActivity[i].invoicedMonthMission=e.invoicedMonthMission,t.monthsProfitabilityActivity[i].saariRef=e.saariRef),t}createProfitabilityActivity(t,e,i){const n=new d.Z9(i);for(let o=0;o<i;o++)t+o<12?(n.monthsProfitabilityActivity[o].month=t+o+1,n.monthsProfitabilityActivity[o].year=e):(n.monthsProfitabilityActivity[o].month=t+o+1-12,n.monthsProfitabilityActivity[o].year=e+1);return n}AddProjectsWithoutResourcesLoad(){this.profitabilityActivitiesProjects.forEach(t=>{let e=this.profitabilityActivities.find(e=>e.activityId===t.activityId&&e.projectId===t.projectId);void 0===e&&(e=this.createProfitabilityActivity(this.startMonth,this.startYear,this.monthsCount),e.activityId=t.activityId,e.activityName=t.activityName,e.companyName=t.companyName,e.projectId=t.projectId,e.projectName=t.projectName,e.userId=0,e.userIdentifier="No Load",this.profitabilityActivities.push(e))})}dateFormat(t){return null==t||"0001-01-01T00:00:00"===t?"":this.dateTimeService.getShortFormat(t)}dateOnly(t){return this.dateTimeService.dateOnly(t)}daysChangePeriodFrom(t){const e=new Date(t);this.profitabilityActivityStartDate=st([e.getFullYear(),e.getMonth()]).toDate(),this.minDate=this.profitabilityActivityStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityActivityEndDate=st([e.getFullYear(),e.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityActivityEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}daysChangePeriodTo(t){const e=new Date(t);this.profitabilityActivityEndDate=st(e).endOf("month").toDate(),this.maxDate=this.profitabilityActivityEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityActivityStartDate=st([e.getFullYear(),e.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityActivityStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}displayProductivity(){this.searchFilterService.pageIndex=0,!1===this.hideProductivity?(this.displayedProductivityLabel="Summary",this.hideProductivity=!0):(this.displayedProductivityLabel="Details",this.hideProductivity=!1)}exportToExcel(){if(void 0!==this.profitabilityActivities&&0!==this.profitabilityActivities.length){const t=[],e=[],i=this.subColumnsNames.length,n=[],o=[];t.push({header:"",key:"A",width:20}),t.push({header:"",key:"B",width:20}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});let r=["Activity","Project","Company","Resource"];o.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityActivitiesGrouped[0].monthsProfitabilityActivity.forEach(e=>{this.subColumnsNames.forEach(i=>{t.push({header:void 0!==e.month?this.monthNames[e.month-1].toString()+" "+e.year.toString():"Total",key:i+e.monthIndex,width:20}),r.push(i)}),n.push(this.getExcelColumn(5+i*e.monthIndex)+"1:"+this.getExcelColumn(4+i*(e.monthIndex+1))+"1"),o.push({cell:this.getExcelColumn(5+i*e.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});let a=0;this.subColumnsNames.forEach(()=>{o.push({cell:this.getExcelColumn(5+i*e.monthIndex+a)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),a++})}),e.push(r),this.profitabilityActivitiesGrouped.forEach(t=>{r=[],r.push(t.activityName),r.push(t.projectName),r.push(t.companyName),r.push(t.userIdentifier),t.monthsProfitabilityActivity.forEach(t=>{r.push(this.formatNullOrEmptyValue(t.spentMonthLoad)),r.push(this.formatNullOrEmptyValue(t.invoicedMonthLoad)),r.push(t.spentMonthAmount),r.push(t.achivedMonthCost),r.push(t.invoicedMonthCost),r.push(t.spentMonthMission),r.push(t.invoicedMonthMission),r.push(t.saariRef),r.push(t.productivity)}),e.push(r)}),this.excelService.generateExcel(t,e,n,o,"Profitability_Activity")}}getExcelColumn(t){const e=26,i=t%e==0?Math.floor(t/e)-1:Math.floor(t/e),n=t%e==0?e:t%e;return t<=e?String.fromCharCode(n+64):String.fromCharCode(i+64)+String.fromCharCode(n+64)}formatNullOrEmptyValue(t){return""===t||null===t?0:t}openProfitabilityActivityLegend(){this.uploadDialogRef=this.dialog.open(at,{disableClose:!1,panelClass:"form_modal",width:"700px",height:"320px",hasBackdrop:!0,data:{}})}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(c.Injector))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-activity"]],decls:46,vars:17,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"hidden","click"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length",4,"ngIf"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[3,"pageSize","pageIndex","length"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityActivities","profitabilityActivitiesFiltred","profitabilityActivitiesProjects","profitabilityActivitiesTotal","monthsCount"],[3,"profitabilityActivitiesGroup","monthsCount"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Period"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-select-month",8),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodFrom(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"div",7),c.\u0275\u0275elementStart(14,"app-select-month",9),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodTo(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"div",5),c.\u0275\u0275elementStart(16,"mat-list"),c.\u0275\u0275elementStart(17,"mat-list-item"),c.\u0275\u0275elementStart(18,"h3",6),c.\u0275\u0275text(19,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"div",10),c.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(22,"div",12),c.\u0275\u0275elementStart(23,"div",13),c.\u0275\u0275elementStart(24,"div",14),c.\u0275\u0275elementStart(25,"button",15),c.\u0275\u0275listener("click",function(){return e.searchProfitabilityActivity()}),c.\u0275\u0275text(26,"Search"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(27,"nav",16),c.\u0275\u0275elementStart(28,"div",17),c.\u0275\u0275elementStart(29,"button",18),c.\u0275\u0275listener("click",function(){return e.exportToExcel()}),c.\u0275\u0275element(30,"em",19),c.\u0275\u0275text(31," Export "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(32,"button",20),c.\u0275\u0275listener("click",function(){return e.displayProductivity()}),c.\u0275\u0275text(33),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(34,"button",18),c.\u0275\u0275listener("click",function(){return e.openProfitabilityActivityLegend()}),c.\u0275\u0275element(35,"em",21),c.\u0275\u0275text(36," Legend "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(37,"div",22),c.\u0275\u0275template(38,te,1,3,"app-paginator",23),c.\u0275\u0275template(39,ee,1,3,"app-paginator",23),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(40,ie,3,0,"div",24),c.\u0275\u0275elementStart(41,"div",25),c.\u0275\u0275elementStart(42,"div",26),c.\u0275\u0275template(43,ne,6,0,"div",27),c.\u0275\u0275template(44,oe,3,11,"div",28),c.\u0275\u0275template(45,re,3,8,"div",28),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("selectedDate",e.profitabilityActivityStartDate)("maxDate",e.maxDate),c.\u0275\u0275advance(2),c.\u0275\u0275property("selectedDate",e.profitabilityActivityEndDate)("minDate",e.minDate),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("settings",e.dropdownSettings)("disabled",!e.isSuperAdmin),c.\u0275\u0275advance(11),c.\u0275\u0275property("hidden",e.hideBtnProductivity),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",e.displayedProductivityLabel," "),c.\u0275\u0275advance(5),c.\u0275\u0275property("ngIf",e.hideProductivity),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",!e.hideProductivity),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngIf",e.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult&&e.hideProductivity),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult&&!e.hideProductivity))},directives:[u.i$,u.Tg,lt.j,r.OP,y.NgControlStatus,y.NgModel,C.M2,n.NgIf,I.J,j.$g,Ut,Xt],pipes:[Z.R],styles:[".search-input{font-size:14px}.multi-search{width:100%}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),t})(),se=(()=>{class t{constructor(t){this.dialogRef=t}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.so))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-project-legend"]],decls:33,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"form",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"span"),c.\u0275\u0275text(4," Profitability Project Legend "),c.\u0275\u0275elementStart(5,"em",3),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(6,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"div",4),c.\u0275\u0275elementStart(8,"div"),c.\u0275\u0275elementStart(9,"span",5),c.\u0275\u0275text(10,"Spent (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(11,"La charge d\xe9pens\xe9e (HJ) = La charge d\xe9pens\xe9e du projet."),c.\u0275\u0275element(12,"br"),c.\u0275\u0275elementStart(13,"span",5),c.\u0275\u0275text(14,"Invoiced (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = La charge factur\xe9e des personnes affect\xe9es au projet."),c.\u0275\u0275element(16,"br"),c.\u0275\u0275elementStart(17,"span",5),c.\u0275\u0275text(18,"Spent Amount (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(19,"Montant d\xe9pens\xe9 (\u20ac) = la somme du co\xfbt (co\xfbt interne de la ressource * 20 jours) de chaque ressource appartenant \xe0 l'activit\xe9."),c.\u0275\u0275element(20,"br"),c.\u0275\u0275elementStart(21,"span",5),c.\u0275\u0275text(22,"Achieved Cost (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(23,"Montant factur\xe9 (\u20ac) = La somme (co\xfbt externe selon profil de la personne * nbr de jour factur\xe9) pour chaque personne affect\xe9e au projet."),c.\u0275\u0275element(24,"br"),c.\u0275\u0275elementStart(25,"span",5),c.\u0275\u0275text(26,"Invoiced Cost (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(27,"Montant factur\xe9 (\u20ac) = Le montant total des factures valid\xe9es du projet. (Il est r\xe9cup\xe9r\xe9 de la facture)."),c.\u0275\u0275element(28,"br"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(29,"div",6),c.\u0275\u0275elementStart(30,"div",7),c.\u0275\u0275elementStart(31,"button",8),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(32,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())},directives:[y.\u0275NgNoValidate,y.NgControlStatusGroup,y.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:190px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t})();function le(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",9),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(t)," ")}}function de(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[t]," ")}}function ce(t,e){1&t&&c.\u0275\u0275element(0,"td")}function he(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",14),c.\u0275\u0275elementStart(1,"td",15),c.\u0275\u0275elementStart(2,"span",16),c.\u0275\u0275text(3),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,ce,1,0,"td",8),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",t.activityName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function me(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function pe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"label",24),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(3).$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.companyName,"")}}function ue(t,e){1&t&&(c.\u0275\u0275elementStart(0,"label",25),c.\u0275\u0275text(1," Empty"),c.\u0275\u0275elementEnd())}function fe(t,e){if(1&t&&(c.\u0275\u0275template(0,pe,2,1,"label",22),c.\u0275\u0275template(1,ue,2,0,"label",23),c.\u0275\u0275text(2)),2&t){const t=c.\u0275\u0275nextContext(2).$implicit;c.\u0275\u0275property("ngIf",t.companyName),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",!t.companyName),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," ")}}function ge(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function ye(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValue(t,e),"")}}function ve(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",26),c.\u0275\u0275template(1,ge,2,0,"div",19),c.\u0275\u0275template(2,ye,1,1,"ng-template",null,20,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275propertyInterpolate1("matTooltip"," ",o.getTotalSubColumnValue(t,n),""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(t,n))("ngIfElse",i)}}function be(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",17),c.\u0275\u0275elementStart(1,"td",18),c.\u0275\u0275template(2,me,2,0,"div",19),c.\u0275\u0275template(3,fe,3,3,"ng-template",null,20,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(5,ve,4,3,"td",21),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275reference(4),e=c.\u0275\u0275nextContext().$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",e.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==i.getTotalSubColumnValue(i.i,e))("ngIfElse",t),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function Se(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function xe(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate(i.getSubColumnValue(t,e))}}function Ce(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",29),c.\u0275\u0275template(1,Se,2,0,"div",19),c.\u0275\u0275template(2,xe,1,1,"ng-template",null,20,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getSubColumnValue(t,n))("ngIfElse",i)}}function Ie(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",27),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,Ce,4,2,"td",28),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(2),c.\u0275\u0275textInterpolate1(" ",t.userIdentifier," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function Pe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tbody"),c.\u0275\u0275template(1,he,5,2,"tr",11),c.\u0275\u0275template(2,be,6,4,"tr",12),c.\u0275\u0275template(3,Ie,4,2,"tr",13),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",1==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",2==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level)}}let Ee=(()=>{class t{constructor(t,e,i,n){this.dialog=t,this.profitabilityProjectGroupService=e,this.dateTimeService=i,this.numberFormatter=n,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent MD","Invoiced MD","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityProjectsGrouped=[]}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}ngOnChanges(){(null!==this.profitabilityProjects||void 0!==this.profitabilityProjects)&&(this.profitabilityProjectsGrouped=this.profitabilityProjectGroupService.getProfitabilityProjectsGrouped(this.profitabilityProjects,this.profitabilityProjectsFiltred,this.profitabilityActivitiesProjects,this.monthsCount))}buildColmnsHeader(){if((null!==this.profitabilityProjects||void 0!==this.profitabilityProjects)&&this.profitabilityProjects.length>0){const t=this.profitabilityProjects[0].monthsProfitabilityProject.length;for(let e=0;e<t;e++){this.displayedColumns.push("M"+e);const t=this.profitabilityProjects[0].monthsProfitabilityProject[this.getMonthIndex(e)].month-1,i=this.profitabilityProjects[0].monthsProfitabilityProject[this.getMonthIndex(e)].year;isNaN(t)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[t]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}}getMonthIndex(t){return Math.floor(t)}getMonthDetailsIndex(t){return Math.floor(t/this.displayedSubColumnsNamesCount)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityProject[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityProject[n].spentMonthLoad,1);case 1:return this.format(e.monthsProfitabilityProject[n].invoicedMonthLoad);case 2:return this.format(e.monthsProfitabilityProject[n].spentMonthAmount);case 3:return this.format(e.monthsProfitabilityProject[n].achivedMonthCost);case 4:case 5:case 6:case 7:return-1}}getTotalSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityProject[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityProject[n].spentMonthLoad,1);case 1:return this.numberFormatter.round(e.monthsProfitabilityProject[n].invoicedMonthLoad,1);case 2:return this.format(this.numberFormatter.round(e.monthsProfitabilityProject[n].spentMonthAmount,1));case 3:return this.format(this.numberFormatter.round(e.monthsProfitabilityProject[n].achivedMonthCost,1));case 4:return this.format(this.numberFormatter.round(e.monthsProfitabilityProject[n].invoicedMonthCost,1));case 5:return this.format(this.numberFormatter.round(e.monthsProfitabilityProject[n].spentMonthMission,1));case 6:return this.format(this.numberFormatter.round(e.monthsProfitabilityProject[n].invoicedMonthMission,1));case 7:return e.monthsProfitabilityProject[n].saariRef}}dateOnly(t){return this.dateTimeService.dateOnly(t)}datePipe(t){return"0001-01-01T00:00:00"===t?"":t}format(t){return 0===t?"":t}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(h.$M),c.\u0275\u0275directiveInject(p.Cv),c.\u0275\u0275directiveInject(rt.e))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-project"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},inputs:{profitabilityProjects:"profitabilityProjects",profitabilityProjectsFiltred:"profitabilityProjectsFiltred",profitabilityActivitiesProjects:"profitabilityActivitiesProjects",profitabilityProjectsTotal:"profitabilityProjectsTotal",monthsCount:"monthsCount"},features:[c.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],["style","text-align: center;",3,"matTooltip",4,"ngFor","ngForOf"],["style","background-color:#24901d;","class","label",4,"ngIf"],["style","background-color:rgb(235, 64, 64);","class","label",4,"ngIf"],[1,"label",2,"background-color","#24901d"],[1,"label",2,"background-color","rgb(235, 64, 64)"],[2,"text-align","center",3,"matTooltip"],[1,"td-third",2,"width","15%"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0),c.\u0275\u0275element(1,"caption",1),c.\u0275\u0275elementStart(2,"thead",2),c.\u0275\u0275elementStart(3,"tr",3),c.\u0275\u0275elementStart(4,"th",4),c.\u0275\u0275text(5,"Activity / Company-Project / Resource"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(6,le,2,2,"th",5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"tr",6),c.\u0275\u0275template(8,de,2,1,"th",7),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(9,Pe,4,3,"tbody",8),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(6),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",e.displayedSubColumns),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.profitabilityProjectsGrouped))},directives:[n.NgForOf,n.NgIf,D.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t})();function Me(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275elementStart(1,"h1"),c.\u0275\u0275text(2,"No Result Found"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function Ae(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",29),c.\u0275\u0275elementStart(1,"div",30),c.\u0275\u0275elementStart(2,"div",31),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275elementStart(4,"div",32),c.\u0275\u0275element(5,"mat-spinner"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function je(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",33),c.\u0275\u0275element(1,"app-project",34),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("profitabilityProjects",c.\u0275\u0275pipeBind3(2,6,t.profitabilityProjects,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("profitabilityProjectsFiltred",t.profitabilityProjects)("profitabilityActivitiesProjects",t.profitabilityActivitiesProjects)("monthsCount",t.monthsCount)}}function we(t,e){if(1&t&&c.\u0275\u0275element(0,"div",33),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading)}}let De=(()=>{class t{constructor(t){this.emptyResult=!1,this.profitabilityProjectsGrouped=[],this.profitabilityProjectsGroup=[],this.profitabilityProjectsLength=0,this.profitabilityProjectsGroupLength=0,this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.projectsIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.selectedProjectsIdentifiers=[],this.dropdownSettings={},this.dropDownSelected=!1,this.searchFilterService=new p.nJ,this.paginatorPipe=new ot.Ry(this.searchFilterService),this.subscription=new nt.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent","Invoiced","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.dialog=t.get(it.uw),this.searchFilterService=t.get(p.nJ),this.excelService=t.get(p.xB),this.profitabilityProjectService=t.get(h.jE),this.profitabilityProjectGroupService=t.get(h.$M),this.projectService=t.get(m.Y4),this.dateTimeService=t.get(p.Cv),this.numberFormatter=t.get(rt.e),this.notificationService=t.get(p.gq)}ngOnInit(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===s.Fl.SuperAdmin,this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=12,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.getActivities(),this.subscription.add(this.profitabilityProjectService.reloadProfitabilityProject.subscribe(()=>{const t=JSON.parse(sessionStorage.getItem("profitabilityProjectSearch")),e=t.selectedProjectsIdentifiers,i=t.selectedActivitiesIdentifiers.map(t=>t.id).join(","),n=e.map(t=>t.id).join(",");this.getProfitabilityProject(i,n,t.profitabilityProjectStartDate,t.profitabilityProjectEndDate)})),this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}))}ngOnDestroy(){this.subscription.unsubscribe()}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t,this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.getActivityProjects(this.selectedActivitiesIds),this.setSearchFilter())})}onDropDownClose(){this.dropDownSelected&&(this.dropDownSelected=!1,this.selectedActivitiesIds="",this.selectedActivitiesIdentifiers.length!==this.activitiesIdentifiers.length&&(this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(",")),this.getActivityProjects(this.selectedActivitiesIds))}getActivityProjects(t){this.profitabilityProjectService.getActivityProjects(t).subscribe(t=>{this.projectsIdentifiers=[],this.selectedProjectsIdentifiers=[],this.selectedProjectsIds="",null!=t&&(this.projectsIdentifiers=t)})}setSearchFilter(){const t=JSON.parse(sessionStorage.getItem("profitabilityProjectSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),t.selectedProjectsIdentifiers&&t.selectedProjectsIdentifiers.length>0&&(this.selectedProjectsIdentifiers=t.selectedProjectsIdentifiers),this.selectedProjectsIds=this.selectedProjectsIdentifiers.map(t=>t.id).join(","),null!=t.profitabilityProjectStartDate&&(this.profitabilityProjectStartDate=new Date(t.profitabilityProjectStartDate),this.minDate=this.profitabilityProjectStartDate),null!=t.profitabilityProjectEndDate&&(this.profitabilityProjectEndDate=new Date(t.profitabilityProjectEndDate),this.maxDate=this.profitabilityProjectEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId);const t=this.dateTimeService.today();this.profitabilityProjectStartDate=st([t.getFullYear(),t.getMonth()]).toDate(),this.profitabilityProjectEndDate=st(t).endOf("month").toDate(),this.minDate=this.profitabilityProjectStartDate,this.maxDate=this.profitabilityProjectEndDate}}searchProfitabilityProject(){this.searchFilterService.pageIndex=0,this.profitabilityProjects=[],this.profitabilityProjectsGroup=[],this.profitabilityProjectsLength=0,this.profitabilityProjectsGroupLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.selectedProjectsIds="",this.selectedProjectsIdentifiers&&this.selectedProjectsIdentifiers.length>0&&(this.selectedProjectsIds=this.selectedProjectsIdentifiers.map(t=>t.id).join(",")),this.emptyResult=!0,this.listView=!1;const t=new d.QR;t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.selectedProjectsIdentifiers=this.selectedProjectsIdentifiers,t.profitabilityProjectStartDate=this.profitabilityProjectStartDate,t.profitabilityProjectEndDate=this.profitabilityProjectEndDate,sessionStorage.setItem("profitabilityProjectSearch",JSON.stringify(t)),this.computeStartMonthandYear(),this.getProfitabilityProject(this.selectedActivitiesIds,this.selectedProjectsIds,this.profitabilityProjectStartDate,this.profitabilityProjectEndDate)}getProfitabilityProject(t,e,i,n){this.isLoading=!0,this.profitabilityProjectService.getProfitabilityProject(t,e,i,n).subscribe(o=>{null!=o&&this.profitabilityProjectService.getProfitabilityActivityProject(t,e,i,n).subscribe(t=>{if(this.isLoading=!1,this.profitabilityActivitiesProjects=t,this.prepareProfitabilityProjects(o),this.AddProjectsWithoutResourcesLoad(),this.profitabilityProjectsLength=this.profitabilityProjects.length,this.emptyResult=!1,this.listView=!0,0===this.profitabilityProjects.length)this.emptyResult=!0;else if(void 0!==this.profitabilityProjects){const t=this.profitabilityProjectGroupService.getProfitabilityProjectsGrouped(this.profitabilityProjects,this.profitabilityProjects,this.profitabilityActivitiesProjects,this.monthsCount);this.profitabilityProjectsGrouped=JSON.parse(JSON.stringify(t)),this.profitabilityProjectsGroup=this.profitabilityProjectsGrouped.filter(t=>1===t.level),this.profitabilityProjectsGroupLength=this.profitabilityProjectsGroup.length,this.emptyResult=!1}},()=>{this.isLoading=!1,this.notificationService.danger("Profitability project not loaded.")})},()=>{this.isLoading=!1,this.notificationService.danger("Profitability project not loaded.")})}prepareProfitabilityProjects(t){t.forEach(t=>{const e=this.profitabilityProjects.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId&&e.userId===t.userId);if(-1!==e)this.profitabilityProjects[e]=this.prepareProfitabilityProject(this.profitabilityProjects[e],t);else{const e=this.createProfitabilityProject(this.startMonth,this.startYear,this.monthsCount);this.profitabilityProjects.push(this.prepareProfitabilityProject(e,t))}})}computeStartMonthandYear(){this.startMonth=this.profitabilityProjectStartDate.getMonth(),this.startYear=this.profitabilityProjectStartDate.getFullYear(),this.computeMonthsCount()}computeMonthsCount(){this.monthsCount=12*(this.profitabilityProjectEndDate.getFullYear()-this.profitabilityProjectStartDate.getFullYear()),this.monthsCount-=this.profitabilityProjectStartDate.getMonth(),this.monthsCount+=this.profitabilityProjectEndDate.getMonth()+1}prepareProfitabilityProject(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=e.projectName,t.companyName=e.companyName,t.userId=e.userId,t.userIdentifier=e.userIdentifier;const i=t.monthsProfitabilityProject.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsProfitabilityProject[i].spentMonthLoad=e.spentMonthLoad,t.monthsProfitabilityProject[i].invoicedMonthLoad=e.invoicedMonthLoad,t.monthsProfitabilityProject[i].achivedMonthCost=e.achivedMonthCost,t.monthsProfitabilityProject[i].invoicedMonthCost=e.invoicedMonthCost,t.monthsProfitabilityProject[i].spentMonthAmount=this.numberFormatter.round(e.spentMonthAmount,0),t.monthsProfitabilityProject[i].spentMonthMission=e.spentMonthMission,t.monthsProfitabilityProject[i].invoicedMonthMission=e.invoicedMonthMission,t.monthsProfitabilityProject[i].saariRef=e.saariRef),t}createProfitabilityProject(t,e,i){const n=new d.dv(i);for(let o=0;o<i;o++)t+o<12?(n.monthsProfitabilityProject[o].month=t+o+1,n.monthsProfitabilityProject[o].year=e):(n.monthsProfitabilityProject[o].month=t+o+1-12,n.monthsProfitabilityProject[o].year=e+1);return n}AddProjectsWithoutResourcesLoad(){this.profitabilityActivitiesProjects.forEach(t=>{let e=this.profitabilityProjects.find(e=>e.activityId===t.activityId&&e.projectId===t.projectId);void 0===e&&(e=this.createProfitabilityProject(this.startMonth,this.startYear,this.monthsCount),e.activityId=t.activityId,e.activityName=t.activityName,e.companyName=t.companyName,e.projectId=t.projectId,e.projectName=t.projectName,e.userId=0,e.userIdentifier="No Load",this.profitabilityProjects.push(e))})}dateFormat(t){return null==t||"0001-01-01T00:00:00"===t?"":this.dateTimeService.getShortFormat(t)}dateOnly(t){return this.dateTimeService.dateOnly(t)}daysChangePeriodFrom(t){const e=new Date(t);this.profitabilityProjectStartDate=st([e.getFullYear(),e.getMonth()]).toDate(),this.minDate=this.profitabilityProjectStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityProjectEndDate=st([e.getFullYear(),e.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityProjectEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}daysChangePeriodTo(t){const e=new Date(t);this.profitabilityProjectEndDate=st(e).endOf("month").toDate(),this.maxDate=this.profitabilityProjectEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityProjectStartDate=st([e.getFullYear(),e.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityProjectStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}exportToExcel(){if(void 0!==this.profitabilityProjects&&0!==this.profitabilityProjects.length){const t=[],e=[],i=this.subColumnsNames.length,n=[],o=[];t.push({header:"",key:"A",width:20}),t.push({header:"",key:"B",width:20}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});let r=["Activity","Project","Company","Resource"];o.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityProjectsGrouped[1].monthsProfitabilityProject.forEach(e=>{this.subColumnsNames.forEach(i=>{t.push({header:void 0!==e.month?this.monthNames[e.month-1].toString()+" "+e.year.toString():"Total",key:i+e.monthIndex,width:20}),r.push(i)}),n.push(this.getExcelColumn(5+i*e.monthIndex)+"1:"+this.getExcelColumn(4+i*(e.monthIndex+1))+"1"),o.push({cell:this.getExcelColumn(5+i*e.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});let a=0;this.subColumnsNames.forEach(()=>{o.push({cell:this.getExcelColumn(5+i*e.monthIndex+a)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),a++})}),e.push(r),this.profitabilityProjectsGrouped.forEach(t=>{1!==t.level&&(r=[],r.push(t.activityName),r.push(t.projectName),r.push(t.companyName),r.push(t.userIdentifier),t.monthsProfitabilityProject.forEach(t=>{r.push(this.formatNullOrEmptyValue(t.spentMonthLoad)),r.push(this.formatNullOrEmptyValue(t.invoicedMonthLoad)),r.push(t.spentMonthAmount),r.push(t.achivedMonthCost),r.push(t.invoicedMonthCost),r.push(t.spentMonthMission),r.push(t.invoicedMonthMission),r.push(t.saariRef)}),e.push(r))}),this.excelService.generateExcel(t,e,n,o,"Profitability_Project")}}getExcelColumn(t){const e=26,i=t%e==0?Math.floor(t/e)-1:Math.floor(t/e),n=t%e==0?e:t%e;return t<=e?String.fromCharCode(n+64):String.fromCharCode(i+64)+String.fromCharCode(n+64)}formatNullOrEmptyValue(t){return""===t||null===t?0:t}openProfitabilityProjectLegend(){this.uploadDialogRef=this.dialog.open(se,{disableClose:!1,panelClass:"form_modal",width:"700px",height:"320px",hasBackdrop:!0,data:{}})}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(c.Injector))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-project"]],decls:49,vars:20,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange","click","onDropDownClose"],[1,"col-xl-3","col-lg-12"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","ngModelChange"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityProjects","profitabilityProjectsFiltred","profitabilityActivitiesProjects","monthsCount"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Period"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-select-month",8),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodFrom(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"div",7),c.\u0275\u0275elementStart(14,"app-select-month",9),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodTo(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"div",5),c.\u0275\u0275elementStart(16,"mat-list"),c.\u0275\u0275elementStart(17,"mat-list-item"),c.\u0275\u0275elementStart(18,"h3",6),c.\u0275\u0275text(19,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"div",10),c.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t})("click",function(){return e.dropDownSelected=!0})("onDropDownClose",function(){return e.onDropDownClose()}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(22,"div",12),c.\u0275\u0275elementStart(23,"mat-list"),c.\u0275\u0275elementStart(24,"mat-list-item"),c.\u0275\u0275elementStart(25,"h3",6),c.\u0275\u0275text(26,"Projects"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(27,"div",10),c.\u0275\u0275elementStart(28,"ng-multiselect-dropdown",13),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedProjectsIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(29,"div",14),c.\u0275\u0275elementStart(30,"div",15),c.\u0275\u0275elementStart(31,"button",16),c.\u0275\u0275listener("click",function(){return e.searchProfitabilityProject()}),c.\u0275\u0275text(32,"Search"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(33,"nav",17),c.\u0275\u0275elementStart(34,"div",18),c.\u0275\u0275elementStart(35,"button",19),c.\u0275\u0275listener("click",function(){return e.exportToExcel()}),c.\u0275\u0275element(36,"em",20),c.\u0275\u0275text(37," Export "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(38,"button",19),c.\u0275\u0275listener("click",function(){return e.openProfitabilityProjectLegend()}),c.\u0275\u0275element(39,"em",21),c.\u0275\u0275text(40," Legend "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(41,"div",22),c.\u0275\u0275element(42,"app-paginator",23),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(43,Me,3,0,"div",24),c.\u0275\u0275elementStart(44,"div",25),c.\u0275\u0275elementStart(45,"div",26),c.\u0275\u0275template(46,Ae,6,0,"div",27),c.\u0275\u0275template(47,je,3,10,"div",28),c.\u0275\u0275template(48,we,1,2,"div",28),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("selectedDate",e.profitabilityProjectStartDate)("maxDate",e.maxDate),c.\u0275\u0275advance(2),c.\u0275\u0275property("selectedDate",e.profitabilityProjectEndDate)("minDate",e.minDate),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("settings",e.dropdownSettings)("disabled",!e.isSuperAdmin),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("data",e.projectsIdentifiers)("ngModel",e.selectedProjectsIdentifiers)("settings",e.dropdownSettings),c.\u0275\u0275advance(14),c.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.profitabilityProjectsLength),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngIf",e.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult))},directives:[u.i$,u.Tg,lt.j,r.OP,y.NgControlStatus,y.NgModel,C.M2,I.J,n.NgIf,j.$g,Ee],pipes:[Z.R],styles:[".search-input{font-size:14px}.multi-search{width:100%}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),t})(),Re=(()=>{class t{constructor(t){this.dialogRef=t}close(){this.dialogRef.close()}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.so))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-resource-legend"]],decls:47,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[2,"font-weight","bold","color","rgb(0, 184, 83)"],[2,"font-weight","bold","color","rgb(255, 81, 0)"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"form",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"span"),c.\u0275\u0275text(4," Profitability Resource Legend "),c.\u0275\u0275elementStart(5,"em",3),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(6,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"div",4),c.\u0275\u0275elementStart(8,"div"),c.\u0275\u0275elementStart(9,"span",5),c.\u0275\u0275text(10,"Spent (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(11," la charge d\xe9pens\xe9e (projets; projets g\xe9n\xe9riques...) de la personne."),c.\u0275\u0275element(12,"br"),c.\u0275\u0275elementStart(13,"span",5),c.\u0275\u0275text(14,"Invoiced (MD): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = la charge factur\xe9e de la personne."),c.\u0275\u0275element(16,"br"),c.\u0275\u0275elementStart(17,"span",5),c.\u0275\u0275text(18,"Spent Amount (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(19,"La charge d\xe9pens\xe9e (\u20ac) = co\xfbt interne * 20 jours."),c.\u0275\u0275element(20,"br"),c.\u0275\u0275elementStart(21,"span",5),c.\u0275\u0275text(22,"Invoiced Cost (\u20ac): "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(23,"La charge factur\xe9e (\u20ac) = la somme (co\xfbt externe selon profil de la personne * nbr de jours factur\xe9s) de la personne."),c.\u0275\u0275element(24,"br"),c.\u0275\u0275elementStart(25,"span",5),c.\u0275\u0275text(26,"Productivity (%):"),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(27,"Rentabilit\xe9 (%)"),c.\u0275\u0275element(28,"br"),c.\u0275\u0275elementStart(29,"span"),c.\u0275\u0275text(30,"- En charge : "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(31,"(Invoiced (MD) / Spent (MD)) * 100. (Les jours des cong\xe9s ne sont pas pris en compte dans la charge d\xe9pens\xe9)"),c.\u0275\u0275element(32,"br"),c.\u0275\u0275elementStart(33,"span"),c.\u0275\u0275text(34,"- En co\xfbt : "),c.\u0275\u0275elementEnd(),c.\u0275\u0275text(35,"((Invoiced Cost (\u20ac) \u2013 Spent Amount (\u20ac)) / Spent Amount (\u20ac)) * 100."),c.\u0275\u0275element(36,"br"),c.\u0275\u0275elementStart(37,"span",6),c.\u0275\u0275text(38,"La couleur verte correspond aux projets g\xe9n\xe9riques. "),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(39,"br"),c.\u0275\u0275elementStart(40,"span",7),c.\u0275\u0275text(41,"La couleur orang\xe9e correspond aux projets qui n'appartiennent pas \xe0 l'activit\xe9 s\xe9lectionn\xe9e. "),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(42,"br"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(43,"div",8),c.\u0275\u0275elementStart(44,"div",9),c.\u0275\u0275elementStart(45,"button",10),c.\u0275\u0275listener("click",function(){return e.close()}),c.\u0275\u0275text(46,"close"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())},directives:[y.\u0275NgNoValidate,y.NgControlStatusGroup,y.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:260px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t})();function ke(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",9),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(t)," ")}}function Le(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",10),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[t]," ")}}function Ne(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",18),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext(2).$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",n.getTotalSubColumnValueByCost(t,i)," ")}}function Fe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",14),c.\u0275\u0275elementStart(1,"td",15),c.\u0275\u0275elementStart(2,"span",16),c.\u0275\u0275text(3),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,Ne,2,1,"td",17),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",t.activityName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function Oe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext(2).$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",n.getTotalSubColumnValue(t,i)," ")}}function Te(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",14),c.\u0275\u0275element(1,"td",15),c.\u0275\u0275template(2,Oe,2,1,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext(2);c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",t.displayedSubColumns)}}function _e(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function We(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext(2).$implicit;c.\u0275\u0275textInterpolate1(" ",t.userIdentifier," ")}}function ze(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function He(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValueByCost(t,e),"")}}function Ve(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",18),c.\u0275\u0275template(1,ze,2,0,"div",23),c.\u0275\u0275template(2,He,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValueByCost(t,n)&&void 0===n)("ngIfElse",i)}}function Ge(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",21),c.\u0275\u0275elementStart(1,"td",22),c.\u0275\u0275template(2,_e,2,0,"div",23),c.\u0275\u0275template(3,We,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(5,Ve,4,2,"td",17),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275reference(4),e=c.\u0275\u0275nextContext().$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",e.userIdentifier,""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==i.getTotalSubColumnValueByCost(i.i,e))("ngIfElse",t),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function Be(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function Je(t,e){}function $e(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function Ye(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate1(" ",i.getTotalSubColumnValue(t,e),"")}}function Ue(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275template(1,$e,2,0,"div",23),c.\u0275\u0275template(2,Ye,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(t,n))("ngIfElse",i)}}function Qe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",21),c.\u0275\u0275elementStart(1,"td",22),c.\u0275\u0275template(2,Be,2,0,"div",23),c.\u0275\u0275template(3,Je,0,0,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(5,Ue,4,2,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275reference(4),e=c.\u0275\u0275nextContext().$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",e.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==i.getTotalSubColumnValue(i.i,e))("ngIfElse",t),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function qe(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function Ke(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate(i.getSubColumnValue(t,e))}}function Ze(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275template(1,qe,2,0,"div",23),c.\u0275\u0275template(2,Ke,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getSubColumnValue(t,n))("ngIfElse",i)}}function Xe(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",25),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,Ze,4,2,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function ti(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function ei(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate(i.getSubColumnValue(t,e))}}function ii(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275template(1,ti,2,0,"div",23),c.\u0275\u0275template(2,ei,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getSubColumnValue(t,n))("ngIfElse",i)}}function ni(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",26),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,ii,4,2,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function oi(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275text(1," - "),c.\u0275\u0275elementEnd())}function ri(t,e){if(1&t&&c.\u0275\u0275text(0),2&t){const t=c.\u0275\u0275nextContext().index,e=c.\u0275\u0275nextContext(2).$implicit,i=c.\u0275\u0275nextContext();c.\u0275\u0275textInterpolate(i.getSubColumnValue(t,e))}}function ai(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275template(1,oi,2,0,"div",23),c.\u0275\u0275template(2,ri,1,1,"ng-template",null,24,c.\u0275\u0275templateRefExtractor),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275reference(3),n=c.\u0275\u0275nextContext(2).$implicit,o=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",-1==o.getSubColumnValue(t,n))("ngIfElse",i)}}function si(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",27),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,ai,4,2,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.displayedSubColumns)}}function li(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tbody"),c.\u0275\u0275template(1,Fe,5,2,"tr",11),c.\u0275\u0275template(2,Te,3,1,"tr",11),c.\u0275\u0275template(3,Ge,6,4,"tr",12),c.\u0275\u0275template(4,Qe,6,4,"tr",12),c.\u0275\u0275template(5,Xe,4,3,"tr",13),c.\u0275\u0275template(6,ni,4,3,"tr",13),c.\u0275\u0275template(7,si,4,3,"tr",13),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",1==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",1==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",2==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",2==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level&&0===t.projectActivityId),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level&&0!==t.projectActivityId&&t.projectActivityId!==t.activityId),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level&&0!==t.projectActivityId&&t.projectActivityId===t.activityId)}}let di=(()=>{class t{constructor(t,e,i,n){this.dialog=t,this.profitabilityResourceGroupService=e,this.dateTimeService=i,this.numberFormatter=n,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent \u20ac / MD","Invoiced \u20ac / MD","Productivity %"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityResourcesGrouped=[]}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}ngOnChanges(){(null!==this.profitabilityResources||void 0!==this.profitabilityResources)&&(this.profitabilityResourcesGrouped=this.profitabilityResourceGroupService.getProfitabilityResourcesGrouped(this.profitabilityResources,this.profitabilityResourcesFiltred,this.profitabilityResourcesSpentTotal,this.monthsCount))}buildColmnsHeader(){if((null!==this.profitabilityResources||void 0!==this.profitabilityResources)&&this.profitabilityResources.length>0){const t=this.profitabilityResources[0].monthsProfitabilityResource.length;for(let e=0;e<t;e++){this.displayedColumns.push("M"+e);const t=this.profitabilityResources[0].monthsProfitabilityResource[this.getMonthIndex(e)].month-1,i=this.profitabilityResources[0].monthsProfitabilityResource[this.getMonthIndex(e)].year;isNaN(t)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[t]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}}getMonthIndex(t){return Math.floor(t)}getMonthDetailsIndex(t){return Math.floor(t/this.displayedSubColumnsNamesCount)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityResource[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityResource[n].spentMonthLoad,1);case 1:return this.numberFormatter.round(e.monthsProfitabilityResource[n].invoicedMonthLoad,1);case 2:return this.getResourceProjectLoadProductivity(e,n)}}getTotalSubColumnValue(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityResource[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityResource[n].spentMonthLoad,1);case 1:return this.numberFormatter.round(e.monthsProfitabilityResource[n].invoicedMonthLoad,1);case 2:return this.getResourceLoadProductivity(e,n)}}getTotalSubColumnValueByCost(t,e){const i=t%this.displayedSubColumnsNamesCount,n=Math.floor(t/this.displayedSubColumnsNamesCount);if(void 0!==e.monthsProfitabilityResource[n])switch(i){case 0:return this.numberFormatter.round(e.monthsProfitabilityResource[n].spentMonthAmount,1);case 1:return this.numberFormatter.round(e.monthsProfitabilityResource[n].achivedMonthCost,1);case 2:return this.getResourceCostProductivity(e,n)}}getResourceCostProductivity(t,e){if(2===t.level){const i=t.monthsProfitabilityResource[e].achivedMonthCost,n=t.monthsProfitabilityResource[e].spentMonthAmount;return void 0!==n&&0!==n&&void 0!==i?this.numberFormatter.round(100*(i/n-1),1):"N/A"}if(1===t.level)return"-"}getResourceLoadProductivity(t,e){if(2===t.level){const i=t.monthsProfitabilityResource[e].spentMonthLoadNotLeave,n=t.monthsProfitabilityResource[e].invoicedMonthLoad;return void 0!==i&&0!==i&&void 0!==n?this.numberFormatter.round(n/i*100,1):"N/A"}if(1===t.level)return"-"}getResourceProjectLoadProductivity(t,e){const i=t.monthsProfitabilityResource[e].spentMonthLoad,n=t.monthsProfitabilityResource[e].invoicedMonthLoad;return void 0!==i&&0!==i&&void 0!==n?this.numberFormatter.round(n/i*100,1):"N/A"}dateOnly(t){return this.dateTimeService.dateOnly(t)}datePipe(t){return"0001-01-01T00:00:00"===t?"":t}format(t){return 0===t?"":t}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(h.Bt),c.\u0275\u0275directiveInject(p.Cv),c.\u0275\u0275directiveInject(rt.e))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-resource"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},inputs:{profitabilityResources:"profitabilityResources",profitabilityResourcesFiltred:"profitabilityResourcesFiltred",profitabilityResourcesSpentTotal:"profitabilityResourcesSpentTotal",monthsCount:"monthsCount"},features:[c.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center; border-bottom: 1px solid #c8cecf;",4,"ngFor","ngForOf"],[2,"text-align","center","border-bottom","1px solid #c8cecf"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],[1,"td-third",2,"width","15%","color","rgb(0, 184, 83)",3,"matTooltip"],[1,"td-third",2,"width","15%","color","rgb(255, 81, 0)",3,"matTooltip"],[1,"td-third",2,"width","15%",3,"matTooltip"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0),c.\u0275\u0275element(1,"caption",1),c.\u0275\u0275elementStart(2,"thead",2),c.\u0275\u0275elementStart(3,"tr",3),c.\u0275\u0275elementStart(4,"th",4),c.\u0275\u0275text(5,"Activity / Resource / Project"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(6,ke,2,2,"th",5),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(7,"tr",6),c.\u0275\u0275template(8,Le,2,1,"th",7),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(9,li,8,7,"tbody",8),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(6),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders),c.\u0275\u0275advance(2),c.\u0275\u0275property("ngForOf",e.displayedSubColumns),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.profitabilityResourcesGrouped))},directives:[n.NgForOf,n.NgIf,D.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em;text-align:center}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t})();function ci(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275elementStart(1,"h1"),c.\u0275\u0275text(2,"No Result Found"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function hi(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",28),c.\u0275\u0275elementStart(1,"div",29),c.\u0275\u0275elementStart(2,"div",30),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275elementStart(4,"div",31),c.\u0275\u0275element(5,"mat-spinner"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function mi(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",32),c.\u0275\u0275element(1,"app-resource",33),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("profitabilityResources",c.\u0275\u0275pipeBind3(2,6,t.profitabilityResources,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("profitabilityResourcesFiltred",t.profitabilityResources)("profitabilityResourcesSpentTotal",t.profitabilityResourcesSpentTotal)("monthsCount",t.monthsCount)}}let pi=(()=>{class t{constructor(t){this.emptyResult=!1,this.profitabilityResourcesGrouped=[],this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new p.nJ,this.paginatorPipe=new ot.Ry(this.searchFilterService),this.subscription=new nt.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent MD","Spent \u20ac","Invoiced MD","Invoiced \u20ac","Productivity MD %","Productivity \u20ac %"],this.dialog=t.get(it.uw),this.sortService=t.get(p.Kx),this.searchFilterService=t.get(p.nJ),this.excelService=t.get(p.xB),this.profitabilityResourceService=t.get(h.LH),this.profitabilityResourceGroupService=t.get(h.Bt),this.projectService=t.get(m.Y4),this.dateTimeService=t.get(p.Cv),this.numberFormatter=t.get(rt.e),this.notificationService=t.get(p.gq)}ngOnInit(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===s.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.profitabilityResourceService.reloadProfitabilityResource.subscribe(t=>{const e=JSON.parse(sessionStorage.getItem("profitabilityResourceSearch")),i=e.selectedActivitiesIdentifiers.map(t=>t.id).join(",");this.getProfitabilityResource(i,e.profitabilityResourceStartDate,e.profitabilityResourceEndDate)})),this.profitabilityResourcesLength=0,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}))}ngOnDestroy(){this.subscription.unsubscribe()}onResetActivity(){this.selectedActivitiesIdentifiers=[]}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t,this.setSearchFilter())})}setSearchFilter(){const t=JSON.parse(sessionStorage.getItem("profitabilityResourceSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),null!=t.profitabilityResourceStartDate&&(this.profitabilityResourceStartDate=new Date(t.profitabilityResourceStartDate),this.minDate=this.profitabilityResourceStartDate),null!=t.profitabilityResourceEndDate&&(this.profitabilityResourceEndDate=new Date(t.profitabilityResourceEndDate),this.maxDate=this.profitabilityResourceEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId);const t=this.dateTimeService.today();this.profitabilityResourceStartDate=st([t.getFullYear(),t.getMonth()]).toDate(),this.profitabilityResourceEndDate=st(t).endOf("month").toDate(),this.minDate=this.profitabilityResourceStartDate,this.maxDate=this.profitabilityResourceEndDate}}searchProfitabilityResource(){this.searchFilterService.pageIndex=0,this.profitabilityResources=[],this.profitabilityResourcesLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.emptyResult=!0,this.listView=!1;const t=new d.W_;t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.profitabilityResourceStartDate=this.profitabilityResourceStartDate,t.profitabilityResourceEndDate=this.profitabilityResourceEndDate,sessionStorage.setItem("profitabilityResourceSearch",JSON.stringify(t)),this.computeStartMonthandYear(),this.getProfitabilityResource(this.selectedActivitiesIds,this.profitabilityResourceStartDate,this.profitabilityResourceEndDate)}getProfitabilityResource(t,e,i){this.isLoading=!0,this.profitabilityResourceService.getProfitabilityResource(t,e,i).subscribe(n=>{null!=n&&this.profitabilityResourceService.getProfitabilityResourceSpentTotal(t,e,i).subscribe(t=>{if(this.isLoading=!1,this.profitabilityResourcesSpentTotal=t,this.prepareProfitabilityResources(n),this.profitabilityResourcesLength=this.profitabilityResources.length,this.emptyResult=!1,this.listView=!0,0===this.profitabilityResources.length)this.emptyResult=!0;else{const t=this.profitabilityResourceGroupService.getProfitabilityResourcesGrouped(this.profitabilityResources,this.profitabilityResources,this.profitabilityResourcesSpentTotal,this.monthsCount);this.profitabilityResourcesGrouped=JSON.parse(JSON.stringify(t)),this.emptyResult=!1}},()=>{this.isLoading=!1,this.notificationService.danger("Profitability resource not loaded.")})},()=>{this.isLoading=!1,this.notificationService.danger("Profitability resource not loaded.")})}prepareProfitabilityResources(t){t.forEach(t=>{const e=this.profitabilityResources.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId&&e.userId===t.userId);if(-1!==e)this.profitabilityResources[e]=this.prepareProfitabilityResource(this.profitabilityResources[e],t);else{const e=this.createProfitabilityResource(this.startMonth,this.startYear,this.monthsCount);this.profitabilityResources.push(this.prepareProfitabilityResource(e,t))}})}computeStartMonthandYear(){this.startMonth=this.profitabilityResourceStartDate.getMonth(),this.startYear=this.profitabilityResourceStartDate.getFullYear(),this.computeMonthsCount()}computeMonthsCount(){this.monthsCount=12*(this.profitabilityResourceEndDate.getFullYear()-this.profitabilityResourceStartDate.getFullYear()),this.monthsCount-=this.profitabilityResourceStartDate.getMonth(),this.monthsCount+=this.profitabilityResourceEndDate.getMonth()+1}prepareProfitabilityResource(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=e.projectName,t.projectActivityId=e.projectActivityId,t.userId=e.userId,t.userIdentifier=e.userIdentifier,t.userNumber=e.userNumber,t.fullName=e.fullName;const i=t.monthsProfitabilityResource.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsProfitabilityResource[i].spentMonthLoad=this.numberFormatter.round(e.spentMonthLoad,1),t.monthsProfitabilityResource[i].spentMonthLoadNotLeave=this.numberFormatter.round(e.spentMonthLoad,1),t.monthsProfitabilityResource[i].invoicedMonthLoad=e.invoicedMonthLoad,t.monthsProfitabilityResource[i].achivedMonthCost=e.achivedMonthCost),t}createProfitabilityResource(t,e,i){const n=new d.ud(i);for(let o=0;o<i;o++)t+o<12?(n.monthsProfitabilityResource[o].month=t+o+1,n.monthsProfitabilityResource[o].year=e):(n.monthsProfitabilityResource[o].month=t+o+1-12,n.monthsProfitabilityResource[o].year=e+1);return n}exportToExcel(){if(void 0!==this.profitabilityResources&&0!==this.profitabilityResources.length){const t=[],e=[],i=this.subColumnsNames.length,n=[],o=[];t.push({header:"",key:"A",width:25}),t.push({header:"",key:"B",width:8}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});let r=["Activity","Matricule","Resource","Project"];o.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityResourcesGrouped[0].monthsProfitabilityResource.forEach(e=>{this.subColumnsNames.forEach(i=>{t.push({header:void 0!==e.month?this.monthNames[e.month-1].toString()+" "+e.year.toString():"Total",key:i+e.monthIndex,width:20}),r.push(i)}),n.push(this.getExcelColumn(5+i*e.monthIndex)+"1:"+this.getExcelColumn(4+i*(e.monthIndex+1))+"1"),o.push({cell:this.getExcelColumn(5+i*e.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});let a=0;this.subColumnsNames.forEach(()=>{o.push({cell:this.getExcelColumn(5+i*e.monthIndex+a)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),a++})}),e.push(r),this.profitabilityResourcesGrouped.forEach(t=>{r=[],r.push(t.activityName),r.push(t.userNumber),r.push(t.fullName),r.push(t.projectName),t.monthsProfitabilityResource.forEach(e=>{r.push(this.formatNullOrEmptyValue(e.spentMonthLoad)),1===t.level||2===t.level?(r.push(this.formatNullOrEmptyValue(e.spentMonthAmount)),r.push(this.formatNullOrEmptyValue(e.invoicedMonthLoad)),r.push(this.formatNullOrEmptyValue(e.achivedMonthCost)),r.push(this.getResourceProjectLoadProductivity(t.level,e)),r.push(this.getResourceProjectCostProductivity(t.level,e))):(r.push("-"),r.push(this.formatNullOrEmptyValue(e.invoicedMonthLoad)),r.push("-"),r.push(this.getResourceProjectLoadProductivity(t.level,e)),r.push("-"))}),e.push(r)}),this.excelService.generateExcel(t,e,n,o,"Profitability_Resource")}}formatNullOrEmptyValue(t){return""===t||null===t?0:t}getResourceProjectLoadProductivity(t,e){if(1!==t){if(void 0!==e.spentMonthLoadNotLeave&&0!==e.spentMonthLoadNotLeave&&void 0!==e.invoicedMonthLoad){if(2===t)return this.numberFormatter.round(e.invoicedMonthLoad/e.spentMonthLoadNotLeave*100,1);const i=e.spentMonthLoad,n=e.invoicedMonthLoad;if(void 0!==i&&0!==i&&void 0!==n)return this.numberFormatter.round(n/i*100,1)}return"N/A"}return"-"}getResourceProjectCostProductivity(t,e){if(2===t){const t=e.achivedMonthCost,i=e.spentMonthAmount;return void 0!==i&&0!==i&&void 0!==t?this.numberFormatter.round(100*(t/i-1),1):"N/A"}if(1===t)return"-"}getExcelColumn(t){const e=26,i=t%e==0?Math.floor(t/e)-1:Math.floor(t/e),n=t%e==0?e:t%e;return t<=e?String.fromCharCode(n+64):String.fromCharCode(i+64)+String.fromCharCode(n+64)}dateFormat(t){return null==t||"0001-01-01T00:00:00"===t?"":this.dateTimeService.getShortFormat(t)}dateOnly(t){return this.dateTimeService.dateOnly(t)}daysChangePeriodFrom(t){const e=new Date(t);this.profitabilityResourceStartDate=st([e.getFullYear(),e.getMonth()]).toDate(),this.minDate=this.profitabilityResourceStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityResourceEndDate=st([e.getFullYear(),e.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityResourceEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}daysChangePeriodTo(t){const e=new Date(t);this.profitabilityResourceEndDate=st(e).endOf("month").toDate(),this.maxDate=this.profitabilityResourceEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityResourceStartDate=st([e.getFullYear(),e.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityResourceStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}openProfitabilityResourceLegend(){this.uploadDialogRef=this.dialog.open(Re,{disableClose:!1,panelClass:"form_modal",width:"750px",height:"390px",hasBackdrop:!0,data:{}})}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(c.Injector))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-resource"]],decls:42,vars:15,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityResources","profitabilityResourcesFiltred","profitabilityResourcesSpentTotal","monthsCount"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Period"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-select-month",8),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodFrom(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"div",7),c.\u0275\u0275elementStart(14,"app-select-month",9),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodTo(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"div",5),c.\u0275\u0275elementStart(16,"mat-list"),c.\u0275\u0275elementStart(17,"mat-list-item"),c.\u0275\u0275elementStart(18,"h3",6),c.\u0275\u0275text(19,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"div",10),c.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),c.\u0275\u0275listener("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(22,"div",12),c.\u0275\u0275elementStart(23,"div",13),c.\u0275\u0275elementStart(24,"div",14),c.\u0275\u0275elementStart(25,"button",15),c.\u0275\u0275listener("click",function(){return e.searchProfitabilityResource()}),c.\u0275\u0275text(26,"Search"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(27,"nav",16),c.\u0275\u0275elementStart(28,"div",17),c.\u0275\u0275elementStart(29,"button",18),c.\u0275\u0275listener("click",function(){return e.exportToExcel()}),c.\u0275\u0275element(30,"em",19),c.\u0275\u0275text(31," Export "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(32,"button",18),c.\u0275\u0275listener("click",function(){return e.openProfitabilityResourceLegend()}),c.\u0275\u0275element(33,"em",20),c.\u0275\u0275text(34," Legend "),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(35,"div",21),c.\u0275\u0275element(36,"app-paginator",22),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(37,ci,3,0,"div",23),c.\u0275\u0275elementStart(38,"div",24),c.\u0275\u0275elementStart(39,"div",25),c.\u0275\u0275template(40,hi,6,0,"div",26),c.\u0275\u0275template(41,mi,3,10,"div",27),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("selectedDate",e.profitabilityResourceStartDate)("maxDate",e.maxDate),c.\u0275\u0275advance(2),c.\u0275\u0275property("selectedDate",e.profitabilityResourceEndDate)("minDate",e.minDate),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("settings",e.dropdownSettings)("disabled",!e.isSuperAdmin),c.\u0275\u0275advance(15),c.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.profitabilityResourcesLength),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngIf",e.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult))},directives:[u.i$,u.Tg,lt.j,r.OP,y.NgControlStatus,y.NgModel,C.M2,I.J,n.NgIf,j.$g,di],pipes:[Z.R],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.multi-search[_ngcontent-%COMP%]{width:100%}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;justify-items:center}#loader[_ngcontent-%COMP%]{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}"]}),t})();function ui(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"th",6),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(t)," ")}}function fi(t,e){1&t&&c.\u0275\u0275element(0,"td",14)}function gi(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",10),c.\u0275\u0275elementStart(1,"td",11),c.\u0275\u0275elementStart(2,"span",12),c.\u0275\u0275text(3),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(4,fi,1,0,"td",13),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(3),c.\u0275\u0275textInterpolate1(" ",t.activityName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders)}}function yi(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",14),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext(2).$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate(n.getTotalColumnValue(t,i))}}function vi(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr",15),c.\u0275\u0275elementStart(1,"td",16),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,yi,2,1,"td",13),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.userIdentifier,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.userIdentifier," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders)}}function bi(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"td",14),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()),2&t){const t=e.index,i=c.\u0275\u0275nextContext(2).$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate(n.getColumnValue(t,i))}}function Si(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",17),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,bi,2,1,"td",13),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders)}}function xi(t,e){if(1&t){const t=c.\u0275\u0275getCurrentView();c.\u0275\u0275elementStart(0,"td",20),c.\u0275\u0275listener("blur",function(e){const i=c.\u0275\u0275restoreView(t).index,n=c.\u0275\u0275nextContext(2).$implicit;return c.\u0275\u0275nextContext().submitWorkload(i,n,e)}),c.\u0275\u0275text(1),c.\u0275\u0275elementEnd()}if(2&t){const t=e.index,i=c.\u0275\u0275nextContext(2).$implicit,n=c.\u0275\u0275nextContext();c.\u0275\u0275attribute("contenteditable",n.isEditable(i.projectId)),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate(n.getColumnValue(t,i))}}function Ci(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tr"),c.\u0275\u0275elementStart(1,"td",18),c.\u0275\u0275text(2),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(3,xi,2,2,"td",19),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext().$implicit,e=c.\u0275\u0275nextContext();c.\u0275\u0275advance(1),c.\u0275\u0275propertyInterpolate1("matTooltip"," ",t.projectName,""),c.\u0275\u0275advance(1),c.\u0275\u0275textInterpolate1(" ",t.projectName," "),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders)}}function Ii(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"tbody"),c.\u0275\u0275template(1,gi,5,2,"tr",7),c.\u0275\u0275template(2,vi,4,3,"tr",8),c.\u0275\u0275template(3,Si,4,3,"tr",9),c.\u0275\u0275template(4,Ci,4,3,"tr",9),c.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",1==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",2==t.level),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level&&null===t.projectActivityId),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",null==t.level&&null!==t.projectActivityId)}}let Pi=(()=>{class t{constructor(t,e,i,n,o){this.dialog=t,this.notificationService=e,this.invoicedWorkloadService=i,this.invoicedWorkloadGroupService=n,this.dateTimeService=o,this.previousState={getPrevious:!1,pageIndex:null,pageSize:null},this.subscription=new nt.w0,this.displayedColumns=["userIdentifier"],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.invoicedWorkloadsGrouped=[]}ngOnInit(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColumnsHeader(),this.listView=!0}ngOnChanges(){this.reloadWorkloads()}buildColumnsHeader(){if((null!==this.invoicedWorkloads||void 0!==this.invoicedWorkloads)&&this.invoicedWorkloads.length>0){const t=this.invoicedWorkloads[0].monthsInvoicedWorkload.length;for(let e=0;e<t;e++){this.displayedColumns.push("M"+e);const t=this.invoicedWorkloads[0].monthsInvoicedWorkload[this.getMonthIndex(e)].month-1,i=this.invoicedWorkloads[0].monthsInvoicedWorkload[this.getMonthIndex(e)].year;this.monthColumnsHeaders.push(this.monthNames[t]+i)}}}getMonthIndex(t){return Math.floor(t)}getColumnHeader(t){return this.monthColumnsHeaders[t]}getColumnValue(t,e){if(e.monthsInvoicedWorkload[t]&&e.monthsInvoicedWorkload[t].invoicedMonthLoad)return this.format(e.monthsInvoicedWorkload[t].invoicedMonthLoad)}getTotalColumnValue(t,e){if(e.monthsInvoicedWorkload[t])return e.monthsInvoicedWorkload[t].invoicedMonthLoad}dateOnly(t){return this.dateTimeService.dateOnly(t)}datePipe(t){return"0001-01-01T00:00:00"===t?"":t}format(t){return 0===t?"":t}submitWorkload(t,e,i){const n=Number(i.target.textContent);if(void 0!==n){const o=e.monthsInvoicedWorkload[t].workloadId;0!==n?(this.insertOrUpdateWorkload(t,e,n),i.target.textContent=n):(i.target.textContent="",0!==o&&this.deleteWorkload(t,e,n))}}isEditable(t){return null!=t}insertOrUpdateWorkload(t,e,i){if(i!==e.monthsInvoicedWorkload[t].invoicedMonthLoad){e.monthsInvoicedWorkload[t].invoicedMonthLoad=i;const n=e.monthsInvoicedWorkload[t].month-1,o=e.monthsInvoicedWorkload[t].year,r=new d.X5;r.workloadId=e.monthsInvoicedWorkload[t].workloadId,r.userId=e.userId,r.workloadStartDate=new Date(o,n,1),r.workloadEndDate=new Date(o,n+1,0),r.budgetedWorkload=i,r.projectId=e.projectId,this.invoicedWorkloadService.insertOrUpdateWorkload(r).subscribe(i=>{0!==i?(e.monthsInvoicedWorkload[t].workloadId=i,this.reloadWorkloads()):this.notificationService.danger("Workload not saved. Workload may already exist, please refresh your screen.")},()=>{this.notificationService.danger("Workload not saved, please refresh your screen.")})}}deleteWorkload(t,e,i){const n=e.monthsInvoicedWorkload[t].workloadId;e.monthsInvoicedWorkload[t].invoicedMonthLoad=i,this.invoicedWorkloadService.deleteWorkload(n).subscribe(i=>{0!==i?(e.monthsInvoicedWorkload[t].workloadId=0,this.reloadWorkloads()):this.notificationService.danger("Workload not deleted. Workload may already deleted, please refresh your screen.")},()=>{this.notificationService.danger("Workload not deleted, please refresh your screen.")})}reloadWorkloads(){(null!==this.invoicedWorkloads||void 0!==this.invoicedWorkloads)&&(this.invoicedWorkloadsGrouped=this.invoicedWorkloadGroupService.getInvoicedWorkloadsGrouped(this.invoicedWorkloads,this.invoicedWorkloadsFiltred,this.monthsCount))}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(it.uw),c.\u0275\u0275directiveInject(p.gq),c.\u0275\u0275directiveInject(h.Iv),c.\u0275\u0275directiveInject(h.UN),c.\u0275\u0275directiveInject(p.Cv))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-workload"]],viewQuery:function(t,e){if(1&t&&c.\u0275\u0275viewQuery(dt.YE,7),2&t){let t;c.\u0275\u0275queryRefresh(t=c.\u0275\u0275loadQuery())&&(e.sort=t.first)}},inputs:{invoicedWorkloads:"invoicedWorkloads",invoicedWorkloadsFiltred:"invoicedWorkloadsFiltred",monthsCount:"monthsCount"},features:[c.\u0275\u0275NgOnChangesFeature],decls:8,vars:2,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],["scope","col",1,"th-first"],["id","monthHeader",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[1,"td-third",2,"width","15%","color","red",3,"matTooltip"],[1,"td-third",2,"width","15%",3,"matTooltip"],["style","text-align: center;","onfocus","this.className='focused'","onfocusout","this.className='notFocused'",3,"blur",4,"ngFor","ngForOf"],["onfocus","this.className='focused'","onfocusout","this.className='notFocused'",2,"text-align","center",3,"blur"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"table",0),c.\u0275\u0275element(1,"caption",1),c.\u0275\u0275elementStart(2,"thead",2),c.\u0275\u0275elementStart(3,"tr"),c.\u0275\u0275elementStart(4,"th",3),c.\u0275\u0275text(5,"Activity / Resource / Project"),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(6,ui,2,1,"th",4),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(7,Ii,5,4,"tbody",5),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(6),c.\u0275\u0275property("ngForOf",e.monthColumnsHeaders),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngForOf",e.invoicedWorkloadsGrouped))},directives:[n.NgForOf,n.NgIf,D.gM],styles:["thead[_ngcontent-%COMP%]   th.th-first[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}.focused[_ngcontent-%COMP%]{border:2px solid #131212;text-align:center}"]}),t})();function Ei(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div"),c.\u0275\u0275elementStart(1,"h1"),c.\u0275\u0275text(2,"No Result Found"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function Mi(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",24),c.\u0275\u0275elementStart(1,"div",25),c.\u0275\u0275elementStart(2,"div",26),c.\u0275\u0275elementStart(3,"div",1),c.\u0275\u0275elementStart(4,"div",27),c.\u0275\u0275element(5,"mat-spinner"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd())}function Ai(t,e){if(1&t&&(c.\u0275\u0275elementStart(0,"div",28),c.\u0275\u0275element(1,"app-workload",29),c.\u0275\u0275pipe(2,"paginator"),c.\u0275\u0275elementEnd()),2&t){const t=c.\u0275\u0275nextContext();c.\u0275\u0275classProp("blurred",t.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("invoicedWorkloads",c.\u0275\u0275pipeBind3(2,5,t.invoicedWorkloads,t.searchFilterService.pageIndex,t.searchFilterService.pageSize))("invoicedWorkloadsFiltred",t.invoicedWorkloads)("monthsCount",t.monthsCount)}}const ji=[{path:"",data:{title:"Indicators",status:!1},canActivate:[l.a1],children:[{path:"load-plan",component:et,data:{title:"Workload Plan",icon:"icon-home",function:s.FI.LoadPlan,status:!0},canActivate:[l.a1]},{path:"profitability-activity",component:ae,data:{title:"Profitability Activity",icon:"icon-home",function:s.FI.ProfitabilityActivity,status:!0},canActivate:[l.a1]},{path:"profitability-resource",component:pi,data:{title:"Profitability Resource",icon:"icon-home",function:s.FI.ProfitabilityResource,status:!0},canActivate:[l.a1]},{path:"invoiced-workload",component:(()=>{class t{constructor(t){this.emptyResult=!1,this.invoicedWorkloadsLength=0,this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new p.nJ,this.paginatorPipe=new ot.Ry(this.searchFilterService),this.subscription=new nt.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.searchFilterService=t.get(p.nJ),this.invoicedWorkloadService=t.get(h.Iv),this.projectService=t.get(m.Y4),this.dateTimeService=t.get(p.Cv),this.notificationService=t.get(p.gq)}ngOnInit(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===s.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!0,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!1,allowSearchFilter:!1,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.searchFilterService.resultChanged.subscribe(()=>{setTimeout(()=>{this.emptyResult=0===this.searchFilterService.showingDataLastFilter.length})}))}ngOnDestroy(){this.subscription.unsubscribe()}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t,this.setSearchFilter())})}setSearchFilter(){const t=JSON.parse(sessionStorage.getItem("invoicedWorkloadSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),null!=t.invoicedWorkloadStartDate&&(this.invoicedWorkloadStartDate=new Date(t.invoicedWorkloadStartDate),this.minDate=this.invoicedWorkloadStartDate),null!=t.invoicedWorkloadEndDate&&(this.invoicedWorkloadEndDate=new Date(t.invoicedWorkloadEndDate),this.maxDate=this.invoicedWorkloadEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId);const t=this.dateTimeService.today();t.getMonth()<6?(this.invoicedWorkloadStartDate=st([t.getFullYear(),0]).toDate(),this.invoicedWorkloadEndDate=st([t.getFullYear(),5]).toDate()):(this.invoicedWorkloadStartDate=st([t.getFullYear(),6]).toDate(),this.invoicedWorkloadEndDate=st([t.getFullYear(),11]).toDate()),this.minDate=this.invoicedWorkloadStartDate,this.maxDate=this.invoicedWorkloadEndDate}}searchInvoicedWorkload(){this.searchFilterService.pageIndex=0,this.invoicedWorkloads=[],this.invoicedWorkloadsLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.emptyResult=!0,this.listView=!1;const t=new d.Zs;t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.invoicedWorkloadStartDate=this.invoicedWorkloadStartDate,t.invoicedWorkloadEndDate=this.invoicedWorkloadEndDate,sessionStorage.setItem("invoicedWorkloadSearch",JSON.stringify(t)),this.computeStartMonthandYear(),this.getInvoicedWorkload(this.selectedActivitiesIds,this.invoicedWorkloadStartDate,this.invoicedWorkloadEndDate)}getInvoicedWorkload(t,e,i){this.isLoading=!0,this.invoicedWorkloadService.getInvoicedWorkload(t,e,i).subscribe(t=>{null!=t&&(this.isLoading=!1,this.prepareInvoicedWorkloads(t),this.invoicedWorkloadsLength=this.invoicedWorkloads.length,0!==this.invoicedWorkloadsLength&&(this.emptyResult=!1,this.listView=!0))},()=>{this.isLoading=!1,this.notificationService.danger("Workload not loaded.")})}prepareInvoicedWorkloads(t){t.forEach(t=>{const e=this.invoicedWorkloads.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId&&e.userId===t.userId);if(-1!==e)this.invoicedWorkloads[e]=this.prepareInvoicedWorkload(this.invoicedWorkloads[e],t);else{const e=this.createInvoicedWorkload(this.startMonth,this.startYear,this.monthsCount);this.invoicedWorkloads.push(this.prepareInvoicedWorkload(e,t))}})}computeStartMonthandYear(){this.startMonth=this.invoicedWorkloadStartDate.getMonth(),this.startYear=this.invoicedWorkloadStartDate.getFullYear(),this.monthsCount=this.computeMonthsCount()}computeMonthsCount(){let t;return t=12*(this.invoicedWorkloadEndDate.getFullYear()-this.invoicedWorkloadStartDate.getFullYear()),t-=this.invoicedWorkloadStartDate.getMonth(),t+=this.invoicedWorkloadEndDate.getMonth()+1,t}prepareInvoicedWorkload(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=null===e.projectName?"No Recurrent Projects":e.projectName,t.projectActivityId=e.projectActivityId,t.userId=e.userId,t.userIdentifier=e.userIdentifier;const i=t.monthsInvoicedWorkload.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsInvoicedWorkload[i].invoicedMonthLoad=e.invoicedMonthLoad,t.monthsInvoicedWorkload[i].workloadId=e.workloadId),t}createInvoicedWorkload(t,e,i){const n=new d.SP(i);for(let o=0;o<i;o++)t+o<12?(n.monthsInvoicedWorkload[o].month=t+o+1,n.monthsInvoicedWorkload[o].year=e):(n.monthsInvoicedWorkload[o].month=t+o+1-12,n.monthsInvoicedWorkload[o].year=e+1);return n}daysChangePeriodFrom(t){const e=new Date(t);this.invoicedWorkloadStartDate=st(e).startOf("month").toDate(),this.minDate=this.invoicedWorkloadStartDate,this.computeMonthsCount()>12&&(this.invoicedWorkloadEndDate=st([e.getFullYear(),e.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.invoicedWorkloadEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}daysChangePeriodTo(t){const e=new Date(t);this.invoicedWorkloadEndDate=st(e).endOf("month").toDate(),this.maxDate=this.invoicedWorkloadEndDate,this.computeMonthsCount()>12&&(this.invoicedWorkloadStartDate=st([e.getFullYear(),e.getMonth()]).add(-11,"months").startOf("month").toDate(),this.minDate=this.invoicedWorkloadStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}onActivityDeSelect(t){this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(e=>e.id===t.id)}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(c.Injector))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-invoiced-workload"]],decls:35,vars:15,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","settings","data","ngModel","disabled","onDeSelect","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"col-sm-12"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"invoicedWorkloads","invoicedWorkloadsFiltred","monthsCount"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Period"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-select-month",8),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodFrom(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"div",7),c.\u0275\u0275elementStart(14,"app-select-month",9),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodTo(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(15,"div",5),c.\u0275\u0275elementStart(16,"mat-list"),c.\u0275\u0275elementStart(17,"mat-list-item"),c.\u0275\u0275elementStart(18,"h3",6),c.\u0275\u0275text(19,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(20,"div",10),c.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),c.\u0275\u0275listener("onDeSelect",function(t){return e.onActivityDeSelect(t)})("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(22,"div",12),c.\u0275\u0275elementStart(23,"div",13),c.\u0275\u0275elementStart(24,"div",14),c.\u0275\u0275elementStart(25,"button",15),c.\u0275\u0275listener("click",function(){return e.searchInvoicedWorkload()}),c.\u0275\u0275text(26,"Search"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(27,"nav",16),c.\u0275\u0275elementStart(28,"div",17),c.\u0275\u0275element(29,"app-paginator",18),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275template(30,Ei,3,0,"div",19),c.\u0275\u0275elementStart(31,"div",20),c.\u0275\u0275elementStart(32,"div",21),c.\u0275\u0275template(33,Mi,6,0,"div",22),c.\u0275\u0275template(34,Ai,3,9,"div",23),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("selectedDate",e.invoicedWorkloadStartDate)("maxDate",e.maxDate),c.\u0275\u0275advance(2),c.\u0275\u0275property("selectedDate",e.invoicedWorkloadEndDate)("minDate",e.minDate),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("settings",e.dropdownSettings)("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers)("disabled",!e.isSuperAdmin),c.\u0275\u0275advance(8),c.\u0275\u0275property("pageSize",e.searchFilterService.pageSize)("pageIndex",e.searchFilterService.pageIndex)("length",e.invoicedWorkloadsLength),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.emptyResult&&e.listView),c.\u0275\u0275advance(3),c.\u0275\u0275property("ngIf",e.isLoading),c.\u0275\u0275advance(1),c.\u0275\u0275property("ngIf",e.listView&&!e.emptyResult))},directives:[u.i$,u.Tg,lt.j,r.OP,y.NgControlStatus,y.NgModel,C.M2,I.J,n.NgIf,j.$g,Pi],pipes:[Z.R],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.multi-search[_ngcontent-%COMP%]{width:100%}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;justify-items:center}#loader[_ngcontent-%COMP%]{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}"]}),t})(),data:{title:"Invoiced Workload",icon:"icon-home",function:s.FI.InvoicedWorkload,status:!0},canActivate:[l.a1]},{path:"profitability-project",component:De,data:{title:"Profitability Project",icon:"icon-home",function:s.FI.ProfitabilityProject,status:!0},canActivate:[l.a1]},{path:"analytics-reports",component:(()=>{class t{constructor(t){this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.analyticsResourcesGrouped=[],this.analyticsResourcesProjectsGrouped=[],this.analyticsProjectsGrouped=[],this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.projectsIdentifiers=[],this.subColumnsNames=["Price \u20ac","Invoiced MD","Invoiced \u20ac"],this.projectService=t.get(m.Y4),this.analyticsReportsService=t.get(h.n9),this.analyticsResourceGroupService=t.get(h.Rr),this.analyticsResourceProjectGroupService=t.get(h.GF),this.analyticsProjectGroupService=t.get(h.Sm),this.dateTimeService=t.get(p.Cv),this.excelService=t.get(p.xB)}ngOnInit(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.getActivities(),this.dropdownSettings={singleSelection:!0,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!1,allowSearchFilter:!1,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."}}getActivities(){this.projectService.getActivities().subscribe(t=>{null!=t&&(this.activitiesIdentifiers=t),this.setSearchFilter()})}setSearchFilter(){this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(t=>t.id===this.currentUser.activityId);const t=this.dateTimeService.today(),e=st([t.getFullYear(),t.getMonth()]).subtract(1,"months").toDate();this.daysChangePeriodTo(e)}daysChangePeriodTo(t){const e=new Date(t);this.analyticsReportsStartDate=st(e).startOf("year").toDate(),this.analyticsReportsEndDate=st(e).endOf("month").toDate()}onActivityDeSelect(t){this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(e=>e.id===t.id)}exportAnalyticsReports(){this.analyticsResources=[],this.analyticsResourcesProjects=[],this.analyticsProjects=[],this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(t=>t.id).join(","),this.computeStartMonthAndYear(),this.getAnalyticsReports(this.selectedActivitiesIds,this.analyticsReportsStartDate,this.analyticsReportsEndDate)}computeStartMonthAndYear(){this.startMonth=this.analyticsReportsStartDate.getMonth(),this.startYear=this.analyticsReportsStartDate.getFullYear(),this.computeMonthsCount()}computeMonthsCount(){this.monthsCount=12*(this.analyticsReportsEndDate.getFullYear()-this.analyticsReportsStartDate.getFullYear()),this.monthsCount-=this.analyticsReportsStartDate.getMonth(),this.monthsCount+=this.analyticsReportsEndDate.getMonth()+1}getAnalyticsReports(t,e,i){this.analyticsReportsService.getAnalyticsReports(t,e,i).subscribe(t=>{null!=t&&(this.buildAnalyticsResources(t),this.buildAnalyticsResourcesProjects(t),this.buildAnalyticsProjects(t),this.exportAnalyticsReportsToExcel())})}buildAnalyticsResources(t){if(this.prepareAnalyticsResources(t),void 0!==this.analyticsResources&&0!==this.analyticsResources.length){const t=this.analyticsResourceGroupService.getAnalyticsResourceGrouped(this.analyticsResources,this.analyticsResources,this.monthsCount);this.analyticsResourcesGrouped=JSON.parse(JSON.stringify(t))}}prepareAnalyticsResources(t){t.forEach(t=>{const e=this.analyticsResources.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId&&e.userId===t.userId);if(-1!==e)this.analyticsResources[e]=this.prepareAnalyticsResource(this.analyticsResources[e],t);else{const e=this.createAnalyticsResource(this.startMonth,this.startYear,this.monthsCount);this.analyticsResources.push(this.prepareAnalyticsResource(e,t))}this.getProjects(t)})}getProjects(t){t&&t.projectName&&!this.projectsIdentifiers.find(e=>e.id===t.projectId)&&this.projectsIdentifiers.push({id:t.projectId,description:t.projectName})}prepareAnalyticsResource(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=e.projectName,t.projectActivityId=e.projectActivityId,t.userId=e.userId,t.userNumber=e.userNumber,t.userFirstName=e.userFirstName,t.userLastName=e.userLastName;const i=t.monthsAnalyticsResource.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsAnalyticsResource[i].invoicedMonthPrice=e.invoicedMonthPrice,t.monthsAnalyticsResource[i].invoicedMonthLoad=e.invoicedMonthLoad,t.monthsAnalyticsResource[i].invoicedMonthAmount=e.invoicedMonthAmount,t.monthsAnalyticsResource[i].spentMonthAmount=e.spentMonthAmount),t}createAnalyticsResource(t,e,i){const n=new d.du(i);for(let o=0;o<i;o++)t+o<12?(n.monthsAnalyticsResource[o].month=t+o+1,n.monthsAnalyticsResource[o].year=e):(n.monthsAnalyticsResource[o].month=t+o+1-12,n.monthsAnalyticsResource[o].year=e+1);return n}buildAnalyticsResourcesProjects(t){if(this.projectsCount=this.projectsIdentifiers.length,this.prepareAnalyticsResourcesProjects(t),this.analyticsResourcesProjects&&0!==this.analyticsResourcesProjects.length){const t=this.analyticsResourceProjectGroupService.getAnalyticsResourceProjectGrouped(this.analyticsResourcesProjects,this.analyticsResourcesProjects,this.projectsCount);this.analyticsResourcesProjectsGrouped=JSON.parse(JSON.stringify(t))}}prepareAnalyticsResourcesProjects(t){t.forEach(t=>{const e=this.analyticsResourcesProjects.findIndex(e=>e.activityId===t.activityId&&e.userId===t.userId);if(-1!==e)this.analyticsResourcesProjects[e]=this.prepareAnalyticsResourceProject(this.analyticsResourcesProjects[e],t);else{const e=this.createAnalyticsResourceProject(this.startYear,this.projectsCount);this.analyticsResourcesProjects.push(this.prepareAnalyticsResourceProject(e,t))}})}prepareAnalyticsResourceProject(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.userId=e.userId,t.userNumber=e.userNumber,t.userFirstName=e.userFirstName,t.userLastName=e.userLastName;const i=t.projectsAnalyticsResourceProject.findIndex(t=>t.projectId===e.projectId&&t.year===e.year);return-1!==i&&(t.projectsAnalyticsResourceProject[i].invoicedProjectPrice=this.concatInvoicedResoucePrices(t.projectsAnalyticsResourceProject[i].invoicedProjectPrice,e.invoicedMonthPrice,e.invoicedMonthLoad),t.projectsAnalyticsResourceProject[i].invoicedProjectPrice=Array.from(new Set(t.projectsAnalyticsResourceProject[i].invoicedProjectPrice.split("#"))).join("#"),t.projectsAnalyticsResourceProject[i].invoicedProjectLoad+=e.invoicedMonthLoad,t.projectsAnalyticsResourceProject[i].invoicedProjectAmount+=e.invoicedMonthAmount),t}concatInvoicedResoucePrices(t,e,i){return 0!==i&&(""===t?t=e.toString():t+="#"+e),t}createAnalyticsResourceProject(t,e){const i=new d.SL(e);for(let n=0;n<e;n++)i.projectsAnalyticsResourceProject[n].projectIndex=n,i.projectsAnalyticsResourceProject[n].projectId=this.projectsIdentifiers[n].id,i.projectsAnalyticsResourceProject[n].projectName=this.projectsIdentifiers[n].description,i.projectsAnalyticsResourceProject[n].year=t;return i}buildAnalyticsProjects(t){if(this.prepareAnalyticsProjects(t),0!==this.analyticsProjects.length&&void 0!==this.analyticsProjects){const t=this.analyticsProjectGroupService.getAnalyticsProjectGrouped(this.analyticsProjects,this.analyticsProjects,this.monthsCount);this.analyticsProjectsGrouped=JSON.parse(JSON.stringify(t))}}prepareAnalyticsProjects(t){t.forEach(t=>{if(null!==t.projectId){const e=this.analyticsProjects.findIndex(e=>e.activityId===t.activityId&&e.projectId===t.projectId);if(-1!==e)this.analyticsProjects[e]=this.prepareAnalyticsProject(this.analyticsProjects[e],t);else{const e=this.createAnalyticsProject(this.startMonth,this.startYear,this.monthsCount);this.analyticsProjects.push(this.prepareAnalyticsProject(e,t))}}})}prepareAnalyticsProject(t,e){t.activityId=e.activityId,t.activityName=e.activityName,t.projectId=e.projectId,t.projectName=e.projectName,t.projectActivityId=e.projectActivityId;const i=t.monthsAnalyticsProject.findIndex(t=>t.month===e.month&&t.year===e.year);return-1!==i&&(t.monthsAnalyticsProject[i].invoicedMonthAmount+=e.invoicedMonthAmount),t}createAnalyticsProject(t,e,i){const n=new d.Ok(i);for(let o=0;o<i;o++)t+o<12?(n.monthsAnalyticsProject[o].month=t+o+1,n.monthsAnalyticsProject[o].year=e):(n.monthsAnalyticsProject[o].month=t+o+1-12,n.monthsAnalyticsProject[o].year=e+1);return n}exportAnalyticsReportsToExcel(){if(void 0!==this.analyticsResources&&0!==this.analyticsResources.length){const t="Analytics_Reports_"+this.selectedActivitiesIdentifiers[0].description+"_"+this.analyticsResourcesGrouped[0].monthsAnalyticsResource[0].year,e=[];let i=this.fillAnalyticsResoucesExcelHeaderSheet();i=this.fillAnalyticsResoucesExcelBodySheet(i),e.push(i);let n=this.fillAnalyticsResoucesProjectsExcelHeaderSheet();n=this.fillAnalyticsResoucesProjectsExcelBodySheet(n),e.push(n);let o=this.fillAnalyticsProjectsExcelHeaderSheet();o=this.fillAnalyticsProjectsExcelBodySheet(o),e.push(o),this.excelService.generateExcelMultiSheets(e,t)}}fillAnalyticsResoucesExcelHeaderSheet(){const t=[],e=[],i=[],n=[],o=this.subColumnsNames.length;let r=0;t.push({header:"",key:"A",width:8}),t.push({header:"",key:"B",width:18}),t.push({header:"",key:"C",width:18});const a=["Matricule","First Name","Last Name"];return n.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}}),this.analyticsResourcesGrouped[0].monthsAnalyticsResource.forEach(e=>{this.subColumnsNames.forEach(i=>{t.push({header:void 0!==e.month?this.monthNames[e.month-1].toString()+" "+e.year.toString():"Total",key:i+e.monthIndex,width:12}),a.push(i)}),e.month||(a.push("Int Cost \u20ac"),r=1),i.push(this.getExcelColumn(4+o*e.monthIndex)+"1:"+this.getExcelColumn(3+o*(e.monthIndex+1)+r)+"1"),n.push({cell:this.getExcelColumn(4+o*e.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),n.push({cell:this.getExcelColumn(4+o*(e.monthIndex+1))+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});let s=0;this.subColumnsNames.forEach(()=>{n.push({cell:this.getExcelColumn(4+o*e.monthIndex+s)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),s++})}),e.push(a),{header:t,rows:e,merges:i,styles:n,name:"Resources"}}fillAnalyticsResoucesExcelBodySheet(t){const e=t.rows;return this.analyticsResourcesGrouped.forEach(t=>{if(t.level){const i=[];i.push(t.userNumber),i.push(t.userLastName),i.push(t.userFirstName),t.monthsAnalyticsResource.forEach(e=>{i.push(e.invoicedMonthPrice),i.push(this.formatNullValue(e.invoicedMonthLoad,t.level)),i.push(this.formatNullValue(e.invoicedMonthAmount,t.level)),e.month||i.push(this.formatNullValue(e.spentMonthAmount,t.level))}),e.push(i)}}),t}fillAnalyticsResoucesProjectsExcelHeaderSheet(){const t=[],e=[],i=[],n=[],o=this.subColumnsNames.length;t.push({header:"",key:"A",width:8}),t.push({header:"",key:"B",width:18}),t.push({header:"",key:"C",width:18});const r=["Matricule","First Name","Last Name"];return n.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}}),this.analyticsResourcesProjectsGrouped[0].projectsAnalyticsResourceProject.forEach(e=>{this.subColumnsNames.forEach(i=>{t.push({header:void 0!==e.projectId?this.projectsIdentifiers[e.projectIndex].description.toString():"Total",key:i+e.projectIndex,width:12}),r.push(i)}),i.push(this.getExcelColumn(4+o*e.projectIndex)+"1:"+this.getExcelColumn(3+o*(e.projectIndex+1))+"1"),n.push({cell:this.getExcelColumn(4+o*e.projectIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),n.push({cell:this.getExcelColumn(4+o*(e.projectIndex+1))+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});let a=0;this.subColumnsNames.forEach(()=>{n.push({cell:this.getExcelColumn(4+o*e.projectIndex+a)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),a++})}),e.push(r),{header:t,rows:e,merges:i,styles:n,name:"ResourcesProjects"}}fillAnalyticsResoucesProjectsExcelBodySheet(t){const e=t.rows;return this.analyticsResourcesProjectsGrouped.forEach(t=>{if(t.level){const i=[];i.push(t.userNumber),i.push(t.userLastName),i.push(t.userFirstName),t.projectsAnalyticsResourceProject.forEach(e=>{i.push(e.invoicedProjectPrice),i.push(this.formatNullValue(e.invoicedProjectLoad,t.level)),i.push(this.formatNullValue(e.invoicedProjectAmount,t.level))}),e.push(i)}}),t}fillAnalyticsProjectsExcelHeaderSheet(){const t=[],e=[];return t.push({header:"Projects "+this.analyticsResourcesGrouped[0].activityName+" "+this.analyticsResourcesGrouped[0].monthsAnalyticsResource[0].year,key:"A",width:27}),e.push({cell:"A1",font:{bold:!0}}),this.analyticsResourcesGrouped[0].monthsAnalyticsResource.forEach(i=>{t.push({header:void 0!==i.month?this.monthNames[i.month-1].toString()+" "+i.year.toString():"Total",key:void 0!==i.month?this.monthNames[i.month-1].toString():"Total",width:15}),e.push({cell:this.getExcelColumn(2+i.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}})}),{header:t,rows:[],merges:[],styles:e,name:"Projects"}}fillAnalyticsProjectsExcelBodySheet(t){const e=t.rows;return this.analyticsProjectsGrouped.forEach(t=>{if(t.level){const i=[];i.push(t.projectName),t.monthsAnalyticsProject.forEach(e=>{i.push(this.formatNullValue(e.invoicedMonthAmount,t.level))}),e.push(i)}}),t}formatNullValue(t,e){return 1!==e&&null===t?0:t}getExcelColumn(t){const e=26,i=t%e==0?Math.floor(t/e)-1:Math.floor(t/e),n=t%e==0?e:t%e;return t<=e?String.fromCharCode(n+64):String.fromCharCode(i+64)+String.fromCharCode(n+64)}}return t.\u0275fac=function(e){return new(e||t)(c.\u0275\u0275directiveInject(c.Injector))},t.\u0275cmp=c.\u0275\u0275defineComponent({type:t,selectors:[["app-analytics-reports"]],decls:25,vars:5,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","settings","data","ngModel","onDeSelect","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"]],template:function(t,e){1&t&&(c.\u0275\u0275elementStart(0,"div",0),c.\u0275\u0275elementStart(1,"div",1),c.\u0275\u0275elementStart(2,"div",2),c.\u0275\u0275elementStart(3,"div",3),c.\u0275\u0275elementStart(4,"div",4),c.\u0275\u0275elementStart(5,"div",1),c.\u0275\u0275elementStart(6,"div",5),c.\u0275\u0275elementStart(7,"mat-list"),c.\u0275\u0275elementStart(8,"mat-list-item"),c.\u0275\u0275elementStart(9,"h3",6),c.\u0275\u0275text(10,"Period"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(11,"div",7),c.\u0275\u0275elementStart(12,"app-select-month",8),c.\u0275\u0275listener("daysChange",function(t){return e.daysChangePeriodTo(t)}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(13,"div",5),c.\u0275\u0275elementStart(14,"mat-list"),c.\u0275\u0275elementStart(15,"mat-list-item"),c.\u0275\u0275elementStart(16,"h3",6),c.\u0275\u0275text(17,"Activity"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementStart(18,"div",9),c.\u0275\u0275elementStart(19,"ng-multiselect-dropdown",10),c.\u0275\u0275listener("onDeSelect",function(t){return e.onActivityDeSelect(t)})("ngModelChange",function(t){return e.selectedActivitiesIdentifiers=t}),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275element(20,"div",11),c.\u0275\u0275elementStart(21,"div",12),c.\u0275\u0275elementStart(22,"div",13),c.\u0275\u0275elementStart(23,"button",14),c.\u0275\u0275listener("click",function(){return e.exportAnalyticsReports()}),c.\u0275\u0275text(24,"Export"),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd(),c.\u0275\u0275elementEnd()),2&t&&(c.\u0275\u0275advance(12),c.\u0275\u0275property("selectedDate",e.analyticsReportsEndDate),c.\u0275\u0275advance(7),c.\u0275\u0275property("placeholder","Select...")("settings",e.dropdownSettings)("data",e.activitiesIdentifiers)("ngModel",e.selectedActivitiesIdentifiers))},directives:[u.i$,u.Tg,lt.j,r.OP,y.NgControlStatus,y.NgModel],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}"]}),t})(),data:{title:"Analytics Reports",icon:"icon-home",function:s.FI.AnalyticsReports,status:!0},canActivate:[l.a1]}]}];let wi=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=c.\u0275\u0275defineInjector({imports:[[a.Bz.forChild(ji)],a.Bz]}),t})();var Di=i(36332),Ri=i(90171);let ki=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=c.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=c.\u0275\u0275defineInjector({providers:[h.VK,h.zc,p.nJ,h.LH,h.Bt,h.Iv,h.UN,h.jE,h.$M,h.n9,h.Rr,h.GF,h.Sm],imports:[[n.CommonModule,o.m,r.ZQ.forRoot(),wi,Di.o,Ri.To]]}),t})()},72172:function(t,e,i){i.d(e,{z:function(){return o}});var n=i(37716);let o=(()=>{class t{constructor(){}blockPaste(t){const e=t.clipboardData.getData("text");let i=0,n=!1;for(;i<e.length&&!0!==n;)this.isNotNumber(e[i].charCodeAt())?(n=!0,t.preventDefault()):i++}onKeydownHandler(t){const e=t.key;void 0!==e&&(this.isNotNumber(e.charCodeAt())&&"Backspace"!==e&&"Delete"!==e&&"ArrowLeft"!==e&&"ArrowRight"!==e&&"Tab"!==e&&t.preventDefault(),null!=this.inputValue&&(-1!==this.inputValue.toString().indexOf(".")||-1!==this.inputValue.toString().indexOf(","))&&(46===e.charCodeAt()||44===e.charCodeAt())&&t.preventDefault())}isNotNumber(t){return t<44||t>57||45===t||47===t}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=n.\u0275\u0275defineDirective({type:t,selectors:[["","appNumberValidator",""]],hostBindings:function(t,e){1&t&&n.\u0275\u0275listener("paste",function(t){return e.blockPaste(t)})("keydown",function(t){return e.onKeydownHandler(t)})},inputs:{inputValue:"inputValue"}}),t})()},55750:function(t,e,i){i.d(e,{Ry:function(){return n.R}});var n=i(34239);i(62758)},34239:function(t,e,i){i.d(e,{R:function(){return r}});var n=i(37716),o=i(10337);let r=(()=>{class t{constructor(t){this.searchFilterService=t}transform(t,e,i){if(this.startIndex=e*(i*this.searchFilterService.rowSpan)+1,this.endIndex=i*this.searchFilterService.rowSpan*(e+1),null!=t)return this.searchFilterService.showingDataLastFilter=t.slice(this.startIndex-1,this.endIndex),this.searchFilterService.resultChanged.next(),t.slice(this.startIndex-1,this.endIndex)}}return t.\u0275fac=function(e){return new(e||t)(n.\u0275\u0275directiveInject(o.nJ,16))},t.\u0275pipe=n.\u0275\u0275definePipe({name:"paginator",type:t,pure:!0}),t})()},62758:function(t,e,i){i.d(e,{M:function(){return r}});var n=i(37716),o=i(10337);let r=(()=>{class t{constructor(t){this.dtService=t}transform(t,e){return null==t||"0001-01-01T00:00:00"===t?"":"day"===e?this.dtService.getShortFormatWithDay(t):this.dtService.getShortFormat(t)}}return t.\u0275fac=function(e){return new(e||t)(n.\u0275\u0275directiveInject(o.Cv,16))},t.\u0275pipe=n.\u0275\u0275definePipe({name:"shortDate",type:t,pure:!0}),t})()},39924:function(t,e,i){i.d(e,{J:function(){return p}});var n=i(37716),o=i(99692),r=i(10337),a=i(98295),s=i(67441),l=i(3679),d=i(38583),c=i(72458);function h(t,e){if(1&t&&(n.\u0275\u0275elementStart(0,"mat-option",6),n.\u0275\u0275text(1),n.\u0275\u0275elementEnd()),2&t){const t=e.$implicit;n.\u0275\u0275property("value",t),n.\u0275\u0275advance(1),n.\u0275\u0275textInterpolate(t)}}const m=function(){return[6,12,24,60,120]};let p=(()=>{class t{constructor(t){this.searchFilterService=t,this.disabled=!1,this.hidePageSize=!1,this.showFirstLastButtons=!1,this.page=new n.EventEmitter}set pageIndexChanged(t){this.pageIndex=t,this.updateGoto()}set lengthChanged(t){this.length=t,this.updateGoto()}set pageSizeChanged(t){this.pageSize=t,this.updateGoto()}ngOnInit(){this.updateGoto()}onPaginateChange(t){this.searchFilterService.pageIndex=t.pageIndex,this.searchFilterService.pageSize=t.pageSize,this.length=t.length,this.pageIndex=t.pageIndex,this.pageSize=t.pageSize,this.updateGoto(),this.emitPageEvent(t)}updateGoto(){this.goTo=(this.pageIndex||0)+1,this.pageNumbers=[];const t=Math.ceil(this.length/this.pageSize);for(let e=1;e<=t;e++)this.pageNumbers.push(e)}goToChange(){this.paginator.pageIndex=this.goTo-1,this.searchFilterService.pageIndex=this.paginator.pageIndex,this.searchFilterService.pageSize=this.paginator.pageSize,this.emitPageEvent({length:this.paginator.length,pageIndex:this.paginator.pageIndex,pageSize:this.paginator.pageSize})}emitPageEvent(t){this.page.next(t)}}return t.\u0275fac=function(e){return new(e||t)(n.\u0275\u0275directiveInject(r.nJ))},t.\u0275cmp=n.\u0275\u0275defineComponent({type:t,selectors:[["app-paginator"]],viewQuery:function(t,e){if(1&t&&n.\u0275\u0275viewQuery(o.NW,7),2&t){let t;n.\u0275\u0275queryRefresh(t=n.\u0275\u0275loadQuery())&&(e.paginator=t.first)}},inputs:{length:"length",pageIndex:"pageIndex",pageSize:"pageSize",disabled:"disabled",hidePageSize:"hidePageSize",pageSizeOptions:"pageSizeOptions",showFirstLastButtons:"showFirstLastButtons",pageIndexChanged:["pageIndex","pageIndexChanged"],lengthChanged:["length","lengthChanged"],pageSizeChanged:["pageSize","pageSizeChanged"]},outputs:{page:"page"},decls:8,vars:8,consts:[[1,"d-flex"],[3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page"],[1,"go-to-container"],[1,"go-to-label"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(t,e){1&t&&(n.\u0275\u0275elementStart(0,"div",0),n.\u0275\u0275elementStart(1,"mat-paginator",1),n.\u0275\u0275listener("page",function(t){return e.onPaginateChange(t)}),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(2,"div",2),n.\u0275\u0275elementStart(3,"div",3),n.\u0275\u0275text(4,"Go To: "),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementStart(5,"mat-form-field"),n.\u0275\u0275elementStart(6,"mat-select",4),n.\u0275\u0275listener("ngModelChange",function(t){return e.goTo=t})("selectionChange",function(){return e.goToChange()}),n.\u0275\u0275template(7,h,2,2,"mat-option",5),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd(),n.\u0275\u0275elementEnd()),2&t&&(n.\u0275\u0275advance(1),n.\u0275\u0275property("length",e.length)("pageSize",e.pageSize)("pageIndex",e.pageIndex)("pageSizeOptions",n.\u0275\u0275pureFunction0(7,m))("showFirstLastButtons",!0),n.\u0275\u0275advance(5),n.\u0275\u0275property("ngModel",e.goTo),n.\u0275\u0275advance(1),n.\u0275\u0275property("ngForOf",e.pageNumbers))},directives:[o.NW,a.KE,s.gD,l.NgControlStatus,l.NgModel,d.NgForOf,c.ey],styles:['.mat-paginator[_ngcontent-%COMP%]{width:100%;float:right}.d-flex[_ngcontent-%COMP%]{display:flex}  .mat-select-trigger{font-size:12px}  .mat-option{font-size:12px}.go-to-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;background:white}.go-to-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:56px;margin:6px 4px 0;font-size:12px;font-family:Roboto,"Helvetica Neue",sans-serif}.go-to-container[_ngcontent-%COMP%]   .go-to-label[_ngcontent-%COMP%]{width:36px;margin:0 4px;font-size:12px;color:#0000008a;font-family:Roboto,"Helvetica Neue",sans-serif}']}),t})()}}]);
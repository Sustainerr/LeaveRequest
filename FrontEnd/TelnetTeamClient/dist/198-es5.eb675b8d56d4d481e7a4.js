!function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}(self.webpackChunktelnetteam_app=self.webpackChunktelnetteam_app||[]).push([[198],{13198:function(t,i,o){o.r(i),o.d(i,{IndicatorModule:function(){return On}});var r=o(38583),a=o(32403),l=o(67827),s=o(88452),c=o(62028),d=o(63753),u=o(97004),m=o(37716),h=o(4618),p=o(44995),f=o(10337),v=o(19992),y=o(64576),g=o(7539),b=o(3679),S=o(82613),x=o(98295),C=o(49983),I=o(72172),P=o(69517),E=o(39924),k=o(4929);function M(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-grid-tile",6),m.\u0275\u0275text(1),m.\u0275\u0275pipe(2,"number"),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate2(" ",n.userIdentifier," (",m.\u0275\u0275pipeBind2(2,2,i.getTotal(n.monthLoads[1].load),"1.2-2"),") ")}}function A(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-grid-tile",6),m.\u0275\u0275text(1),m.\u0275\u0275pipe(2,"number"),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate2(" ",n.userIdentifier," (",m.\u0275\u0275pipeBind2(2,2,i.getTotal(n.monthLoads[1].load),"1.2-2"),") ")}}var j,w=((j=function(){function t(n){e(this,t),this.searchFilterService=n}return n(t,[{key:"ngOnInit",value:function(){}},{key:"getTotal",value:function(e){return void 0===e.total?0:e.total}}]),t}()).\u0275fac=function(e){return new(e||j)(m.\u0275\u0275directiveInject(f.nJ))},j.\u0275cmp=m.\u0275\u0275defineComponent({type:j,selectors:[["app-resources-inter-contract"]],inputs:{resourcesLoadBudgeted:"resourcesLoadBudgeted",resourcesLoadPlanned:"resourcesLoadPlanned",budgetedNumber:"budgetedNumber",plannedNumber:"plannedNumber"},decls:13,vars:5,consts:[["cols","12","rowHeight","40px"],["colspan","12",1,"header",2,"margin-bottom","5px"],["cols","12","rowHeight","40px",2,"margin-top","5px",3,"hidden"],["colspan","1",1,"header",3,"rowspan"],["class","body",4,"ngFor","ngForOf"],["cols","12","rowHeight","40px",2,"margin-top","5px"],[1,"body"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-grid-list",0),m.\u0275\u0275elementStart(1,"mat-grid-tile",1),m.\u0275\u0275text(2,"Inter contract resources "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(3,"mat-grid-list",2),m.\u0275\u0275elementStart(4,"mat-grid-tile",3),m.\u0275\u0275text(5,"Invoiced "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementContainerStart(6),m.\u0275\u0275template(7,M,3,5,"mat-grid-tile",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(8,"mat-grid-list",5),m.\u0275\u0275elementStart(9,"mat-grid-tile",3),m.\u0275\u0275text(10,"Planned "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementContainerStart(11),m.\u0275\u0275template(12,A,3,5,"mat-grid-tile",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(3),m.\u0275\u0275property("hidden",0===t.resourcesLoadBudgeted.length),m.\u0275\u0275advance(1),m.\u0275\u0275property("rowspan",t.budgetedNumber),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",t.resourcesLoadBudgeted),m.\u0275\u0275advance(2),m.\u0275\u0275property("rowspan",t.plannedNumber),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",t.resourcesLoadPlanned))},directives:[k.Il,k.DX,r.NgForOf],pipes:[r.DecimalPipe],styles:[".mat-grid-tile[_ngcontent-%COMP%]{border:1px rgba(255,255,255,.2)}.header[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:550;text-align:center;background-color:#3f629d}.body[_ngcontent-%COMP%]{font-size:12px!important;background-color:#fff;text-align:left}"]}),j),D=o(4885),R=o(32789),L=o(38590);function N(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"li"),m.\u0275\u0275text(1),m.\u0275\u0275pipe(2,"number"),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate2(" \xa0\xa0\xa0\xa0",n.taskName,": ",m.\u0275\u0275pipeBind2(2,2,n.total,"1.2-2")," ")}}function F(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"ul"),m.\u0275\u0275template(1,N,3,5,"li",2),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(2).$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",n.tasks)}}function O(e,t){if(1&e){var n=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275elementStart(1,"div"),m.\u0275\u0275text(2," \xa0 "),m.\u0275\u0275elementStart(3,"span",3),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(n);var e=m.\u0275\u0275nextContext().$implicit;return m.\u0275\u0275nextContext(4).expandProject(e)}),m.\u0275\u0275text(4),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(5,"span",1),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(n);var e=m.\u0275\u0275nextContext().$implicit;return m.\u0275\u0275nextContext(4).expandProject(e)}),m.\u0275\u0275text(6),m.\u0275\u0275pipe(7,"number"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(8,F,2,1,"ul",0),m.\u0275\u0275elementEnd()}if(2&e){var i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext(4);m.\u0275\u0275advance(3),m.\u0275\u0275property("ngClass",o.isProjectExpandable(i)),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.projectName,": "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngClass",o.isProjectExpandable(i)),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",m.\u0275\u0275pipeBind2(7,5,i.total,"1.2-2"),""),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngIf",i.expanded)}}function T(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"li"),m.\u0275\u0275template(1,O,9,8,"div",0),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",0!==n.projectId)}}function _(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"ul"),m.\u0275\u0275template(1,T,2,1,"li",2),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(3);m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",n.load.projects)}}function W(e,t){if(1&e){var n=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"li"),m.\u0275\u0275elementStart(1,"span",1),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(n);var e=m.\u0275\u0275nextContext(2);return e.expandLoad(e.load)}),m.\u0275\u0275text(2),m.\u0275\u0275pipe(3,"number"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(4,_,2,1,"ul",0),m.\u0275\u0275elementEnd()}if(2&e){var i=m.\u0275\u0275nextContext(2);m.\u0275\u0275advance(1),m.\u0275\u0275property("ngClass",i.isLoadExpandable(i.load)),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",m.\u0275\u0275pipeBind2(3,3,i.load.total,"1.2-2")," "),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngIf",i.load.expanded)}}function z(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"li"),m.\u0275\u0275elementStart(1,"span",4),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(3,"span",5),m.\u0275\u0275text(4),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",n.projectName,":"),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(n.total)}}function H(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"li"),m.\u0275\u0275elementStart(1,"ul"),m.\u0275\u0275template(2,z,5,2,"li",2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(2);m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",n.load.projects)}}function V(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"ul"),m.\u0275\u0275template(1,W,5,6,"li",0),m.\u0275\u0275template(2,H,3,1,"li",0),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!n.palnnedEstimatedWorkload),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",n.palnnedEstimatedWorkload)}}var G=function(){var t=function(){function t(){e(this,t),this.visibleLoad=!1,this.palnnedEstimatedWorkload=!1}return n(t,[{key:"ngOnInit",value:function(){this.visibleLoad=void 0!==this.load.total,this.visibleLoad&&(this.palnnedEstimatedWorkload=this.load.type===u.L2.Planned&&0===this.load.total&&1===this.load.projects.length&&0===this.load.projects[0].projectId)}},{key:"isLoadExpandable",value:function(e){return 0!==e.projects.length?"underline pointer":"underline"}},{key:"expandLoad",value:function(e){e.expanded=!e.expanded}},{key:"isProjectExpandable",value:function(e){return 0!==e.tasks.length?"underline pointer":"underline"}},{key:"expandProject",value:function(e){e.expanded=!e.expanded}}]),t}();return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-month-load"]],inputs:{load:"load"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"ngClass","click"],[4,"ngFor","ngForOf"],[1,"bold",3,"ngClass","click"],[1,"bold","italic"],[1,"italic"]],template:function(e,t){1&e&&m.\u0275\u0275template(0,V,3,2,"ul",0),2&e&&m.\u0275\u0275property("ngIf",t.visibleLoad)},directives:[r.NgIf,r.NgClass,r.NgForOf],pipes:[r.DecimalPipe],styles:[".pointer[_ngcontent-%COMP%]{cursor:pointer}.bold[_ngcontent-%COMP%]{font-weight:bold}.underline[_ngcontent-%COMP%]{-webkit-text-decoration-line:underline;text-decoration-line:underline}.italic[_ngcontent-%COMP%]{font-style:italic}"]}),t}();function B(e,t){1&e&&(m.\u0275\u0275elementStart(0,"th",11),m.\u0275\u0275text(1,"Resource"),m.\u0275\u0275elementEnd())}function J(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",12),m.\u0275\u0275elementStart(1,"span",13),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=t.dataIndex,o=m.\u0275\u0275nextContext();m.\u0275\u0275styleProp("display",o.getRowSpan(i)?"":"none"),m.\u0275\u0275propertyInterpolate("matTooltip",n.userIdentifier),m.\u0275\u0275attribute("rowspan",o.getRowSpan(i)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(n.userIdentifier)}}function $(e,t){1&e&&m.\u0275\u0275element(0,"th",11)}function Y(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",14),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate(i.getResourceLoadType(n.type))}}var U=function(e){return{width:e}};function Q(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",18),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngStyle",m.\u0275\u0275pureFunction1(2,U,i.getMonthColumnHeaderWidth())),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate(i.getColumnHeader(n))}}function q(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",19),m.\u0275\u0275elementStart(1,"div",20),m.\u0275\u0275element(2,"app-month-load",21),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext().index,o=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",o.loadColorClass(n,i)),m.\u0275\u0275advance(2),m.\u0275\u0275property("load",n.monthLoads[i].load)}}function K(e,t){1&e&&(m.\u0275\u0275elementContainerStart(0,15),m.\u0275\u0275template(1,Q,2,4,"th",16),m.\u0275\u0275template(2,q,3,2,"td",17),m.\u0275\u0275elementContainerEnd()),2&e&&m.\u0275\u0275propertyInterpolate("matColumnDef",t.$implicit)}function Z(e,t){1&e&&m.\u0275\u0275element(0,"tr",22)}function X(e,t){1&e&&m.\u0275\u0275element(0,"tr",23)}var ee=function(){var t=function(){function t(n){e(this,t),this.searchFilterService=n,this.displayedColumns=["Resource","Type"],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.dataSource=new R.by}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.buildColmnsHeader(),this.dataSource=new R.by(this.resourcesLoad),this.subscription=this.searchFilterService.resultChanged.subscribe(function(){e.dataSource=new R.by(e.searchFilterService.showingDataLastFilter)})}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"buildColmnsHeader",value:function(){for(var e=this.resourcesLoad[0].monthLoads.length,t=0;t<e;t++)this.displayedColumns.push("M"+(t+1)),this.monthColumnsHeaders.push(this.monthNames[this.resourcesLoad[0].monthLoads[t].month]+this.resourcesLoad[0].monthLoads[t].year)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getMonthColumnHeaderWidth",value:function(){return Math.round(84/this.resourcesLoad[0].monthLoads.length)+"%"}},{key:"getRowSpan",value:function(e){return Number.isInteger(e/this.loadTypes)?this.loadTypes:""}},{key:"getResourceLoadType",value:function(e){switch(e){case u.L2.Budgeted:return"I";case u.L2.Planned:return"P";case u.L2.Real:return"R"}}},{key:"loadColorClass",value:function(e,t){var n=new Date(e.monthLoads[t].year,e.monthLoads[t].month,1),i=new Date(e.monthLoads[t].year,e.monthLoads[t].month+1,0);if(new Date(e.monthLoads[t].year,12,0)>e.entryDate&&(void 0!==e.exitDate&&(n>e.exitDate||i<e.entryDate)||void 0===e.exitDate&&i<e.entryDate))return"resigned-new-resource";var o=e.monthLoads[t].load.total;return o>15?"big-load":o>=5?"average-load":o>0?"tiny-load":this.plannedLoadColorClass(e,t)}},{key:"plannedLoadColorClass",value:function(e,t){var n=e.monthLoads[t].load;if(n.type!==u.L2.Planned||0!==n.total||1!==n.projects.length||0!==n.projects[0].projectId)return 0===e.monthLoads[t].load.total&&e.type===u.L2.Planned&&(e.monthLoads[t].load.total=null),"empty-load";switch(n.projects[0].probability){case 0:return"weak-probability";case 1:return"average-probability";case 2:return"strong-probability";default:return"empty-load"}}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(f.nJ))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-resources-load"]],inputs:{resourcesLoad:"resourcesLoad",loadTypes:"loadTypes",year:"year"},decls:12,vars:5,consts:[["mat-table","","multiTemplateDataRows","",1,"table-width","mat-elevation-z8",3,"dataSource"],["table",""],[2,"padding","0px"],["matColumnDef","Resource"],["mat-header-cell","","scope","col",4,"matHeaderCellDef"],["mat-cell","",3,"matTooltip","display",4,"matCellDef"],["matColumnDef","Type"],["mat-cell","",4,"matCellDef"],[3,"matColumnDef",4,"ngFor","ngForOf"],["mat-header-row","","class","table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell","","scope","col"],["mat-cell","",3,"matTooltip"],[1,"span-ellipsis"],["mat-cell",""],[3,"matColumnDef"],["mat-header-cell","","scope","col",3,"ngStyle",4,"matHeaderCellDef"],["mat-cell","",3,"ngClass",4,"matCellDef"],["mat-header-cell","","scope","col",3,"ngStyle"],["mat-cell","",3,"ngClass"],[1,"loaded-content"],[3,"load"],["mat-header-row","",1,"table-primary","table-*"],["mat-row",""]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0,1),m.\u0275\u0275element(2,"caption",2),m.\u0275\u0275elementContainerStart(3,3),m.\u0275\u0275template(4,B,2,0,"th",4),m.\u0275\u0275template(5,J,3,5,"td",5),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(6,6),m.\u0275\u0275template(7,$,1,0,"th",4),m.\u0275\u0275template(8,Y,2,1,"td",7),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275template(9,K,3,1,"ng-container",8),m.\u0275\u0275template(10,Z,1,0,"tr",9),m.\u0275\u0275template(11,X,1,0,"tr",10),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275property("dataSource",t.dataSource),m.\u0275\u0275advance(9),m.\u0275\u0275property("ngForOf",t.displayedColumns.slice(2,t.displayedColumns.length)),m.\u0275\u0275advance(1),m.\u0275\u0275property("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),m.\u0275\u0275advance(1),m.\u0275\u0275property("matRowDefColumns",t.displayedColumns))},directives:[R.BZ,R.w1,R.fO,R.Dz,r.NgForOf,R.as,R.nj,R.ge,R.ev,L.gM,r.NgStyle,r.NgClass,G,R.XQ,R.Gk],styles:["td.mat-cell[_ngcontent-%COMP%]{height:30px!important;min-width:30px!important;padding-left:10px}td.mat-cell[_ngcontent-%COMP%]:last-of-type, td.mat-footer-cell[_ngcontent-%COMP%]:last-of-type, th.mat-header-cell[_ngcontent-%COMP%]:last-of-type{padding-right:0;border-right:none}.material-icons[_ngcontent-%COMP%]{font-size:15px}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600;text-align:center}.span-ellipsis[_ngcontent-%COMP%]{text-overflow:ellipsis;overflow:hidden;white-space:nowrap}.mat-column-Resource[_ngcontent-%COMP%]{flex:0 0 14%!important;width:14%!important}.mat-column-Type[_ngcontent-%COMP%]{flex:0 0 2%!important;width:2%!important}.big-load[_ngcontent-%COMP%]{background-color:#063a9bf1!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.average-load[_ngcontent-%COMP%]{background-color:#00beff!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.tiny-load[_ngcontent-%COMP%]{background-color:orange!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.weak-probability[_ngcontent-%COMP%]{background-color:red!important;border-right:1px dashed rgba(0,0,0,.12);color:#fff!important}.average-probability[_ngcontent-%COMP%]{background-color:#ffdead!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.strong-probability[_ngcontent-%COMP%]{background-color:#98fb98!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.empty-load[_ngcontent-%COMP%]{background-color:tomato!important;border-right:1px dashed rgba(0,0,0,.12);color:#000!important}.resigned-new-resource[_ngcontent-%COMP%]{background-color:gray!important;border-right:1px dashed rgba(255,255,255,.2);border-bottom:1px solid rgba(255,255,255,.2);color:#fff!important}"]}),t}(),te=o(34239);function ne(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",61),m.\u0275\u0275elementStart(1,"div",62),m.\u0275\u0275elementStart(2,"div",63),m.\u0275\u0275elementStart(3,"div",1),m.\u0275\u0275elementStart(4,"div",64),m.\u0275\u0275element(5,"mat-spinner"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function ie(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",58),m.\u0275\u0275element(1,"app-resources-load",65),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275property("hidden",!n.hideInterContractGrid),m.\u0275\u0275advance(1),m.\u0275\u0275property("resourcesLoad",m.\u0275\u0275pipeBind3(2,6,n.resourcesLoad,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("loadTypes",n.selectedLoadTypesIdentifiers.length)("year",n.year)}}var oe=function(){var t=function(){function t(n,i,o,r,a,l,s){e(this,t),this.indicatorService=n,this.projectService=i,this.coreDataService=o,this.dateTimeService=r,this.excelService=a,this.searchFilterService=l,this.notificationService=s,this.budgeted=!0,this.planned=!0,this.real=!0,this.includeInterns=!1,this.interContract=!1,this.monthsCountInterContract="3",this.displayinterContract="InterContract",this.hideInterContractGrid=!0,this.showBtn=!0,this.resourcesType="Budgeted",this.loadValue=10,this.detailLevel="0",this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.listView=!1,this.resourcesLoad=[],this.resoucesInterContractBudgeted=[],this.resoucesInterContractPlanned=[],this.lengthResourcesLoad=0,this.isLoading=!1,this.customersIdentifiers=[],this.selectedCustomersIdentifiers=[],this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.resourcesIdentifiers=[],this.selectedResourcesIdentifiers=[],this.departmentsIdentifiers=[],this.selectedDepartmentsIdentifiers=[],this.projectsIdentifiers=[],this.selectedProjectsIdentifiers=[],this.loadTypesIdentifiers=[],this.selectedLoadTypesIdentifiers=[],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "]}return n(t,[{key:"ngOnInit",value:function(){this.year=(new Date).getFullYear(),this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.bindFilterData()}},{key:"bindFilterData",value:function(){this.getClients(),this.getActivities(),this.getResources(),this.getDepartments(),this.getProjects()}},{key:"getClients",value:function(){var e=this;this.projectService.getClients().subscribe(function(t){null!=t&&(e.customersIdentifiers=t)})}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t,e.selectedActivitiesIdentifiers=e.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId}))})}},{key:"getResources",value:function(){var e=this;this.coreDataService.getActiveUsers().subscribe(function(t){null!=t&&(e.resourcesIdentifiers=t)})}},{key:"getDepartments",value:function(){var e=this;this.coreDataService.getDepartments().subscribe(function(t){null!=t&&(e.departmentsIdentifiers=t)})}},{key:"getProjects",value:function(){var e=this;this.projectService.getAllProjects().subscribe(function(t){null!=t&&(e.projectsIdentifiers=t)})}},{key:"IsInterContract",value:function(){this.interContract?(this.startMonth=(new Date).getMonth(),this.monthsCount=+this.monthsCountInterContract+1,this.startDate=new Date(this.startMonth+1+"/01/"+(new Date).getFullYear()),this.endDate=new Date(new Date(this.startDate).setMonth(this.startDate.getMonth()+1+ +this.monthsCountInterContract,0)),this.year=(new Date).getFullYear()):this.year===(new Date).getFullYear()?(this.startMonth=0,this.monthsCount=12,this.startDate=new Date("01/01/"+this.year),this.endDate=new Date("12/31/"+this.year)):(this.startMonth=0,this.monthsCount=12,this.startDate=new Date("01/01/"+this.year),this.endDate=new Date("12/31/"+this.year),this.hideInterContractGrid=!0)}},{key:"getInterContractList",value:function(){this.interContract?this.buildSelectedInterContractResources():this.year===(new Date).getFullYear()&&this.buildNotSelectedInterContractResources(),this.budgetedRowsNumber=this.getRowNumber(this.resoucesInterContractBudgeted),this.plannedRowsNumber=this.getRowNumber(this.resoucesInterContractPlanned)}},{key:"buildSelectedInterContractResources",value:function(){var e=this;this.resourcesLoad.forEach(function(t){(void 0===t.monthLoads[1].load.total||t.monthLoads[1].load.total<e.loadValue)&&void 0===t.exitDate&&(t.type===u.L2.Budgeted?e.resoucesInterContractBudgeted.push(t):t.type===u.L2.Planned&&e.resoucesInterContractPlanned.push(t))})}},{key:"buildNotSelectedInterContractResources",value:function(){var e=this;this.resourcesLoad.forEach(function(t){var n=(new Date).getMonth();n=n<11?n+1:n,void 0!==t.monthLoads[n].load&&(void 0===t.monthLoads[n].load.total||t.monthLoads[n].load.total<e.loadValue)&&void 0===t.exitDate&&(t.type===u.L2.Budgeted?e.resoucesInterContractBudgeted.push(t):t.type===u.L2.Planned&&e.resoucesInterContractPlanned.push(t))})}},{key:"getRowNumber",value:function(e){return e.length<11?1:e.length%11>0?Math.floor(e.length/11)+1:Math.floor(e.length/11)}},{key:"search",value:function(){var e=this;if(this.searchFilterService.pageIndex=0,this.resourcesLoad=[],this.resoucesInterContractBudgeted=[],this.resoucesInterContractPlanned=[],this.lengthResourcesLoad=0,this.listView=!1,this.showBtn=!0,this.concatLoadType(),this.IsInterContract(),0!==this.selectedLoadTypesIdentifiers.length)if(this.loadValue>25)this.notificationService.danger("Load value of interContract must be less than 25");else if(0==+this.monthsCountInterContract||+this.monthsCountInterContract>12)this.notificationService.danger("The number of interContract months must be between 1 and 12");else{this.isLoading=!0;var t=new u.Gl;t.selectedDepartmentsIdentifiers=this.selectedDepartmentsIdentifiers,t.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,t.selectedResourcesIdentifiers=this.selectedResourcesIdentifiers,t.selectedCustomersIdentifiers=this.selectedCustomersIdentifiers,t.selectedProjectsIdentifiers=this.selectedProjectsIdentifiers,t.selectedLoadTypesIdentifiers=this.selectedLoadTypesIdentifiers,t.detailLevel=this.detailLevel,t.includeInterns=this.includeInterns,t.startDate=this.startDate,t.endDate=this.endDate,this.indicatorService.getLoadPlanBudgeted(t).subscribe(function(n){e.indicatorService.getLoadPlanPlanned(t).subscribe(function(i){e.indicatorService.getLoadPlanReal(t).subscribe(function(t){e.prepareResourcesLoads(n),e.prepareResourcesLoads(i),e.prepareResourcesLoads(t);var o=(new Date).getFullYear();(e.interContract||e.year===o)&&e.getInterContractList(),e.searchFilterService.rowSpan=e.selectedLoadTypesIdentifiers.length,e.lengthResourcesLoad=e.resourcesLoad.length/e.selectedLoadTypesIdentifiers.length,e.listView=0!==e.lengthResourcesLoad,e.showBtn=!(0!==e.lengthResourcesLoad&&(e.interContract||e.year===o)),e.isLoading=!1})})})}}},{key:"onResetAllFilters",value:function(){var e=this;this.year=(new Date).getFullYear(),this.selectedResourcesIdentifiers=[],this.selectedDepartmentsIdentifiers=[],this.selectedProjectsIdentifiers=[],this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId}),this.selectedCustomersIdentifiers=[],this.budgeted=!0,this.planned=!0,this.real=!0,this.detailLevel="0",this.includeInterns=!1,this.monthsCountInterContract="3",this.loadValue=10,this.interContractTypes="1",this.interContract=!1}},{key:"yearChanged",value:function(e){this.year=new Date(e).getFullYear()}},{key:"bugdetedChecked",value:function(e){"1"===e.value?(this.budgeted=!0,this.planned=!1,this.real=!1,this.resourcesType="Budgeted"):"2"===e.value&&(this.budgeted=!1,this.planned=!0,this.real=!1,this.resourcesType="Planed")}},{key:"interContractChecked",value:function(e){e.checked?(this.interContractTypes="1",this.budgeted=!0,this.planned=!1,this.real=!1):this.hideInterContractGrid=!0}},{key:"changeBtnName",value:function(){"InterContract"===this.displayinterContract?(this.displayinterContract="Workload plan",this.hideInterContractGrid=!1):(this.displayinterContract="InterContract",this.hideInterContractGrid=!0)}},{key:"exportToExcel",value:function(){var e=this;if(void 0!==this.resourcesLoad&&0!==this.resourcesLoad.length){var t=[{header:"Matricule",key:"A",width:10},{header:"Ressource",key:"B",width:30},{header:"Type",key:"C",width:10},{header:this.monthNames[this.startMonth]+this.year,key:"D",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth]+this.year,key:"E",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+1]+this.year,key:"F",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+1]+this.year,key:"G",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+2]+this.year,key:"H",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+2]+this.year,key:"I",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+3]+this.year,key:"J",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+3]+this.year,key:"K",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+4]+this.year,key:"L",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+4]+this.year,key:"M",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+5]+this.year,key:"N",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+5]+this.year,key:"O",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+6]+this.year,key:"P",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+6]+this.year,key:"Q",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+7]+this.year,key:"R",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+7]+this.year,key:"S",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+8]+this.year,key:"T",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+8]+this.year,key:"U",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+9]+this.year,key:"V",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+9]+this.year,key:"W",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+10]+this.year,key:"X",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+10]+this.year,key:"Y",width:25,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+11]+this.year,key:"Z",width:10,style:{alignment:{wrapText:!0}}},{header:this.monthNames[this.startMonth+11]+this.year,key:"AA",width:25,style:{alignment:{wrapText:!0}}}],n=[];n.push(this.getHeaderStyle("A")),n.push(this.getHeaderStyle("B")),n.push(this.getHeaderStyle("C")),n.push(this.getHeaderStyle("D")),n.push(this.getHeaderStyle("F")),n.push(this.getHeaderStyle("H")),n.push(this.getHeaderStyle("J")),n.push(this.getHeaderStyle("L")),n.push(this.getHeaderStyle("N")),n.push(this.getHeaderStyle("P")),n.push(this.getHeaderStyle("R")),n.push(this.getHeaderStyle("T")),n.push(this.getHeaderStyle("V")),n.push(this.getHeaderStyle("X")),n.push(this.getHeaderStyle("Z"));var i=[],o=1;this.resourcesLoad.forEach(function(t){var r=[];o++,r.push(t.userIdentifier.split(" ")[0]),r.push(t.userIdentifier.replace(t.userIdentifier.split(" ")[0]+" ","")),r.push(e.getResourceLoadType(t.type)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[0].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[0].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,0),"D","E",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[1].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[1].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,1),"F","G",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[2].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[2].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,2),"H","I",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[3].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[3].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,3),"J","K",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[4].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[4].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,4),"L","M",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[5].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[5].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,5),"N","O",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[6].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[6].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,6),"P","Q",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[7].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[7].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,7),"R","S",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[8].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[8].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,8),"T","U",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[9].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[9].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,9),"V","W",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[10].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[10].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,10),"X","Y",o)),r.push(e.getRessourceLoadMonthLoad(t.monthLoads[11].load)),r.push(e.getRessourceLoadMonthLoadDetails(t.monthLoads[11].load)),n=n.concat(e.getRessourceLoadMonthLoadCellsStyle(e.getRessourceLoadMonthLoadCellColor(t,11),"Z","AA",o)),i.push(r)}),this.excelService.generateExcel(t,i,["D1:E1","F1:G1","H1:I1","J1:K1","L1:M1","N1:O1","P1:Q1","R1:S1","T1:U1","V1:W1","X1:Y1","Z1:AA1"],n,"WorkloadPlan")}}},{key:"getHeaderStyle",value:function(e){return{cell:e+"1",font:{color:{argb:"FFFFFF"},bold:!0},alignment:{vertical:"middle",horizontal:"center"},fill:{type:"pattern",pattern:"solid",fgColor:{argb:"3F629D"}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}}},{key:"getResourceLoadType",value:function(e){switch(e){case u.L2.Budgeted:return"I";case u.L2.Planned:return"P";case u.L2.Real:return"R"}}},{key:"getRessourceLoadMonthLoad",value:function(e){var t=String.fromCharCode(13)+String.fromCharCode(10),n="";return null!=e.total&&(n=e.type===u.L2.Planned&&0===e.total&&1===e.projects.length&&0===e.projects[0].projectId?e.projects[0].total.toString():e.total.toString()+t),n}},{key:"getRessourceLoadMonthLoadDetails",value:function(e){var t=String.fromCharCode(13)+String.fromCharCode(10),n="";return null!=e.total&&(e.type===u.L2.Planned&&0===e.total&&1===e.projects.length&&0===e.projects[0].projectId?n=e.projects[0].projectName+":"+e.projects[0].total:e.projects.forEach(function(e){0!==e.projectId&&(n=n+e.projectName+":"+e.total+t)})),n}},{key:"getRessourceLoadMonthLoadCellsStyle",value:function(e,t,n,i){var o=[];return o.push({cell:t+i,fill:{type:"pattern",pattern:"solid",fgColor:{argb:e}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),o.push({cell:n+i,fill:{type:"pattern",pattern:"solid",fgColor:{argb:e}},border:{top:{style:"thin"},left:{style:"thin"},bottom:{style:"thin"},right:{style:"thin"}}}),o}},{key:"getRessourceLoadMonthLoadCellColor",value:function(e,t){if(this.resignedOrNewResource(e,t))return"808080";var n=e.monthLoads[t].load.total;if(n>15)return"063A9B";if(n>=5)return"00BEFF";if(n>0)return"FFA500";var i=e.monthLoads[t].load;return i.type===u.L2.Planned&&0===i.total&&1===i.projects.length&&0===i.projects[0].projectId?this.plannedWorkloadCellColor(i.projects[0].probability):"FF6347"}},{key:"resignedOrNewResource",value:function(e,t){var n=new Date(e.monthLoads[t].year,e.monthLoads[t].month,1),i=new Date(e.monthLoads[t].year,e.monthLoads[t].month+1,0);return new Date(e.monthLoads[t].year,12,0)>e.entryDate&&(void 0!==e.exitDate&&(n>e.exitDate||i<e.entryDate)||void 0===e.exitDate&&i<e.entryDate)}},{key:"plannedWorkloadCellColor",value:function(e){switch(e){case 0:return"FF0000";case 1:return"FFDEAD";case 2:return"98FB98";default:return"FF6347"}}},{key:"prepareResourcesLoads",value:function(e){var t=this;e.forEach(function(e){if(!t.interContract||t.interContract&&t.dateTimeService.isNullDate(e.exitDate)){var n=t.resourcesLoad.findIndex(function(t){return t.userId===e.userId&&t.type===e.loadType});-1!==n?t.resourcesLoad[n]=t.prepareResourceLoad(t.resourcesLoad[n],e):t.selectedLoadTypesIdentifiers.forEach(function(n){var i=t.createNewResourceLoad(t.startMonth,t.year,t.monthsCount);i.userId=e.userId,i.userIdentifier=e.userIdentifier,i.entryDate=new Date(e.entryDate),t.dateTimeService.isNullDate(e.exitDate)||(i.exitDate=new Date(e.exitDate)),i.type=n,i.type===e.loadType&&(i=t.prepareResourceLoad(i,e)),t.resourcesLoad.push(i)})}})}},{key:"createNewResourceLoad",value:function(e,t,n){for(var i=new u.$4(n),o=0;o<n;o++)e+o<12?(i.monthLoads[o].month=e+o,i.monthLoads[o].year=t):(i.monthLoads[o].month=e+o-12,i.monthLoads[o].year=t+1);return i}},{key:"prepareResourceLoad",value:function(e,t){if(null!==t.month){var n=e.monthLoads.findIndex(function(e){return e.month===t.month-1&&e.year===t.year});e.monthLoads[n]=this.prepareMonthLoad(e.monthLoads[n],t)}return e}},{key:"prepareMonthLoad",value:function(e,t){return e.load=this.prepareLoad(e.load,t),e}},{key:"prepareLoad",value:function(e,t){if(null===t.projectId)e.type=t.loadType,e.total=t.monthLoad;else{var n;if(n=e.projects.findIndex(function(e){return e.projectId===t.projectId&&e.projectName===t.projectAbreviation}),0===t.projectId&&void 0===e.total&&(e.type=t.loadType,e.total=0),-1!==n)e.projects[n]=this.prepareProjectLoad(e.projects[n],t);else{var i=new u.e9;i.projectId=t.projectId,i.projectName=t.projectAbreviation,e.projects.push(this.prepareProjectLoad(i,t))}}return e}},{key:"prepareProjectLoad",value:function(e,t){if(null===t.taskId)e.total=t.monthLoad,0===e.projectId&&(e.probability=t.probability);else{var n=e.tasks.findIndex(function(e){return e.taskId===t.taskId});if(-1!==n)e.tasks[n]=this.prepareTaskLoad(e.tasks[n],t);else{var i=new u.of;i.taskId=t.taskId,i.taskName=t.taskName,e.tasks.push(this.prepareTaskLoad(i,t))}}return e}},{key:"prepareTaskLoad",value:function(e,t){return e.total=t.monthLoad,e}},{key:"concatLoadType",value:function(){this.selectedLoadTypesIdentifiers=[],this.budgeted&&this.selectedLoadTypesIdentifiers.push(u.L2.Budgeted),this.planned&&this.selectedLoadTypesIdentifiers.push(u.L2.Planned),this.real&&this.selectedLoadTypesIdentifiers.push(u.L2.Real)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(h.Qk),m.\u0275\u0275directiveInject(p.Y4),m.\u0275\u0275directiveInject(f.YY),m.\u0275\u0275directiveInject(f.Cv),m.\u0275\u0275directiveInject(f.xB),m.\u0275\u0275directiveInject(f.nJ),m.\u0275\u0275directiveInject(f.gq))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-load-plan"]],decls:144,vars:50,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-2","col-lg-12"],[1,"mat-subheader","col-sm-3"],[1,"col-sm-9"],[3,"enabled","yearChange"],[1,"check-box-list"],[3,"ngModel","disabled","ngModelChange"],[3,"ngModel","ngModelChange"],["value","0"],["value","1"],["value","2"],[1,"col-xl-6","col-lg-12"],[1,"col-sm-6"],[1,"mat-subheader","col-sm-2"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"settings","data","ngModel","placeholder","ngModelChange"],[1,"col-sm-12"],[1,"mat-subheader","col-sm-1"],[1,"col-sm-11"],[1,"multi-search",2,"width","100%",3,"settings","data","ngModel","placeholder","ngModelChange"],[1,"text","m-b-10",3,"ngModel","ngModelChange","change"],[1,"text","m-b-5"],[1,"input-info-load","m-b-5"],["type","text","min","1","max","12","appNumberValidator","","matInput","","name","searchInput","maxlength","2",3,"disabled","ngModel","ngModelChange"],["appNumberValidator","","type","text","min","1","max","20","matInput","","name","searchInput",3,"disabled","ngModel","ngModelChange"],["aria-label","Select an option",1,"text","margin-left","m-b-5",3,"disabled","ngModel","ngModelChange"],["value","1",3,"change"],["value","2",3,"change"],[1,"col-xl-3","col-lg-12"],[1,"text","m-b-10",3,"ngModel","ngModelChange"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"disabled","click"],[1,"btn","btn-md","btn-default","ripple","light","m-t-10",3,"disabled","click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"col-sm-3"],["type","button",1,"export","btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"hidden","click"],[3,"pageSize","pageIndex","length"],[1,"col-sm-12","legend","m-b-10"],[1,"table-width"],[2,"padding","0px"],["scope","col"],[1,"box","load-less-5"],[1,"box","load-between-5-15"],[1,"box","load-over-15"],[1,"box","weak-probability"],[1,"box","average-probability"],[1,"box","strong-probability"],[1,"box","resigned-new"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],[1,"loaded-content",3,"hidden"],[3,"resourcesLoadBudgeted","resourcesLoadPlanned","budgetedNumber","plannedNumber"],["class","loaded-content",3,"blurred","hidden",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[3,"resourcesLoad","loadTypes","year"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Year"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-input-year",8),m.\u0275\u0275listener("yearChange",function(e){return t.yearChanged(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"mat-list-item"),m.\u0275\u0275elementStart(14,"div",9),m.\u0275\u0275elementStart(15,"mat-checkbox",10),m.\u0275\u0275listener("ngModelChange",function(e){return t.budgeted=e}),m.\u0275\u0275text(16,"Invoiced"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(17,"mat-checkbox",10),m.\u0275\u0275listener("ngModelChange",function(e){return t.planned=e}),m.\u0275\u0275text(18,"Planned"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(19,"mat-checkbox",10),m.\u0275\u0275listener("ngModelChange",function(e){return t.real=e}),m.\u0275\u0275text(20,"Real"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(21,"mat-list-item"),m.\u0275\u0275elementStart(22,"mat-radio-group",11),m.\u0275\u0275listener("ngModelChange",function(e){return t.detailLevel=e}),m.\u0275\u0275elementStart(23,"mat-radio-button",12),m.\u0275\u0275text(24,"Loads"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(25,"mat-radio-button",13),m.\u0275\u0275text(26,"Projects"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(27,"mat-radio-button",14),m.\u0275\u0275text(28,"Details"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(29,"div",15),m.\u0275\u0275elementStart(30,"mat-list"),m.\u0275\u0275elementStart(31,"mat-list-item"),m.\u0275\u0275elementStart(32,"div",16),m.\u0275\u0275elementStart(33,"div",1),m.\u0275\u0275elementStart(34,"h3",17),m.\u0275\u0275text(35,"Resource"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(36,"div",18),m.\u0275\u0275elementStart(37,"ng-multiselect-dropdown",19),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedResourcesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(38,"div",16),m.\u0275\u0275elementStart(39,"div",1),m.\u0275\u0275elementStart(40,"h3",17),m.\u0275\u0275text(41,"Depart."),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(42,"div",18),m.\u0275\u0275elementStart(43,"ng-multiselect-dropdown",19),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedDepartmentsIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(44,"mat-list-item"),m.\u0275\u0275elementStart(45,"div",20),m.\u0275\u0275elementStart(46,"div",1),m.\u0275\u0275elementStart(47,"h3",21),m.\u0275\u0275text(48,"Project"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(49,"div",22),m.\u0275\u0275elementStart(50,"ng-multiselect-dropdown",23),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedProjectsIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(51,"mat-list-item"),m.\u0275\u0275elementStart(52,"mat-checkbox",24),m.\u0275\u0275listener("ngModelChange",function(e){return t.interContract=e})("change",function(e){return t.interContractChecked(e)}),m.\u0275\u0275text(53," Inter-Contract"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(54,"div",25),m.\u0275\u0275text(55,"For the"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(56,"mat-form-field",26),m.\u0275\u0275elementStart(57,"input",27),m.\u0275\u0275listener("ngModelChange",function(e){return t.monthsCountInterContract=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(58,"div",25),m.\u0275\u0275text(59,"next month(s) with a load less than"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(60,"mat-form-field",26),m.\u0275\u0275elementStart(61,"input",28),m.\u0275\u0275listener("ngModelChange",function(e){return t.loadValue=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(62,"div",25),m.\u0275\u0275text(63,"MD"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(64,"mat-radio-group",29),m.\u0275\u0275listener("ngModelChange",function(e){return t.interContractTypes=e}),m.\u0275\u0275elementStart(65,"mat-radio-button",30),m.\u0275\u0275listener("change",function(e){return t.bugdetedChecked(e)}),m.\u0275\u0275text(66,"Invoiced "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(67,"mat-radio-button",31),m.\u0275\u0275listener("change",function(e){return t.bugdetedChecked(e)}),m.\u0275\u0275text(68,"Planned "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(69,"div",32),m.\u0275\u0275elementStart(70,"mat-list"),m.\u0275\u0275elementStart(71,"mat-list-item"),m.\u0275\u0275elementStart(72,"div",20),m.\u0275\u0275elementStart(73,"div",1),m.\u0275\u0275elementStart(74,"h3",17),m.\u0275\u0275text(75,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(76,"div",18),m.\u0275\u0275elementStart(77,"ng-multiselect-dropdown",19),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(78,"mat-list-item"),m.\u0275\u0275elementStart(79,"div",20),m.\u0275\u0275elementStart(80,"div",1),m.\u0275\u0275elementStart(81,"h3",17),m.\u0275\u0275text(82,"Customer"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(83,"div",18),m.\u0275\u0275elementStart(84,"ng-multiselect-dropdown",19),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedCustomersIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(85,"mat-list-item"),m.\u0275\u0275elementStart(86,"mat-checkbox",33),m.\u0275\u0275listener("ngModelChange",function(e){return t.includeInterns=e}),m.\u0275\u0275text(87,"Include Interns"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(88,"div",34),m.\u0275\u0275elementStart(89,"div",35),m.\u0275\u0275elementStart(90,"button",36),m.\u0275\u0275listener("click",function(){return t.search()}),m.\u0275\u0275text(91,"Search"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(92,"div",35),m.\u0275\u0275elementStart(93,"button",37),m.\u0275\u0275listener("click",function(){return t.onResetAllFilters()}),m.\u0275\u0275text(94,"Reset"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(95,"nav",38),m.\u0275\u0275elementStart(96,"div",39),m.\u0275\u0275elementStart(97,"button",40),m.\u0275\u0275listener("click",function(){return t.exportToExcel()}),m.\u0275\u0275element(98,"em",41),m.\u0275\u0275text(99," Export "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(100,"button",42),m.\u0275\u0275listener("click",function(){return t.changeBtnName()}),m.\u0275\u0275text(101),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(102,"div",7),m.\u0275\u0275element(103,"app-paginator",43),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(104,"div",44),m.\u0275\u0275elementStart(105,"table",45),m.\u0275\u0275element(106,"caption",46),m.\u0275\u0275elementStart(107,"tbody"),m.\u0275\u0275elementStart(108,"tr"),m.\u0275\u0275element(109,"th",47),m.\u0275\u0275elementStart(110,"td"),m.\u0275\u0275element(111,"div",48),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(112,"td"),m.\u0275\u0275text(113," Load < 5 MD "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(114,"td"),m.\u0275\u0275element(115,"div",49),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(116,"td"),m.\u0275\u0275text(117," Load between 5 and 15 MD "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(118,"td"),m.\u0275\u0275element(119,"div",50),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(120,"td"),m.\u0275\u0275text(121," Load > 15 MD "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(122,"td"),m.\u0275\u0275element(123,"div",51),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(124,"td"),m.\u0275\u0275text(125," Weak Probability "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(126,"td"),m.\u0275\u0275element(127,"div",52),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(128,"td"),m.\u0275\u0275text(129," Average Probability "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(130,"td"),m.\u0275\u0275element(131,"div",53),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(132,"td"),m.\u0275\u0275text(133," Strong Probability "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(134,"td"),m.\u0275\u0275element(135,"div",54),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(136,"td"),m.\u0275\u0275text(137," Resigned or New Recruit "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(138,"div",55),m.\u0275\u0275elementStart(139,"div",56),m.\u0275\u0275template(140,ne,6,0,"div",57),m.\u0275\u0275elementStart(141,"div",58),m.\u0275\u0275element(142,"app-resources-inter-contract",59),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(143,ie,3,10,"div",60),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("enabled",!t.interContract),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngModel",t.budgeted)("disabled",t.interContract),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngModel",t.planned)("disabled",t.interContract),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngModel",t.real)("disabled",t.interContract),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngModel",t.detailLevel),m.\u0275\u0275advance(15),m.\u0275\u0275property("settings",t.dropdownSettings)("data",t.resourcesIdentifiers)("ngModel",t.selectedResourcesIdentifiers)("placeholder","Select..."),m.\u0275\u0275advance(6),m.\u0275\u0275property("settings",t.dropdownSettings)("data",t.departmentsIdentifiers)("ngModel",t.selectedDepartmentsIdentifiers)("placeholder","Select..."),m.\u0275\u0275advance(7),m.\u0275\u0275property("settings",t.dropdownSettings)("data",t.projectsIdentifiers)("ngModel",t.selectedProjectsIdentifiers)("placeholder","Select..."),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngModel",t.interContract),m.\u0275\u0275advance(5),m.\u0275\u0275property("disabled",!t.interContract)("ngModel",t.monthsCountInterContract),m.\u0275\u0275advance(4),m.\u0275\u0275property("disabled",!t.interContract)("ngModel",t.loadValue),m.\u0275\u0275advance(3),m.\u0275\u0275property("disabled",!t.interContract)("ngModel",t.interContractTypes),m.\u0275\u0275advance(13),m.\u0275\u0275property("settings",t.dropdownSettings)("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers)("placeholder","Select..."),m.\u0275\u0275advance(7),m.\u0275\u0275property("settings",t.dropdownSettings)("data",t.customersIdentifiers)("ngModel",t.selectedCustomersIdentifiers)("placeholder","Select..."),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngModel",t.includeInterns),m.\u0275\u0275advance(4),m.\u0275\u0275property("disabled",t.isLoading),m.\u0275\u0275advance(3),m.\u0275\u0275property("disabled",t.isLoading),m.\u0275\u0275advance(7),m.\u0275\u0275property("hidden",t.showBtn),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",t.displayinterContract," "),m.\u0275\u0275advance(2),m.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.lengthResourcesLoad),m.\u0275\u0275advance(37),m.\u0275\u0275property("ngIf",t.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("hidden",t.hideInterContractGrid),m.\u0275\u0275advance(1),m.\u0275\u0275property("resourcesLoadBudgeted",t.resoucesInterContractBudgeted)("resourcesLoadPlanned",t.resoucesInterContractPlanned)("budgetedNumber",t.budgetedRowsNumber)("plannedNumber",t.plannedRowsNumber),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView))},directives:[v.i$,v.Tg,y.G,g.oG,b.NgControlStatus,b.NgModel,S.VQ,S.U0,l.OP,x.KE,C.Nt,b.DefaultValueAccessor,I.z,b.MaxLengthValidator,P.M2,E.J,r.NgIf,w,D.$g,ee],pipes:[te.R],styles:[".multiselect-dropdown .dropdown-list .item1 .filter-textbox{font-size:12px}.multiselect-dropdown .dropdown-btn{font-size:14px}.multiselect-dropdown .selected-item{font-size:10px;background:#448aff}.multiselect-dropdown .multiselect-item-checkbox{font-size:12px}.mat-list .mat-divider{margin-top:15px}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.text{margin-top:15px;height:40px;padding:0 5px;font-size:13px;font-weight:normal!important;color:#0000008a}.input-info-load{width:4%;font-size:15px;text-align:center!important}.mat-radio-button{padding-right:4px}.mat-radio-group{font-size:12px!important;color:#0000008a!important}.mat-radio-label-content{font-size:13px!important;font-weight:bold!important}.check-box-list{font-size:14px!important;margin-bottom:6px;color:#0000008a!important;padding-left:0!important}.mat-checkbox-layout{margin-bottom:0;padding:2px}.mat-checkbox-layout .mat-checkbox-label{font-size:13px!important;font-weight:bold!important;color:#0000008a}.mat-list-base .mat-list-item .mat-list-item-content{padding-left:0!important;padding-right:0!important}.margin-left{margin-left:20px}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 465px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}.legend{font-size:12px;font-weight:normal;color:#0000008a}.box{width:40px;height:20px;border:1px solid white}.load-less-5{background-color:orange}.load-between-5-15{background-color:#00beff}.load-over-15{background-color:#00f}.weak-probability{background-color:red}.average-probability{background-color:#ffdead}.strong-probability{background-color:#98fb98}.resigned-new{background-color:gray}\n"],encapsulation:2}),t}(),re=o(22238),ae=o(70833),le=o(55750),se=o(60428),ce=function(){var t=function(){function t(n){e(this,t),this.dialogRef=n}return n(t,[{key:"close",value:function(){this.dialogRef.close()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.so))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-activity-legend"]],decls:36,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"form",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"span"),m.\u0275\u0275text(4," Profitability Activity Legend "),m.\u0275\u0275elementStart(5,"em",3),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(6,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"div",4),m.\u0275\u0275elementStart(8,"div"),m.\u0275\u0275elementStart(9,"span",5),m.\u0275\u0275text(10,"Spent (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(11,"La charge d\xe9pens\xe9e (HJ) = la charge d\xe9pens\xe9e des projets de l'activit\xe9."),m.\u0275\u0275element(12,"br"),m.\u0275\u0275elementStart(13,"span",5),m.\u0275\u0275text(14,"Invoiced (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = la charge factur\xe9e des projets de l'activit\xe9."),m.\u0275\u0275element(16,"br"),m.\u0275\u0275elementStart(17,"span",5),m.\u0275\u0275text(18,"Spent Amount (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(19,"Montant d\xe9pens\xe9 (\u20ac) = la somme du co\xfbt (co\xfbt interne de la ressource * 20 jours) de chaque ressource appartenant \xe0 l'activit\xe9."),m.\u0275\u0275element(20,"br"),m.\u0275\u0275elementStart(21,"span",5),m.\u0275\u0275text(22,"Achieved Cost (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(23,"Montant factur\xe9 (\u20ac) = la somme du prix (prix de la ressource * nbr de jours factur\xe9) pour les membres de chaque projet."),m.\u0275\u0275element(24,"br"),m.\u0275\u0275elementStart(25,"span",5),m.\u0275\u0275text(26,"Invoiced Cost (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(27,"Montant factur\xe9 (\u20ac) = le co\xfbt r\xe9el de la facturation (Il est r\xe9cup\xe9r\xe9 de la facture)."),m.\u0275\u0275element(28,"br"),m.\u0275\u0275elementStart(29,"span",5),m.\u0275\u0275text(30,"Productivity (%): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(31,"Rentabilit\xe9 (%) = (Invoiced Cost (\u20ac) / Spent Amount (\u20ac)) * 100. "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(32,"div",6),m.\u0275\u0275elementStart(33,"div",7),m.\u0275\u0275elementStart(34,"button",8),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(35,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())},directives:[b.\u0275NgNoValidate,b.NgControlStatusGroup,b.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:190px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t}(),de=o(16738),ue=o(60040),me=o(11494),he=o(62758);function pe(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Resource"),m.\u0275\u0275elementEnd())}function fe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",n.userIdentifier," ")}}function ve(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Company Entry"),m.\u0275\u0275elementEnd())}function ye(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275pipe(3,"shortDate"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",m.\u0275\u0275pipeBind1(3,2,n.entryDate)," ")}}function ge(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Company Exit"),m.\u0275\u0275elementEnd())}function be(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275pipe(3,"shortDate"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",m.\u0275\u0275pipeBind1(3,2,n.exitDate)," ")}}function Se(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Activity Start"),m.\u0275\u0275elementEnd())}function xe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275pipe(3,"shortDate"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",m.\u0275\u0275pipeBind1(3,2,n.startDate)," ")}}function Ce(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Activity End"),m.\u0275\u0275elementEnd())}function Ie(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275pipe(3,"shortDate"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",m.\u0275\u0275pipeBind1(3,2,n.endDate)," ")}}function Pe(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-header-cell",15),m.\u0275\u0275text(1,"Spent Amount \u20ac"),m.\u0275\u0275elementEnd())}function Ee(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",16),m.\u0275\u0275elementStart(1,"span"),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275property("ngClass",i.isUserQuitWithEmptyExitDate(n)),m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1("",n.spentMonthAmount," ")}}function ke(e,t){1&e&&m.\u0275\u0275element(0,"mat-header-row",17)}function Me(e,t){1&e&&m.\u0275\u0275element(0,"mat-row")}function Ae(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"mat-cell",18),m.\u0275\u0275elementStart(1,"strong",19),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate(n.activityName)}}function je(e,t){1&e&&m.\u0275\u0275element(0,"mat-row")}var we=function(){return["groupHeader"]},De=function(){var t=function(){function t(n,i,o,r,a){e(this,t),this.profitabilityActivityService=n,this.sortService=i,this.groupsService=o,this.dialog=r,this.data=a,this.displayedColumns=["userIdentifier","entryDate","exitDate","startDate","endDate","spentMonthAmount"],this.groupByColumns=["activityName"],this.dataSource=new R.by}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.dataSource=new R.by(this.groupsService.addGroups(this.data,this.groupByColumns)),this.subscription=this.profitabilityActivityService.sortSpentAmount.subscribe(function(){e.dataSource=new R.by(e.groupsService.addGroups(e.data,e.groupByColumns))})}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"isGroup",value:function(e,t){return t.level}},{key:"isUserQuitWithEmptyExitDate",value:function(e){if(1===e.userQuit&&"0001-01-01T00:00:00"===e.exitDate)return"red"}},{key:"onSortData",value:function(e){var t=this;e.active&&""!==e.direction&&void 0!==this.data&&(this.data.sort(function(n,i){var o="asc"===e.direction;switch(e.active){case"userIdentifier":return t.sortService.compare(n.userIdentifier,i.userIdentifier,o,!1);case"entryDate":return t.sortService.compare(n.entryDate,i.entryDate,o,!1);case"exitDate":return t.sortService.compare(n.exitDate,i.exitDate,o,!1);case"startDate":return t.sortService.compare(n.startDate,i.startDate,o,!1);case"endDate":return t.sortService.compare(n.endDate,i.endDate,o,!1);case"spentMonthAmount":return t.sortService.compare(n.spentMonthAmount,i.spentMonthAmount,o,!0);default:return 0}}),this.profitabilityActivityService.sortSpentAmount.next())}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(h.VK),m.\u0275\u0275directiveInject(f.Kx),m.\u0275\u0275directiveInject(f.Jc),m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(re.WI))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-spent-amount"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},decls:25,vars:7,consts:[["matSort","","matSortDirection","asc","matSortDisableClear","",3,"dataSource","matSortChange"],["table",""],["matColumnDef","userIdentifier"],["mat-sort-header","",4,"matHeaderCellDef"],[3,"ngClass",4,"matCellDef"],["matColumnDef","entryDate"],["matColumnDef","exitDate"],["matColumnDef","startDate"],["matColumnDef","endDate"],["matColumnDef","spentMonthAmount"],["class"," table-primary table-*",4,"matHeaderRowDef","matHeaderRowDefSticky"],[4,"matRowDef","matRowDefColumns"],["matColumnDef","groupHeader"],["colspan","999",4,"matCellDef"],[4,"matRowDef","matRowDefColumns","matRowDefWhen"],["mat-sort-header",""],[3,"ngClass"],[1,"table-primary","table-*"],["colspan","999"],[1,"strong"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"mat-table",0,1),m.\u0275\u0275listener("matSortChange",function(e){return t.onSortData(e)}),m.\u0275\u0275elementContainerStart(2,2),m.\u0275\u0275template(3,pe,2,0,"mat-header-cell",3),m.\u0275\u0275template(4,fe,3,2,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(5,5),m.\u0275\u0275template(6,ve,2,0,"mat-header-cell",3),m.\u0275\u0275template(7,ye,4,4,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(8,6),m.\u0275\u0275template(9,ge,2,0,"mat-header-cell",3),m.\u0275\u0275template(10,be,4,4,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(11,7),m.\u0275\u0275template(12,Se,2,0,"mat-header-cell",3),m.\u0275\u0275template(13,xe,4,4,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(14,8),m.\u0275\u0275template(15,Ce,2,0,"mat-header-cell",3),m.\u0275\u0275template(16,Ie,4,4,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275elementContainerStart(17,9),m.\u0275\u0275template(18,Pe,2,0,"mat-header-cell",3),m.\u0275\u0275template(19,Ee,3,2,"mat-cell",4),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275template(20,ke,1,0,"mat-header-row",10),m.\u0275\u0275template(21,Me,1,0,"mat-row",11),m.\u0275\u0275elementContainerStart(22,12),m.\u0275\u0275template(23,Ae,3,1,"mat-cell",13),m.\u0275\u0275elementContainerEnd(),m.\u0275\u0275template(24,je,1,0,"mat-row",14),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275property("dataSource",t.dataSource),m.\u0275\u0275advance(20),m.\u0275\u0275property("matHeaderRowDef",t.displayedColumns)("matHeaderRowDefSticky",!0),m.\u0275\u0275advance(1),m.\u0275\u0275property("matRowDefColumns",t.displayedColumns),m.\u0275\u0275advance(3),m.\u0275\u0275property("matRowDefColumns",m.\u0275\u0275pureFunction0(6,we))("matRowDefWhen",t.isGroup))},directives:[R.BZ,me.YE,R.w1,R.fO,R.Dz,R.as,R.nj,R.ge,me.nU,R.ev,r.NgClass,R.XQ,R.Gk],pipes:[he.M],styles:[".mat-table[_ngcontent-%COMP%]{overflow:auto;border-radius:4px;max-height:calc(100vh - 392px)}table[_ngcontent-%COMP%]{width:100%}.strong[_ngcontent-%COMP%]{background:-webkit-linear-gradient(#5a5a5a,black);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:bold}.mat-header-cell[_ngcontent-%COMP%]{color:#fff;font-size:15px;font-weight:600}"]}),t}();function Re(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",9),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(n)," ")}}function Le(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",10),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[n]," ")}}function Ne(e,t){if(1&e){var n=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"span",20),m.\u0275\u0275listener("click",function(){m.\u0275\u0275restoreView(n);var e=m.\u0275\u0275nextContext().index,t=m.\u0275\u0275nextContext(2).$implicit;return m.\u0275\u0275nextContext().activitySpentDetailDisplay(e,t)}),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()}if(2&e){var i=m.\u0275\u0275nextContext().index,o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",r.getTotalSubColumnValue(i,o)," ")}}function Fe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"span"),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i)," ")}}function Oe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",18),m.\u0275\u0275template(1,Ne,2,1,"span",19),m.\u0275\u0275template(2,Fe,2,1,"span",13),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=t.index,o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",r.isActivityMonthSpentAmount(n,i,o)),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!r.isActivityMonthSpentAmount(n,i,o))}}function Te(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",14),m.\u0275\u0275elementStart(1,"td",15),m.\u0275\u0275elementStart(2,"span",16),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(4,Oe,3,2,"td",17),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",n.activityName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function _e(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function We(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"label",28),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(3).$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.companyName,"")}}function ze(e,t){1&e&&(m.\u0275\u0275elementStart(0,"label",29),m.\u0275\u0275text(1," Empty"),m.\u0275\u0275elementEnd())}function He(e,t){if(1&e&&(m.\u0275\u0275template(0,We,2,1,"label",26),m.\u0275\u0275template(1,ze,2,0,"label",27),m.\u0275\u0275text(2)),2&e){var n=m.\u0275\u0275nextContext(2).$implicit;m.\u0275\u0275property("ngIf",n.companyName),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!n.companyName),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," ")}}function Ve(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Ge(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i),"")}}function Be(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",30),m.\u0275\u0275template(1,Ve,2,0,"div",23),m.\u0275\u0275template(2,Ge,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275propertyInterpolate1("matTooltip"," ",r.getTotalSubColumnValue(n,o),""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getTotalSubColumnValue(n,o))("ngIfElse",i)}}function Je(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",21),m.\u0275\u0275elementStart(1,"td",22),m.\u0275\u0275template(2,_e,2,0,"div",23),m.\u0275\u0275template(3,He,3,3,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(5,Be,4,3,"td",25),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275reference(4),i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",i.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(o.i,i))("ngIfElse",n),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",o.displayedSubColumns)}}function $e(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Ye(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate(o.getSubColumnValue(n,i))}}function Ue(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",18),m.\u0275\u0275template(1,$e,2,0,"div",23),m.\u0275\u0275template(2,Ye,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getSubColumnValue(n,o))("ngIfElse",i)}}function Qe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",31),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,Ue,4,2,"td",17),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1(" ",n.userIdentifier," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function qe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tbody"),m.\u0275\u0275template(1,Te,5,2,"tr",11),m.\u0275\u0275template(2,Je,6,4,"tr",12),m.\u0275\u0275template(3,Qe,4,2,"tr",13),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",1==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",2==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level)}}var Ke=function(){var t=function(){function t(n,i,o,r,a){e(this,t),this.dialog=n,this.profitabilityActivityService=i,this.profitabilityActivityGroupService=o,this.dateTimeService=r,this.numberFormatter=a,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent MD","Invoiced MD","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityActivitiesGrouped=[],this.activitySpentAmountDisplaying=!1}return n(t,[{key:"ngOnInit",value:function(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}},{key:"ngOnChanges",value:function(){(null!==this.profitabilityActivities||void 0!==this.profitabilityActivities)&&(this.profitabilityActivitiesGrouped=this.profitabilityActivityGroupService.getProfitabilityActivitiesGrouped(this.profitabilityActivities,this.profitabilityActivitiesFiltred,this.profitabilityActivitiesProjects,this.profitabilityActivitiesTotal,this.monthsCount))}},{key:"buildColmnsHeader",value:function(){if((null!==this.profitabilityActivities||void 0!==this.profitabilityActivities)&&this.profitabilityActivities.length>0)for(var e=this.profitabilityActivities[0].monthsProfitabilityActivity.length,t=0;t<e;t++){this.displayedColumns.push("M"+t);var n=this.profitabilityActivities[0].monthsProfitabilityActivity[this.getMonthIndex(t)].month-1,i=this.profitabilityActivities[0].monthsProfitabilityActivity[this.getMonthIndex(t)].year;isNaN(n)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[n]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}},{key:"getMonthIndex",value:function(e){return Math.floor(e)}},{key:"getMonthDetailsIndex",value:function(e){return Math.floor(e/this.displayedSubColumnsNamesCount)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityActivity[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityActivity[i].spentMonthLoad,1);case 1:return this.format(t.monthsProfitabilityActivity[i].invoicedMonthLoad);case 2:return this.format(t.monthsProfitabilityActivity[i].spentMonthAmount);case 3:return this.format(t.monthsProfitabilityActivity[i].achivedMonthCost);case 4:case 5:case 6:case 7:return-1}}},{key:"getTotalSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityActivity[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityActivity[i].spentMonthLoad,1);case 1:return this.numberFormatter.round(t.monthsProfitabilityActivity[i].invoicedMonthLoad,1);case 2:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].spentMonthAmount,1));case 3:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].achivedMonthCost,1));case 4:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].invoicedMonthCost,1));case 5:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].spentMonthMission,1));case 6:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].invoicedMonthMission,1));case 7:return t.monthsProfitabilityActivity[i].saariRef}}},{key:"activitySpentDetailDisplay",value:function(e,t){var n=this;if(!this.activitySpentAmountDisplaying){this.activitySpentAmountDisplaying=!0;var i=t.activityId.toString(),o=Math.floor(e/this.displayedSubColumnsNamesCount),r=t.monthsProfitabilityActivity[o].month,a=t.monthsProfitabilityActivity[o].year;if(void 0!==r&&void 0!==a){var l=new Date(r+"/01/"+a),s=de(l).endOf("month").toDate();this.profitabilityActivityService.getProfitabilityActivitySpentDetail(i,l,s).subscribe(function(e){var t={disableClose:!1,hasBackdrop:!0,width:"1000px",data:e};n.activitySpentAmountDisplaying=!1,n.displayEditdialogRef=n.dialog.open(De,t)})}}}},{key:"isActivityMonthSpentAmount",value:function(e,t,n){var i=Math.floor(t/this.displayedSubColumnsNamesCount);return e===this.displayedSubColumnsNames[2]&&i<n.monthsProfitabilityActivity.length-1}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"datePipe",value:function(e){return"0001-01-01T00:00:00"===e?"":e}},{key:"format",value:function(e){return 0===e?"":e}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(h.VK),m.\u0275\u0275directiveInject(h.zc),m.\u0275\u0275directiveInject(f.Cv),m.\u0275\u0275directiveInject(se.e))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-activity"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},inputs:{profitabilityActivities:"profitabilityActivities",profitabilityActivitiesFiltred:"profitabilityActivitiesFiltred",profitabilityActivitiesProjects:"profitabilityActivitiesProjects",profitabilityActivitiesTotal:"profitabilityActivitiesTotal",monthsCount:"monthsCount"},features:[m.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],["class","activitySpentAmount",3,"click",4,"ngIf"],[1,"activitySpentAmount",3,"click"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],["style","text-align: center;",3,"matTooltip",4,"ngFor","ngForOf"],["style","background-color:#24901d;","class","label",4,"ngIf"],["style","background-color:rgb(235, 64, 64);","class","label",4,"ngIf"],[1,"label",2,"background-color","#24901d"],[1,"label",2,"background-color","rgb(235, 64, 64)"],[2,"text-align","center",3,"matTooltip"],[1,"td-third",2,"width","15%"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0),m.\u0275\u0275element(1,"caption",1),m.\u0275\u0275elementStart(2,"thead",2),m.\u0275\u0275elementStart(3,"tr",3),m.\u0275\u0275elementStart(4,"th",4),m.\u0275\u0275text(5,"Activity / Company-Project / Resource"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(6,Re,2,2,"th",5),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"tr",6),m.\u0275\u0275template(8,Le,2,1,"th",7),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(9,qe,4,3,"tbody",8),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(6),m.\u0275\u0275property("ngForOf",t.monthColumnsHeaders),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",t.displayedSubColumns),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",t.profitabilityActivitiesGrouped))},directives:[r.NgForOf,r.NgIf,L.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}.activitySpentAmount[_ngcontent-%COMP%]{cursor:pointer;-webkit-text-decoration-line:underline;text-decoration-line:underline}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t}();function Ze(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",9),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(n)," ")}}function Xe(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",10),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[n]," ")}}function et(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",15),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i)," ")}}function tt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tbody"),m.\u0275\u0275elementStart(1,"tr",11),m.\u0275\u0275elementStart(2,"td",12),m.\u0275\u0275elementStart(3,"span",13),m.\u0275\u0275text(4),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(5,et,2,1,"td",14),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(4),m.\u0275\u0275textInterpolate1(" ",n.activityName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}var nt=function(){var t=function(){function t(n,i){e(this,t),this.dialog=n,this.numberFormatter=i,this.displayedColumns=["activityName"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Count","Spent Amount \u20ac","Invoiced Cost \u20ac","Productivity %"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[]}return n(t,[{key:"ngOnInit",value:function(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}},{key:"buildColmnsHeader",value:function(){if((null!==this.profitabilityActivitiesGroup||void 0!==this.profitabilityActivitiesGroup)&&this.profitabilityActivitiesGroup.length>0)for(var e=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity.length,t=0;t<e;t++){this.displayedColumns.push("M"+t);var n=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity[this.getMonthIndex(t)].month-1,i=this.profitabilityActivitiesGroup[0].monthsProfitabilityActivity[this.getMonthIndex(t)].year;isNaN(n)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[n]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}},{key:"getMonthIndex",value:function(e){return Math.floor(e)}},{key:"getMonthDetailsIndex",value:function(e){return Math.floor(e/this.displayedSubColumnsNamesCount)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getTotalSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityActivity[i])switch(n){case 0:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].resourcesCount,2));case 1:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].spentMonthAmount,1));case 2:return this.format(this.numberFormatter.round(t.monthsProfitabilityActivity[i].invoicedMonthCost,1));case 3:return this.numberFormatter.round(t.monthsProfitabilityActivity[i].productivity,1)}}},{key:"format",value:function(e){return 0===e?"":e}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(se.e))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-productivity"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},inputs:{profitabilityActivitiesGroup:"profitabilityActivitiesGroup",monthsCount:"monthsCount"},decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0),m.\u0275\u0275element(1,"caption",1),m.\u0275\u0275elementStart(2,"thead",2),m.\u0275\u0275elementStart(3,"tr",3),m.\u0275\u0275elementStart(4,"th",4),m.\u0275\u0275text(5,"Activity Productivity Summary"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(6,Ze,2,2,"th",5),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"tr",6),m.\u0275\u0275template(8,Xe,2,1,"th",7),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(9,tt,6,2,"tbody",8),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(6),m.\u0275\u0275property("ngForOf",t.monthColumnsHeaders),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",t.displayedSubColumns),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",t.profitabilityActivitiesGroup))},directives:[r.NgForOf],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t}();function it(e,t){if(1&e&&m.\u0275\u0275element(0,"app-paginator",29),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275property("pageSize",n.searchFilterService.pageSize)("pageIndex",n.searchFilterService.pageIndex)("length",n.profitabilityActivitiesLength)}}function ot(e,t){if(1&e&&m.\u0275\u0275element(0,"app-paginator",29),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275property("pageSize",n.searchFilterService.pageSize)("pageIndex",n.searchFilterService.pageIndex)("length",n.profitabilityActivitiesGroupLength)}}function rt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275elementStart(1,"h1"),m.\u0275\u0275text(2,"No Result Found"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function at(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",30),m.\u0275\u0275elementStart(1,"div",31),m.\u0275\u0275elementStart(2,"div",32),m.\u0275\u0275elementStart(3,"div",1),m.\u0275\u0275elementStart(4,"div",33),m.\u0275\u0275element(5,"mat-spinner"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function lt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",34),m.\u0275\u0275element(1,"app-activity",35),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("profitabilityActivities",m.\u0275\u0275pipeBind3(2,7,n.profitabilityActivities,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("profitabilityActivitiesFiltred",n.profitabilityActivities)("profitabilityActivitiesProjects",n.profitabilityActivitiesProjects)("profitabilityActivitiesTotal",n.profitabilityActivitiesTotal)("monthsCount",n.monthsCount)}}function st(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",34),m.\u0275\u0275element(1,"app-productivity",36),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("profitabilityActivitiesGroup",m.\u0275\u0275pipeBind3(2,4,n.profitabilityActivitiesGroup,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("monthsCount",n.monthsCount)}}var ct=function(){var t=function(){function t(n){e(this,t),this.emptyResult=!1,this.profitabilityActivitiesGrouped=[],this.profitabilityActivitiesGroup=[],this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new f.nJ,this.paginatorPipe=new le.Ry(this.searchFilterService),this.subscription=new ae.w0,this.hideBtnProductivity=!0,this.hideProductivity=!0,this.displayedProductivityLabel="Summary",this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent","Invoiced","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref","Productivity %"],this.dialog=n.get(re.uw),this.searchFilterService=n.get(f.nJ),this.excelService=n.get(f.xB),this.profitabilityActivityService=n.get(h.VK),this.profitabilityActivityGroupService=n.get(h.zc),this.projectService=n.get(p.Y4),this.dateTimeService=n.get(f.Cv),this.numberFormatter=n.get(se.e),this.notificationService=n.get(f.gq)}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===c.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=12,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.profitabilityActivityService.reloadProfitabilityActivity.subscribe(function(){var t=JSON.parse(sessionStorage.getItem("profitabilityActivitySearch")),n=t.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(",");e.getProfitabilityActivity(n,t.profitabilityActivityStartDate,t.profitabilityActivityEndDate)})),this.profitabilityActivitiesLength=0,this.profitabilityActivitiesGroupLength=0,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(function(){setTimeout(function(){e.emptyResult=0===e.searchFilterService.showingDataLastFilter.length})}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t,e.setSearchFilter())})}},{key:"setSearchFilter",value:function(){var e=this,t=JSON.parse(sessionStorage.getItem("profitabilityActivitySearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),null!=t.profitabilityActivityStartDate&&(this.profitabilityActivityStartDate=new Date(t.profitabilityActivityStartDate),this.minDate=this.profitabilityActivityStartDate),null!=t.profitabilityActivityEndDate&&(this.profitabilityActivityEndDate=new Date(t.profitabilityActivityEndDate),this.maxDate=this.profitabilityActivityEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId});var n=this.dateTimeService.today();this.profitabilityActivityStartDate=de([n.getFullYear(),n.getMonth()]).toDate(),this.profitabilityActivityEndDate=de(n).endOf("month").toDate(),this.minDate=this.profitabilityActivityStartDate,this.maxDate=this.profitabilityActivityEndDate}}},{key:"searchProfitabilityActivity",value:function(){this.searchFilterService.pageIndex=0,this.profitabilityActivities=[],this.profitabilityActivitiesGroup=[],this.profitabilityActivitiesLength=0,this.profitabilityActivitiesGroupLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),this.emptyResult=!0,this.listView=!1;var e=new u.Zh;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.profitabilityActivityStartDate=this.profitabilityActivityStartDate,e.profitabilityActivityEndDate=this.profitabilityActivityEndDate,sessionStorage.setItem("profitabilityActivitySearch",JSON.stringify(e)),this.computeStartMonthandYear(),this.getProfitabilityActivity(this.selectedActivitiesIds,this.profitabilityActivityStartDate,this.profitabilityActivityEndDate)}},{key:"getProfitabilityActivity",value:function(e,t,n){var i=this;this.isLoading=!0,this.profitabilityActivityService.getProfitabilityActivity(e,t,n).subscribe(function(o){null!=o&&i.profitabilityActivityService.getProfitabilityActivityProject(e,t,n).subscribe(function(r){i.profitabilityActivityService.getProfitabilityActivitySpentTotal(e,t,n).subscribe(function(e){if(i.isLoading=!1,i.profitabilityActivitiesProjects=r,i.profitabilityActivitiesTotal=e,i.prepareProfitabilityActivities(o),i.AddProjectsWithoutResourcesLoad(),i.profitabilityActivitiesLength=i.profitabilityActivities.length,i.emptyResult=!1,i.listView=!0,0===i.profitabilityActivities.length)i.emptyResult=!0,i.hideBtnProductivity=!0;else if(void 0!==i.profitabilityActivities){var t=i.profitabilityActivityGroupService.getProfitabilityActivitiesGrouped(i.profitabilityActivities,i.profitabilityActivities,i.profitabilityActivitiesProjects,i.profitabilityActivitiesTotal,i.monthsCount);i.profitabilityActivitiesGrouped=JSON.parse(JSON.stringify(t)),i.profitabilityActivitiesGroup=i.profitabilityActivitiesGrouped.filter(function(e){return 1===e.level}),i.profitabilityActivitiesGroupLength=i.profitabilityActivitiesGroup.length,i.emptyResult=!1,i.hideBtnProductivity=!1}},function(){i.isLoading=!1,i.notificationService.danger("Profitability activity not loaded.")})},function(){i.isLoading=!1,i.notificationService.danger("Profitability activity not loaded.")})},function(){i.isLoading=!1,i.notificationService.danger("Profitability activity not loaded.")})}},{key:"prepareProfitabilityActivities",value:function(e){var t=this;e.forEach(function(e){var n=t.profitabilityActivities.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId&&t.userId===e.userId});if(-1!==n)t.profitabilityActivities[n]=t.prepareProfitabilityActivity(t.profitabilityActivities[n],e);else{var i=t.createProfitabilityActivity(t.startMonth,t.startYear,t.monthsCount);t.profitabilityActivities.push(t.prepareProfitabilityActivity(i,e))}})}},{key:"computeStartMonthandYear",value:function(){this.startMonth=this.profitabilityActivityStartDate.getMonth(),this.startYear=this.profitabilityActivityStartDate.getFullYear(),this.computeMonthsCount()}},{key:"computeMonthsCount",value:function(){this.monthsCount=12*(this.profitabilityActivityEndDate.getFullYear()-this.profitabilityActivityStartDate.getFullYear()),this.monthsCount-=this.profitabilityActivityStartDate.getMonth(),this.monthsCount+=this.profitabilityActivityEndDate.getMonth()+1}},{key:"prepareProfitabilityActivity",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=t.projectName,e.companyName=t.companyName,e.userId=t.userId,e.userIdentifier=t.userIdentifier;var n=e.monthsProfitabilityActivity.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsProfitabilityActivity[n].spentMonthLoad=t.spentMonthLoad,e.monthsProfitabilityActivity[n].invoicedMonthLoad=t.invoicedMonthLoad,e.monthsProfitabilityActivity[n].globalMonthSpent=t.globalMonthSpent,e.monthsProfitabilityActivity[n].achivedMonthCost=t.achivedMonthCost,e.monthsProfitabilityActivity[n].invoicedMonthCost=t.invoicedMonthCost,e.monthsProfitabilityActivity[n].spentMonthAmount=this.numberFormatter.round(t.spentMonthAmount,0),e.monthsProfitabilityActivity[n].spentMonthMission=t.spentMonthMission,e.monthsProfitabilityActivity[n].invoicedMonthMission=t.invoicedMonthMission,e.monthsProfitabilityActivity[n].saariRef=t.saariRef),e}},{key:"createProfitabilityActivity",value:function(e,t,n){for(var i=new u.Z9(n),o=0;o<n;o++)e+o<12?(i.monthsProfitabilityActivity[o].month=e+o+1,i.monthsProfitabilityActivity[o].year=t):(i.monthsProfitabilityActivity[o].month=e+o+1-12,i.monthsProfitabilityActivity[o].year=t+1);return i}},{key:"AddProjectsWithoutResourcesLoad",value:function(){var e=this;this.profitabilityActivitiesProjects.forEach(function(t){var n=e.profitabilityActivities.find(function(e){return e.activityId===t.activityId&&e.projectId===t.projectId});void 0===n&&((n=e.createProfitabilityActivity(e.startMonth,e.startYear,e.monthsCount)).activityId=t.activityId,n.activityName=t.activityName,n.companyName=t.companyName,n.projectId=t.projectId,n.projectName=t.projectName,n.userId=0,n.userIdentifier="No Load",e.profitabilityActivities.push(n))})}},{key:"dateFormat",value:function(e){return null==e||"0001-01-01T00:00:00"===e?"":this.dateTimeService.getShortFormat(e)}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"daysChangePeriodFrom",value:function(e){var t=new Date(e);this.profitabilityActivityStartDate=de([t.getFullYear(),t.getMonth()]).toDate(),this.minDate=this.profitabilityActivityStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityActivityEndDate=de([t.getFullYear(),t.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityActivityEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"daysChangePeriodTo",value:function(e){var t=new Date(e);this.profitabilityActivityEndDate=de(t).endOf("month").toDate(),this.maxDate=this.profitabilityActivityEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityActivityStartDate=de([t.getFullYear(),t.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityActivityStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"displayProductivity",value:function(){this.searchFilterService.pageIndex=0,!1===this.hideProductivity?(this.displayedProductivityLabel="Summary",this.hideProductivity=!0):(this.displayedProductivityLabel="Details",this.hideProductivity=!1)}},{key:"exportToExcel",value:function(){var e=this;if(void 0!==this.profitabilityActivities&&0!==this.profitabilityActivities.length){var t=[],n=[],i=this.subColumnsNames.length,o=[],r=[];t.push({header:"",key:"A",width:20}),t.push({header:"",key:"B",width:20}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});var a=["Activity","Project","Company","Resource"];r.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityActivitiesGrouped[0].monthsProfitabilityActivity.forEach(function(n){e.subColumnsNames.forEach(function(i){t.push({header:void 0!==n.month?e.monthNames[n.month-1].toString()+" "+n.year.toString():"Total",key:i+n.monthIndex,width:20}),a.push(i)}),o.push(e.getExcelColumn(5+i*n.monthIndex)+"1:"+e.getExcelColumn(4+i*(n.monthIndex+1))+"1"),r.push({cell:e.getExcelColumn(5+i*n.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});var l=0;e.subColumnsNames.forEach(function(){r.push({cell:e.getExcelColumn(5+i*n.monthIndex+l)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),l++})}),n.push(a),this.profitabilityActivitiesGrouped.forEach(function(t){(a=[]).push(t.activityName),a.push(t.projectName),a.push(t.companyName),a.push(t.userIdentifier),t.monthsProfitabilityActivity.forEach(function(t){a.push(e.formatNullOrEmptyValue(t.spentMonthLoad)),a.push(e.formatNullOrEmptyValue(t.invoicedMonthLoad)),a.push(t.spentMonthAmount),a.push(t.achivedMonthCost),a.push(t.invoicedMonthCost),a.push(t.spentMonthMission),a.push(t.invoicedMonthMission),a.push(t.saariRef),a.push(t.productivity)}),n.push(a)}),this.excelService.generateExcel(t,n,o,r,"Profitability_Activity")}}},{key:"getExcelColumn",value:function(e){var t=26,n=e%t==0?Math.floor(e/t)-1:Math.floor(e/t),i=e%t==0?t:e%t;return e<=t?String.fromCharCode(i+64):String.fromCharCode(n+64)+String.fromCharCode(i+64)}},{key:"formatNullOrEmptyValue",value:function(e){return""===e||null===e?0:e}},{key:"openProfitabilityActivityLegend",value:function(){this.uploadDialogRef=this.dialog.open(ce,{disableClose:!1,panelClass:"form_modal",width:"700px",height:"320px",hasBackdrop:!0,data:{}})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(m.Injector))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-activity"]],decls:46,vars:17,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"hidden","click"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length",4,"ngIf"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[3,"pageSize","pageIndex","length"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityActivities","profitabilityActivitiesFiltred","profitabilityActivitiesProjects","profitabilityActivitiesTotal","monthsCount"],[3,"profitabilityActivitiesGroup","monthsCount"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Period"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-select-month",8),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodFrom(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",7),m.\u0275\u0275elementStart(14,"app-select-month",9),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodTo(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(15,"div",5),m.\u0275\u0275elementStart(16,"mat-list"),m.\u0275\u0275elementStart(17,"mat-list-item"),m.\u0275\u0275elementStart(18,"h3",6),m.\u0275\u0275text(19,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(20,"div",10),m.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(22,"div",12),m.\u0275\u0275elementStart(23,"div",13),m.\u0275\u0275elementStart(24,"div",14),m.\u0275\u0275elementStart(25,"button",15),m.\u0275\u0275listener("click",function(){return t.searchProfitabilityActivity()}),m.\u0275\u0275text(26,"Search"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(27,"nav",16),m.\u0275\u0275elementStart(28,"div",17),m.\u0275\u0275elementStart(29,"button",18),m.\u0275\u0275listener("click",function(){return t.exportToExcel()}),m.\u0275\u0275element(30,"em",19),m.\u0275\u0275text(31," Export "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(32,"button",20),m.\u0275\u0275listener("click",function(){return t.displayProductivity()}),m.\u0275\u0275text(33),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(34,"button",18),m.\u0275\u0275listener("click",function(){return t.openProfitabilityActivityLegend()}),m.\u0275\u0275element(35,"em",21),m.\u0275\u0275text(36," Legend "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(37,"div",22),m.\u0275\u0275template(38,it,1,3,"app-paginator",23),m.\u0275\u0275template(39,ot,1,3,"app-paginator",23),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(40,rt,3,0,"div",24),m.\u0275\u0275elementStart(41,"div",25),m.\u0275\u0275elementStart(42,"div",26),m.\u0275\u0275template(43,at,6,0,"div",27),m.\u0275\u0275template(44,lt,3,11,"div",28),m.\u0275\u0275template(45,st,3,8,"div",28),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("selectedDate",t.profitabilityActivityStartDate)("maxDate",t.maxDate),m.\u0275\u0275advance(2),m.\u0275\u0275property("selectedDate",t.profitabilityActivityEndDate)("minDate",t.minDate),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers)("settings",t.dropdownSettings)("disabled",!t.isSuperAdmin),m.\u0275\u0275advance(11),m.\u0275\u0275property("hidden",t.hideBtnProductivity),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",t.displayedProductivityLabel," "),m.\u0275\u0275advance(5),m.\u0275\u0275property("ngIf",t.hideProductivity),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!t.hideProductivity),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.emptyResult&&t.listView),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngIf",t.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult&&t.hideProductivity),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult&&!t.hideProductivity))},directives:[v.i$,v.Tg,ue.j,l.OP,b.NgControlStatus,b.NgModel,P.M2,r.NgIf,E.J,D.$g,Ke,nt],pipes:[te.R],styles:[".search-input{font-size:14px}.multi-search{width:100%}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),t}(),dt=function(){var t=function(){function t(n){e(this,t),this.dialogRef=n}return n(t,[{key:"close",value:function(){this.dialogRef.close()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.so))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-project-legend"]],decls:33,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"form",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"span"),m.\u0275\u0275text(4," Profitability Project Legend "),m.\u0275\u0275elementStart(5,"em",3),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(6,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"div",4),m.\u0275\u0275elementStart(8,"div"),m.\u0275\u0275elementStart(9,"span",5),m.\u0275\u0275text(10,"Spent (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(11,"La charge d\xe9pens\xe9e (HJ) = La charge d\xe9pens\xe9e du projet."),m.\u0275\u0275element(12,"br"),m.\u0275\u0275elementStart(13,"span",5),m.\u0275\u0275text(14,"Invoiced (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = La charge factur\xe9e des personnes affect\xe9es au projet."),m.\u0275\u0275element(16,"br"),m.\u0275\u0275elementStart(17,"span",5),m.\u0275\u0275text(18,"Spent Amount (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(19,"Montant d\xe9pens\xe9 (\u20ac) = la somme du co\xfbt (co\xfbt interne de la ressource * 20 jours) de chaque ressource appartenant \xe0 l'activit\xe9."),m.\u0275\u0275element(20,"br"),m.\u0275\u0275elementStart(21,"span",5),m.\u0275\u0275text(22,"Achieved Cost (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(23,"Montant factur\xe9 (\u20ac) = La somme (co\xfbt externe selon profil de la personne * nbr de jour factur\xe9) pour chaque personne affect\xe9e au projet."),m.\u0275\u0275element(24,"br"),m.\u0275\u0275elementStart(25,"span",5),m.\u0275\u0275text(26,"Invoiced Cost (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(27,"Montant factur\xe9 (\u20ac) = Le montant total des factures valid\xe9es du projet. (Il est r\xe9cup\xe9r\xe9 de la facture)."),m.\u0275\u0275element(28,"br"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(29,"div",6),m.\u0275\u0275elementStart(30,"div",7),m.\u0275\u0275elementStart(31,"button",8),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(32,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())},directives:[b.\u0275NgNoValidate,b.NgControlStatusGroup,b.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:190px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t}();function ut(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",9),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(n)," ")}}function mt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",10),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[n]," ")}}function ht(e,t){1&e&&m.\u0275\u0275element(0,"td")}function pt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",14),m.\u0275\u0275elementStart(1,"td",15),m.\u0275\u0275elementStart(2,"span",16),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(4,ht,1,0,"td",8),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",n.activityName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function ft(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function vt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"label",24),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(3).$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.companyName,"")}}function yt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"label",25),m.\u0275\u0275text(1," Empty"),m.\u0275\u0275elementEnd())}function gt(e,t){if(1&e&&(m.\u0275\u0275template(0,vt,2,1,"label",22),m.\u0275\u0275template(1,yt,2,0,"label",23),m.\u0275\u0275text(2)),2&e){var n=m.\u0275\u0275nextContext(2).$implicit;m.\u0275\u0275property("ngIf",n.companyName),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",!n.companyName),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," ")}}function bt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function St(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i),"")}}function xt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",26),m.\u0275\u0275template(1,bt,2,0,"div",19),m.\u0275\u0275template(2,St,1,1,"ng-template",null,20,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275propertyInterpolate1("matTooltip"," ",r.getTotalSubColumnValue(n,o),""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getTotalSubColumnValue(n,o))("ngIfElse",i)}}function Ct(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",17),m.\u0275\u0275elementStart(1,"td",18),m.\u0275\u0275template(2,ft,2,0,"div",19),m.\u0275\u0275template(3,gt,3,3,"ng-template",null,20,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(5,xt,4,3,"td",21),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275reference(4),i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",i.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(o.i,i))("ngIfElse",n),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",o.displayedSubColumns)}}function It(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Pt(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate(o.getSubColumnValue(n,i))}}function Et(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",29),m.\u0275\u0275template(1,It,2,0,"div",19),m.\u0275\u0275template(2,Pt,1,1,"ng-template",null,20,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getSubColumnValue(n,o))("ngIfElse",i)}}function kt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",27),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,Et,4,2,"td",28),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(2),m.\u0275\u0275textInterpolate1(" ",n.userIdentifier," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function Mt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tbody"),m.\u0275\u0275template(1,pt,5,2,"tr",11),m.\u0275\u0275template(2,Ct,6,4,"tr",12),m.\u0275\u0275template(3,kt,4,2,"tr",13),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",1==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",2==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level)}}var At=function(){var t=function(){function t(n,i,o,r){e(this,t),this.dialog=n,this.profitabilityProjectGroupService=i,this.dateTimeService=o,this.numberFormatter=r,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent MD","Invoiced MD","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityProjectsGrouped=[]}return n(t,[{key:"ngOnInit",value:function(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}},{key:"ngOnChanges",value:function(){(null!==this.profitabilityProjects||void 0!==this.profitabilityProjects)&&(this.profitabilityProjectsGrouped=this.profitabilityProjectGroupService.getProfitabilityProjectsGrouped(this.profitabilityProjects,this.profitabilityProjectsFiltred,this.profitabilityActivitiesProjects,this.monthsCount))}},{key:"buildColmnsHeader",value:function(){if((null!==this.profitabilityProjects||void 0!==this.profitabilityProjects)&&this.profitabilityProjects.length>0)for(var e=this.profitabilityProjects[0].monthsProfitabilityProject.length,t=0;t<e;t++){this.displayedColumns.push("M"+t);var n=this.profitabilityProjects[0].monthsProfitabilityProject[this.getMonthIndex(t)].month-1,i=this.profitabilityProjects[0].monthsProfitabilityProject[this.getMonthIndex(t)].year;isNaN(n)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[n]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}},{key:"getMonthIndex",value:function(e){return Math.floor(e)}},{key:"getMonthDetailsIndex",value:function(e){return Math.floor(e/this.displayedSubColumnsNamesCount)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityProject[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityProject[i].spentMonthLoad,1);case 1:return this.format(t.monthsProfitabilityProject[i].invoicedMonthLoad);case 2:return this.format(t.monthsProfitabilityProject[i].spentMonthAmount);case 3:return this.format(t.monthsProfitabilityProject[i].achivedMonthCost);case 4:case 5:case 6:case 7:return-1}}},{key:"getTotalSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityProject[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityProject[i].spentMonthLoad,1);case 1:return this.numberFormatter.round(t.monthsProfitabilityProject[i].invoicedMonthLoad,1);case 2:return this.format(this.numberFormatter.round(t.monthsProfitabilityProject[i].spentMonthAmount,1));case 3:return this.format(this.numberFormatter.round(t.monthsProfitabilityProject[i].achivedMonthCost,1));case 4:return this.format(this.numberFormatter.round(t.monthsProfitabilityProject[i].invoicedMonthCost,1));case 5:return this.format(this.numberFormatter.round(t.monthsProfitabilityProject[i].spentMonthMission,1));case 6:return this.format(this.numberFormatter.round(t.monthsProfitabilityProject[i].invoicedMonthMission,1));case 7:return t.monthsProfitabilityProject[i].saariRef}}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"datePipe",value:function(e){return"0001-01-01T00:00:00"===e?"":e}},{key:"format",value:function(e){return 0===e?"":e}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(h.$M),m.\u0275\u0275directiveInject(f.Cv),m.\u0275\u0275directiveInject(se.e))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-project"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},inputs:{profitabilityProjects:"profitabilityProjects",profitabilityProjectsFiltred:"profitabilityProjectsFiltred",profitabilityActivitiesProjects:"profitabilityActivitiesProjects",profitabilityProjectsTotal:"profitabilityProjectsTotal",monthsCount:"monthsCount"},features:[m.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],["style","text-align: center;",3,"matTooltip",4,"ngFor","ngForOf"],["style","background-color:#24901d;","class","label",4,"ngIf"],["style","background-color:rgb(235, 64, 64);","class","label",4,"ngIf"],[1,"label",2,"background-color","#24901d"],[1,"label",2,"background-color","rgb(235, 64, 64)"],[2,"text-align","center",3,"matTooltip"],[1,"td-third",2,"width","15%"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0),m.\u0275\u0275element(1,"caption",1),m.\u0275\u0275elementStart(2,"thead",2),m.\u0275\u0275elementStart(3,"tr",3),m.\u0275\u0275elementStart(4,"th",4),m.\u0275\u0275text(5,"Activity / Company-Project / Resource"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(6,ut,2,2,"th",5),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"tr",6),m.\u0275\u0275template(8,mt,2,1,"th",7),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(9,Mt,4,3,"tbody",8),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(6),m.\u0275\u0275property("ngForOf",t.monthColumnsHeaders),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",t.displayedSubColumns),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",t.profitabilityProjectsGrouped))},directives:[r.NgForOf,r.NgIf,L.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t}();function jt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275elementStart(1,"h1"),m.\u0275\u0275text(2,"No Result Found"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function wt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",29),m.\u0275\u0275elementStart(1,"div",30),m.\u0275\u0275elementStart(2,"div",31),m.\u0275\u0275elementStart(3,"div",1),m.\u0275\u0275elementStart(4,"div",32),m.\u0275\u0275element(5,"mat-spinner"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function Dt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",33),m.\u0275\u0275element(1,"app-project",34),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("profitabilityProjects",m.\u0275\u0275pipeBind3(2,6,n.profitabilityProjects,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("profitabilityProjectsFiltred",n.profitabilityProjects)("profitabilityActivitiesProjects",n.profitabilityActivitiesProjects)("monthsCount",n.monthsCount)}}function Rt(e,t){if(1&e&&m.\u0275\u0275element(0,"div",33),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading)}}var Lt=function(){var t=function(){function t(n){e(this,t),this.emptyResult=!1,this.profitabilityProjectsGrouped=[],this.profitabilityProjectsGroup=[],this.profitabilityProjectsLength=0,this.profitabilityProjectsGroupLength=0,this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.projectsIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.selectedProjectsIdentifiers=[],this.dropdownSettings={},this.dropDownSelected=!1,this.searchFilterService=new f.nJ,this.paginatorPipe=new le.Ry(this.searchFilterService),this.subscription=new ae.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent","Invoiced","Spent Amount \u20ac","Achieved Cost \u20ac","Invoiced Cost \u20ac","Spent Mission \u20ac","Invoiced Mission \u20ac","Saari Ref"],this.dialog=n.get(re.uw),this.searchFilterService=n.get(f.nJ),this.excelService=n.get(f.xB),this.profitabilityProjectService=n.get(h.jE),this.profitabilityProjectGroupService=n.get(h.$M),this.projectService=n.get(p.Y4),this.dateTimeService=n.get(f.Cv),this.numberFormatter=n.get(se.e),this.notificationService=n.get(f.gq)}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===c.Fl.SuperAdmin,this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=12,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.getActivities(),this.subscription.add(this.profitabilityProjectService.reloadProfitabilityProject.subscribe(function(){var t=JSON.parse(sessionStorage.getItem("profitabilityProjectSearch")),n=t.selectedProjectsIdentifiers,i=t.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),o=n.map(function(e){return e.id}).join(",");e.getProfitabilityProject(i,o,t.profitabilityProjectStartDate,t.profitabilityProjectEndDate)})),this.subscription.add(this.searchFilterService.resultChanged.subscribe(function(){setTimeout(function(){e.emptyResult=0===e.searchFilterService.showingDataLastFilter.length})}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t,e.selectedActivitiesIdentifiers=e.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId}),e.selectedActivitiesIds=e.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),e.getActivityProjects(e.selectedActivitiesIds),e.setSearchFilter())})}},{key:"onDropDownClose",value:function(){this.dropDownSelected&&(this.dropDownSelected=!1,this.selectedActivitiesIds="",this.selectedActivitiesIdentifiers.length!==this.activitiesIdentifiers.length&&(this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(",")),this.getActivityProjects(this.selectedActivitiesIds))}},{key:"getActivityProjects",value:function(e){var t=this;this.profitabilityProjectService.getActivityProjects(e).subscribe(function(e){t.projectsIdentifiers=[],t.selectedProjectsIdentifiers=[],t.selectedProjectsIds="",null!=e&&(t.projectsIdentifiers=e)})}},{key:"setSearchFilter",value:function(){var e=this,t=JSON.parse(sessionStorage.getItem("profitabilityProjectSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),t.selectedProjectsIdentifiers&&t.selectedProjectsIdentifiers.length>0&&(this.selectedProjectsIdentifiers=t.selectedProjectsIdentifiers),this.selectedProjectsIds=this.selectedProjectsIdentifiers.map(function(e){return e.id}).join(","),null!=t.profitabilityProjectStartDate&&(this.profitabilityProjectStartDate=new Date(t.profitabilityProjectStartDate),this.minDate=this.profitabilityProjectStartDate),null!=t.profitabilityProjectEndDate&&(this.profitabilityProjectEndDate=new Date(t.profitabilityProjectEndDate),this.maxDate=this.profitabilityProjectEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId});var n=this.dateTimeService.today();this.profitabilityProjectStartDate=de([n.getFullYear(),n.getMonth()]).toDate(),this.profitabilityProjectEndDate=de(n).endOf("month").toDate(),this.minDate=this.profitabilityProjectStartDate,this.maxDate=this.profitabilityProjectEndDate}}},{key:"searchProfitabilityProject",value:function(){this.searchFilterService.pageIndex=0,this.profitabilityProjects=[],this.profitabilityProjectsGroup=[],this.profitabilityProjectsLength=0,this.profitabilityProjectsGroupLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),this.selectedProjectsIds="",this.selectedProjectsIdentifiers&&this.selectedProjectsIdentifiers.length>0&&(this.selectedProjectsIds=this.selectedProjectsIdentifiers.map(function(e){return e.id}).join(",")),this.emptyResult=!0,this.listView=!1;var e=new u.QR;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.selectedProjectsIdentifiers=this.selectedProjectsIdentifiers,e.profitabilityProjectStartDate=this.profitabilityProjectStartDate,e.profitabilityProjectEndDate=this.profitabilityProjectEndDate,sessionStorage.setItem("profitabilityProjectSearch",JSON.stringify(e)),this.computeStartMonthandYear(),this.getProfitabilityProject(this.selectedActivitiesIds,this.selectedProjectsIds,this.profitabilityProjectStartDate,this.profitabilityProjectEndDate)}},{key:"getProfitabilityProject",value:function(e,t,n,i){var o=this;this.isLoading=!0,this.profitabilityProjectService.getProfitabilityProject(e,t,n,i).subscribe(function(r){null!=r&&o.profitabilityProjectService.getProfitabilityActivityProject(e,t,n,i).subscribe(function(e){if(o.isLoading=!1,o.profitabilityActivitiesProjects=e,o.prepareProfitabilityProjects(r),o.AddProjectsWithoutResourcesLoad(),o.profitabilityProjectsLength=o.profitabilityProjects.length,o.emptyResult=!1,o.listView=!0,0===o.profitabilityProjects.length)o.emptyResult=!0;else if(void 0!==o.profitabilityProjects){var t=o.profitabilityProjectGroupService.getProfitabilityProjectsGrouped(o.profitabilityProjects,o.profitabilityProjects,o.profitabilityActivitiesProjects,o.monthsCount);o.profitabilityProjectsGrouped=JSON.parse(JSON.stringify(t)),o.profitabilityProjectsGroup=o.profitabilityProjectsGrouped.filter(function(e){return 1===e.level}),o.profitabilityProjectsGroupLength=o.profitabilityProjectsGroup.length,o.emptyResult=!1}},function(){o.isLoading=!1,o.notificationService.danger("Profitability project not loaded.")})},function(){o.isLoading=!1,o.notificationService.danger("Profitability project not loaded.")})}},{key:"prepareProfitabilityProjects",value:function(e){var t=this;e.forEach(function(e){var n=t.profitabilityProjects.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId&&t.userId===e.userId});if(-1!==n)t.profitabilityProjects[n]=t.prepareProfitabilityProject(t.profitabilityProjects[n],e);else{var i=t.createProfitabilityProject(t.startMonth,t.startYear,t.monthsCount);t.profitabilityProjects.push(t.prepareProfitabilityProject(i,e))}})}},{key:"computeStartMonthandYear",value:function(){this.startMonth=this.profitabilityProjectStartDate.getMonth(),this.startYear=this.profitabilityProjectStartDate.getFullYear(),this.computeMonthsCount()}},{key:"computeMonthsCount",value:function(){this.monthsCount=12*(this.profitabilityProjectEndDate.getFullYear()-this.profitabilityProjectStartDate.getFullYear()),this.monthsCount-=this.profitabilityProjectStartDate.getMonth(),this.monthsCount+=this.profitabilityProjectEndDate.getMonth()+1}},{key:"prepareProfitabilityProject",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=t.projectName,e.companyName=t.companyName,e.userId=t.userId,e.userIdentifier=t.userIdentifier;var n=e.monthsProfitabilityProject.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsProfitabilityProject[n].spentMonthLoad=t.spentMonthLoad,e.monthsProfitabilityProject[n].invoicedMonthLoad=t.invoicedMonthLoad,e.monthsProfitabilityProject[n].achivedMonthCost=t.achivedMonthCost,e.monthsProfitabilityProject[n].invoicedMonthCost=t.invoicedMonthCost,e.monthsProfitabilityProject[n].spentMonthAmount=this.numberFormatter.round(t.spentMonthAmount,0),e.monthsProfitabilityProject[n].spentMonthMission=t.spentMonthMission,e.monthsProfitabilityProject[n].invoicedMonthMission=t.invoicedMonthMission,e.monthsProfitabilityProject[n].saariRef=t.saariRef),e}},{key:"createProfitabilityProject",value:function(e,t,n){for(var i=new u.dv(n),o=0;o<n;o++)e+o<12?(i.monthsProfitabilityProject[o].month=e+o+1,i.monthsProfitabilityProject[o].year=t):(i.monthsProfitabilityProject[o].month=e+o+1-12,i.monthsProfitabilityProject[o].year=t+1);return i}},{key:"AddProjectsWithoutResourcesLoad",value:function(){var e=this;this.profitabilityActivitiesProjects.forEach(function(t){var n=e.profitabilityProjects.find(function(e){return e.activityId===t.activityId&&e.projectId===t.projectId});void 0===n&&((n=e.createProfitabilityProject(e.startMonth,e.startYear,e.monthsCount)).activityId=t.activityId,n.activityName=t.activityName,n.companyName=t.companyName,n.projectId=t.projectId,n.projectName=t.projectName,n.userId=0,n.userIdentifier="No Load",e.profitabilityProjects.push(n))})}},{key:"dateFormat",value:function(e){return null==e||"0001-01-01T00:00:00"===e?"":this.dateTimeService.getShortFormat(e)}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"daysChangePeriodFrom",value:function(e){var t=new Date(e);this.profitabilityProjectStartDate=de([t.getFullYear(),t.getMonth()]).toDate(),this.minDate=this.profitabilityProjectStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityProjectEndDate=de([t.getFullYear(),t.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityProjectEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"daysChangePeriodTo",value:function(e){var t=new Date(e);this.profitabilityProjectEndDate=de(t).endOf("month").toDate(),this.maxDate=this.profitabilityProjectEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityProjectStartDate=de([t.getFullYear(),t.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityProjectStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"exportToExcel",value:function(){var e=this;if(void 0!==this.profitabilityProjects&&0!==this.profitabilityProjects.length){var t=[],n=[],i=this.subColumnsNames.length,o=[],r=[];t.push({header:"",key:"A",width:20}),t.push({header:"",key:"B",width:20}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});var a=["Activity","Project","Company","Resource"];r.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityProjectsGrouped[1].monthsProfitabilityProject.forEach(function(n){e.subColumnsNames.forEach(function(i){t.push({header:void 0!==n.month?e.monthNames[n.month-1].toString()+" "+n.year.toString():"Total",key:i+n.monthIndex,width:20}),a.push(i)}),o.push(e.getExcelColumn(5+i*n.monthIndex)+"1:"+e.getExcelColumn(4+i*(n.monthIndex+1))+"1"),r.push({cell:e.getExcelColumn(5+i*n.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});var l=0;e.subColumnsNames.forEach(function(){r.push({cell:e.getExcelColumn(5+i*n.monthIndex+l)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),l++})}),n.push(a),this.profitabilityProjectsGrouped.forEach(function(t){1!==t.level&&((a=[]).push(t.activityName),a.push(t.projectName),a.push(t.companyName),a.push(t.userIdentifier),t.monthsProfitabilityProject.forEach(function(t){a.push(e.formatNullOrEmptyValue(t.spentMonthLoad)),a.push(e.formatNullOrEmptyValue(t.invoicedMonthLoad)),a.push(t.spentMonthAmount),a.push(t.achivedMonthCost),a.push(t.invoicedMonthCost),a.push(t.spentMonthMission),a.push(t.invoicedMonthMission),a.push(t.saariRef)}),n.push(a))}),this.excelService.generateExcel(t,n,o,r,"Profitability_Project")}}},{key:"getExcelColumn",value:function(e){var t=26,n=e%t==0?Math.floor(e/t)-1:Math.floor(e/t),i=e%t==0?t:e%t;return e<=t?String.fromCharCode(i+64):String.fromCharCode(n+64)+String.fromCharCode(i+64)}},{key:"formatNullOrEmptyValue",value:function(e){return""===e||null===e?0:e}},{key:"openProfitabilityProjectLegend",value:function(){this.uploadDialogRef=this.dialog.open(dt,{disableClose:!1,panelClass:"form_modal",width:"700px",height:"320px",hasBackdrop:!0,data:{}})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(m.Injector))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-project"]],decls:49,vars:20,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange","click","onDropDownClose"],[1,"col-xl-3","col-lg-12"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","ngModelChange"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityProjects","profitabilityProjectsFiltred","profitabilityActivitiesProjects","monthsCount"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Period"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-select-month",8),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodFrom(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",7),m.\u0275\u0275elementStart(14,"app-select-month",9),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodTo(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(15,"div",5),m.\u0275\u0275elementStart(16,"mat-list"),m.\u0275\u0275elementStart(17,"mat-list-item"),m.\u0275\u0275elementStart(18,"h3",6),m.\u0275\u0275text(19,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(20,"div",10),m.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e})("click",function(){return t.dropDownSelected=!0})("onDropDownClose",function(){return t.onDropDownClose()}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(22,"div",12),m.\u0275\u0275elementStart(23,"mat-list"),m.\u0275\u0275elementStart(24,"mat-list-item"),m.\u0275\u0275elementStart(25,"h3",6),m.\u0275\u0275text(26,"Projects"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(27,"div",10),m.\u0275\u0275elementStart(28,"ng-multiselect-dropdown",13),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedProjectsIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(29,"div",14),m.\u0275\u0275elementStart(30,"div",15),m.\u0275\u0275elementStart(31,"button",16),m.\u0275\u0275listener("click",function(){return t.searchProfitabilityProject()}),m.\u0275\u0275text(32,"Search"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(33,"nav",17),m.\u0275\u0275elementStart(34,"div",18),m.\u0275\u0275elementStart(35,"button",19),m.\u0275\u0275listener("click",function(){return t.exportToExcel()}),m.\u0275\u0275element(36,"em",20),m.\u0275\u0275text(37," Export "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(38,"button",19),m.\u0275\u0275listener("click",function(){return t.openProfitabilityProjectLegend()}),m.\u0275\u0275element(39,"em",21),m.\u0275\u0275text(40," Legend "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(41,"div",22),m.\u0275\u0275element(42,"app-paginator",23),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(43,jt,3,0,"div",24),m.\u0275\u0275elementStart(44,"div",25),m.\u0275\u0275elementStart(45,"div",26),m.\u0275\u0275template(46,wt,6,0,"div",27),m.\u0275\u0275template(47,Dt,3,10,"div",28),m.\u0275\u0275template(48,Rt,1,2,"div",28),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("selectedDate",t.profitabilityProjectStartDate)("maxDate",t.maxDate),m.\u0275\u0275advance(2),m.\u0275\u0275property("selectedDate",t.profitabilityProjectEndDate)("minDate",t.minDate),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers)("settings",t.dropdownSettings)("disabled",!t.isSuperAdmin),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("data",t.projectsIdentifiers)("ngModel",t.selectedProjectsIdentifiers)("settings",t.dropdownSettings),m.\u0275\u0275advance(14),m.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.profitabilityProjectsLength),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.emptyResult&&t.listView),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngIf",t.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult))},directives:[v.i$,v.Tg,ue.j,l.OP,b.NgControlStatus,b.NgModel,P.M2,E.J,r.NgIf,D.$g,At],pipes:[te.R],styles:[".search-input{font-size:14px}.multi-search{width:100%}.mat-list .mat-subheader{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper{width:100%;height:100%}.overlay{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper{display:flex;justify-content:center;justify-items:center}#loader{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}\n"],encapsulation:2}),t}(),Nt=function(){var t=function(){function t(n){e(this,t),this.dialogRef=n}return n(t,[{key:"close",value:function(){this.dialogRef.close()}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.so))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-resource-legend"]],decls:47,vars:0,consts:[[1,"form-container"],[1,"modal_header"],[1,"modal_title"],[1,"material-icons","modal-close",3,"click"],[1,"modal_body"],[2,"font-weight","bold"],[2,"font-weight","bold","color","rgb(0, 184, 83)"],[2,"font-weight","bold","color","rgb(255, 81, 0)"],[1,"modal_footer"],[1,"pull-right"],["type","button",1,"btn","btn-outline-primary","m-r-5",3,"click"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"form",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"span"),m.\u0275\u0275text(4," Profitability Resource Legend "),m.\u0275\u0275elementStart(5,"em",3),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(6,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"div",4),m.\u0275\u0275elementStart(8,"div"),m.\u0275\u0275elementStart(9,"span",5),m.\u0275\u0275text(10,"Spent (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(11," la charge d\xe9pens\xe9e (projets; projets g\xe9n\xe9riques...) de la personne."),m.\u0275\u0275element(12,"br"),m.\u0275\u0275elementStart(13,"span",5),m.\u0275\u0275text(14,"Invoiced (MD): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(15,"La charge factur\xe9e (HJ) = la charge factur\xe9e de la personne."),m.\u0275\u0275element(16,"br"),m.\u0275\u0275elementStart(17,"span",5),m.\u0275\u0275text(18,"Spent Amount (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(19,"La charge d\xe9pens\xe9e (\u20ac) = co\xfbt interne * 20 jours."),m.\u0275\u0275element(20,"br"),m.\u0275\u0275elementStart(21,"span",5),m.\u0275\u0275text(22,"Invoiced Cost (\u20ac): "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(23,"La charge factur\xe9e (\u20ac) = la somme (co\xfbt externe selon profil de la personne * nbr de jours factur\xe9s) de la personne."),m.\u0275\u0275element(24,"br"),m.\u0275\u0275elementStart(25,"span",5),m.\u0275\u0275text(26,"Productivity (%):"),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(27,"Rentabilit\xe9 (%)"),m.\u0275\u0275element(28,"br"),m.\u0275\u0275elementStart(29,"span"),m.\u0275\u0275text(30,"- En charge : "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(31,"(Invoiced (MD) / Spent (MD)) * 100. (Les jours des cong\xe9s ne sont pas pris en compte dans la charge d\xe9pens\xe9)"),m.\u0275\u0275element(32,"br"),m.\u0275\u0275elementStart(33,"span"),m.\u0275\u0275text(34,"- En co\xfbt : "),m.\u0275\u0275elementEnd(),m.\u0275\u0275text(35,"((Invoiced Cost (\u20ac) \u2013 Spent Amount (\u20ac)) / Spent Amount (\u20ac)) * 100."),m.\u0275\u0275element(36,"br"),m.\u0275\u0275elementStart(37,"span",6),m.\u0275\u0275text(38,"La couleur verte correspond aux projets g\xe9n\xe9riques. "),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(39,"br"),m.\u0275\u0275elementStart(40,"span",7),m.\u0275\u0275text(41,"La couleur orang\xe9e correspond aux projets qui n'appartiennent pas \xe0 l'activit\xe9 s\xe9lectionn\xe9e. "),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(42,"br"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(43,"div",8),m.\u0275\u0275elementStart(44,"div",9),m.\u0275\u0275elementStart(45,"button",10),m.\u0275\u0275listener("click",function(){return t.close()}),m.\u0275\u0275text(46,"close"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())},directives:[b.\u0275NgNoValidate,b.NgControlStatusGroup,b.NgForm],styles:[".modal_header[_ngcontent-%COMP%]{height:50px;background-color:#3f629d;padding:18px 15px}.modal_header[_ngcontent-%COMP%]   .modal_title[_ngcontent-%COMP%]{color:#fff;line-height:1}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]{float:right;cursor:pointer}.modal_header[_ngcontent-%COMP%]   .modal-close[_ngcontent-%COMP%]:hover{color:red}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]{cursor:not-allowed;color:#dcdcdc}.modal_header[_ngcontent-%COMP%]   .modal-close-disabled[_ngcontent-%COMP%]:hover{color:#dcdcdc}.modal_body[_ngcontent-%COMP%]{height:260px;padding:25px}.modal_footer[_ngcontent-%COMP%]{padding:25px}"]}),t}();function Ft(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",9),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275attribute("colspan",i.displayedSubColumnsNamesCount),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(n)," ")}}function Ot(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",10),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.displayedSubColumns[n]," ")}}function Tt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",18),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValueByCost(n,i)," ")}}function _t(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",14),m.\u0275\u0275elementStart(1,"td",15),m.\u0275\u0275elementStart(2,"span",16),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(4,Tt,2,1,"td",17),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",n.activityName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function Wt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i)," ")}}function zt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",14),m.\u0275\u0275element(1,"td",15),m.\u0275\u0275template(2,Wt,2,1,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext(2);m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",n.displayedSubColumns)}}function Ht(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Vt(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext(2).$implicit;m.\u0275\u0275textInterpolate1(" ",n.userIdentifier," ")}}function Gt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Bt(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValueByCost(n,i),"")}}function Jt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",18),m.\u0275\u0275template(1,Gt,2,0,"div",23),m.\u0275\u0275template(2,Bt,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getTotalSubColumnValueByCost(n,o)&&void 0===o)("ngIfElse",i)}}function $t(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",21),m.\u0275\u0275elementStart(1,"td",22),m.\u0275\u0275template(2,Ht,2,0,"div",23),m.\u0275\u0275template(3,Vt,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(5,Jt,4,2,"td",17),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275reference(4),i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",i.userIdentifier,""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValueByCost(o.i,i))("ngIfElse",n),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",o.displayedSubColumns)}}function Yt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function Ut(e,t){}function Qt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function qt(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate1(" ",o.getTotalSubColumnValue(n,i),"")}}function Kt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275template(1,Qt,2,0,"div",23),m.\u0275\u0275template(2,qt,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getTotalSubColumnValue(n,o))("ngIfElse",i)}}function Zt(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",21),m.\u0275\u0275elementStart(1,"td",22),m.\u0275\u0275template(2,Yt,2,0,"div",23),m.\u0275\u0275template(3,Ut,0,0,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(5,Kt,4,2,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275reference(4),i=m.\u0275\u0275nextContext().$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",i.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==o.getTotalSubColumnValue(o.i,i))("ngIfElse",n),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngForOf",o.displayedSubColumns)}}function Xt(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function en(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate(o.getSubColumnValue(n,i))}}function tn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275template(1,Xt,2,0,"div",23),m.\u0275\u0275template(2,en,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getSubColumnValue(n,o))("ngIfElse",i)}}function nn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",25),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,tn,4,2,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function on(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function rn(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate(o.getSubColumnValue(n,i))}}function an(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275template(1,on,2,0,"div",23),m.\u0275\u0275template(2,rn,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getSubColumnValue(n,o))("ngIfElse",i)}}function ln(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",26),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,an,4,2,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function sn(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275text(1," - "),m.\u0275\u0275elementEnd())}function cn(e,t){if(1&e&&m.\u0275\u0275text(0),2&e){var n=m.\u0275\u0275nextContext().index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275textInterpolate(o.getSubColumnValue(n,i))}}function dn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275template(1,sn,2,0,"div",23),m.\u0275\u0275template(2,cn,1,1,"ng-template",null,24,m.\u0275\u0275templateRefExtractor),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275reference(3),o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",-1==r.getSubColumnValue(n,o))("ngIfElse",i)}}function un(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",27),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,dn,4,2,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.displayedSubColumns)}}function mn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tbody"),m.\u0275\u0275template(1,_t,5,2,"tr",11),m.\u0275\u0275template(2,zt,3,1,"tr",11),m.\u0275\u0275template(3,$t,6,4,"tr",12),m.\u0275\u0275template(4,Zt,6,4,"tr",12),m.\u0275\u0275template(5,nn,4,3,"tr",13),m.\u0275\u0275template(6,ln,4,3,"tr",13),m.\u0275\u0275template(7,un,4,3,"tr",13),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",1==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",1==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",2==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",2==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level&&0===n.projectActivityId),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level&&0!==n.projectActivityId&&n.projectActivityId!==n.activityId),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level&&0!==n.projectActivityId&&n.projectActivityId===n.activityId)}}var hn=function(){var t=function(){function t(n,i,o,r){e(this,t),this.dialog=n,this.profitabilityResourceGroupService=i,this.dateTimeService=o,this.numberFormatter=r,this.displayedColumns=["userIdentifier"],this.displayedSubColumns=[],this.displayedSubColumnsNames=["Spent \u20ac / MD","Invoiced \u20ac / MD","Productivity %"],this.displayedSubColumnsNamesCount=this.displayedSubColumnsNames.length,this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.profitabilityResourcesGrouped=[]}return n(t,[{key:"ngOnInit",value:function(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColmnsHeader(),this.listView=!0}},{key:"ngOnChanges",value:function(){(null!==this.profitabilityResources||void 0!==this.profitabilityResources)&&(this.profitabilityResourcesGrouped=this.profitabilityResourceGroupService.getProfitabilityResourcesGrouped(this.profitabilityResources,this.profitabilityResourcesFiltred,this.profitabilityResourcesSpentTotal,this.monthsCount))}},{key:"buildColmnsHeader",value:function(){if((null!==this.profitabilityResources||void 0!==this.profitabilityResources)&&this.profitabilityResources.length>0)for(var e=this.profitabilityResources[0].monthsProfitabilityResource.length,t=0;t<e;t++){this.displayedColumns.push("M"+t);var n=this.profitabilityResources[0].monthsProfitabilityResource[this.getMonthIndex(t)].month-1,i=this.profitabilityResources[0].monthsProfitabilityResource[this.getMonthIndex(t)].year;isNaN(n)?this.monthColumnsHeaders.push("Total"):this.monthColumnsHeaders.push(this.monthNames[n]+i),this.displayedSubColumns=this.displayedSubColumns.concat(this.displayedSubColumnsNames)}}},{key:"getMonthIndex",value:function(e){return Math.floor(e)}},{key:"getMonthDetailsIndex",value:function(e){return Math.floor(e/this.displayedSubColumnsNamesCount)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityResource[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityResource[i].spentMonthLoad,1);case 1:return this.numberFormatter.round(t.monthsProfitabilityResource[i].invoicedMonthLoad,1);case 2:return this.getResourceProjectLoadProductivity(t,i)}}},{key:"getTotalSubColumnValue",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityResource[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityResource[i].spentMonthLoad,1);case 1:return this.numberFormatter.round(t.monthsProfitabilityResource[i].invoicedMonthLoad,1);case 2:return this.getResourceLoadProductivity(t,i)}}},{key:"getTotalSubColumnValueByCost",value:function(e,t){var n=e%this.displayedSubColumnsNamesCount,i=Math.floor(e/this.displayedSubColumnsNamesCount);if(void 0!==t.monthsProfitabilityResource[i])switch(n){case 0:return this.numberFormatter.round(t.monthsProfitabilityResource[i].spentMonthAmount,1);case 1:return this.numberFormatter.round(t.monthsProfitabilityResource[i].achivedMonthCost,1);case 2:return this.getResourceCostProductivity(t,i)}}},{key:"getResourceCostProductivity",value:function(e,t){if(2===e.level){var n=e.monthsProfitabilityResource[t].achivedMonthCost,i=e.monthsProfitabilityResource[t].spentMonthAmount;return void 0!==i&&0!==i&&void 0!==n?this.numberFormatter.round(100*(n/i-1),1):"N/A"}if(1===e.level)return"-"}},{key:"getResourceLoadProductivity",value:function(e,t){if(2===e.level){var n=e.monthsProfitabilityResource[t].spentMonthLoadNotLeave,i=e.monthsProfitabilityResource[t].invoicedMonthLoad;return void 0!==n&&0!==n&&void 0!==i?this.numberFormatter.round(i/n*100,1):"N/A"}if(1===e.level)return"-"}},{key:"getResourceProjectLoadProductivity",value:function(e,t){var n=e.monthsProfitabilityResource[t].spentMonthLoad,i=e.monthsProfitabilityResource[t].invoicedMonthLoad;return void 0!==n&&0!==n&&void 0!==i?this.numberFormatter.round(i/n*100,1):"N/A"}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"datePipe",value:function(e){return"0001-01-01T00:00:00"===e?"":e}},{key:"format",value:function(e){return 0===e?"":e}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(h.Bt),m.\u0275\u0275directiveInject(f.Cv),m.\u0275\u0275directiveInject(se.e))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-resource"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},inputs:{profitabilityResources:"profitabilityResources",profitabilityResourcesFiltred:"profitabilityResourcesFiltred",profitabilityResourcesSpentTotal:"profitabilityResourcesSpentTotal",monthsCount:"monthsCount"},features:[m.\u0275\u0275NgOnChangesFeature],decls:10,vars:3,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],[1,"th-first"],["rowspan","2","scope","col",1,"th-third"],["id","monthHeader",4,"ngFor","ngForOf"],[1,"th-second"],["id","subColumns",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["id","subColumns"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center; border-bottom: 1px solid #c8cecf;",4,"ngFor","ngForOf"],[2,"text-align","center","border-bottom","1px solid #c8cecf"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[4,"ngIf","ngIfElse"],["elseBlock",""],[1,"td-third",2,"width","15%","color","rgb(0, 184, 83)",3,"matTooltip"],[1,"td-third",2,"width","15%","color","rgb(255, 81, 0)",3,"matTooltip"],[1,"td-third",2,"width","15%",3,"matTooltip"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0),m.\u0275\u0275element(1,"caption",1),m.\u0275\u0275elementStart(2,"thead",2),m.\u0275\u0275elementStart(3,"tr",3),m.\u0275\u0275elementStart(4,"th",4),m.\u0275\u0275text(5,"Activity / Resource / Project"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(6,Ft,2,2,"th",5),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(7,"tr",6),m.\u0275\u0275template(8,Ot,2,1,"th",7),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(9,mn,8,7,"tbody",8),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(6),m.\u0275\u0275property("ngForOf",t.monthColumnsHeaders),m.\u0275\u0275advance(2),m.\u0275\u0275property("ngForOf",t.displayedSubColumns),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",t.profitabilityResourcesGrouped))},directives:[r.NgForOf,r.NgIf,L.gM],styles:["thead[_ngcontent-%COMP%]   tr.th-first[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:0;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   tr.th-second[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;top:43px;background:#3f629d;z-index:2}thead[_ngcontent-%COMP%]   th.th-third[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#subColumns[_ngcontent-%COMP%]{margin-bottom:-10px;width:calc(100% - 1.2em);background-color:#3f629d;color:#fff;border-top:1px solid #dee2e6;border-bottom:none;font-weight:normal;font-size:.85em;text-align:center}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}"]}),t}();function pn(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275elementStart(1,"h1"),m.\u0275\u0275text(2,"No Result Found"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function fn(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",28),m.\u0275\u0275elementStart(1,"div",29),m.\u0275\u0275elementStart(2,"div",30),m.\u0275\u0275elementStart(3,"div",1),m.\u0275\u0275elementStart(4,"div",31),m.\u0275\u0275element(5,"mat-spinner"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function vn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",32),m.\u0275\u0275element(1,"app-resource",33),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("profitabilityResources",m.\u0275\u0275pipeBind3(2,6,n.profitabilityResources,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("profitabilityResourcesFiltred",n.profitabilityResources)("profitabilityResourcesSpentTotal",n.profitabilityResourcesSpentTotal)("monthsCount",n.monthsCount)}}var yn=function(){var t=function(){function t(n){e(this,t),this.emptyResult=!1,this.profitabilityResourcesGrouped=[],this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new f.nJ,this.paginatorPipe=new le.Ry(this.searchFilterService),this.subscription=new ae.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.subColumnsNames=["Spent MD","Spent \u20ac","Invoiced MD","Invoiced \u20ac","Productivity MD %","Productivity \u20ac %"],this.dialog=n.get(re.uw),this.sortService=n.get(f.Kx),this.searchFilterService=n.get(f.nJ),this.excelService=n.get(f.xB),this.profitabilityResourceService=n.get(h.LH),this.profitabilityResourceGroupService=n.get(h.Bt),this.projectService=n.get(p.Y4),this.dateTimeService=n.get(f.Cv),this.numberFormatter=n.get(se.e),this.notificationService=n.get(f.gq)}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===c.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!1,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!0,allowSearchFilter:!0,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.profitabilityResourceService.reloadProfitabilityResource.subscribe(function(t){var n=JSON.parse(sessionStorage.getItem("profitabilityResourceSearch")),i=n.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(",");e.getProfitabilityResource(i,n.profitabilityResourceStartDate,n.profitabilityResourceEndDate)})),this.profitabilityResourcesLength=0,this.getActivities(),this.subscription.add(this.searchFilterService.resultChanged.subscribe(function(){setTimeout(function(){e.emptyResult=0===e.searchFilterService.showingDataLastFilter.length})}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"onResetActivity",value:function(){this.selectedActivitiesIdentifiers=[]}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t,e.setSearchFilter())})}},{key:"setSearchFilter",value:function(){var e=this,t=JSON.parse(sessionStorage.getItem("profitabilityResourceSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),null!=t.profitabilityResourceStartDate&&(this.profitabilityResourceStartDate=new Date(t.profitabilityResourceStartDate),this.minDate=this.profitabilityResourceStartDate),null!=t.profitabilityResourceEndDate&&(this.profitabilityResourceEndDate=new Date(t.profitabilityResourceEndDate),this.maxDate=this.profitabilityResourceEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId});var n=this.dateTimeService.today();this.profitabilityResourceStartDate=de([n.getFullYear(),n.getMonth()]).toDate(),this.profitabilityResourceEndDate=de(n).endOf("month").toDate(),this.minDate=this.profitabilityResourceStartDate,this.maxDate=this.profitabilityResourceEndDate}}},{key:"searchProfitabilityResource",value:function(){this.searchFilterService.pageIndex=0,this.profitabilityResources=[],this.profitabilityResourcesLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),this.emptyResult=!0,this.listView=!1;var e=new u.W_;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.profitabilityResourceStartDate=this.profitabilityResourceStartDate,e.profitabilityResourceEndDate=this.profitabilityResourceEndDate,sessionStorage.setItem("profitabilityResourceSearch",JSON.stringify(e)),this.computeStartMonthandYear(),this.getProfitabilityResource(this.selectedActivitiesIds,this.profitabilityResourceStartDate,this.profitabilityResourceEndDate)}},{key:"getProfitabilityResource",value:function(e,t,n){var i=this;this.isLoading=!0,this.profitabilityResourceService.getProfitabilityResource(e,t,n).subscribe(function(o){null!=o&&i.profitabilityResourceService.getProfitabilityResourceSpentTotal(e,t,n).subscribe(function(e){if(i.isLoading=!1,i.profitabilityResourcesSpentTotal=e,i.prepareProfitabilityResources(o),i.profitabilityResourcesLength=i.profitabilityResources.length,i.emptyResult=!1,i.listView=!0,0===i.profitabilityResources.length)i.emptyResult=!0;else{var t=i.profitabilityResourceGroupService.getProfitabilityResourcesGrouped(i.profitabilityResources,i.profitabilityResources,i.profitabilityResourcesSpentTotal,i.monthsCount);i.profitabilityResourcesGrouped=JSON.parse(JSON.stringify(t)),i.emptyResult=!1}},function(){i.isLoading=!1,i.notificationService.danger("Profitability resource not loaded.")})},function(){i.isLoading=!1,i.notificationService.danger("Profitability resource not loaded.")})}},{key:"prepareProfitabilityResources",value:function(e){var t=this;e.forEach(function(e){var n=t.profitabilityResources.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId&&t.userId===e.userId});if(-1!==n)t.profitabilityResources[n]=t.prepareProfitabilityResource(t.profitabilityResources[n],e);else{var i=t.createProfitabilityResource(t.startMonth,t.startYear,t.monthsCount);t.profitabilityResources.push(t.prepareProfitabilityResource(i,e))}})}},{key:"computeStartMonthandYear",value:function(){this.startMonth=this.profitabilityResourceStartDate.getMonth(),this.startYear=this.profitabilityResourceStartDate.getFullYear(),this.computeMonthsCount()}},{key:"computeMonthsCount",value:function(){this.monthsCount=12*(this.profitabilityResourceEndDate.getFullYear()-this.profitabilityResourceStartDate.getFullYear()),this.monthsCount-=this.profitabilityResourceStartDate.getMonth(),this.monthsCount+=this.profitabilityResourceEndDate.getMonth()+1}},{key:"prepareProfitabilityResource",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=t.projectName,e.projectActivityId=t.projectActivityId,e.userId=t.userId,e.userIdentifier=t.userIdentifier,e.userNumber=t.userNumber,e.fullName=t.fullName;var n=e.monthsProfitabilityResource.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsProfitabilityResource[n].spentMonthLoad=this.numberFormatter.round(t.spentMonthLoad,1),e.monthsProfitabilityResource[n].spentMonthLoadNotLeave=this.numberFormatter.round(t.spentMonthLoad,1),e.monthsProfitabilityResource[n].invoicedMonthLoad=t.invoicedMonthLoad,e.monthsProfitabilityResource[n].achivedMonthCost=t.achivedMonthCost),e}},{key:"createProfitabilityResource",value:function(e,t,n){for(var i=new u.ud(n),o=0;o<n;o++)e+o<12?(i.monthsProfitabilityResource[o].month=e+o+1,i.monthsProfitabilityResource[o].year=t):(i.monthsProfitabilityResource[o].month=e+o+1-12,i.monthsProfitabilityResource[o].year=t+1);return i}},{key:"exportToExcel",value:function(){var e=this;if(void 0!==this.profitabilityResources&&0!==this.profitabilityResources.length){var t=[],n=[],i=this.subColumnsNames.length,o=[],r=[];t.push({header:"",key:"A",width:25}),t.push({header:"",key:"B",width:8}),t.push({header:"",key:"C",width:20}),t.push({header:"",key:"D",width:20});var a=["Activity","Matricule","Resource","Project"];r.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}},{cell:"D2",font:{bold:!0}}),this.profitabilityResourcesGrouped[0].monthsProfitabilityResource.forEach(function(n){e.subColumnsNames.forEach(function(i){t.push({header:void 0!==n.month?e.monthNames[n.month-1].toString()+" "+n.year.toString():"Total",key:i+n.monthIndex,width:20}),a.push(i)}),o.push(e.getExcelColumn(5+i*n.monthIndex)+"1:"+e.getExcelColumn(4+i*(n.monthIndex+1))+"1"),r.push({cell:e.getExcelColumn(5+i*n.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});var l=0;e.subColumnsNames.forEach(function(){r.push({cell:e.getExcelColumn(5+i*n.monthIndex+l)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),l++})}),n.push(a),this.profitabilityResourcesGrouped.forEach(function(t){(a=[]).push(t.activityName),a.push(t.userNumber),a.push(t.fullName),a.push(t.projectName),t.monthsProfitabilityResource.forEach(function(n){a.push(e.formatNullOrEmptyValue(n.spentMonthLoad)),1===t.level||2===t.level?(a.push(e.formatNullOrEmptyValue(n.spentMonthAmount)),a.push(e.formatNullOrEmptyValue(n.invoicedMonthLoad)),a.push(e.formatNullOrEmptyValue(n.achivedMonthCost)),a.push(e.getResourceProjectLoadProductivity(t.level,n)),a.push(e.getResourceProjectCostProductivity(t.level,n))):(a.push("-"),a.push(e.formatNullOrEmptyValue(n.invoicedMonthLoad)),a.push("-"),a.push(e.getResourceProjectLoadProductivity(t.level,n)),a.push("-"))}),n.push(a)}),this.excelService.generateExcel(t,n,o,r,"Profitability_Resource")}}},{key:"formatNullOrEmptyValue",value:function(e){return""===e||null===e?0:e}},{key:"getResourceProjectLoadProductivity",value:function(e,t){if(1!==e){if(void 0!==t.spentMonthLoadNotLeave&&0!==t.spentMonthLoadNotLeave&&void 0!==t.invoicedMonthLoad){if(2===e)return this.numberFormatter.round(t.invoicedMonthLoad/t.spentMonthLoadNotLeave*100,1);var n=t.spentMonthLoad,i=t.invoicedMonthLoad;if(void 0!==n&&0!==n&&void 0!==i)return this.numberFormatter.round(i/n*100,1)}return"N/A"}return"-"}},{key:"getResourceProjectCostProductivity",value:function(e,t){if(2===e){var n=t.achivedMonthCost,i=t.spentMonthAmount;return void 0!==i&&0!==i&&void 0!==n?this.numberFormatter.round(100*(n/i-1),1):"N/A"}if(1===e)return"-"}},{key:"getExcelColumn",value:function(e){var t=26,n=e%t==0?Math.floor(e/t)-1:Math.floor(e/t),i=e%t==0?t:e%t;return e<=t?String.fromCharCode(i+64):String.fromCharCode(n+64)+String.fromCharCode(i+64)}},{key:"dateFormat",value:function(e){return null==e||"0001-01-01T00:00:00"===e?"":this.dateTimeService.getShortFormat(e)}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"daysChangePeriodFrom",value:function(e){var t=new Date(e);this.profitabilityResourceStartDate=de([t.getFullYear(),t.getMonth()]).toDate(),this.minDate=this.profitabilityResourceStartDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityResourceEndDate=de([t.getFullYear(),t.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.profitabilityResourceEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"daysChangePeriodTo",value:function(e){var t=new Date(e);this.profitabilityResourceEndDate=de(t).endOf("month").toDate(),this.maxDate=this.profitabilityResourceEndDate,this.computeMonthsCount(),this.monthsCount>12&&(this.profitabilityResourceStartDate=de([t.getFullYear(),t.getMonth()]).add(-11,"months").endOf("month").toDate(),this.minDate=this.profitabilityResourceStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"openProfitabilityResourceLegend",value:function(){this.uploadDialogRef=this.dialog.open(Nt,{disableClose:!1,panelClass:"form_modal",width:"750px",height:"390px",hasBackdrop:!0,data:{}})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(m.Injector))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-profitability-resource"]],decls:42,vars:15,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","data","ngModel","settings","disabled","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"nav-item","nav-grid","col-sm-4"],["type","button",1,"btn","btn-sm","btn-primary","m-r-10",2,"font-size","inherit",3,"click"],[1,"fa","fa-file-excel-o",2,"font-size","medium"],[1,"fa","fa-info-circle",2,"font-size","large"],[1,"col-sm-8"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"profitabilityResources","profitabilityResourcesFiltred","profitabilityResourcesSpentTotal","monthsCount"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Period"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-select-month",8),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodFrom(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",7),m.\u0275\u0275elementStart(14,"app-select-month",9),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodTo(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(15,"div",5),m.\u0275\u0275elementStart(16,"mat-list"),m.\u0275\u0275elementStart(17,"mat-list-item"),m.\u0275\u0275elementStart(18,"h3",6),m.\u0275\u0275text(19,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(20,"div",10),m.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),m.\u0275\u0275listener("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(22,"div",12),m.\u0275\u0275elementStart(23,"div",13),m.\u0275\u0275elementStart(24,"div",14),m.\u0275\u0275elementStart(25,"button",15),m.\u0275\u0275listener("click",function(){return t.searchProfitabilityResource()}),m.\u0275\u0275text(26,"Search"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(27,"nav",16),m.\u0275\u0275elementStart(28,"div",17),m.\u0275\u0275elementStart(29,"button",18),m.\u0275\u0275listener("click",function(){return t.exportToExcel()}),m.\u0275\u0275element(30,"em",19),m.\u0275\u0275text(31," Export "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(32,"button",18),m.\u0275\u0275listener("click",function(){return t.openProfitabilityResourceLegend()}),m.\u0275\u0275element(33,"em",20),m.\u0275\u0275text(34," Legend "),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(35,"div",21),m.\u0275\u0275element(36,"app-paginator",22),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(37,pn,3,0,"div",23),m.\u0275\u0275elementStart(38,"div",24),m.\u0275\u0275elementStart(39,"div",25),m.\u0275\u0275template(40,fn,6,0,"div",26),m.\u0275\u0275template(41,vn,3,10,"div",27),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("selectedDate",t.profitabilityResourceStartDate)("maxDate",t.maxDate),m.\u0275\u0275advance(2),m.\u0275\u0275property("selectedDate",t.profitabilityResourceEndDate)("minDate",t.minDate),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers)("settings",t.dropdownSettings)("disabled",!t.isSuperAdmin),m.\u0275\u0275advance(15),m.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.profitabilityResourcesLength),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.emptyResult&&t.listView),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngIf",t.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult))},directives:[v.i$,v.Tg,ue.j,l.OP,b.NgControlStatus,b.NgModel,P.M2,E.J,r.NgIf,D.$g,hn],pipes:[te.R],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.multi-search[_ngcontent-%COMP%]{width:100%}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;justify-items:center}#loader[_ngcontent-%COMP%]{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}"]}),t}();function gn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"th",6),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",i.getColumnHeader(n)," ")}}function bn(e,t){1&e&&m.\u0275\u0275element(0,"td",14)}function Sn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",10),m.\u0275\u0275elementStart(1,"td",11),m.\u0275\u0275elementStart(2,"span",12),m.\u0275\u0275text(3),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(4,bn,1,0,"td",13),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(3),m.\u0275\u0275textInterpolate1(" ",n.activityName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.monthColumnsHeaders)}}function xn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",14),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate(o.getTotalColumnValue(n,i))}}function Cn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr",15),m.\u0275\u0275elementStart(1,"td",16),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,xn,2,1,"td",13),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.userIdentifier,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.userIdentifier," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.monthColumnsHeaders)}}function In(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"td",14),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()),2&e){var n=t.index,i=m.\u0275\u0275nextContext(2).$implicit,o=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate(o.getColumnValue(n,i))}}function Pn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",17),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,In,2,1,"td",13),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.monthColumnsHeaders)}}function En(e,t){if(1&e){var n=m.\u0275\u0275getCurrentView();m.\u0275\u0275elementStart(0,"td",20),m.\u0275\u0275listener("blur",function(e){var t=m.\u0275\u0275restoreView(n).index,i=m.\u0275\u0275nextContext(2).$implicit;return m.\u0275\u0275nextContext().submitWorkload(t,i,e)}),m.\u0275\u0275text(1),m.\u0275\u0275elementEnd()}if(2&e){var i=t.index,o=m.\u0275\u0275nextContext(2).$implicit,r=m.\u0275\u0275nextContext();m.\u0275\u0275attribute("contenteditable",r.isEditable(o.projectId)),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate(r.getColumnValue(i,o))}}function kn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tr"),m.\u0275\u0275elementStart(1,"td",18),m.\u0275\u0275text(2),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(3,En,2,2,"td",19),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext().$implicit,i=m.\u0275\u0275nextContext();m.\u0275\u0275advance(1),m.\u0275\u0275propertyInterpolate1("matTooltip"," ",n.projectName,""),m.\u0275\u0275advance(1),m.\u0275\u0275textInterpolate1(" ",n.projectName," "),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",i.monthColumnsHeaders)}}function Mn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"tbody"),m.\u0275\u0275template(1,Sn,5,2,"tr",7),m.\u0275\u0275template(2,Cn,4,3,"tr",8),m.\u0275\u0275template(3,Pn,4,3,"tr",9),m.\u0275\u0275template(4,kn,4,3,"tr",9),m.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",1==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",2==n.level),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level&&null===n.projectActivityId),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",null==n.level&&null!==n.projectActivityId)}}var An=function(){var t=function(){function t(n,i,o,r,a){e(this,t),this.dialog=n,this.notificationService=i,this.invoicedWorkloadService=o,this.invoicedWorkloadGroupService=r,this.dateTimeService=a,this.previousState={getPrevious:!1,pageIndex:null,pageSize:null},this.subscription=new ae.w0,this.displayedColumns=["userIdentifier"],this.monthNames=["Jan ","Feb ","Mar ","Apr ","May ","Jun ","Jul ","Aug ","Sep ","Oct ","Nov ","Dec "],this.monthColumnsHeaders=[],this.invoicedWorkloadsGrouped=[]}return n(t,[{key:"ngOnInit",value:function(){this.user=JSON.parse(localStorage.getItem("currentUser")),this.buildColumnsHeader(),this.listView=!0}},{key:"ngOnChanges",value:function(){this.reloadWorkloads()}},{key:"buildColumnsHeader",value:function(){if((null!==this.invoicedWorkloads||void 0!==this.invoicedWorkloads)&&this.invoicedWorkloads.length>0)for(var e=this.invoicedWorkloads[0].monthsInvoicedWorkload.length,t=0;t<e;t++){this.displayedColumns.push("M"+t);var n=this.invoicedWorkloads[0].monthsInvoicedWorkload[this.getMonthIndex(t)].month-1,i=this.invoicedWorkloads[0].monthsInvoicedWorkload[this.getMonthIndex(t)].year;this.monthColumnsHeaders.push(this.monthNames[n]+i)}}},{key:"getMonthIndex",value:function(e){return Math.floor(e)}},{key:"getColumnHeader",value:function(e){return this.monthColumnsHeaders[e]}},{key:"getColumnValue",value:function(e,t){if(t.monthsInvoicedWorkload[e]&&t.monthsInvoicedWorkload[e].invoicedMonthLoad)return this.format(t.monthsInvoicedWorkload[e].invoicedMonthLoad)}},{key:"getTotalColumnValue",value:function(e,t){if(t.monthsInvoicedWorkload[e])return t.monthsInvoicedWorkload[e].invoicedMonthLoad}},{key:"dateOnly",value:function(e){return this.dateTimeService.dateOnly(e)}},{key:"datePipe",value:function(e){return"0001-01-01T00:00:00"===e?"":e}},{key:"format",value:function(e){return 0===e?"":e}},{key:"submitWorkload",value:function(e,t,n){var i=Number(n.target.textContent);if(void 0!==i){var o=t.monthsInvoicedWorkload[e].workloadId;0!==i?(this.insertOrUpdateWorkload(e,t,i),n.target.textContent=i):(n.target.textContent="",0!==o&&this.deleteWorkload(e,t,i))}}},{key:"isEditable",value:function(e){return null!=e}},{key:"insertOrUpdateWorkload",value:function(e,t,n){var i=this;if(n!==t.monthsInvoicedWorkload[e].invoicedMonthLoad){t.monthsInvoicedWorkload[e].invoicedMonthLoad=n;var o=t.monthsInvoicedWorkload[e].month-1,r=t.monthsInvoicedWorkload[e].year,a=new u.X5;a.workloadId=t.monthsInvoicedWorkload[e].workloadId,a.userId=t.userId,a.workloadStartDate=new Date(r,o,1),a.workloadEndDate=new Date(r,o+1,0),a.budgetedWorkload=n,a.projectId=t.projectId,this.invoicedWorkloadService.insertOrUpdateWorkload(a).subscribe(function(n){0!==n?(t.monthsInvoicedWorkload[e].workloadId=n,i.reloadWorkloads()):i.notificationService.danger("Workload not saved. Workload may already exist, please refresh your screen.")},function(){i.notificationService.danger("Workload not saved, please refresh your screen.")})}}},{key:"deleteWorkload",value:function(e,t,n){var i=this,o=t.monthsInvoicedWorkload[e].workloadId;t.monthsInvoicedWorkload[e].invoicedMonthLoad=n,this.invoicedWorkloadService.deleteWorkload(o).subscribe(function(n){0!==n?(t.monthsInvoicedWorkload[e].workloadId=0,i.reloadWorkloads()):i.notificationService.danger("Workload not deleted. Workload may already deleted, please refresh your screen.")},function(){i.notificationService.danger("Workload not deleted, please refresh your screen.")})}},{key:"reloadWorkloads",value:function(){(null!==this.invoicedWorkloads||void 0!==this.invoicedWorkloads)&&(this.invoicedWorkloadsGrouped=this.invoicedWorkloadGroupService.getInvoicedWorkloadsGrouped(this.invoicedWorkloads,this.invoicedWorkloadsFiltred,this.monthsCount))}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(re.uw),m.\u0275\u0275directiveInject(f.gq),m.\u0275\u0275directiveInject(h.Iv),m.\u0275\u0275directiveInject(h.UN),m.\u0275\u0275directiveInject(f.Cv))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-workload"]],viewQuery:function(e,t){var n;(1&e&&m.\u0275\u0275viewQuery(me.YE,7),2&e)&&(m.\u0275\u0275queryRefresh(n=m.\u0275\u0275loadQuery())&&(t.sort=n.first))},inputs:{invoicedWorkloads:"invoicedWorkloads",invoicedWorkloadsFiltred:"invoicedWorkloadsFiltred",monthsCount:"monthsCount"},features:[m.\u0275\u0275NgOnChangesFeature],decls:8,vars:2,consts:[[1,"table","table-bordered"],[2,"padding","0px"],[1,"th"],["scope","col",1,"th-first"],["id","monthHeader",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],["id","monthHeader"],["style","background-color: lightgoldenrodyellow;",4,"ngIf"],["style","background-color: rgb(178, 240, 248);",4,"ngIf"],[4,"ngIf"],[2,"background-color","lightgoldenrodyellow"],[1,"td-first"],[1,"span-ellipsis"],["style","text-align: center;",4,"ngFor","ngForOf"],[2,"text-align","center"],[2,"background-color","rgb(178, 240, 248)"],[1,"td-second",3,"matTooltip"],[1,"td-third",2,"width","15%","color","red",3,"matTooltip"],[1,"td-third",2,"width","15%",3,"matTooltip"],["style","text-align: center;","onfocus","this.className='focused'","onfocusout","this.className='notFocused'",3,"blur",4,"ngFor","ngForOf"],["onfocus","this.className='focused'","onfocusout","this.className='notFocused'",2,"text-align","center",3,"blur"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"table",0),m.\u0275\u0275element(1,"caption",1),m.\u0275\u0275elementStart(2,"thead",2),m.\u0275\u0275elementStart(3,"tr"),m.\u0275\u0275elementStart(4,"th",3),m.\u0275\u0275text(5,"Activity / Resource / Project"),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(6,gn,2,1,"th",4),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(7,Mn,5,4,"tbody",5),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(6),m.\u0275\u0275property("ngForOf",t.monthColumnsHeaders),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngForOf",t.invoicedWorkloadsGrouped))},directives:[r.NgForOf,r.NgIf,L.gM],styles:["thead[_ngcontent-%COMP%]   th.th-first[_ngcontent-%COMP%]{width:17%;left:0;background:#3f629d;z-index:3!important}tbody[_ngcontent-%COMP%]   td.td-first[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:lightgoldenrodyellow;z-index:1}tbody[_ngcontent-%COMP%]   td.td-second[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:#b2f0f8;z-index:1}tbody[_ngcontent-%COMP%]   td.td-third[_ngcontent-%COMP%]{position:sticky;position:-webkit-sticky;left:0;background:white;z-index:1}.th[_ngcontent-%COMP%]{background-color:#3f629d;color:#fff;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6;font-size:.9em}#monthHeader[_ngcontent-%COMP%]{text-align:center}td[_ngcontent-%COMP%]{font-size:.85em;overflow:hidden;text-overflow:ellipsis;max-width:80px;border-top:0px solid #dee2e6;border-bottom:0px solid #dee2e6}.tr[_ngcontent-%COMP%]{text-align:center}.focused[_ngcontent-%COMP%]{border:2px solid #131212;text-align:center}"]}),t}();function jn(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div"),m.\u0275\u0275elementStart(1,"h1"),m.\u0275\u0275text(2,"No Result Found"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function wn(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",24),m.\u0275\u0275elementStart(1,"div",25),m.\u0275\u0275elementStart(2,"div",26),m.\u0275\u0275elementStart(3,"div",1),m.\u0275\u0275elementStart(4,"div",27),m.\u0275\u0275element(5,"mat-spinner"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd())}function Dn(e,t){if(1&e&&(m.\u0275\u0275elementStart(0,"div",28),m.\u0275\u0275element(1,"app-workload",29),m.\u0275\u0275pipe(2,"paginator"),m.\u0275\u0275elementEnd()),2&e){var n=m.\u0275\u0275nextContext();m.\u0275\u0275classProp("blurred",n.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("invoicedWorkloads",m.\u0275\u0275pipeBind3(2,5,n.invoicedWorkloads,n.searchFilterService.pageIndex,n.searchFilterService.pageSize))("invoicedWorkloadsFiltred",n.invoicedWorkloads)("monthsCount",n.monthsCount)}}var Rn=[{path:"",data:{title:"Indicators",status:!1},canActivate:[d.a1],children:[{path:"load-plan",component:oe,data:{title:"Workload Plan",icon:"icon-home",function:c.FI.LoadPlan,status:!0},canActivate:[d.a1]},{path:"profitability-activity",component:ct,data:{title:"Profitability Activity",icon:"icon-home",function:c.FI.ProfitabilityActivity,status:!0},canActivate:[d.a1]},{path:"profitability-resource",component:yn,data:{title:"Profitability Resource",icon:"icon-home",function:c.FI.ProfitabilityResource,status:!0},canActivate:[d.a1]},{path:"invoiced-workload",component:function(){var t=function(){function t(n){e(this,t),this.emptyResult=!1,this.invoicedWorkloadsLength=0,this.listView=!1,this.isSuperAdmin=!1,this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.searchFilterService=new f.nJ,this.paginatorPipe=new le.Ry(this.searchFilterService),this.subscription=new ae.w0,this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.searchFilterService=n.get(f.nJ),this.invoicedWorkloadService=n.get(h.Iv),this.projectService=n.get(p.Y4),this.dateTimeService=n.get(f.Cv),this.notificationService=n.get(f.gq)}return n(t,[{key:"ngOnInit",value:function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.isSuperAdmin=this.currentUser.groupId===c.Fl.SuperAdmin,this.getActivities(),this.searchFilterService.pageIndex=0,this.searchFilterService.pageSize=24,this.dropdownSettings={singleSelection:!0,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!1,allowSearchFilter:!1,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."},this.subscription.add(this.searchFilterService.resultChanged.subscribe(function(){setTimeout(function(){e.emptyResult=0===e.searchFilterService.showingDataLastFilter.length})}))}},{key:"ngOnDestroy",value:function(){this.subscription.unsubscribe()}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t,e.setSearchFilter())})}},{key:"setSearchFilter",value:function(){var e=this,t=JSON.parse(sessionStorage.getItem("invoicedWorkloadSearch"));if(t)t.selectedActivitiesIdentifiers&&t.selectedActivitiesIdentifiers.length>0&&(this.selectedActivitiesIdentifiers=t.selectedActivitiesIdentifiers),this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),null!=t.invoicedWorkloadStartDate&&(this.invoicedWorkloadStartDate=new Date(t.invoicedWorkloadStartDate),this.minDate=this.invoicedWorkloadStartDate),null!=t.invoicedWorkloadEndDate&&(this.invoicedWorkloadEndDate=new Date(t.invoicedWorkloadEndDate),this.maxDate=this.invoicedWorkloadEndDate);else{this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId});var n=this.dateTimeService.today();n.getMonth()<6?(this.invoicedWorkloadStartDate=de([n.getFullYear(),0]).toDate(),this.invoicedWorkloadEndDate=de([n.getFullYear(),5]).toDate()):(this.invoicedWorkloadStartDate=de([n.getFullYear(),6]).toDate(),this.invoicedWorkloadEndDate=de([n.getFullYear(),11]).toDate()),this.minDate=this.invoicedWorkloadStartDate,this.maxDate=this.invoicedWorkloadEndDate}}},{key:"searchInvoicedWorkload",value:function(){this.searchFilterService.pageIndex=0,this.invoicedWorkloads=[],this.invoicedWorkloadsLength=0,this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),this.emptyResult=!0,this.listView=!1;var e=new u.Zs;e.selectedActivitiesIdentifiers=this.selectedActivitiesIdentifiers,e.invoicedWorkloadStartDate=this.invoicedWorkloadStartDate,e.invoicedWorkloadEndDate=this.invoicedWorkloadEndDate,sessionStorage.setItem("invoicedWorkloadSearch",JSON.stringify(e)),this.computeStartMonthandYear(),this.getInvoicedWorkload(this.selectedActivitiesIds,this.invoicedWorkloadStartDate,this.invoicedWorkloadEndDate)}},{key:"getInvoicedWorkload",value:function(e,t,n){var i=this;this.isLoading=!0,this.invoicedWorkloadService.getInvoicedWorkload(e,t,n).subscribe(function(e){null!=e&&(i.isLoading=!1,i.prepareInvoicedWorkloads(e),i.invoicedWorkloadsLength=i.invoicedWorkloads.length,0!==i.invoicedWorkloadsLength&&(i.emptyResult=!1,i.listView=!0))},function(){i.isLoading=!1,i.notificationService.danger("Workload not loaded.")})}},{key:"prepareInvoicedWorkloads",value:function(e){var t=this;e.forEach(function(e){var n=t.invoicedWorkloads.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId&&t.userId===e.userId});if(-1!==n)t.invoicedWorkloads[n]=t.prepareInvoicedWorkload(t.invoicedWorkloads[n],e);else{var i=t.createInvoicedWorkload(t.startMonth,t.startYear,t.monthsCount);t.invoicedWorkloads.push(t.prepareInvoicedWorkload(i,e))}})}},{key:"computeStartMonthandYear",value:function(){this.startMonth=this.invoicedWorkloadStartDate.getMonth(),this.startYear=this.invoicedWorkloadStartDate.getFullYear(),this.monthsCount=this.computeMonthsCount()}},{key:"computeMonthsCount",value:function(){var e;return e=12*(this.invoicedWorkloadEndDate.getFullYear()-this.invoicedWorkloadStartDate.getFullYear()),e-=this.invoicedWorkloadStartDate.getMonth(),e+=this.invoicedWorkloadEndDate.getMonth()+1}},{key:"prepareInvoicedWorkload",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=null===t.projectName?"No Recurrent Projects":t.projectName,e.projectActivityId=t.projectActivityId,e.userId=t.userId,e.userIdentifier=t.userIdentifier;var n=e.monthsInvoicedWorkload.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsInvoicedWorkload[n].invoicedMonthLoad=t.invoicedMonthLoad,e.monthsInvoicedWorkload[n].workloadId=t.workloadId),e}},{key:"createInvoicedWorkload",value:function(e,t,n){for(var i=new u.SP(n),o=0;o<n;o++)e+o<12?(i.monthsInvoicedWorkload[o].month=e+o+1,i.monthsInvoicedWorkload[o].year=t):(i.monthsInvoicedWorkload[o].month=e+o+1-12,i.monthsInvoicedWorkload[o].year=t+1);return i}},{key:"daysChangePeriodFrom",value:function(e){var t=new Date(e);this.invoicedWorkloadStartDate=de(t).startOf("month").toDate(),this.minDate=this.invoicedWorkloadStartDate,this.computeMonthsCount()>12&&(this.invoicedWorkloadEndDate=de([t.getFullYear(),t.getMonth()]).add(11,"months").endOf("month").toDate(),this.maxDate=this.invoicedWorkloadEndDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"daysChangePeriodTo",value:function(e){var t=new Date(e);this.invoicedWorkloadEndDate=de(t).endOf("month").toDate(),this.maxDate=this.invoicedWorkloadEndDate,this.computeMonthsCount()>12&&(this.invoicedWorkloadStartDate=de([t.getFullYear(),t.getMonth()]).add(-11,"months").startOf("month").toDate(),this.minDate=this.invoicedWorkloadStartDate,this.notificationService.warning("Period can not be more then 12 months!"))}},{key:"onActivityDeSelect",value:function(e){this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.id})}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(m.Injector))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-invoiced-workload"]],decls:35,vars:15,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","maxDate","daysChange"],[3,"selectedDate","minDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","settings","data","ngModel","disabled","onDeSelect","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"],[1,"navbar","navbar-light","bg-faded","m-b-10","p-10"],[1,"col-sm-12"],[3,"pageSize","pageIndex","length"],[4,"ngIf"],[1,"wrapper"],[1,"div-scrollable"],["class","overlay",4,"ngIf"],["class","loaded-content",3,"blurred",4,"ngIf"],[1,"overlay"],[1,"spinner-wrapper"],[1,"container"],["id","loader"],[1,"loaded-content"],[3,"invoicedWorkloads","invoicedWorkloadsFiltred","monthsCount"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Period"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-select-month",8),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodFrom(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",7),m.\u0275\u0275elementStart(14,"app-select-month",9),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodTo(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(15,"div",5),m.\u0275\u0275elementStart(16,"mat-list"),m.\u0275\u0275elementStart(17,"mat-list-item"),m.\u0275\u0275elementStart(18,"h3",6),m.\u0275\u0275text(19,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(20,"div",10),m.\u0275\u0275elementStart(21,"ng-multiselect-dropdown",11),m.\u0275\u0275listener("onDeSelect",function(e){return t.onActivityDeSelect(e)})("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(22,"div",12),m.\u0275\u0275elementStart(23,"div",13),m.\u0275\u0275elementStart(24,"div",14),m.\u0275\u0275elementStart(25,"button",15),m.\u0275\u0275listener("click",function(){return t.searchInvoicedWorkload()}),m.\u0275\u0275text(26,"Search"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(27,"nav",16),m.\u0275\u0275elementStart(28,"div",17),m.\u0275\u0275element(29,"app-paginator",18),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275template(30,jn,3,0,"div",19),m.\u0275\u0275elementStart(31,"div",20),m.\u0275\u0275elementStart(32,"div",21),m.\u0275\u0275template(33,wn,6,0,"div",22),m.\u0275\u0275template(34,Dn,3,9,"div",23),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("selectedDate",t.invoicedWorkloadStartDate)("maxDate",t.maxDate),m.\u0275\u0275advance(2),m.\u0275\u0275property("selectedDate",t.invoicedWorkloadEndDate)("minDate",t.minDate),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("settings",t.dropdownSettings)("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers)("disabled",!t.isSuperAdmin),m.\u0275\u0275advance(8),m.\u0275\u0275property("pageSize",t.searchFilterService.pageSize)("pageIndex",t.searchFilterService.pageIndex)("length",t.invoicedWorkloadsLength),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.emptyResult&&t.listView),m.\u0275\u0275advance(3),m.\u0275\u0275property("ngIf",t.isLoading),m.\u0275\u0275advance(1),m.\u0275\u0275property("ngIf",t.listView&&!t.emptyResult))},directives:[v.i$,v.Tg,ue.j,l.OP,b.NgControlStatus,b.NgModel,P.M2,E.J,r.NgIf,D.$g,An],pipes:[te.R],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.multi-search[_ngcontent-%COMP%]{width:100%}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}.div-scrollable[_ngcontent-%COMP%]{overflow-x:auto;overflow-y:auto;min-height:217px;max-height:calc(100vh - 342px)}.wrapper[_ngcontent-%COMP%]{width:100%;height:100%}.overlay[_ngcontent-%COMP%]{position:absolute;z-index:1002;background-color:#ffffff80;width:100%;height:100%}.spinner-wrapper[_ngcontent-%COMP%]{display:flex;justify-content:center;justify-items:center}#loader[_ngcontent-%COMP%]{bottom:0;height:175px;left:0;margin:auto;position:absolute;right:0;top:0;width:175px}"]}),t}(),data:{title:"Invoiced Workload",icon:"icon-home",function:c.FI.InvoicedWorkload,status:!0},canActivate:[d.a1]},{path:"profitability-project",component:Lt,data:{title:"Profitability Project",icon:"icon-home",function:c.FI.ProfitabilityProject,status:!0},canActivate:[d.a1]},{path:"analytics-reports",component:function(){var t=function(){function t(n){e(this,t),this.activitiesIdentifiers=[],this.selectedActivitiesIdentifiers=[],this.dropdownSettings={},this.analyticsResourcesGrouped=[],this.analyticsResourcesProjectsGrouped=[],this.analyticsProjectsGrouped=[],this.monthNames=["January ","February ","March ","April ","May ","June ","July ","August ","September ","October ","November ","December "],this.projectsIdentifiers=[],this.subColumnsNames=["Price \u20ac","Invoiced MD","Invoiced \u20ac"],this.projectService=n.get(p.Y4),this.analyticsReportsService=n.get(h.n9),this.analyticsResourceGroupService=n.get(h.Rr),this.analyticsResourceProjectGroupService=n.get(h.GF),this.analyticsProjectGroupService=n.get(h.Sm),this.dateTimeService=n.get(f.Cv),this.excelService=n.get(f.xB)}return n(t,[{key:"ngOnInit",value:function(){this.currentUser=JSON.parse(localStorage.getItem("currentUser")),this.getActivities(),this.dropdownSettings={singleSelection:!0,idField:"id",textField:"description",selectAllText:"Select All",unSelectAllText:"UnSelect All",itemsShowLimit:1,enableCheckAll:!1,allowSearchFilter:!1,maxHeight:150,placeholder:"criteria",searchPlaceholderText:"Search..."}}},{key:"getActivities",value:function(){var e=this;this.projectService.getActivities().subscribe(function(t){null!=t&&(e.activitiesIdentifiers=t),e.setSearchFilter()})}},{key:"setSearchFilter",value:function(){var e=this;this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.currentUser.activityId});var t=this.dateTimeService.today(),n=de([t.getFullYear(),t.getMonth()]).subtract(1,"months").toDate();this.daysChangePeriodTo(n)}},{key:"daysChangePeriodTo",value:function(e){var t=new Date(e);this.analyticsReportsStartDate=de(t).startOf("year").toDate(),this.analyticsReportsEndDate=de(t).endOf("month").toDate()}},{key:"onActivityDeSelect",value:function(e){this.selectedActivitiesIdentifiers=this.activitiesIdentifiers.filter(function(t){return t.id===e.id})}},{key:"exportAnalyticsReports",value:function(){this.analyticsResources=[],this.analyticsResourcesProjects=[],this.analyticsProjects=[],this.selectedActivitiesIds=this.selectedActivitiesIdentifiers.map(function(e){return e.id}).join(","),this.computeStartMonthAndYear(),this.getAnalyticsReports(this.selectedActivitiesIds,this.analyticsReportsStartDate,this.analyticsReportsEndDate)}},{key:"computeStartMonthAndYear",value:function(){this.startMonth=this.analyticsReportsStartDate.getMonth(),this.startYear=this.analyticsReportsStartDate.getFullYear(),this.computeMonthsCount()}},{key:"computeMonthsCount",value:function(){this.monthsCount=12*(this.analyticsReportsEndDate.getFullYear()-this.analyticsReportsStartDate.getFullYear()),this.monthsCount-=this.analyticsReportsStartDate.getMonth(),this.monthsCount+=this.analyticsReportsEndDate.getMonth()+1}},{key:"getAnalyticsReports",value:function(e,t,n){var i=this;this.analyticsReportsService.getAnalyticsReports(e,t,n).subscribe(function(e){null!=e&&(i.buildAnalyticsResources(e),i.buildAnalyticsResourcesProjects(e),i.buildAnalyticsProjects(e),i.exportAnalyticsReportsToExcel())})}},{key:"buildAnalyticsResources",value:function(e){if(this.prepareAnalyticsResources(e),void 0!==this.analyticsResources&&0!==this.analyticsResources.length){var t=this.analyticsResourceGroupService.getAnalyticsResourceGrouped(this.analyticsResources,this.analyticsResources,this.monthsCount);this.analyticsResourcesGrouped=JSON.parse(JSON.stringify(t))}}},{key:"prepareAnalyticsResources",value:function(e){var t=this;e.forEach(function(e){var n=t.analyticsResources.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId&&t.userId===e.userId});if(-1!==n)t.analyticsResources[n]=t.prepareAnalyticsResource(t.analyticsResources[n],e);else{var i=t.createAnalyticsResource(t.startMonth,t.startYear,t.monthsCount);t.analyticsResources.push(t.prepareAnalyticsResource(i,e))}t.getProjects(e)})}},{key:"getProjects",value:function(e){e&&e.projectName&&!this.projectsIdentifiers.find(function(t){return t.id===e.projectId})&&this.projectsIdentifiers.push({id:e.projectId,description:e.projectName})}},{key:"prepareAnalyticsResource",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=t.projectName,e.projectActivityId=t.projectActivityId,e.userId=t.userId,e.userNumber=t.userNumber,e.userFirstName=t.userFirstName,e.userLastName=t.userLastName;var n=e.monthsAnalyticsResource.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsAnalyticsResource[n].invoicedMonthPrice=t.invoicedMonthPrice,e.monthsAnalyticsResource[n].invoicedMonthLoad=t.invoicedMonthLoad,e.monthsAnalyticsResource[n].invoicedMonthAmount=t.invoicedMonthAmount,e.monthsAnalyticsResource[n].spentMonthAmount=t.spentMonthAmount),e}},{key:"createAnalyticsResource",value:function(e,t,n){for(var i=new u.du(n),o=0;o<n;o++)e+o<12?(i.monthsAnalyticsResource[o].month=e+o+1,i.monthsAnalyticsResource[o].year=t):(i.monthsAnalyticsResource[o].month=e+o+1-12,i.monthsAnalyticsResource[o].year=t+1);return i}},{key:"buildAnalyticsResourcesProjects",value:function(e){if(this.projectsCount=this.projectsIdentifiers.length,this.prepareAnalyticsResourcesProjects(e),this.analyticsResourcesProjects&&0!==this.analyticsResourcesProjects.length){var t=this.analyticsResourceProjectGroupService.getAnalyticsResourceProjectGrouped(this.analyticsResourcesProjects,this.analyticsResourcesProjects,this.projectsCount);this.analyticsResourcesProjectsGrouped=JSON.parse(JSON.stringify(t))}}},{key:"prepareAnalyticsResourcesProjects",value:function(e){var t=this;e.forEach(function(e){var n=t.analyticsResourcesProjects.findIndex(function(t){return t.activityId===e.activityId&&t.userId===e.userId});if(-1!==n)t.analyticsResourcesProjects[n]=t.prepareAnalyticsResourceProject(t.analyticsResourcesProjects[n],e);else{var i=t.createAnalyticsResourceProject(t.startYear,t.projectsCount);t.analyticsResourcesProjects.push(t.prepareAnalyticsResourceProject(i,e))}})}},{key:"prepareAnalyticsResourceProject",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.userId=t.userId,e.userNumber=t.userNumber,e.userFirstName=t.userFirstName,e.userLastName=t.userLastName;var n=e.projectsAnalyticsResourceProject.findIndex(function(e){return e.projectId===t.projectId&&e.year===t.year});return-1!==n&&(e.projectsAnalyticsResourceProject[n].invoicedProjectPrice=this.concatInvoicedResoucePrices(e.projectsAnalyticsResourceProject[n].invoicedProjectPrice,t.invoicedMonthPrice,t.invoicedMonthLoad),e.projectsAnalyticsResourceProject[n].invoicedProjectPrice=Array.from(new Set(e.projectsAnalyticsResourceProject[n].invoicedProjectPrice.split("#"))).join("#"),e.projectsAnalyticsResourceProject[n].invoicedProjectLoad+=t.invoicedMonthLoad,e.projectsAnalyticsResourceProject[n].invoicedProjectAmount+=t.invoicedMonthAmount),e}},{key:"concatInvoicedResoucePrices",value:function(e,t,n){return 0!==n&&(""===e?e=t.toString():e+="#"+t),e}},{key:"createAnalyticsResourceProject",value:function(e,t){for(var n=new u.SL(t),i=0;i<t;i++)n.projectsAnalyticsResourceProject[i].projectIndex=i,n.projectsAnalyticsResourceProject[i].projectId=this.projectsIdentifiers[i].id,n.projectsAnalyticsResourceProject[i].projectName=this.projectsIdentifiers[i].description,n.projectsAnalyticsResourceProject[i].year=e;return n}},{key:"buildAnalyticsProjects",value:function(e){if(this.prepareAnalyticsProjects(e),0!==this.analyticsProjects.length&&void 0!==this.analyticsProjects){var t=this.analyticsProjectGroupService.getAnalyticsProjectGrouped(this.analyticsProjects,this.analyticsProjects,this.monthsCount);this.analyticsProjectsGrouped=JSON.parse(JSON.stringify(t))}}},{key:"prepareAnalyticsProjects",value:function(e){var t=this;e.forEach(function(e){if(null!==e.projectId){var n=t.analyticsProjects.findIndex(function(t){return t.activityId===e.activityId&&t.projectId===e.projectId});if(-1!==n)t.analyticsProjects[n]=t.prepareAnalyticsProject(t.analyticsProjects[n],e);else{var i=t.createAnalyticsProject(t.startMonth,t.startYear,t.monthsCount);t.analyticsProjects.push(t.prepareAnalyticsProject(i,e))}}})}},{key:"prepareAnalyticsProject",value:function(e,t){e.activityId=t.activityId,e.activityName=t.activityName,e.projectId=t.projectId,e.projectName=t.projectName,e.projectActivityId=t.projectActivityId;var n=e.monthsAnalyticsProject.findIndex(function(e){return e.month===t.month&&e.year===t.year});return-1!==n&&(e.monthsAnalyticsProject[n].invoicedMonthAmount+=t.invoicedMonthAmount),e}},{key:"createAnalyticsProject",value:function(e,t,n){for(var i=new u.Ok(n),o=0;o<n;o++)e+o<12?(i.monthsAnalyticsProject[o].month=e+o+1,i.monthsAnalyticsProject[o].year=t):(i.monthsAnalyticsProject[o].month=e+o+1-12,i.monthsAnalyticsProject[o].year=t+1);return i}},{key:"exportAnalyticsReportsToExcel",value:function(){if(void 0!==this.analyticsResources&&0!==this.analyticsResources.length){var e="Analytics_Reports_"+this.selectedActivitiesIdentifiers[0].description+"_"+this.analyticsResourcesGrouped[0].monthsAnalyticsResource[0].year,t=[],n=this.fillAnalyticsResoucesExcelHeaderSheet();n=this.fillAnalyticsResoucesExcelBodySheet(n),t.push(n);var i=this.fillAnalyticsResoucesProjectsExcelHeaderSheet();i=this.fillAnalyticsResoucesProjectsExcelBodySheet(i),t.push(i);var o=this.fillAnalyticsProjectsExcelHeaderSheet();o=this.fillAnalyticsProjectsExcelBodySheet(o),t.push(o),this.excelService.generateExcelMultiSheets(t,e)}}},{key:"fillAnalyticsResoucesExcelHeaderSheet",value:function(){var e=this,t=[],n=[],i=[],o=[],r=this.subColumnsNames.length,a=0;t.push({header:"",key:"A",width:8}),t.push({header:"",key:"B",width:18}),t.push({header:"",key:"C",width:18});var l=["Matricule","First Name","Last Name"];return o.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}}),this.analyticsResourcesGrouped[0].monthsAnalyticsResource.forEach(function(n){e.subColumnsNames.forEach(function(i){t.push({header:void 0!==n.month?e.monthNames[n.month-1].toString()+" "+n.year.toString():"Total",key:i+n.monthIndex,width:12}),l.push(i)}),n.month||(l.push("Int Cost \u20ac"),a=1),i.push(e.getExcelColumn(4+r*n.monthIndex)+"1:"+e.getExcelColumn(3+r*(n.monthIndex+1)+a)+"1"),o.push({cell:e.getExcelColumn(4+r*n.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),o.push({cell:e.getExcelColumn(4+r*(n.monthIndex+1))+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});var s=0;e.subColumnsNames.forEach(function(){o.push({cell:e.getExcelColumn(4+r*n.monthIndex+s)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),s++})}),n.push(l),{header:t,rows:n,merges:i,styles:o,name:"Resources"}}},{key:"fillAnalyticsResoucesExcelBodySheet",value:function(e){var t=this,n=e.rows;return this.analyticsResourcesGrouped.forEach(function(e){if(e.level){var i=[];i.push(e.userNumber),i.push(e.userLastName),i.push(e.userFirstName),e.monthsAnalyticsResource.forEach(function(n){i.push(n.invoicedMonthPrice),i.push(t.formatNullValue(n.invoicedMonthLoad,e.level)),i.push(t.formatNullValue(n.invoicedMonthAmount,e.level)),n.month||i.push(t.formatNullValue(n.spentMonthAmount,e.level))}),n.push(i)}}),e}},{key:"fillAnalyticsResoucesProjectsExcelHeaderSheet",value:function(){var e=this,t=[],n=[],i=[],o=[],r=this.subColumnsNames.length;t.push({header:"",key:"A",width:8}),t.push({header:"",key:"B",width:18}),t.push({header:"",key:"C",width:18});var a=["Matricule","First Name","Last Name"];return o.push({cell:"A2",font:{bold:!0}},{cell:"B2",font:{bold:!0}},{cell:"C2",font:{bold:!0}}),this.analyticsResourcesProjectsGrouped[0].projectsAnalyticsResourceProject.forEach(function(n){e.subColumnsNames.forEach(function(i){t.push({header:void 0!==n.projectId?e.projectsIdentifiers[n.projectIndex].description.toString():"Total",key:i+n.projectIndex,width:12}),a.push(i)}),i.push(e.getExcelColumn(4+r*n.projectIndex)+"1:"+e.getExcelColumn(3+r*(n.projectIndex+1))+"1"),o.push({cell:e.getExcelColumn(4+r*n.projectIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),o.push({cell:e.getExcelColumn(4+r*(n.projectIndex+1))+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}});var l=0;e.subColumnsNames.forEach(function(){o.push({cell:e.getExcelColumn(4+r*n.projectIndex+l)+"2",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}}),l++})}),n.push(a),{header:t,rows:n,merges:i,styles:o,name:"ResourcesProjects"}}},{key:"fillAnalyticsResoucesProjectsExcelBodySheet",value:function(e){var t=this,n=e.rows;return this.analyticsResourcesProjectsGrouped.forEach(function(e){if(e.level){var i=[];i.push(e.userNumber),i.push(e.userLastName),i.push(e.userFirstName),e.projectsAnalyticsResourceProject.forEach(function(n){i.push(n.invoicedProjectPrice),i.push(t.formatNullValue(n.invoicedProjectLoad,e.level)),i.push(t.formatNullValue(n.invoicedProjectAmount,e.level))}),n.push(i)}}),e}},{key:"fillAnalyticsProjectsExcelHeaderSheet",value:function(){var e=this,t=[],n=[];return t.push({header:"Projects "+this.analyticsResourcesGrouped[0].activityName+" "+this.analyticsResourcesGrouped[0].monthsAnalyticsResource[0].year,key:"A",width:27}),n.push({cell:"A1",font:{bold:!0}}),this.analyticsResourcesGrouped[0].monthsAnalyticsResource.forEach(function(i){t.push({header:void 0!==i.month?e.monthNames[i.month-1].toString()+" "+i.year.toString():"Total",key:void 0!==i.month?e.monthNames[i.month-1].toString():"Total",width:15}),n.push({cell:e.getExcelColumn(2+i.monthIndex)+"1",font:{bold:!0},alignment:{vertical:"middle",horizontal:"center"}})}),{header:t,rows:[],merges:[],styles:n,name:"Projects"}}},{key:"fillAnalyticsProjectsExcelBodySheet",value:function(e){var t=this,n=e.rows;return this.analyticsProjectsGrouped.forEach(function(e){if(e.level){var i=[];i.push(e.projectName),e.monthsAnalyticsProject.forEach(function(n){i.push(t.formatNullValue(n.invoicedMonthAmount,e.level))}),n.push(i)}}),e}},{key:"formatNullValue",value:function(e,t){return 1!==t&&null===e?0:e}},{key:"getExcelColumn",value:function(e){var t=26,n=e%t==0?Math.floor(e/t)-1:Math.floor(e/t),i=e%t==0?t:e%t;return e<=t?String.fromCharCode(i+64):String.fromCharCode(n+64)+String.fromCharCode(i+64)}}]),t}();return t.\u0275fac=function(e){return new(e||t)(m.\u0275\u0275directiveInject(m.Injector))},t.\u0275cmp=m.\u0275\u0275defineComponent({type:t,selectors:[["app-analytics-reports"]],decls:25,vars:5,consts:[[1,"page-body"],[1,"row"],[1,"col-xl-12","col-lg-12","filter-bar"],[1,"card","m-b-10"],[1,"card-body","p-t-10"],[1,"col-xl-4","col-lg-12"],[1,"mat-subheader","col-sm-2"],[1,"search-input","col-sm-5"],[3,"selectedDate","daysChange"],[1,"col-sm-10"],[1,"multi-search",2,"width","120%",3,"placeholder","settings","data","ngModel","onDeSelect","ngModelChange"],[1,"col-xl-3","col-lg-12"],[1,"col-xl-1","col-lg-12"],[1,"text-center"],[1,"btn","btn-md","btn-primary","ripple","m-t-5",3,"click"]],template:function(e,t){1&e&&(m.\u0275\u0275elementStart(0,"div",0),m.\u0275\u0275elementStart(1,"div",1),m.\u0275\u0275elementStart(2,"div",2),m.\u0275\u0275elementStart(3,"div",3),m.\u0275\u0275elementStart(4,"div",4),m.\u0275\u0275elementStart(5,"div",1),m.\u0275\u0275elementStart(6,"div",5),m.\u0275\u0275elementStart(7,"mat-list"),m.\u0275\u0275elementStart(8,"mat-list-item"),m.\u0275\u0275elementStart(9,"h3",6),m.\u0275\u0275text(10,"Period"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(11,"div",7),m.\u0275\u0275elementStart(12,"app-select-month",8),m.\u0275\u0275listener("daysChange",function(e){return t.daysChangePeriodTo(e)}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(13,"div",5),m.\u0275\u0275elementStart(14,"mat-list"),m.\u0275\u0275elementStart(15,"mat-list-item"),m.\u0275\u0275elementStart(16,"h3",6),m.\u0275\u0275text(17,"Activity"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementStart(18,"div",9),m.\u0275\u0275elementStart(19,"ng-multiselect-dropdown",10),m.\u0275\u0275listener("onDeSelect",function(e){return t.onActivityDeSelect(e)})("ngModelChange",function(e){return t.selectedActivitiesIdentifiers=e}),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275element(20,"div",11),m.\u0275\u0275elementStart(21,"div",12),m.\u0275\u0275elementStart(22,"div",13),m.\u0275\u0275elementStart(23,"button",14),m.\u0275\u0275listener("click",function(){return t.exportAnalyticsReports()}),m.\u0275\u0275text(24,"Export"),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd(),m.\u0275\u0275elementEnd()),2&e&&(m.\u0275\u0275advance(12),m.\u0275\u0275property("selectedDate",t.analyticsReportsEndDate),m.\u0275\u0275advance(7),m.\u0275\u0275property("placeholder","Select...")("settings",t.dropdownSettings)("data",t.activitiesIdentifiers)("ngModel",t.selectedActivitiesIdentifiers))},directives:[v.i$,v.Tg,ue.j,l.OP,b.NgControlStatus,b.NgModel],styles:[".search-input[_ngcontent-%COMP%]{font-size:14px}.mat-list[_ngcontent-%COMP%]   .mat-subheader[_ngcontent-%COMP%]{height:40px;padding:0 5px;font-size:15px;font-weight:bolder}"]}),t}(),data:{title:"Analytics Reports",icon:"icon-home",function:c.FI.AnalyticsReports,status:!0},canActivate:[d.a1]}]}],Ln=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=m.\u0275\u0275defineInjector({imports:[[s.Bz.forChild(Rn)],s.Bz]}),t}(),Nn=o(36332),Fn=o(90171),On=function(){var t=function t(){e(this,t)};return t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=m.\u0275\u0275defineNgModule({type:t}),t.\u0275inj=m.\u0275\u0275defineInjector({providers:[h.VK,h.zc,f.nJ,h.LH,h.Bt,h.Iv,h.UN,h.jE,h.$M,h.n9,h.Rr,h.GF,h.Sm],imports:[[r.CommonModule,a.m,l.ZQ.forRoot(),Ln,Nn.o,Fn.To]]}),t}()},72172:function(t,i,o){o.d(i,{z:function(){return l}});var r,a=o(37716),l=((r=function(){function t(){e(this,t)}return n(t,[{key:"blockPaste",value:function(e){for(var t=e.clipboardData.getData("text"),n=0,i=!1;n<t.length&&!0!==i;)this.isNotNumber(t[n].charCodeAt())?(i=!0,e.preventDefault()):n++}},{key:"onKeydownHandler",value:function(e){var t=e.key;void 0!==t&&(this.isNotNumber(t.charCodeAt())&&"Backspace"!==t&&"Delete"!==t&&"ArrowLeft"!==t&&"ArrowRight"!==t&&"Tab"!==t&&e.preventDefault(),null!=this.inputValue&&(-1!==this.inputValue.toString().indexOf(".")||-1!==this.inputValue.toString().indexOf(","))&&(46===t.charCodeAt()||44===t.charCodeAt())&&e.preventDefault())}},{key:"isNotNumber",value:function(e){return e<44||e>57||45===e||47===e}}]),t}()).\u0275fac=function(e){return new(e||r)},r.\u0275dir=a.\u0275\u0275defineDirective({type:r,selectors:[["","appNumberValidator",""]],hostBindings:function(e,t){1&e&&a.\u0275\u0275listener("paste",function(e){return t.blockPaste(e)})("keydown",function(e){return t.onKeydownHandler(e)})},inputs:{inputValue:"inputValue"}}),r)},55750:function(e,t,n){n.d(t,{Ry:function(){return i.R}});var i=n(34239);n(62758)},34239:function(t,i,o){o.d(i,{R:function(){return s}});var r,a=o(37716),l=o(10337),s=((r=function(){function t(n){e(this,t),this.searchFilterService=n}return n(t,[{key:"transform",value:function(e,t,n){if(this.startIndex=t*(n*this.searchFilterService.rowSpan)+1,this.endIndex=n*this.searchFilterService.rowSpan*(t+1),null!=e)return this.searchFilterService.showingDataLastFilter=e.slice(this.startIndex-1,this.endIndex),this.searchFilterService.resultChanged.next(),e.slice(this.startIndex-1,this.endIndex)}}]),t}()).\u0275fac=function(e){return new(e||r)(a.\u0275\u0275directiveInject(l.nJ,16))},r.\u0275pipe=a.\u0275\u0275definePipe({name:"paginator",type:r,pure:!0}),r)},62758:function(t,i,o){o.d(i,{M:function(){return s}});var r,a=o(37716),l=o(10337),s=((r=function(){function t(n){e(this,t),this.dtService=n}return n(t,[{key:"transform",value:function(e,t){return null==e||"0001-01-01T00:00:00"===e?"":"day"===t?this.dtService.getShortFormatWithDay(e):this.dtService.getShortFormat(e)}}]),t}()).\u0275fac=function(e){return new(e||r)(a.\u0275\u0275directiveInject(l.Cv,16))},r.\u0275pipe=a.\u0275\u0275definePipe({name:"shortDate",type:r,pure:!0}),r)},39924:function(t,i,o){o.d(i,{J:function(){return v}});var r=o(37716),a=o(99692),l=o(10337),s=o(98295),c=o(67441),d=o(3679),u=o(38583),m=o(72458);function h(e,t){if(1&e&&(r.\u0275\u0275elementStart(0,"mat-option",6),r.\u0275\u0275text(1),r.\u0275\u0275elementEnd()),2&e){var n=t.$implicit;r.\u0275\u0275property("value",n),r.\u0275\u0275advance(1),r.\u0275\u0275textInterpolate(n)}}var p,f=function(){return[6,12,24,60,120]},v=((p=function(){function t(n){e(this,t),this.searchFilterService=n,this.disabled=!1,this.hidePageSize=!1,this.showFirstLastButtons=!1,this.page=new r.EventEmitter}return n(t,[{key:"pageIndexChanged",set:function(e){this.pageIndex=e,this.updateGoto()}},{key:"lengthChanged",set:function(e){this.length=e,this.updateGoto()}},{key:"pageSizeChanged",set:function(e){this.pageSize=e,this.updateGoto()}},{key:"ngOnInit",value:function(){this.updateGoto()}},{key:"onPaginateChange",value:function(e){this.searchFilterService.pageIndex=e.pageIndex,this.searchFilterService.pageSize=e.pageSize,this.length=e.length,this.pageIndex=e.pageIndex,this.pageSize=e.pageSize,this.updateGoto(),this.emitPageEvent(e)}},{key:"updateGoto",value:function(){this.goTo=(this.pageIndex||0)+1,this.pageNumbers=[];for(var e=Math.ceil(this.length/this.pageSize),t=1;t<=e;t++)this.pageNumbers.push(t)}},{key:"goToChange",value:function(){this.paginator.pageIndex=this.goTo-1,this.searchFilterService.pageIndex=this.paginator.pageIndex,this.searchFilterService.pageSize=this.paginator.pageSize,this.emitPageEvent({length:this.paginator.length,pageIndex:this.paginator.pageIndex,pageSize:this.paginator.pageSize})}},{key:"emitPageEvent",value:function(e){this.page.next(e)}}]),t}()).\u0275fac=function(e){return new(e||p)(r.\u0275\u0275directiveInject(l.nJ))},p.\u0275cmp=r.\u0275\u0275defineComponent({type:p,selectors:[["app-paginator"]],viewQuery:function(e,t){var n;1&e&&r.\u0275\u0275viewQuery(a.NW,7),2&e&&r.\u0275\u0275queryRefresh(n=r.\u0275\u0275loadQuery())&&(t.paginator=n.first)},inputs:{length:"length",pageIndex:"pageIndex",pageSize:"pageSize",disabled:"disabled",hidePageSize:"hidePageSize",pageSizeOptions:"pageSizeOptions",showFirstLastButtons:"showFirstLastButtons",pageIndexChanged:["pageIndex","pageIndexChanged"],lengthChanged:["length","lengthChanged"],pageSizeChanged:["pageSize","pageSizeChanged"]},outputs:{page:"page"},decls:8,vars:8,consts:[[1,"d-flex"],[3,"length","pageSize","pageIndex","pageSizeOptions","showFirstLastButtons","page"],[1,"go-to-container"],[1,"go-to-label"],[3,"ngModel","ngModelChange","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(e,t){1&e&&(r.\u0275\u0275elementStart(0,"div",0),r.\u0275\u0275elementStart(1,"mat-paginator",1),r.\u0275\u0275listener("page",function(e){return t.onPaginateChange(e)}),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(2,"div",2),r.\u0275\u0275elementStart(3,"div",3),r.\u0275\u0275text(4,"Go To: "),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementStart(5,"mat-form-field"),r.\u0275\u0275elementStart(6,"mat-select",4),r.\u0275\u0275listener("ngModelChange",function(e){return t.goTo=e})("selectionChange",function(){return t.goToChange()}),r.\u0275\u0275template(7,h,2,2,"mat-option",5),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd(),r.\u0275\u0275elementEnd()),2&e&&(r.\u0275\u0275advance(1),r.\u0275\u0275property("length",t.length)("pageSize",t.pageSize)("pageIndex",t.pageIndex)("pageSizeOptions",r.\u0275\u0275pureFunction0(7,f))("showFirstLastButtons",!0),r.\u0275\u0275advance(5),r.\u0275\u0275property("ngModel",t.goTo),r.\u0275\u0275advance(1),r.\u0275\u0275property("ngForOf",t.pageNumbers))},directives:[a.NW,s.KE,c.gD,d.NgControlStatus,d.NgModel,u.NgForOf,m.ey],styles:['.mat-paginator[_ngcontent-%COMP%]{width:100%;float:right}.d-flex[_ngcontent-%COMP%]{display:flex}  .mat-select-trigger{font-size:12px}  .mat-option{font-size:12px}.go-to-container[_ngcontent-%COMP%]{display:flex;align-items:baseline;background:white}.go-to-container[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]{width:56px;margin:6px 4px 0;font-size:12px;font-family:Roboto,"Helvetica Neue",sans-serif}.go-to-container[_ngcontent-%COMP%]   .go-to-label[_ngcontent-%COMP%]{width:36px;margin:0 4px;font-size:12px;color:#0000008a;font-family:Roboto,"Helvetica Neue",sans-serif}']}),p)}}])}();